
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Focus NFe API v2</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;shell&quot;,&quot;php&quot;,&quot;java&quot;,&quot;ruby&quot;,&quot;python&quot;,&quot;javascript&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-branca.png" class="logo" alt="Logo branca" />
        <div class="lang-selector">
              <a href="#" data-language-name="shell">shell</a>
              <a href="#" data-language-name="php">php</a>
              <a href="#" data-language-name="java">java</a>
              <a href="#" data-language-name="ruby">ruby</a>
              <a href="#" data-language-name="python">python</a>
              <a href="#" data-language-name="javascript">javascript</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Buscar">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#introducao_introducao" class="toc-h1 toc-link" data-title="introducao">Introdução</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#introducao_como-ler-este-documento" class="toc-h2 toc-link" data-title="como-ler-este-documento">Como ler este documento?</a>
                  </li>
                  <li>
                    <a href="#introducao_qual-documento-fiscal-voce-precisa-emitir" class="toc-h2 toc-link" data-title="qual-documento-fiscal-voce-precisa-emitir">Qual documento fiscal você precisa emitir?</a>
                  </li>
                  <li>
                    <a href="#introducao_visao-geral-do-processo-de-emissao-de-um-documento" class="toc-h2 toc-link" data-title="visao-geral-do-processo-de-emissao-de-um-documento">Visão geral do processo de emissão de um documento</a>
                  </li>
                  <li>
                    <a href="#introducao_autenticacao" class="toc-h2 toc-link" data-title="autenticacao">Autenticação</a>
                  </li>
                  <li>
                    <a href="#introducao_referencia" class="toc-h2 toc-link" data-title="referencia">Referência</a>
                  </li>
                  <li>
                    <a href="#introducao_ambiente" class="toc-h2 toc-link" data-title="ambiente">Ambiente</a>
                  </li>
                  <li>
                    <a href="#introducao_padrao-rest" class="toc-h2 toc-link" data-title="padrao-rest">Padrão REST</a>
                  </li>
                  <li>
                    <a href="#introducao_erros" class="toc-h2 toc-link" data-title="erros">Erros</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#nfe_nfe" class="toc-h1 toc-link" data-title="nfe">NFe</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#nfe_urls" class="toc-h2 toc-link" data-title="urls">URLs</a>
                  </li>
                  <li>
                    <a href="#nfe_campos-obrigatorios-de-uma-nfe" class="toc-h2 toc-link" data-title="campos-obrigatorios-de-uma-nfe">Campos obrigatórios de uma NFe</a>
                  </li>
                  <li>
                    <a href="#nfe_status-api" class="toc-h2 toc-link" data-title="status-api">Status API</a>
                  </li>
                  <li>
                    <a href="#nfe_envio" class="toc-h2 toc-link" data-title="envio">Envio</a>
                  </li>
                  <li>
                    <a href="#nfe_consulta" class="toc-h2 toc-link" data-title="consulta">Consulta</a>
                  </li>
                  <li>
                    <a href="#nfe_cancelamento" class="toc-h2 toc-link" data-title="cancelamento">Cancelamento</a>
                  </li>
                  <li>
                    <a href="#nfe_carta-de-correcao-eletronica" class="toc-h2 toc-link" data-title="carta-de-correcao-eletronica">Carta de Correção Eletrônica</a>
                  </li>
                  <li>
                    <a href="#nfe_reenvio-de-e-mail" class="toc-h2 toc-link" data-title="reenvio-de-e-mail">Reenvio de e-mail</a>
                  </li>
                  <li>
                    <a href="#nfe_inutilizacao" class="toc-h2 toc-link" data-title="inutilizacao">Inutilização</a>
                  </li>
                  <li>
                    <a href="#nfe_outras-documentacoes" class="toc-h2 toc-link" data-title="outras-documentacoes">Outras documentações</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#nfce_nfce" class="toc-h1 toc-link" data-title="nfce">NFCe</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#nfce_urls" class="toc-h2 toc-link" data-title="urls">URLs</a>
                  </li>
                  <li>
                    <a href="#nfce_campos-obrigatorios-de-uma-nfce" class="toc-h2 toc-link" data-title="campos-obrigatorios-de-uma-nfce">Campos obrigatórios de uma NFCe</a>
                  </li>
                  <li>
                    <a href="#nfce_status-api" class="toc-h2 toc-link" data-title="status-api">Status API</a>
                  </li>
                  <li>
                    <a href="#nfce_envio" class="toc-h2 toc-link" data-title="envio">Envio</a>
                  </li>
                  <li>
                    <a href="#nfce_consulta" class="toc-h2 toc-link" data-title="consulta">Consulta</a>
                  </li>
                  <li>
                    <a href="#nfce_cancelamento" class="toc-h2 toc-link" data-title="cancelamento">Cancelamento</a>
                  </li>
                  <li>
                    <a href="#nfce_inutilizacao" class="toc-h2 toc-link" data-title="inutilizacao">Inutilização</a>
                  </li>
                  <li>
                    <a href="#nfce_reenvio-de-e-mail" class="toc-h2 toc-link" data-title="reenvio-de-e-mail">Reenvio de e-mail</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#enviador-de-arquivos-s-t-nfce_enviador-de-arquivos-s-t-nfce" class="toc-h1 toc-link" data-title="enviador-de-arquivos-s-t-nfce">Enviador de Arquivos S@T / NFCe</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#enviador-de-arquivos-s-t-nfce_visao-geral" class="toc-h2 toc-link" data-title="visao-geral">Visão Geral</a>
                  </li>
                  <li>
                    <a href="#enviador-de-arquivos-s-t-nfce_documentos-suportados" class="toc-h2 toc-link" data-title="documentos-suportados">Documentos Suportados</a>
                  </li>
                  <li>
                    <a href="#enviador-de-arquivos-s-t-nfce_cfe-s-t" class="toc-h2 toc-link" data-title="cfe-s-t">CFe S@T</a>
                  </li>
                  <li>
                    <a href="#enviador-de-arquivos-s-t-nfce_nfce" class="toc-h2 toc-link" data-title="nfce">NFCe</a>
                  </li>
                  <li>
                    <a href="#enviador-de-arquivos-s-t-nfce_cfe-mfe" class="toc-h2 toc-link" data-title="cfe-mfe">CFe MFe</a>
                  </li>
                  <li>
                    <a href="#enviador-de-arquivos-s-t-nfce_api-local" class="toc-h2 toc-link" data-title="api-local">API Local</a>
                  </li>
                  <li>
                    <a href="#enviador-de-arquivos-s-t-nfce_download" class="toc-h2 toc-link" data-title="download">Download</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#nfse_nfse" class="toc-h1 toc-link" data-title="nfse">NFSe</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#nfse_urls" class="toc-h2 toc-link" data-title="urls">URLs</a>
                  </li>
                  <li>
                    <a href="#nfse_campos" class="toc-h2 toc-link" data-title="campos">Campos</a>
                  </li>
                  <li>
                    <a href="#nfse_status-api" class="toc-h2 toc-link" data-title="status-api">Status API</a>
                  </li>
                  <li>
                    <a href="#nfse_envio" class="toc-h2 toc-link" data-title="envio">Envio</a>
                  </li>
                  <li>
                    <a href="#nfse_consulta" class="toc-h2 toc-link" data-title="consulta">Consulta</a>
                  </li>
                  <li>
                    <a href="#nfse_cancelamento" class="toc-h2 toc-link" data-title="cancelamento">Cancelamento</a>
                  </li>
                  <li>
                    <a href="#nfse_reenvio-de-email" class="toc-h2 toc-link" data-title="reenvio-de-email">Reenvio de email</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#emissao-nfse-por-arquivo_emissao-nfse-por-arquivo" class="toc-h1 toc-link" data-title="emissao-nfse-por-arquivo">Emissão NFSe por arquivo</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#emissao-nfse-por-arquivo_envio" class="toc-h2 toc-link" data-title="envio">Envio</a>
                  </li>
                  <li>
                    <a href="#emissao-nfse-por-arquivo_consulta" class="toc-h2 toc-link" data-title="consulta">Consulta</a>
                  </li>
                  <li>
                    <a href="#emissao-nfse-por-arquivo_resposta-opcional" class="toc-h2 toc-link" data-title="resposta-opcional">Resposta (opcional)</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#nfses-recebidas-beta_nfses-recebidas-beta" class="toc-h1 toc-link" data-title="nfses-recebidas-beta">NFSes recebidas (beta)</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#nfses-recebidas-beta_urls" class="toc-h2 toc-link" data-title="urls">URLs</a>
                  </li>
                  <li>
                    <a href="#nfses-recebidas-beta_status-api" class="toc-h2 toc-link" data-title="status-api">Status API</a>
                  </li>
                  <li>
                    <a href="#nfses-recebidas-beta_consulta-de-nfse-recebidas" class="toc-h2 toc-link" data-title="consulta-de-nfse-recebidas">Consulta de NFSe Recebidas</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#cte-e-cte-os_cte-e-cte-os" class="toc-h1 toc-link" data-title="cte-e-cte-os">CTe e CTe OS</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#cte-e-cte-os_urls" class="toc-h2 toc-link" data-title="urls">URLs</a>
                  </li>
                  <li>
                    <a href="#cte-e-cte-os_campos-de-um-cte" class="toc-h2 toc-link" data-title="campos-de-um-cte">Campos de um CTe</a>
                  </li>
                  <li>
                    <a href="#cte-e-cte-os_status-api" class="toc-h2 toc-link" data-title="status-api">Status API</a>
                  </li>
                  <li>
                    <a href="#cte-e-cte-os_envio" class="toc-h2 toc-link" data-title="envio">Envio</a>
                  </li>
                  <li>
                    <a href="#cte-e-cte-os_consulta" class="toc-h2 toc-link" data-title="consulta">Consulta</a>
                  </li>
                  <li>
                    <a href="#cte-e-cte-os_cancelamento" class="toc-h2 toc-link" data-title="cancelamento">Cancelamento</a>
                  </li>
                  <li>
                    <a href="#cte-e-cte-os_carta-de-correcao-eletronica" class="toc-h2 toc-link" data-title="carta-de-correcao-eletronica">Carta de Correção Eletrônica</a>
                  </li>
                  <li>
                    <a href="#cte-e-cte-os_inutilizacao" class="toc-h2 toc-link" data-title="inutilizacao">Inutilização</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#mdf-e-beta_mdf-e-beta" class="toc-h1 toc-link" data-title="mdf-e-beta">MDF-e (beta)</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#mdf-e-beta_urls" class="toc-h2 toc-link" data-title="urls">URLs</a>
                  </li>
                  <li>
                    <a href="#mdf-e-beta_campos-de-um-mdf-e" class="toc-h2 toc-link" data-title="campos-de-um-mdf-e">Campos de um MDF-e</a>
                  </li>
                  <li>
                    <a href="#mdf-e-beta_status-api" class="toc-h2 toc-link" data-title="status-api">Status API</a>
                  </li>
                  <li>
                    <a href="#mdf-e-beta_envio" class="toc-h2 toc-link" data-title="envio">Envio</a>
                  </li>
                  <li>
                    <a href="#mdf-e-beta_consulta" class="toc-h2 toc-link" data-title="consulta">Consulta</a>
                  </li>
                  <li>
                    <a href="#mdf-e-beta_cancelamento" class="toc-h2 toc-link" data-title="cancelamento">Cancelamento</a>
                  </li>
                  <li>
                    <a href="#mdf-e-beta_inclusao-de-condutor" class="toc-h2 toc-link" data-title="inclusao-de-condutor">Inclusão de Condutor</a>
                  </li>
                  <li>
                    <a href="#mdf-e-beta_encerramento" class="toc-h2 toc-link" data-title="encerramento">Encerramento</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#manifestacao-nfe_manifestacao-nfe" class="toc-h1 toc-link" data-title="manifestacao-nfe">Manifestação - NFe</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#manifestacao-nfe_urls" class="toc-h2 toc-link" data-title="urls">URLs</a>
                  </li>
                  <li>
                    <a href="#manifestacao-nfe_status-api" class="toc-h2 toc-link" data-title="status-api">Status API</a>
                  </li>
                  <li>
                    <a href="#manifestacao-nfe_manifestacao" class="toc-h2 toc-link" data-title="manifestacao">Manifestação</a>
                  </li>
                  <li>
                    <a href="#manifestacao-nfe_consulta-de-nfe-recebidas" class="toc-h2 toc-link" data-title="consulta-de-nfe-recebidas">Consulta de NFe Recebidas</a>
                  </li>
                  <li>
                    <a href="#manifestacao-nfe_consulta-de-nfe-individuais" class="toc-h2 toc-link" data-title="consulta-de-nfe-individuais">Consulta de NFe individuais</a>
                  </li>
                  <li>
                    <a href="#manifestacao-nfe_download-de-xml" class="toc-h2 toc-link" data-title="download-de-xml">Download de XML</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#manifestacao-cte-beta_manifestacao-cte-beta" class="toc-h1 toc-link" data-title="manifestacao-cte-beta">Manifestação - CTe (beta)</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#manifestacao-cte-beta_urls" class="toc-h2 toc-link" data-title="urls">URLs</a>
                  </li>
                  <li>
                    <a href="#manifestacao-cte-beta_status-api" class="toc-h2 toc-link" data-title="status-api">Status API</a>
                  </li>
                  <li>
                    <a href="#manifestacao-cte-beta_informar-desacordo" class="toc-h2 toc-link" data-title="informar-desacordo">Informar desacordo</a>
                  </li>
                  <li>
                    <a href="#manifestacao-cte-beta_consulta-de-cte-recebidas" class="toc-h2 toc-link" data-title="consulta-de-cte-recebidas">Consulta de CTe Recebidas</a>
                  </li>
                  <li>
                    <a href="#manifestacao-cte-beta_consulta-de-cte-individuais" class="toc-h2 toc-link" data-title="consulta-de-cte-individuais">Consulta de CTe individuais</a>
                  </li>
                  <li>
                    <a href="#manifestacao-cte-beta_download-de-xml" class="toc-h2 toc-link" data-title="download-de-xml">Download de XML</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#backups-nfe-nfce-e-cte_backups-nfe-nfce-e-cte" class="toc-h1 toc-link" data-title="backups-nfe-nfce-e-cte">Backups (NFe, NFCe e CTe)</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#backups-nfe-nfce-e-cte_momentos-de-geracao-e-cuidados-necessarios" class="toc-h2 toc-link" data-title="momentos-de-geracao-e-cuidados-necessarios">Momentos de geração e cuidados necessários</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#gatilhos-webhooks_gatilhos-webhooks" class="toc-h1 toc-link" data-title="gatilhos-webhooks">Gatilhos / Webhooks</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#gatilhos-webhooks_informacoes-gerais" class="toc-h2 toc-link" data-title="informacoes-gerais">Informações gerais</a>
                  </li>
                  <li>
                    <a href="#gatilhos-webhooks_status-api" class="toc-h2 toc-link" data-title="status-api">Status API</a>
                  </li>
                  <li>
                    <a href="#gatilhos-webhooks_eventos" class="toc-h2 toc-link" data-title="eventos">Eventos</a>
                  </li>
                  <li>
                    <a href="#gatilhos-webhooks_criacao" class="toc-h2 toc-link" data-title="criacao">Criação</a>
                  </li>
                  <li>
                    <a href="#gatilhos-webhooks_consulta" class="toc-h2 toc-link" data-title="consulta">Consulta</a>
                  </li>
                  <li>
                    <a href="#gatilhos-webhooks_exclusao" class="toc-h2 toc-link" data-title="exclusao">Exclusão</a>
                  </li>
                  <li>
                    <a href="#gatilhos-webhooks_teste-e-reenvio-de-notificacoes" class="toc-h2 toc-link" data-title="teste-e-reenvio-de-notificacoes">Teste e reenvio de notificações</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#consulta-de-emails_consulta-de-emails" class="toc-h1 toc-link" data-title="consulta-de-emails">Consulta de emails</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#consulta-de-emails_urls" class="toc-h2 toc-link" data-title="urls">URLs</a>
                  </li>
                  <li>
                    <a href="#consulta-de-emails_consulta-de-email-bloqueado" class="toc-h2 toc-link" data-title="consulta-de-email-bloqueado">Consulta de email bloqueado</a>
                  </li>
                  <li>
                    <a href="#consulta-de-emails_solicitacao-de-exclusao-de-email-bloqueado" class="toc-h2 toc-link" data-title="solicitacao-de-exclusao-de-email-bloqueado">Solicitação de exclusão de email bloqueado</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#consulta-de-ncm_consulta-de-ncm" class="toc-h1 toc-link" data-title="consulta-de-ncm">Consulta de NCM</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#consulta-de-ncm_paginacao" class="toc-h2 toc-link" data-title="paginacao">Paginação</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#consulta-de-cfop_consulta-de-cfop" class="toc-h1 toc-link" data-title="consulta-de-cfop">Consulta de CFOP</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#consulta-de-cfop_paginacao" class="toc-h2 toc-link" data-title="paginacao">Paginação</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#consulta-de-cep-beta_consulta-de-cep-beta" class="toc-h1 toc-link" data-title="consulta-de-cep-beta">Consulta de CEP (beta)</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#consulta-de-cep-beta_resposta-da-api" class="toc-h2 toc-link" data-title="resposta-da-api">Resposta da API</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#consulta-de-cnae_consulta-de-cnae" class="toc-h1 toc-link" data-title="consulta-de-cnae">Consulta de CNAE</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#consulta-de-cnae_resposta-da-api" class="toc-h2 toc-link" data-title="resposta-da-api">Resposta da API</a>
                  </li>
                  <li>
                    <a href="#consulta-de-cnae_paginacao" class="toc-h2 toc-link" data-title="paginacao">Paginação</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#consulta-de-municipios_consulta-de-municipios" class="toc-h1 toc-link" data-title="consulta-de-municipios">Consulta de Municípios</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#consulta-de-municipios_resposta-da-api" class="toc-h2 toc-link" data-title="resposta-da-api">Resposta da API</a>
                  </li>
                  <li>
                    <a href="#consulta-de-municipios_paginacao" class="toc-h2 toc-link" data-title="paginacao">Paginação</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#revenda_revenda" class="toc-h1 toc-link" data-title="revenda">Revenda</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#revenda_urls" class="toc-h2 toc-link" data-title="urls">URLs</a>
                  </li>
                  <li>
                    <a href="#revenda_campos" class="toc-h2 toc-link" data-title="campos">Campos</a>
                  </li>
                  <li>
                    <a href="#revenda_criacao-de-empresa" class="toc-h2 toc-link" data-title="criacao-de-empresa">Criação de empresa</a>
                  </li>
                  <li>
                    <a href="#revenda_consulta-de-empresas" class="toc-h2 toc-link" data-title="consulta-de-empresas">Consulta de empresas</a>
                  </li>
                  <li>
                    <a href="#revenda_alteracao-de-empresa" class="toc-h2 toc-link" data-title="alteracao-de-empresa">Alteração de empresa</a>
                  </li>
                  <li>
                    <a href="#revenda_listagem-de-empresas" class="toc-h2 toc-link" data-title="listagem-de-empresas">Listagem de empresas</a>
                  </li>
                  <li>
                    <a href="#revenda_paginacao" class="toc-h2 toc-link" data-title="paginacao">Paginação</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#limite-de-requisicoes_limite-de-requisicoes" class="toc-h1 toc-link" data-title="limite-de-requisicoes">Limite de requisições</a>
          </li>
          <li>
            <a href="#bibliotecas-externas_bibliotecas-externas" class="toc-h1 toc-link" data-title="bibliotecas-externas">Bibliotecas externas</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#bibliotecas-externas_java" class="toc-h2 toc-link" data-title="java">Java</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#codigos-de-exemplo-no-github_codigos-de-exemplo-no-github" class="toc-h1 toc-link" data-title="codigos-de-exemplo-no-github">Códigos de exemplo no GitHub</a>
          </li>
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introducao_introducao'>Introdução</h1>
<aside>Esta é a documentação da API para a versão mais recente (v2). </aside>

<p>A API do Focus NFe permite que você emita ou consulte documentos fiscais (NFe, NFSe, NFCe) a partir do seu sistema, seja qual for a tecnologia que ele utilize através da geração de dados em um formato simplificado, sem a necessidade de gerara a assinatura digital destes documentos. A API ainda gerencia toda a comunicação com os servidores da SEFAZ de cada estado ou com os servidores da prefeitura, no caso de NFSe.</p>

<p>Através desta documentação deverá ser possível fazer a integração com a API do Focus NFe, caso alguma dúvida permaneça você pode entrar em contato com o suporte especializado através do e-mail suporte@acras.com.br.</p>
<h2 id='introducao_como-ler-este-documento'>Como ler este documento?</h2>
<p>Você deverá ler primeiramente a introdução, em seguida, a seção sobre o documento que você irá emitir (<a href="#nfe_nfe">NFe</a>, <a href="#nfce_nfce">NFCe</a> ou <a href="#nfse_nfse">NFSe</a>).</p>

<p>Caso você emita NFe ou NFCe, você deverá ler também sobre os <a href="#backups-nfe-e-nfce_backups-nfe-e-nfce">backups</a>.</p>

<p>Caso você emita NFe ou NFSe, você poderá ler também sobre os <a href="#gatilhos_gatilhos">gatilhos</a>. O uso de gatilhos no sistema é opcional.</p>

<p>Caso você tenha interesse em obter as notas emitidas contra a sua empresa, leia a seção de <a href="#manifestacao_manifestacao">manifestação</a>.</p>

<p>Se sua empresa irá administrar vários clientes que emitem notas, pode ser interessante você ler sobre a seção de <a href="#revenda_revenda">revenda</a>.</p>
<h2 id='introducao_qual-documento-fiscal-voce-precisa-emitir'>Qual documento fiscal você precisa emitir?</h2>
<p>Dependendo da atividade da sua empresa você deverá emitir um ou mais destes documentos que irão representar frente ao governo qualquer operação com mercadoria ou serviços:</p>

<ul>
<li>NFe - Nota Fiscal Eletrônica. Utilizado para indústrias, distribuidores em geral ou empresas que vendem para clientes fora de seu estado. Neste caso é aceitável uma nota demorar vários minutos para ser autorizada. Existe um padrão nacional. O documento é de competência do estado.</li>
<li>NFCe - Nota Fiscal ao Consumidor Eletrônica. Utilizado para empresas de varejo, que trabalham diretamente com o consumidor final. Neste caso há a preocupação da nota ser emitida em poucos segundos. Existe um padrão nacional. O documento é de competência do estado.</li>
<li>NFSe - Nota Fiscal de Serviços Eletrônica. Utilizado para a maioria dos prestadores de serviços. É aceitável a nota demorar vários minutos para ser autorizada. Esta nota é de competência da prefeitura. Existe uma recomendação nacional que cada prefeitura implementa como bem entender.</li>
<li>CTe - Conhecimento de Transporte Eletrônico. Usado para prestadores de serviços de transporte. Existe um padrão nacional. Documento de competência do estado.</li>
</ul>

<p>Existe algumas exceções no país, por exemplo Brasília pode utilizar NFe para serviços e Manaus utiliza NFCe em alguns casos para notas de serviços. Na dúvida, consulte o contador da sua empresa.</p>
<h2 id='introducao_visao-geral-do-processo-de-emissao-de-um-documento'>Visão geral do processo de emissão de um documento</h2>
<p>A emissão de NFe e NFSe são processadas de forma <strong>assíncrona</strong>. NFCe é processada de forma <strong>síncrona</strong>.</p>

<p>A emissão de documentos síncronos (NFCe) é simples:</p>

<ol>
<li>Você envia pela API os dados do documento</li>
<li>A API devolve como resposta da requisição se o documento foi emitido ou não, e qual a mensagem de erro</li>
</ol>

<p>Já a emissão de documentos de forma assíncrona são feitos da seguinte forma:</p>

<ol>
<li>Você envia pela API os dados do documento</li>
<li>A API faz uma primeira validação do formato dos dados. Se houver alguma inconsistência, é devolvida uma mensagem de erro. Se estiver tudo ok, o documento é <strong>aceito para processamento posterior</strong>. Ou seja, ele vai para uma fila onde será eventualmente processado.</li>
<li>Sua aplicação irá fazer uma nova consulta para verificar o status do processamento</li>
<li>Nossa API irá informar se o documento ainda está sendo processado, ou se o processamento já finalizou. Neste último caso informa a mensagem de erro ou os dados do documento gerado caso a nota tenha sido autorizada.</li>
<li>Caso o documento ainda esteja em processamento, sua aplicação deverá agendar uma nova consulta dentro de alguns segundos.</li>
</ol>

<p>Alternativamente, você poderá usar o conceito de <a href="#gatilhos">gatilhos</a>. Neste caso você informa a API qual endereço de sua aplicação deverá ser chamado quando uma nota for autorizada. Neste caso funcionaria assim:</p>

<ol>
<li>Você envia pela API os dados do documento</li>
<li>A API faz uma primeira validação do formato dos dados. Informa sobre inconsistência ou avisa que a nota foi aceita para processamento, como no cenário anterior.</li>
<li>Quando a nota for processada, a API irá ativamente lhe informar através de um HTTP POST no endereço combinado o resultado do processamento.</li>
</ol>
<h2 id='introducao_autenticacao'>Autenticação</h2>
<p>A autenticação é feita através de um token. Ao habilitar a API para sua empresa forneceremos uma string secreta e única que será usada para efetuar todas as operações. A autenticação poderá ser feita usando o método HTTP Basic Auth (saiba mais em <a href="https://en.wikipedia.org/wiki/Basic_access_authentication">https://en.wikipedia.org/wiki/Basic_access_authentication</a>) fornecendo o token como nome de usuário e deixando a senha em branco.</p>

<p>Caso não seja possível utilizar método HTTP Basic Auth você pode também enviar sempre o parâmetro “token” informando o seu token de acesso. Porém nós recomendamos o uso de HTTP Basic Auth pois isto aumenta a segurança impedindo a gravação do token em históricos do navegador, logs de acesso, etc.</p>
<h2 id='introducao_referencia'>Referência</h2>
<p>A referência é a forma que utilizamos para identificar a sua emissão em nossa API, por isso, ela deve ser única para cada token de acesso que você receba. A referência pode ser alfanumérica, contudo, não são permitidos caracteres especiais. É comum a utilização do identificador da tabela em banco de dados que representa uma nota fiscal no seu sistema.</p>

<p>Uma referência pode ser reutilizada caso ocorra erro na autorização. Mas uma vez que a nota seja autorizada (mesmo que posteriormente cancelada), a referência usada não poderá mais ser usada em outro envio.</p>
<h2 id='introducao_ambiente'>Ambiente</h2>
<p>A API do Focus NFe oferece dois ambientes para emissão de notas: homologação e produção.</p>

<p><strong>Homologação</strong></p>

<p>O ambiente de homologação serve para envio de notas fiscais com a finalidade de teste. As notas emitidas aqui não possuem validade fiscal/tributária.</p>

<p><strong>Produção</strong>
Este é o ambiente com validade fiscal e tributária, pois isso, recomendamos que utilize este ambiente apenas quando for iniciar o processo de envio de notas válidas.</p>

<p>O endereço dos servidores são os seguintes:</p>

<p>Homologação: <code>https://homologacao.focusnfe.com.br</code></p>

<p>Produção: <code>https://api.focusnfe.com.br</code></p>

<p><strong>Considerações sobre o uso de SSL</strong></p>
<pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1"># Em PHP normalmente é necessária uma configuração adicional.
# Em muitos sites você irá encontrar a solução abaixo,
# para ignorar a validação do certificado:
</span>
<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_SSL_VERIFYPEER</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="c1"># Porém o correto seria indicar para confiar na unidade certificadora
</span><span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_CAINFO</span><span class="p">,</span> <span class="s2">"/pasta/no/servidor/ca.crt"</span><span class="p">);</span>
<span class="cp">?&gt;</span>

</code></pre>
<p>Verifique em sua linguagem de programação se é necessário alguma configuração adicional para uso de SSL.
Pode ser necessário indicar explicitamente a confiar na autoridade certificadora que emitiu o certificado SSL.
Em especial na linguagem Java é necessário adicionar todos os certificados, inclusive de toda cadeia da empresa
certificadora.</p>

<p>Para poder baixar os certificados de nosso servidor, você pode executar o seguinte comando em algum
console linux:</p>

<p><code>openssl s_client -showcerts -connect api.focusnfe.com.br:443</code></p>

<p>Isto irá listar todos os certificados entre &quot;<code>-----BEGIN CERTIFICATE-----</code>&quot;
e &quot;<code>-----END CERTIFICATE-----</code>&quot;. Apenas salve todos estes certificados em arquivos separados e importe
para a sua ferramenta de armazenamento de certificados. Entre em contato com nosso suporte caso encontre
problemas neste processo.</p>
<h2 id='introducao_padrao-rest'>Padrão REST</h2>
<p>A API utiliza o padrão de arquitetura REST <a href="https://pt.wikipedia.org/wiki/REST">https://pt.wikipedia.org/wiki/REST</a>. Neste padrão, são utilizados verbos ou métodos HTTP (GET, POST, DELETE) em conjunto com determinados recursos disponíveis através de uma URL para representar uma determinada ação. Por exemplo, o verbo GET é usado para representar algum tipo de visualização dos dados de um dado recurso, e o verbo POST é usado para criar um novo recurso e o verbo DELETE representa uma exclusão.</p>

<p>Abaixo alguns exemplos de requisições:</p>

<table><thead>
<tr>
<th>Método</th>
<th>URL (recurso)</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>POST</td>
<td>/v2/nfe?ref=REFERENCIA</td>
<td>Cria uma nota fiscal e a envia para processamento.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/nfe/REFERENCIA</td>
<td>Consulta a nota fiscal com a referência informada e o seu status de processamento</td>
</tr>
<tr>
<td>DELETE</td>
<td>/v2/nfe/REFERENCIA</td>
<td>Cancela uma nota fiscal com a referência informada</td>
</tr>
</tbody></table>

<aside class="notice">
Você deve substituir <code>REFERENCIA</code> pela referência gerada pela sua aplicação.
</aside>

<p>A API utiliza o formato JSON para transferência de dados.</p>

<p>Sempre que é feita uma chamada HTTP é devolvido um código de retorno. Este código irá informar também se a requisição foi aceita ou se ocorreu algum erro, da seguinte forma:</p>

<ul>
<li>Códigos que iniciam com “2” representam ação que foi completada com sucesso, por exemplo: 200, 201.</li>
<li>Códigos que inicial com “4” ou &quot;5&quot; representam algum erro na requisição, por exemplo: 404, 402, etc.</li>
</ul>

<p>Abaixo listamos os códigos HTTP que nossa API pode devolver:</p>

<table><thead>
<tr>
<th>Código HTTP</th>
<th>Significado</th>
<th>Explicação</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Ok</td>
<td>Este código é devolvido quando uma consulta resulta em sucesso.</td>
</tr>
<tr>
<td>201</td>
<td>Criado</td>
<td>Este código é devolvido quando uma requisição é aceita para processamento.</td>
</tr>
<tr>
<td>400</td>
<td>Requisição inválida</td>
<td>Este erro é devolvido quando falta alguma informação na requisição ou ela é inválida por algum outro motivo. Por exemplo quando falta algum parâmetro obrigatório.</td>
</tr>
<tr>
<td>403</td>
<td>Permissão negada</td>
<td>Este erro é devolvido quando ocorre algum problema de permissão envolvendo o token de acesso.</td>
</tr>
<tr>
<td>404</td>
<td>Não encontrado</td>
<td>Este erro é devolvido quando não é encontrado algum recurso que é pesquisado.</td>
</tr>
<tr>
<td>415</td>
<td>Mídia inválida</td>
<td>Este erro é devolvido quando não é reconhecido o formato JSON enviado, devido a alguma falha de sintaxe.</td>
</tr>
<tr>
<td>422</td>
<td>Entidade improcessável</td>
<td>Não existe erro na requisição (sintaxe), porém há algum erro de semântica (por exemplo, tentar cancelar uma nota já cancelada)</td>
</tr>
<tr>
<td>429</td>
<td>Muitas requisições</td>
<td>Você ultrapassou o limite de requisições por minuto. Veja o <a href="#limite-de-requisicoes">limite de requisições</a></td>
</tr>
<tr>
<td>500</td>
<td>Erro interno do servidor</td>
<td>Ocorreu algum erro inesperado. Contate o suporte técnico.</td>
</tr>
</tbody></table>

<p>Note que se o código HTTP devolvido for de sucesso não implica que uma nota tenha sido autorizada com sucesso. Por exemplo, você pode enviar uma nota fiscal para autorização, nossa API devolver o status 201 (criado) (pois não havia nenhum erro aparente na nota fiscal) porém ao ser processada pela SEFAZ ou prefeitura verificou-se que a data de emissão estava muito atrasada. Ou seja, os códigos HTTP são utilizados para verificar se a transação está ok no nível de comunicação da sua aplicação com a nossa API (e não com o SEFAZ).</p>
<h2 id='introducao_erros'>Erros</h2>
<blockquote>
<p>Exemplo de mensagem de erro</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nao_encontrado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nota fiscal não encontrada"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>As mensagens de erro serão apresentadas em qualquer operação sempre que for devolvido um código HTTP que começa com 4. A mensagem será um objeto com os seguintes atributos:</p>

<ul>
<li><strong>codigo</strong> - O código da mensagem</li>
<li><strong>mensagem</strong> - A descrição mais detalhada do que ocorreu</li>
<li><strong>erros</strong> - (Opcional) Quando for possível detalhar o erro, ele será informado neste array de objetos</li>
</ul>

<p>Abaixo listamos os códigos de erro mais comuns.</p>

<table><thead>
<tr>
<th>Código HTTP</th>
<th>Código do erro</th>
<th>Significado</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>requisicao_invalida</td>
<td>Faltou informar algum campo na requisição. Este campo é informando na mensagem do erro</td>
</tr>
<tr>
<td>400</td>
<td>empresa_nao_habilitada</td>
<td>Empresa ainda não habilitada para emitir o documento que você precisa. Habilite no seu painel ou contate o suporte técnico</td>
</tr>
<tr>
<td>400</td>
<td>nfe_cancelada</td>
<td>Foi feita uma tentativa de cancelar uma nota já cancelada</td>
</tr>
<tr>
<td>403</td>
<td>permissao_negada</td>
<td>Sua aplicação por algum motivo se encontra bloqueada para uso. Contate o nosso suporte</td>
</tr>
<tr>
<td>404</td>
<td>nao_encontrado</td>
<td>Ocorre quando o recurso que você está procurando (NFe, NFCe ou NFSe) não é encontrado</td>
</tr>
<tr>
<td>422</td>
<td>nfe_nao_autorizada</td>
<td>Foi feita alguma operação com a nota que só é aplicável se ela estiver autorizada (por exemplo a ação de cancelamento)</td>
</tr>
<tr>
<td>422</td>
<td>nfe_autorizada</td>
<td>Foi solicitado o processamento de uma nota já autorizada</td>
</tr>
<tr>
<td>422</td>
<td>em_processamento</td>
<td>Foi solicitado o processamento de uma nota que já está em processamento</td>
</tr>
</tbody></table>
<h1 id='nfe_nfe'>NFe</h1>
<p>Através da API NFe é possível:</p>

<ul>
<li>Emitir NFe utilizando dados simplificados. Este processo é <strong>assíncrono</strong>. Ou seja, após a emissão a nota será enfileirada para processamento.</li>
<li>Cancelar NFe.</li>
<li>Consultar o status de NFe emitidas.</li>
<li>Encaminhar uma NFe por email</li>
<li>Emitir Carta de Correção.</li>
<li>Inutilizar uma faixa de numeração de NFe</li>
</ul>
<h2 id='nfe_urls'>URLs</h2>
<table><thead>
<tr>
<th>Método</th>
<th>URL (recurso)</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>POST</td>
<td>/v2/nfe?ref=REFERENCIA</td>
<td>Cria uma nota fiscal e a envia para processamento.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/nfe/REFERENCIA</td>
<td>Consulta a nota fiscal com a referência informada e o seu status de processamento</td>
</tr>
<tr>
<td>DELETE</td>
<td>/v2/nfe/REFERENCIA</td>
<td>Cancela uma nota fiscal com a referência informada</td>
</tr>
<tr>
<td>POST</td>
<td>/v2/nfe/REFERENCIA/carta_correcao</td>
<td>Cria uma carta de correção para a nota fiscal com a referência informada.</td>
</tr>
<tr>
<td>POST</td>
<td>/v2/nfe/REFERENCIA/email</td>
<td>Envia um email com uma cópia da nota fiscal com a referência informada</td>
</tr>
<tr>
<td>POST</td>
<td>/v2/nfe/inutilizacao</td>
<td>Inutiliza uma numeração da nota fiscal</td>
</tr>
</tbody></table>
<h2 id='nfe_campos-obrigatorios-de-uma-nfe'>Campos obrigatórios de uma NFe</h2>
<p>Atualmente, a NFe possui centenas de campos para os mais variados tipos e formas de operações, por isso, criamos uma página exclusiva que mostra todos os campos da nossa API para o envio de NFe. Nela, você pode buscar os campos pela TAG XML ou pela nossa tradução para API.</p>

<p><a href="https://focusnfe.com.br/dsl/4.0/NotaFiscalXML.html">Documentação completa dos campos (versão 4.00 da NFe)</a></p>

<p>Abaixo, iremos mostrar os campos de uso obrigatório para emissão de uma Nota Fiscal Eletrônica.</p>

<blockquote>
<blockquote>
<p>Abaixo um exemplo de dados de uma nota (usando a versão 4.00 da NFe):</p>
</blockquote>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"natureza_operacao"</span><span class="p">:</span><span class="s2">"Remessa"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data_emissao"</span><span class="p">:</span><span class="s2">"2017-04-15"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data_entrada_saida"</span><span class="p">:</span><span class="s2">"2017-04-15"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"tipo_documento"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"finalidade_emissao"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="s2">"SEU_CNPJ"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cpf_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SEU_CPF"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"nome_emitente"</span><span class="p">:</span><span class="s2">"Sua Raz</span><span class="se">\u</span><span class="s2">00e3o Social Ltda"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"nome_fantasia_emitente"</span><span class="p">:</span><span class="s2">"Fantasia do Emitente"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"logradouro_emitente"</span><span class="p">:</span><span class="s2">"Rua Quinze de Abril"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_emitente"</span><span class="p">:</span><span class="mi">999</span><span class="p">,</span><span class="w">
  </span><span class="s2">"bairro_emitente"</span><span class="p">:</span><span class="s2">"Jd Paulistano"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"municipio_emitente"</span><span class="p">:</span><span class="s2">"S</span><span class="se">\u</span><span class="s2">00e3o Paulo"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"uf_emitente"</span><span class="p">:</span><span class="s2">"SP"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cep_emitente"</span><span class="p">:</span><span class="s2">"01454-600"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"inscricao_estadual_emitente"</span><span class="p">:</span><span class="s2">"SUA_INSCRICAO_ESTADUAL"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"nome_destinatario"</span><span class="p">:</span><span class="s2">"NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cpf_destinatario"</span><span class="p">:</span><span class="s2">"03055054911"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"inscricao_estadual_destinatario"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"telefone_destinatario"</span><span class="p">:</span><span class="mi">1196185555</span><span class="p">,</span><span class="w">
  </span><span class="s2">"logradouro_destinatario"</span><span class="p">:</span><span class="s2">"Rua S</span><span class="se">\u</span><span class="s2">00e3o Janu</span><span class="se">\u</span><span class="s2">00e1rio"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_destinatario"</span><span class="p">:</span><span class="mi">99</span><span class="p">,</span><span class="w">
  </span><span class="s2">"bairro_destinatario"</span><span class="p">:</span><span class="s2">"Crespo"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"municipio_destinatario"</span><span class="p">:</span><span class="s2">"Manaus"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"uf_destinatario"</span><span class="p">:</span><span class="s2">"AM"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"pais_destinatario"</span><span class="p">:</span><span class="s2">"Brasil"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cep_destinatario"</span><span class="p">:</span><span class="mi">69073178</span><span class="p">,</span><span class="w">
  </span><span class="s2">"valor_frete"</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"valor_seguro"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"valor_total"</span><span class="p">:</span><span class="mf">47.23</span><span class="p">,</span><span class="w">
  </span><span class="s2">"valor_produtos"</span><span class="p">:</span><span class="mf">47.23</span><span class="p">,</span><span class="w">
  </span><span class="s2">"modalidade_frete"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"numero_item"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"codigo_produto"</span><span class="p">:</span><span class="mi">1232</span><span class="p">,</span><span class="w">
      </span><span class="s2">"descricao"</span><span class="p">:</span><span class="s2">"Cartu00f5es de Visita"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"cfop"</span><span class="p">:</span><span class="mi">5923</span><span class="p">,</span><span class="w">
      </span><span class="s2">"unidade_comercial"</span><span class="p">:</span><span class="s2">"un"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"quantidade_comercial"</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="w">
      </span><span class="s2">"valor_unitario_comercial"</span><span class="p">:</span><span class="mf">0.4723</span><span class="p">,</span><span class="w">
      </span><span class="s2">"valor_unitario_tributavel"</span><span class="p">:</span><span class="mf">0.4723</span><span class="p">,</span><span class="w">
      </span><span class="s2">"unidade_tributavel"</span><span class="p">:</span><span class="s2">"un"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"codigo_ncm"</span><span class="p">:</span><span class="mi">49111090</span><span class="p">,</span><span class="w">
      </span><span class="s2">"quantidade_tributavel"</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="w">
      </span><span class="s2">"valor_bruto"</span><span class="p">:</span><span class="mf">47.23</span><span class="p">,</span><span class="w">
      </span><span class="s2">"icms_situacao_tributaria"</span><span class="p">:</span><span class="mi">41</span><span class="p">,</span><span class="w">
      </span><span class="s2">"icms_origem"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"pis_situacao_tributaria"</span><span class="p">:</span><span class="s2">"07"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"cofins_situacao_tributaria"</span><span class="p">:</span><span class="s2">"07"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='nfe_geral'>Geral</h3>
<ul>
<li><strong>natureza_operacao</strong>: Descrição da natureza da operação a ser realizada pela nota fiscal.</li>
<li><strong>data_emissao</strong>: Data da emissão da NFe. Formato padrão ISO, exemplo: “2016-12-25T12:00-0300”.</li>
<li><strong>tipo_documento</strong>: Tipo da NFe. Valores possíveis:</li>
</ul>

<p>0 – Nota Fiscal de Entrada;</p>

<p>1 – Nota Fiscal de Saída.</p>

<ul>
<li><strong>local_destino</strong>: Local onde a operação irá acontecer. Valores possíveis:</li>
</ul>

<p>1 – Operação interna;</p>

<p>2 – Operação interestadual;</p>

<p>3 – Operação com exterior.</p>

<ul>
<li><strong>finalidade_emissao</strong>: Indicar qual a finalidade da emissão da nota. Valores possíveis:</li>
</ul>

<p>1 – Normal;</p>

<p>2 – Complementar;</p>

<p>3 – Nota de ajuste;</p>

<p>4 – Devolução.</p>

<ul>
<li><strong>consumidor_final</strong>: Indicar se a operação é com consumidor final. Valores possíveis:</li>
</ul>

<p>0 – Normal;</p>

<p>1 – Consumidor final.</p>

<ul>
<li><strong>presenca_comprador</strong>: Informar como foi a presença do comprador. Valores possíveis:</li>
</ul>

<p>0 – Não se aplica (por exemplo, para a Nota Fiscal complementar ou de ajuste);</p>

<p>1 – Operação presencial;</p>

<p>2 – Operação não presencial, pela Internet;</p>

<p>3 – Operação não presencial, Teleatendimento;</p>

<p>4 – NFC-e em operação com entrega em domicílio;</p>

<p>9 – Operação não presencial, outros.</p>
<h3 id='nfe_emitente'>Emitente</h3>
<ul>
<li><strong>cnpj_emitente</strong>: CNPJ do emitente da nota. Deve ser usado esse campo ou o &quot;cpf_emitente&quot;.</li>
<li><strong>cpf_emitente</strong>: CPF do emitente da nota. Deve ser usado esse campo ou o &quot;cnpj_emitente&quot;.</li>
<li><strong>inscricao_estadual_emitente</strong>: Informar a Inscrição Estadual do emitente.</li>
<li><strong>logradouro_emitente</strong>: Logradouro do emitente.</li>
<li><strong>numero_emitente</strong>: Número do logradouro do emitente.</li>
<li><strong>bairro_emitente</strong>: Bairro do emitente.</li>
<li><strong>municipio_emitente</strong>: Município do emitente.</li>
<li><strong>uf_emitente</strong>: UF do emitente.</li>
<li><strong>regime_tributario_emitente</strong>: Informar qual o regime tributário do emitente. Valores possíveis:</li>
</ul>

<p>1 – Simples Nacional;</p>

<p>2 – Simples Nacional – excesso de sublimite de receita bruta;</p>

<p>3 – Regime Normal.</p>
<h3 id='nfe_destinatario'>Destinatário</h3>
<ul>
<li><strong>nome_destinatario</strong>: Nome completo do destinatário.</li>
<li><strong>cnpj_destinatario</strong>: CNPJ da empresa destinatária.</li>
<li><strong>cpf_destinatario</strong>: CPF do destinatário. Caso utilize este campo, não enviar o campo “cnpf_destinatario”.</li>
<li><strong>inscricao_estadual_destinatario</strong>: Informar a Inscrição Estadual do destinatário.</li>
<li><strong>logradouro_destinatario</strong>: Logradouro do destinatário.</li>
<li><strong>numero_destinatario</strong>: Número do logradouro do destinatário.</li>
<li><strong>bairro_destinatario</strong>: Bairro do destinatário.</li>
<li><strong>municipio_destinatario</strong>: Município do destinatário.</li>
<li><strong>uf_destinatario</strong>: UF do destinatário.</li>
<li><strong>indicador_inscricao_estadual_destinatario</strong>: Indicador da Inscrição Estadual do destinatário. Valores possíveis:</li>
</ul>

<p>1 – Contribuinte ICMS (informar a IE do destinatário);</p>

<p>2 – Contribuinte isento de Inscrição no cadastro de Contribuintes do ICMS;</p>

<p>9 – Não Contribuinte, que pode ou não possuir Inscrição Estadual no Cadastro de Contribuintes do ICMS.</p>
<h3 id='nfe_itens'>Itens</h3>
<p>Uma NFe irá conter um ou mais itens no campo “items” que poderão conter os campos abaixo:</p>

<ul>
<li><strong>numero_item</strong>: Numeração que indica qual a posição do item na nota, deve ser usado numeração sequencial a partir do número “1”.</li>
<li><strong>codigo_produto</strong>: Código do produto.</li>
<li><strong>descricao</strong>: Descrição do produto.</li>
<li><strong>cfop</strong>: Código Fiscal da Operação, CFOP da operação válido para NFe.</li>
<li><strong>quantidade_comercial</strong>: Quantidade da mercadoria.</li>
<li><strong>quantidade_tributavel</strong>: Quantidade tributavel da mercadoria. Caso não se aplique, utilize o mesmo valor do campo quantidade_comercial.</li>
<li><strong>valor_unitario_comercial</strong>: Valor unitário da mercadoria.</li>
<li><strong>valor_unitario_tributavel</strong>: Valor unitário tributável da mercadoria. Caso não se aplique, utilize o mesmo valor do campo valor_unitario_comercial.</li>
<li><strong>unidade_comercial</strong>: Unidade comercial do produto. Você pode utilizar valores como “KG”, “L”, “UN” entre outros. * Caso não se aplique, use “UN”.</li>
<li><strong>unidade_tributavel</strong>: Unidade tributável do produto. Caso não se aplique, utilize o mesmo valor do campo unidade_comercial.</li>
<li><strong>valor_bruto</strong>: Valor bruto do produto.</li>
<li><strong>código_ncm</strong>: Código NCM do produto. Este código possui 8 dígitos.</li>
<li><strong>inclui_no_total</strong>: Valor do item (valor_bruto) compõe valor total da NFe (valor_produtos)?. Valores possíveis:</li>
</ul>

<p>0 – Não;</p>

<p>1 – Sim.</p>

<ul>
<li><strong>icms_origem</strong>: Informar a origem do ICMS. Valores possíveis:</li>
</ul>

<p>0 – Nacional;</p>

<p>1 – Estrangeira (importação direta);</p>

<p>2 – Estrangeira (adquirida no mercado interno);</p>

<p>3 – Nacional com mais de 40% de conteúdo estrangeiro;</p>

<p>4 – Nacional produzida através de processos produtivos básicos;</p>

<p>5 – Nacional com menos de 40% de conteúdo estrangeiro;</p>

<p>6 – Estrangeira (importação direta) sem produto nacional similar;</p>

<p>7 – Estrangeira (adquirida no mercado interno) sem produto nacional similar;</p>

<ul>
<li><strong>icms_situacao_tributaria</strong>: Informar qual a situação do ICMS para a operação. Valores possíveis:</li>
</ul>

<p>00 – Tributada integralmente;</p>

<p>10 – Tributada e com cobrança do ICMS por substituição tributária;</p>

<p>20 – Tributada com redução de base de cálculo;</p>

<p>30 – Isenta ou não tributada e com cobrança do ICMS por substituição tributária;</p>

<p>40 – Isenta;</p>

<p>41 – Não tributada;</p>

<p>50 – Suspensão;</p>

<p>51 – Diferimento (a exigência do preenchimento das informações do ICMS diferido fica a critério de cada UF);</p>

<p>60 – Cobrado anteriormente por substituição tributária;</p>

<p>70 – Tributada com redução de base de cálculo e com cobrança do ICMS por substituição tributária;
90 – Outras (regime Normal);</p>

<p>101 – Ttributada pelo Simples Nacional com permissão de crédito;</p>

<p>102 – Tributada pelo Simples Nacional sem permissão de crédito;</p>

<p>103 – Isenção do ICMS no Simples Nacional para faixa de receita bruta;</p>

<p>201 – Tributada pelo Simples Nacional com permissão de crédito e com cobrança do ICMS por substituição tributária;</p>

<p>202 – Tributada pelo Simples Nacional sem permissão de crédito e com cobrança do ICMS por substituição tributária;</p>

<p>203 – Isenção do ICMS nos Simples Nacional para faixa de receita bruta e com cobrança do ICMS por substituição tributária;</p>

<p>300 – Imune;</p>

<p>400 – Não tributada pelo Simples Nacional;</p>

<p>500 – ICMS cobrado anteriormente por substituição tributária (substituído) ou por antecipação;</p>

<p>900 – Outras (regime Simples Nacional);</p>

<p>pis_situacao_tributaria: Informar qual a situação do PIS para a operação. Valores possíveis:
01 – Operação tributável: base de cálculo = valor da operação (alíquota normal – cumulativo/não cumulativo);</p>

<p>02 – Operação tributável: base de cálculo = valor da operação (alíquota diferenciada);</p>

<p>03 – Operação tributável: base de cálculo = quantidade vendida × alíquota por unidade de produto;</p>

<p>04 – Operação tributável: tributação monofásica (alíquota zero);</p>

<p>05 – Operação tributável: substituição tributária;</p>

<p>06 – Operação tributável: alíquota zero;</p>

<p>07 – Operação isenta da contribuição;</p>

<p>08 – Operação sem incidência da contribuição;</p>

<p>09 – Operação com suspensão da contribuição;</p>

<p>49 – Outras operações de saída;</p>

<p>50 – Operação com direito a crédito: vinculada exclusivamente a receita tributada no mercado interno;</p>

<p>51 – Operação com direito a crédito: vinculada exclusivamente a receita não tributada no mercado interno;</p>

<p>52 – Operação com direito a crédito: vinculada exclusivamente a receita de exportação;</p>

<p>53 – Operação com direito a crédito: vinculada a receitas tributadas e não-tributadas no mercado interno;</p>

<p>54 – Operação com direito a crédito: vinculada a receitas tributadas no mercado interno e de exportação;</p>

<p>55 – Operação com direito a crédito: vinculada a receitas não-tributadas no mercado interno e de exprtação;</p>

<p>56 – Operação com direito a crédito: vinculada a receitas tributadas e não-tributadas no mercado interno e de exportação;</p>

<p>60 – Crédito presumido: operação de aquisição vinculada exclusivamente a receita tributada no mercado interno;</p>

<p>61 – Crédito presumido: operação de aquisição vinculada exclusivamente a receita não-tributada no mercado interno;</p>

<p>62 – Crédito presumido: operação de aquisição vinculada exclusivamente a receita de exportação;</p>

<p>63 – Crédito presumido: operação de aquisição vinculada a receitas tributadas e não-tributadas no mercado interno;</p>

<p>64 – Crédito presumido: operação de aquisição vinculada a receitas tributadas no mercado interno e de exportação;</p>

<p>65 – Crédito presumido: operação de aquisição vinculada a receitas não-tributadas no mercado interno e de exportação;</p>

<p>66 – Crédito presumido: operação de aquisição vinculada a receitas tributadas e não-tributadas no mercado interno e de exportação;</p>

<p>67 – Crédito presumido: outras operações;</p>

<p>70 – Operação de aquisição sem direito a crédito;</p>

<p>71 – Operação de aquisição com isenção;</p>

<p>72 – Operação de aquisição com suspensão;</p>

<p>73 – Operação de aquisição a alíquota zero;</p>

<p>74 – Operação de aquisição sem incidência da contribuição;</p>

<p>75 – Operação de aquisição por substituição tributária;</p>

<p>98 – Outras operações de entrada;</p>

<p>99 – Outras operações;</p>

<ul>
<li><strong>cofins_situacao_tributaria</strong>: Informar qual a situação do CONFINS para a operação. Valores possíveis:</li>
</ul>

<p>01 – Operação tributável: base de cálculo = valor da operação (alíquota normal – cumulativo/não cumulativo);</p>

<p>02 – Operação tributável: base de cálculo = valor da operação (alíquota diferenciada);</p>

<p>03 – Operação tributável: base de cálculo = quantidade vendida × alíquota por unidade de produto;</p>

<p>04 – Operação tributável: tributação monofásica (alíquota zero);</p>

<p>05 – Operação tributável: substituição tributária;</p>

<p>06 – Operação tributável: alíquota zero;</p>

<p>07 – Operação isenta da contribuição;</p>

<p>08 – Operação sem incidência da contribuição;</p>

<p>09 – Operação com suspensão da contribuição;</p>

<p>49 – Outras operações de saída;</p>

<p>50 – Operação com direito a crédito: vinculada exclusivamente a receita tributada no mercado interno;</p>

<p>51 – Operação com direito a crédito: vinculada exclusivamente a receita não tributada no mercado</p>

<p>interno;</p>

<p>52 – Operação com direito a crédito: vinculada exclusivamente a receita de exportação;</p>

<p>53 – Operação com direito a crédito: vinculada a receitas tributadas e não-tributadas no mercado interno;</p>

<p>54 – Operação com direito a crédito: vinculada a receitas tributadas no mercado interno e de exportação;</p>

<p>55 – Operação com direito a crédito: vinculada a receitas não-tributadas no mercado interno e de exportação;</p>

<p>56 – Operação com direito a crédito: vinculada a receitas tributadas e não-tributadas no mercado interno e de exportação;</p>

<p>60 – Crédito presumido: operação de aquisição vinculada exclusivamente a receita tributada no mercado interno;</p>

<p>61 – Crédito presumido: operação de aquisição vinculada exclusivamente a receita não-tributada no mercado interno;</p>

<p>62 – Crédito presumido: operação de aquisição vinculada exclusivamente a receita de exportação;</p>

<p>63 – Crédito presumido: operação de aquisição vinculada a receitas tributadas e não-tributadas no mercado interno;</p>

<p>64 – Crédito presumido: operação de aquisição vinculada a receitas tributadas no mercado interno e de exportação;</p>

<p>65 – Crédito presumido: operação de aquisição vinculada a receitas não-tributadas no mercado interno e de exportação;</p>

<p>66 – Crédito presumido: operação de aquisição vinculada a receitas tributadas e não-tributadas no mercado interno e de exportação;</p>

<p>67 – Crédito presumido: outras operações;</p>

<p>70 – Operação de aquisição sem direito a crédito;</p>

<p>71 – Operação de aquisição com isenção;</p>

<p>72 – Operação de aquisição com suspensão;</p>

<p>73 – Operação de aquisição a alíquota zero;</p>

<p>74 – Operação de aquisição sem incidência da contribuição;</p>

<p>75 – Operação de aquisição por substituição tributária;</p>

<p>98 – Outras operações de entrada;</p>

<p>99 – Outras operações;</p>

<ul>
<li><strong>icms_base_calculo</strong>: Valor total da base de cálculo do ICMS. Assume zero se não informado.</li>
<li><strong>icms_valor_total</strong>: Valor total do ICMS. Assume zero se não informado.</li>
<li><strong>icms_base_calculo_st</strong>: Valor total da base de cálculo do ICMS do substituto tributário. Assume zero se não informado.</li>
<li><strong>icms_valor_total_st</strong>: Valor total do ICMS do substituto tributário. Assume zero se não informado.</li>
<li><strong>valor_produtos</strong>: Valor total dos produtos. Assume zero se não informado.</li>
<li><strong>valor_frete</strong>: Valor total do frete. Assume zero se não informado.</li>
<li><strong>valor_seguro</strong>: Valor total do seguro. Assume zero se não informado.</li>
<li><strong>valor_desconto</strong>: Valor total do desconto. Assume zero se não informado.</li>
<li><strong>valor_ipi</strong>: Valor total do IPI. Assume zero se não informado.</li>
<li><strong>valor_pis</strong>: Valor do PIS. Assume zero se não informado.</li>
<li><strong>valor_cofins</strong>: Valor do COFINS. Assume zero se não informado.</li>
<li><strong>valor_outras_despesas</strong>: Valor das despesas acessórias. Assume zero se não informado.</li>
<li><strong>valor_total</strong>: Valor total da nota fiscal.</li>
<li><strong>modalidade_frete</strong>: Indica a modalidade do frete da operação. Valores possíveis:</li>
</ul>

<p>0 – Por conta do emitente;</p>

<p>1 – Por conta do destinatário;</p>

<p>2 – Por conta de terceiros;</p>

<p>9 – Sem frete;</p>
<h3 id='nfe_campos-calculados-automaticamente'>Campos calculados automaticamente</h3>
<p>Para simplificar o envio da nota fiscal, alguns campos são calculados automaticamente a partir da versão 4.00 da NFe. Os campos calculados são somatórios de campos fornecidos nos itens da nota fiscal. Os campos serão calculados apenas se eles não forem informados na API.</p>

<p>A lista de campos calculados automaticamente segue abaixo:</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Somatório de campo dos itens</th>
<th>Observação</th>
</tr>
</thead><tbody>
<tr>
<td>icms_base_calculo</td>
<td>icms_base_calculo</td>
<td></td>
</tr>
<tr>
<td>valor_ipi</td>
<td>ipi_valor</td>
<td></td>
</tr>
<tr>
<td>icms_valor_total_st</td>
<td>icms_valor_st</td>
<td></td>
</tr>
<tr>
<td>issqn_base_calculo</td>
<td>issqn_base_calculo</td>
<td></td>
</tr>
<tr>
<td>issqn_valor_total</td>
<td>issqn_valor</td>
<td></td>
</tr>
<tr>
<td>issqn_valor_total_deducao</td>
<td>issqn_valor_deducao</td>
<td></td>
</tr>
<tr>
<td>issqn_valor_total_outras_retencoes</td>
<td>issqn_valor_outras_retencoes</td>
<td></td>
</tr>
<tr>
<td>issqn_valor_total_desconto_incondicionado</td>
<td>issqn_valor_desconto_incondicionado</td>
<td></td>
</tr>
<tr>
<td>issqn_valor_total_desconto_condicionado</td>
<td>issqn_valor_desconto_condicionado</td>
<td></td>
</tr>
<tr>
<td>issqn_valor_total_retencao</td>
<td>issqn_valor_retencao</td>
<td></td>
</tr>
<tr>
<td>issqn_base_calculo</td>
<td>issqn_base_calculo</td>
<td></td>
</tr>
<tr>
<td>valor_total_ii</td>
<td>ii_valor</td>
<td></td>
</tr>
<tr>
<td>fcp_valor_total</td>
<td>fcp_valor</td>
<td></td>
</tr>
<tr>
<td>fcp_valor_total_uf_destino</td>
<td>fcp_valor_uf_destino</td>
<td></td>
</tr>
<tr>
<td>fcp_valor_total_st</td>
<td>fcp_valor_st</td>
<td></td>
</tr>
<tr>
<td>fcp_valor_total_retido_st</td>
<td>fcp_valor_retido_st</td>
<td></td>
</tr>
<tr>
<td>icms_valor_total_uf_destino</td>
<td>icms_valor_uf_destino</td>
<td></td>
</tr>
<tr>
<td>icms_valor_total_uf_remetente</td>
<td>icms_valor_uf_remetente</td>
<td></td>
</tr>
<tr>
<td>icms_base_calculo</td>
<td>icms_base_calculo</td>
<td></td>
</tr>
<tr>
<td>icms_valor_total</td>
<td>icms_valor</td>
<td></td>
</tr>
<tr>
<td>icms_valor_total_desonerado</td>
<td>icms_valor_desonerado</td>
<td></td>
</tr>
<tr>
<td>icms_base_calculo_st</td>
<td>icms_base_calculo_st</td>
<td></td>
</tr>
<tr>
<td>icms_valor_total_st</td>
<td>icms_valor_st</td>
<td></td>
</tr>
<tr>
<td>valor_frete</td>
<td>valor_frete</td>
<td></td>
</tr>
<tr>
<td>valor_seguro</td>
<td>valor_seguro</td>
<td></td>
</tr>
<tr>
<td>valor_outras_despesas</td>
<td>valor_outras_despesas</td>
<td></td>
</tr>
<tr>
<td>valor_desconto</td>
<td>valor_desconto</td>
<td></td>
</tr>
<tr>
<td>valor_ipi_devolvido</td>
<td>valor_ipi_devolvido</td>
<td></td>
</tr>
<tr>
<td>valor_total_tributos</td>
<td>valor_total_tributos</td>
<td></td>
</tr>
<tr>
<td>valor_produtos</td>
<td>valor_bruto</td>
<td>Apenas se inclui_no_total=1</td>
</tr>
<tr>
<td>valor_total_servicos</td>
<td>valor_bruto</td>
<td>Apenas se inclui_no_total=1 e item de serviço</td>
</tr>
<tr>
<td>icms_valor_total</td>
<td>icms_valor</td>
<td>Apenas se icms_situacao_tributaria diferente de40, 41 e 50.</td>
</tr>
<tr>
<td>valor_pis_servicos</td>
<td>pis_valor</td>
<td>Apenas se item de serviço</td>
</tr>
<tr>
<td>valor_cofins_servicos</td>
<td>cofins_valor</td>
<td>Apenas se item de serviço</td>
</tr>
<tr>
<td>valor_pis</td>
<td>pis_valor</td>
<td>Apenas se não for item de serviço</td>
</tr>
<tr>
<td>valor_cofins</td>
<td>cofins_valor</td>
<td>Apenas se não for item de serviço</td>
</tr>
</tbody></table>
<h2 id='nfe_status-api'>Status API</h2>
<p>Aqui você encontra os status possíveis para NFe.</p>

<table><thead>
<tr>
<th>HTTP CODE/STATUS</th>
<th>Status API Focus</th>
<th>Descrição</th>
<th>Correção</th>
</tr>
</thead><tbody>
<tr>
<td>422 - unprocessable entity</td>
<td>erro_validacao_schema</td>
<td>Erro na validação do Schema XML.</td>
<td>Verifique o detalhamento do erro na resposta da API.</td>
</tr>
<tr>
<td>422 - unprocessable entity</td>
<td>nfe_nao_autorizada</td>
<td>Nota fiscal não autorizada.</td>
<td>O cancelamento só é possível para NFe&#39;s autorizadas.</td>
</tr>
<tr>
<td>404 - not found</td>
<td>nao_encontrado</td>
<td>Utilize o método POST.</td>
<td>O método de envio usado é diferente de POST, por favor, use o HTTP POST.</td>
</tr>
<tr>
<td>404 - not found</td>
<td>nao_encontrado</td>
<td>Nota fiscal não encontrada.</td>
<td>Verifique se a nota a ser cancelada realmente existe antes de enviar o cancelamento.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>Parâmetro &quot;justificativa&quot; não informado.</td>
<td>Você precisa usar o parâmetro &#39;justificativa&#39;. Consulte a nossa documentação.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>Parâmetro &quot;justificativa&quot; deve ter entre 15 e 255 caracteres.</td>
<td>A sua justificativa não possui de 15 à 255 careacteres.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>Parâmetro X não informado.</td>
<td>Onde X é o campo que não foi informado em sua requisição.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>Não existe série com os critérios informados.</td>
<td>Os critérios de inutilização não existem. Verifique a nossa documentação.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>CNPJ do emitente não autorizado ou não informado.</td>
<td>Verifique o campo &quot;cnpj_emitente&quot; em seu JSON. É preciso habilitar a emissão de NFe no cadastro do emitente(Painel API).</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>CNPJ/UF do emitente não autorizado ou não informado.</td>
<td>Verifique os campos &quot;cnpj_emitente&quot; e &quot;uf_emitente&quot;. É preciso habilitar a emissão de NFe no cadastro do emitente(Painel API).</td>
</tr>
<tr>
<td>403 - forbidden</td>
<td>permissao_negada</td>
<td>CNPJ do emitente não autorizado.</td>
<td>O emitente utilizado não está autorizado a emitir NFe ou foi informado o CNPJ do emitente incorretamente no JSON.</td>
</tr>
</tbody></table>
<h2 id='nfe_envio'>Envio</h2><pre class="highlight shell tab-shell"><code><span class="c"># arquivo.json deve conter os dados da NFe, substitua REFERENCIA pela referência de sua escolha</span>
curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -T arquivo.json https://homologacao.focusnfe.com.br/v2/nfe?ref<span class="o">=</span>REFERENCIA
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="cm">/* Você deve definir isso globalmente para sua aplicação.
Para ambiente de produção utilize e a variável abaixo:
$server = "https://api.focusnfe.com.br"; */</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="c1">// Substituir a variável, ref, pela sua identificação interna de nota.
</span><span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
<span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
<span class="nv">$nfe</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
  <span class="s2">"natureza_operacao"</span> <span class="o">=&gt;</span> <span class="s2">"Remessa"</span><span class="p">,</span>
  <span class="s2">"data_emissao"</span> <span class="o">=&gt;</span> <span class="s2">"2017-11-30T12:00:00"</span><span class="p">,</span>
  <span class="s2">"data_entrada_saida"</span> <span class="o">=&gt;</span> <span class="s2">"2017-11-3012:00:00"</span><span class="p">,</span>
  <span class="s2">"tipo_documento"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
  <span class="s2">"finalidade_emissao"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
  <span class="s2">"cnpj_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"51916585000125"</span><span class="p">,</span>
  <span class="s2">"nome_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"ACME LTDA"</span><span class="p">,</span>
  <span class="s2">"nome_fantasia_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"ACME LTDA"</span><span class="p">,</span>
  <span class="s2">"logradouro_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"R. Padre Natal Pigato"</span><span class="p">,</span>
  <span class="s2">"numero_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"100"</span><span class="p">,</span>
  <span class="s2">"bairro_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"Santa Felicidade"</span><span class="p">,</span>
  <span class="s2">"municipio_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"Curitiba"</span><span class="p">,</span>
  <span class="s2">"uf_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"PR"</span><span class="p">,</span>
  <span class="s2">"cep_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"82320030"</span><span class="p">,</span>
  <span class="s2">"inscricao_estadual_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"101942171617"</span><span class="p">,</span>
  <span class="s2">"nome_destinatario"</span> <span class="o">=&gt;</span> <span class="s2">"NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="p">,</span>
  <span class="s2">"cpf_destinatario"</span> <span class="o">=&gt;</span> <span class="s2">"51966818092"</span><span class="p">,</span>
  <span class="s2">"telefone_destinatario"</span> <span class="o">=&gt;</span> <span class="s2">"1196185555"</span><span class="p">,</span>
  <span class="s2">"logradouro_destinatario"</span> <span class="o">=&gt;</span> <span class="s2">"Rua S\u00e3o Janu\u00e1rio"</span><span class="p">,</span>
  <span class="s2">"numero_destinatario"</span> <span class="o">=&gt;</span> <span class="s2">"99"</span><span class="p">,</span>
  <span class="s2">"bairro_destinatario"</span> <span class="o">=&gt;</span> <span class="s2">"Crespo"</span><span class="p">,</span>
  <span class="s2">"municipio_destinatario"</span> <span class="o">=&gt;</span> <span class="s2">"Manaus"</span><span class="p">,</span>
  <span class="s2">"uf_destinatario"</span> <span class="o">=&gt;</span> <span class="s2">"AM"</span><span class="p">,</span>
  <span class="s2">"pais_destinatario"</span> <span class="o">=&gt;</span> <span class="s2">"Brasil"</span><span class="p">,</span>
  <span class="s2">"cep_destinatario"</span> <span class="o">=&gt;</span> <span class="s2">"69073178"</span><span class="p">,</span>
  <span class="s2">"valor_frete"</span> <span class="o">=&gt;</span> <span class="s2">"0.0"</span><span class="p">,</span>
  <span class="s2">"valor_seguro"</span> <span class="o">=&gt;</span> <span class="s2">"0"</span><span class="p">,</span>
  <span class="s2">"valor_total"</span> <span class="o">=&gt;</span> <span class="s2">"47.23"</span><span class="p">,</span>
  <span class="s2">"valor_produtos"</span> <span class="o">=&gt;</span> <span class="s2">"47.23"</span><span class="p">,</span>
  <span class="s2">"modalidade_frete"</span> <span class="o">=&gt;</span> <span class="s2">"0"</span><span class="p">,</span>
  <span class="s2">"items"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
      <span class="s2">"numero_item"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
      <span class="s2">"codigo_produto"</span> <span class="o">=&gt;</span> <span class="s2">"1232"</span><span class="p">,</span>
      <span class="s2">"descricao"</span> <span class="o">=&gt;</span> <span class="s2">"Cartu00f5es de Visita"</span><span class="p">,</span>
      <span class="s2">"cfop"</span> <span class="o">=&gt;</span> <span class="s2">"6923"</span><span class="p">,</span>
      <span class="s2">"unidade_comercial"</span> <span class="o">=&gt;</span> <span class="s2">"un"</span><span class="p">,</span>
      <span class="s2">"quantidade_comercial"</span> <span class="o">=&gt;</span> <span class="s2">"100"</span><span class="p">,</span>
      <span class="s2">"valor_unitario_comercial"</span> <span class="o">=&gt;</span> <span class="s2">"0.4723"</span><span class="p">,</span>
      <span class="s2">"valor_unitario_tributavel"</span> <span class="o">=&gt;</span> <span class="s2">"0.4723"</span><span class="p">,</span>
      <span class="s2">"unidade_tributavel"</span> <span class="o">=&gt;</span> <span class="s2">"un"</span><span class="p">,</span>
      <span class="s2">"codigo_ncm"</span> <span class="o">=&gt;</span> <span class="s2">"49111090"</span><span class="p">,</span>
      <span class="s2">"quantidade_tributavel"</span> <span class="o">=&gt;</span> <span class="s2">"100"</span><span class="p">,</span>
      <span class="s2">"valor_bruto"</span> <span class="o">=&gt;</span> <span class="s2">"47.23"</span><span class="p">,</span>
      <span class="s2">"icms_situacao_tributaria"</span> <span class="o">=&gt;</span> <span class="s2">"400"</span><span class="p">,</span>
      <span class="s2">"icms_origem"</span> <span class="o">=&gt;</span> <span class="s2">"0"</span><span class="p">,</span>
      <span class="s2">"pis_situacao_tributaria"</span> <span class="o">=&gt;</span> <span class="s2">"07"</span><span class="p">,</span>
      <span class="s2">"cofins_situacao_tributaria"</span> <span class="o">=&gt;</span> <span class="s2">"07"</span>
    <span class="p">)</span>
  <span class="p">),</span>
<span class="p">);</span>
<span class="c1">// Inicia o processo de envio das informações usando o cURL.
</span><span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/nfe?ref="</span> <span class="o">.</span> <span class="nv">$ref</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$nfe</span><span class="p">));</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight java tab-java"><code>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFeAutorizar</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JSONException</span><span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfe?ref="</span><span class="o">+</span><span class="n">ref</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="cm">/* Aqui são criados as hash's que receberão os dados da nota. */</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">nfe</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">itens</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>

        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"data_emissao"</span><span class="o">,</span> <span class="s">"2018-01-16T09:38:00"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"natureza_operacao"</span><span class="o">,</span> <span class="s">"Remessa de Produtos"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"forma_pagamento"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"tipo_documento"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"finalidade_emissao"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cnpj_emitente"</span><span class="o">,</span> <span class="s">"51916585000125"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"nome_emitente"</span><span class="o">,</span> <span class="s">"ACME LTDA"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"nome_fantasia_emitente"</span><span class="o">,</span> <span class="s">"ACME TESTES"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"logradouro_emitente"</span><span class="o">,</span> <span class="s">"Rua Interventor Manoel Ribas"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero_emitente"</span><span class="o">,</span> <span class="s">"1355 "</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"bairro_emitente"</span><span class="o">,</span> <span class="s">"Santa Felicidade"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"municipio_emitente"</span><span class="o">,</span> <span class="s">"Curitiba"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"uf_emitente"</span><span class="o">,</span> <span class="s">"PR"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cep_emitente"</span><span class="o">,</span> <span class="s">"82320030"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"telefone_emitente"</span><span class="o">,</span> <span class="s">"44912345678"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"inscricao_estadual_emitente"</span><span class="o">,</span> <span class="s">"1234567"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"nome_destinatario"</span><span class="o">,</span> <span class="s">"NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cpf_destinatario"</span><span class="o">,</span> <span class="s">"51966818092"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"inscricao_estadual_destinatario"</span><span class="o">,</span> <span class="s">"ISENTO"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"telefone_destinatario"</span><span class="o">,</span> <span class="s">"19912345678"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"logradouro_destinatario"</span><span class="o">,</span> <span class="s">"Rua Leonor Campos"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero_destinatario"</span><span class="o">,</span> <span class="s">"29"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"bairro_destinatario"</span><span class="o">,</span> <span class="s">"Swiss Park"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"municipio_destinatario"</span><span class="o">,</span> <span class="s">"Campinas"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"uf_destinatario"</span><span class="o">,</span> <span class="s">"SP"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"pais_destinatario"</span><span class="o">,</span> <span class="s">"Brasil"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cep_destinatario"</span><span class="o">,</span> <span class="s">"13049555"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_base_calculo"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_valor_total"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_base_calculo_st"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_valor_total_st"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_modalidade_base_calculo"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_valor"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_frete"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_seguro"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_total"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_produtos"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_desconto"</span><span class="o">,</span> <span class="s">"0.00"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_ipi"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
        <span class="n">nfe</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"modalidade_frete"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero_item"</span><span class="o">,</span><span class="s">"128"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_produto"</span><span class="o">,</span><span class="s">"1007"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"descricao"</span><span class="o">,</span><span class="s">"Multi Mist 500g"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cfop"</span><span class="o">,</span><span class="s">"6102"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"unidade_comercial"</span><span class="o">,</span><span class="s">"un"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"quantidade_comercial"</span><span class="o">,</span><span class="s">"1"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_unitario_comercial"</span><span class="o">,</span><span class="s">"1"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_unitario_tributavel"</span><span class="o">,</span><span class="s">"1"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"unidade_tributavel"</span><span class="o">,</span><span class="s">"un"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_ncm"</span><span class="o">,</span><span class="s">"11041900"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_frete"</span><span class="o">,</span><span class="s">"0"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_desconto"</span><span class="o">,</span><span class="s">"0.00"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"quantidade_tributavel"</span><span class="o">,</span><span class="s">"1"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_bruto"</span><span class="o">,</span><span class="s">"1"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_situacao_tributaria"</span><span class="o">,</span><span class="s">"103"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_origem"</span><span class="o">,</span><span class="s">"0"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"pis_situacao_tributaria"</span><span class="o">,</span><span class="s">"07"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cofins_situacao_tributaria"</span><span class="o">,</span><span class="s">"07"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"ipi_situacao_tributaria"</span><span class="o">,</span><span class="s">"53"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"ipi_codigo_enquadramento_legal"</span><span class="o">,</span><span class="s">"999"</span><span class="o">);</span>

        <span class="cm">/* Depois de fazer o input dos dados, são criados os objetos JSON já com os valores das hash's. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">nfe</span><span class="o">);</span>
        <span class="n">JSONObject</span> <span class="n">jsonItens</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">itens</span><span class="o">);</span>

        <span class="cm">/* Aqui adicionamos os objetos JSON nos campos da API como array no JSON principal. */</span>
        <span class="n">json</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"items"</span><span class="o">,</span> <span class="n">jsonItens</span><span class="o">);</span>

        <span class="cm">/* É recomendado verificar como os dados foram gerados em JSON e se ele está seguindo a estrutura especificada em nossa documentação.
        System.out.print(json); */</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas a seguir exibem as informações retornadas pela nossa API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre><pre class="highlight ruby tab-ruby"><code><span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfe?ref="</span> <span class="o">+</span> <span class="n">ref</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">dados_da_nota</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">natureza_operacao: </span><span class="s2">"Remessa"</span><span class="p">,</span>
  <span class="ss">data_emissao: </span><span class="s2">"2017-11-30T12:00:00"</span><span class="p">,</span>
  <span class="ss">data_entrada_saida: </span><span class="s2">"2017-11-3012:00:00"</span><span class="p">,</span>
  <span class="ss">tipo_documento: </span><span class="s2">"1"</span><span class="p">,</span>
  <span class="ss">finalidade_emissao: </span><span class="s2">"1"</span><span class="p">,</span>
  <span class="ss">cnpj_emitente: </span><span class="s2">"51916585000125"</span><span class="p">,</span>
  <span class="ss">nome_emitente: </span><span class="s2">"ACME LTDA"</span><span class="p">,</span>
  <span class="ss">nome_fantasia_emitente: </span><span class="s2">"ACME LTDA"</span><span class="p">,</span>
  <span class="ss">logradouro_emitente: </span><span class="s2">"R. Padre Natal Pigato"</span><span class="p">,</span>
  <span class="ss">numero_emitente: </span><span class="s2">"100"</span><span class="p">,</span>
  <span class="ss">bairro_emitente: </span><span class="s2">"Santa Felicidade"</span><span class="p">,</span>
  <span class="ss">municipio_emitente: </span><span class="s2">"Curitiba"</span><span class="p">,</span>
  <span class="ss">uf_emitente: </span><span class="s2">"PR"</span><span class="p">,</span>
  <span class="ss">cep_emitente: </span><span class="s2">"82320030"</span><span class="p">,</span>
  <span class="ss">inscricao_estadual_emitente: </span><span class="s2">"101942171617"</span><span class="p">,</span>
  <span class="ss">nome_destinatario: </span><span class="s2">"NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="p">,</span>
  <span class="ss">cpf_destinatario: </span><span class="s2">"51966818092"</span><span class="p">,</span>
  <span class="ss">telefone_destinatario: </span><span class="s2">"1196185555"</span><span class="p">,</span>
  <span class="ss">logradouro_destinatario: </span><span class="s2">"Rua Sao Januario"</span><span class="p">,</span>
  <span class="ss">numero_destinatario: </span><span class="s2">"99"</span><span class="p">,</span>
  <span class="ss">bairro_destinatario: </span><span class="s2">"Crespo"</span><span class="p">,</span>
  <span class="ss">municipio_destinatario: </span><span class="s2">"Manaus"</span><span class="p">,</span>
  <span class="ss">uf_destinatario: </span><span class="s2">"AM"</span><span class="p">,</span>
  <span class="ss">pais_destinatario: </span><span class="s2">"Brasil"</span><span class="p">,</span>
  <span class="ss">cep_destinatario: </span><span class="s2">"69073178"</span><span class="p">,</span>
  <span class="ss">valor_frete: </span><span class="s2">"0.0"</span><span class="p">,</span>
  <span class="ss">valor_seguro: </span><span class="s2">"0"</span><span class="p">,</span>
  <span class="ss">valor_total: </span><span class="s2">"47.23"</span><span class="p">,</span>
  <span class="ss">valor_produtos: </span><span class="s2">"47.23"</span><span class="p">,</span>
  <span class="ss">modalidade_frete: </span><span class="s2">"0"</span><span class="p">,</span>
  <span class="ss">items: </span><span class="p">[</span>
    <span class="ss">numero_item: </span><span class="s2">"1"</span><span class="p">,</span>
    <span class="ss">codigo_produto: </span><span class="s2">"1232"</span><span class="p">,</span>
    <span class="ss">descricao: </span><span class="s2">"Cartu00f5es de Visita"</span><span class="p">,</span>
    <span class="ss">cfop: </span><span class="s2">"6923"</span><span class="p">,</span>
    <span class="ss">unidade_comercial: </span><span class="s2">"un"</span><span class="p">,</span>
    <span class="ss">quantidade_comercial: </span><span class="s2">"100"</span><span class="p">,</span>
    <span class="ss">valor_unitario_comercial: </span><span class="s2">"0.4723"</span><span class="p">,</span>
    <span class="ss">valor_unitario_tributavel: </span><span class="s2">"0.4723"</span><span class="p">,</span>
    <span class="ss">unidade_tributavel: </span><span class="s2">"un"</span><span class="p">,</span>
    <span class="ss">codigo_ncm: </span><span class="s2">"49111090"</span><span class="p">,</span>
    <span class="ss">quantidade_tributavel: </span><span class="s2">"100"</span><span class="p">,</span>
    <span class="ss">valor_bruto: </span><span class="s2">"47.23"</span><span class="p">,</span>
    <span class="ss">icms_situacao_tributaria: </span><span class="s2">"400"</span><span class="p">,</span>
    <span class="ss">icms_origem: </span><span class="s2">"0"</span><span class="p">,</span>
    <span class="ss">pis_situacao_tributaria: </span><span class="s2">"07"</span><span class="p">,</span>
    <span class="ss">cofins_situacao_tributaria: </span><span class="s2">"07"</span>
  <span class="p">]</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>

<span class="c1"># convertemos os dados da nota para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">dados_da_nota</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota.</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfe?ref="</span> <span class="o">+</span> <span class="nx">ref</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">nfe</span> <span class="o">=</span> <span class="p">{</span>
<span class="s2">"natureza_operacao"</span><span class="p">:</span> <span class="s2">"Remessa"</span><span class="p">,</span>
<span class="s2">"data_emissao"</span><span class="p">:</span> <span class="s2">"2018-03-21T11:00:00"</span><span class="p">,</span>
<span class="s2">"data_entrada_saida"</span><span class="p">:</span> <span class="s2">"2018-03-21T11:00:00"</span><span class="p">,</span>
<span class="s2">"tipo_documento"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
<span class="s2">"finalidade_emissao"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
<span class="s2">"cnpj_emitente"</span><span class="p">:</span> <span class="s2">"51916585000125"</span><span class="p">,</span>
<span class="s2">"nome_emitente"</span><span class="p">:</span> <span class="s2">"ACME LTDA"</span><span class="p">,</span>
<span class="s2">"nome_fantasia_emitente"</span><span class="p">:</span> <span class="s2">"ACME LTDA"</span><span class="p">,</span>
<span class="s2">"logradouro_emitente"</span><span class="p">:</span> <span class="s2">"R. Padre Natal Pigato"</span><span class="p">,</span>
<span class="s2">"numero_emitente"</span><span class="p">:</span> <span class="s2">"100"</span><span class="p">,</span>
<span class="s2">"bairro_emitente"</span><span class="p">:</span> <span class="s2">"Santa Felicidade"</span><span class="p">,</span>
<span class="s2">"municipio_emitente"</span><span class="p">:</span> <span class="s2">"Curitiba"</span><span class="p">,</span>
<span class="s2">"uf_emitente"</span><span class="p">:</span> <span class="s2">"PR"</span><span class="p">,</span>
<span class="s2">"cep_emitente"</span><span class="p">:</span> <span class="s2">"82320030"</span><span class="p">,</span>
<span class="s2">"inscricao_estadual_emitente"</span><span class="p">:</span> <span class="s2">"1234567"</span><span class="p">,</span>
<span class="s2">"nome_destinatario"</span><span class="p">:</span> <span class="s2">"NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="p">,</span>
<span class="s2">"cpf_destinatario"</span><span class="p">:</span> <span class="s2">"51966818092"</span><span class="p">,</span>
<span class="s2">"telefone_destinatario"</span><span class="p">:</span> <span class="s2">"1196185555"</span><span class="p">,</span>
<span class="s2">"logradouro_destinatario"</span><span class="p">:</span> <span class="s2">"Rua S\u00e3o Janu\u00e1rio"</span><span class="p">,</span>
<span class="s2">"numero_destinatario"</span><span class="p">:</span> <span class="s2">"99"</span><span class="p">,</span>
<span class="s2">"bairro_destinatario"</span><span class="p">:</span> <span class="s2">"Crespo"</span><span class="p">,</span>
<span class="s2">"municipio_destinatario"</span><span class="p">:</span> <span class="s2">"Manaus"</span><span class="p">,</span>
<span class="s2">"uf_destinatario"</span><span class="p">:</span> <span class="s2">"AM"</span><span class="p">,</span>
<span class="s2">"pais_destinatario"</span><span class="p">:</span> <span class="s2">"Brasil"</span><span class="p">,</span>
<span class="s2">"cep_destinatario"</span><span class="p">:</span> <span class="s2">"69073178"</span><span class="p">,</span>
<span class="s2">"valor_frete"</span><span class="p">:</span> <span class="s2">"0.0"</span><span class="p">,</span>
<span class="s2">"valor_seguro"</span><span class="p">:</span> <span class="s2">"0"</span><span class="p">,</span>
<span class="s2">"valor_total"</span><span class="p">:</span> <span class="s2">"47.23"</span><span class="p">,</span>
<span class="s2">"valor_produtos"</span><span class="p">:</span> <span class="s2">"47.23"</span><span class="p">,</span>
<span class="s2">"modalidade_frete"</span><span class="p">:</span> <span class="s2">"0"</span><span class="p">,</span>
<span class="s2">"items"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">"numero_item"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
      <span class="s2">"codigo_produto"</span><span class="p">:</span> <span class="s2">"1232"</span><span class="p">,</span>
      <span class="s2">"descricao"</span><span class="p">:</span> <span class="s2">"Cartu00f5es de Visita"</span><span class="p">,</span>
      <span class="s2">"cfop"</span><span class="p">:</span> <span class="s2">"6923"</span><span class="p">,</span>
      <span class="s2">"unidade_comercial"</span><span class="p">:</span> <span class="s2">"un"</span><span class="p">,</span>
      <span class="s2">"quantidade_comercial"</span><span class="p">:</span> <span class="s2">"100"</span><span class="p">,</span>
      <span class="s2">"valor_unitario_comercial"</span><span class="p">:</span> <span class="s2">"0.4723"</span><span class="p">,</span>
      <span class="s2">"valor_unitario_tributavel"</span><span class="p">:</span> <span class="s2">"0.4723"</span><span class="p">,</span>
      <span class="s2">"unidade_tributavel"</span><span class="p">:</span> <span class="s2">"un"</span><span class="p">,</span>
      <span class="s2">"codigo_ncm"</span><span class="p">:</span> <span class="s2">"49111090"</span><span class="p">,</span>
      <span class="s2">"quantidade_tributavel"</span><span class="p">:</span> <span class="s2">"100"</span><span class="p">,</span>
      <span class="s2">"valor_bruto"</span><span class="p">:</span> <span class="s2">"47.23"</span><span class="p">,</span>
      <span class="s2">"icms_situacao_tributaria"</span><span class="p">:</span> <span class="s2">"400"</span><span class="p">,</span>
      <span class="s2">"icms_origem"</span><span class="p">:</span> <span class="s2">"0"</span><span class="p">,</span>
      <span class="s2">"pis_situacao_tributaria"</span><span class="p">:</span> <span class="s2">"07"</span><span class="p">,</span>
      <span class="s2">"cofins_situacao_tributaria"</span><span class="p">:</span> <span class="s2">"07"</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">nfe</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfe"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>
<span class="n">ref</span> <span class="o">=</span> <span class="p">{</span><span class="s">"ref"</span><span class="p">:</span><span class="s">"12345"</span><span class="p">}</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="s">'''
Usamos dicionarios para armazenar os campos e valores que em seguida,
serao convertidos em JSON e enviados para nossa API
'''</span>
<span class="n">nfe</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">itens</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">notas_referenciadas</span> <span class="o">=</span><span class="p">{}</span>

<span class="n">nfe</span><span class="p">[</span><span class="s">"natureza_operacao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Venda"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"forma_pagamento"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"data_emissao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"2018-03-07T10:20:00-03:00"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"tipo_documento"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"local_destino"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"finalidade_emissao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"4"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"consumidor_final"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"presenca_comprador"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"9"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"cnpj_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"99999999999999"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"logradouro_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"R. Padre Pigato"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"numero_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"9236"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"bairro_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Santa Gula"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"municipio_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Curitiba"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"uf_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"PR"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"cep_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"82320999"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"telefone_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"4199999999"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"inscricao_estadual_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"999999999"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"regime_tributario_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"cpf_destinatario"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"99999999999"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"nome_destinatario"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"logradouro_destinatario"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Rua Prof. Yolanda Romeu Lugarini"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"numero_destinatario"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"bairro_destinatario"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"JD SANTA CECILIA"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"municipio_destinatario"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"CAMPO MAGRO"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"uf_destinatario"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"PR"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"cep_destinatario"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"83000000"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"indicador_inscricao_estadual_destinatario"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"2"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"icms_base_calculo"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"icms_valor_total"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"icms_valor_total_desonerado"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"icms_base_calculo_st"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"icms_valor_total_st"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"valor_produtos"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"valor_frete"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"valor_seguro"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"valor_desconto"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"valor_total_ii"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"valor_ipi"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"valor_pis"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"valor_cofins"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"valor_outras_despesas"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"valor_total"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"modalidade_frete"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">notas_referenciadas</span><span class="p">[</span><span class="s">"chave_nfe"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">41170599999999999999550020000001111337477298</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"numero_item"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"codigo_produto"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"ESSP"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"descricao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Carrinho de corrida"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"cfop"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1202"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"unidade_comercial"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"UN"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"quantidade_comercial"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"valor_unitario_comercial"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"valor_bruto"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"valor_desconto"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"unidade_tributavel"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"UN"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"codigo_ncm"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"49119900"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"quantidade_tributavel"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"valor_unitario_tributavel"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"inclui_no_total"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"icms_origem"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"icms_situacao_tributaria"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"103"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"pis_situacao_tributaria"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"99"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"cofins_situacao_tributaria"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"99"</span>

<span class="c"># Adicionamos os dados das variaveis itens e notas_referenciadas como listas ao dicionario principal.</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"items"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">itens</span><span class="p">]</span>
<span class="n">nfe</span><span class="p">[</span><span class="s">"notas_referenciadas"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">notas_referenciadas</span><span class="p">]</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">nfe</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre>
<p>Para enviar uma NFe utilize a URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Envia uma NFe para autorização:</p>

<p><code>https://api.focusnfe.com.br/v2/nfe?ref=REFERENCIA</code></p>

<p>Utilize o comando <strong>HTTP POST</strong> para enviar a sua nota para nossa API. Envie como corpo do POST os dados em formato JSON da nota fiscal.</p>

<p>Nesta etapa, é feita uma primeira validação dos dados da nota. Caso ocorra algum problema, por exemplo, algum campo faltante, formato incorreto
ou algum problema com o emitente a nota <strong>não será aceita para processamento</strong> e será devolvida a mensagem de erro apropriada. Veja a seção <a href="#introducao_erros">erros</a>.</p>

<p>Caso a nota seja validada corretamente, a nota será <strong>aceita para processamento</strong>. Isto significa que a nota irá para uma fila de processamento
onde eventualmente será processada (processamento assíncrono). Com isto, a nota poderá ser autorizada ou ocorrer um erro na autorização, de acordo com a validação da SEFAZ.</p>

<p>Para verificar se a nota já foi autorizada, você terá que efetuar uma <a href="#nfe_consulta">consulta</a> ou se utilizar de <a href="#gatilhos_gatilhos">gatilhos</a>.</p>
<h3 id='nfe_reenvio-automatico-em-contingencia'>Reenvio automático em contingência</h3>
<p>Caso nossa equipe de monitoramento detecte que o SEFAZ de algum estado esteja fora do ar as requisições são redirecionadas para o ambiente de contingência da SEFAZ do estado. É natural haver uma demora na SEFAZ em disponibilizar esse ambiente (eles realizam este processo manualmente) porém nossa API irá continuar tentando o reenvio até que seja possível, seja pela emissão normal ou em contingência. Isto é feito de forma transparente aos clientes da API.</p>

<p>Porém, pode ocorrer uma situação em que o SEFAZ do estado fique indisponível no meio do processo de emissão de uma NFe. Neste momento nós não temos como saber se a nota foi autorizada ou não, até que a SEFAZ volte a ficar disponível.</p>

<p>Quando isto ocorre nós não esperamos a SEFAZ do estado voltar e reenviamos assim que possível para o ambiente de contingência, autorizando a nota e evitando a espera para o cliente final. Isto tem como efeito colateral que pode ser que a nota original tenha sido autorizada. Nossa API irá automaticamente detectar esta situação e proceder com o cancelamento da tentativa anterior. Por consequência, será natural haver um “pulo” de numeração percebido pelo cliente final.</p>

<p>O sistema cliente da API pode acompanhar este processo de forma transparente, conforme descrito na seção “Consulta” deste manual.</p>

<blockquote>
<p>Exemplos de respostas da API por <strong>status</strong> para a requisição de envio:</p>

<p>autorizado</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"referencia_000899_nfe"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Autorizado o uso da NF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NFe41190607504505000132550010000000221923094166"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"22"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_nota_fiscal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/41190607504505000132550010000000221923094166-nfe.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_danfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/DANFEs/41190607504505000132550010000000221923094166.pdf"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>erro_validacao_schema</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"erro_validacao_schema"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Erro na validação do Schema XML, verifique o detalhamento dos erros"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"erros"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"mensagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Preencha pelo menos um documento do destinatário: cnpj_destinatario ou cpf_destinatario"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"campo"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='nfe_consulta'>Consulta</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfe/"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="c"># Use este parametro para obter mais informacoes em suas consultas</span>
<span class="n">completa</span> <span class="o">=</span> <span class="s">"completa=1"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">ref</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">completa</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfe/12345
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="cm">/* Você deve definir isso globalmente para sua aplicação.
Para ambiente de produção utilize e a variável abaixo:
$server = "https://api.focusnfe.com.br"; */</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="c1">// Substituir a variável, ref, pela sua identificação interna de nota.
</span><span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
<span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
<span class="c1">// Inicia o processo de envio das informações usando o cURL.
</span><span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/nfe/"</span> <span class="o">.</span> <span class="nv">$ref</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFeConsulta</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfe/"</span><span class="o">+</span><span class="n">ref</span><span class="o">+</span><span class="s">"?completa=1"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfe/"</span> <span class="o">+</span> <span class="n">ref</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>
<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfe/"</span> <span class="o">+</span> <span class="nx">ref</span> <span class="o">+</span> <span class="s2">"?completa=1"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<blockquote>
<p>Exemplo de resposta com o parâmetro opcional, <strong>completa</strong>, recebendo o valor &quot;1&quot;:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"requisicao_cancelamento"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"versao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"id_tag"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID1101119118017764335300017255003000000025138154946401"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_orgao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"41"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ambiente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CNPJ_DO_EMITENTE"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"91180177643353000172550030000000251381549464"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-01-17T16:00:28-02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tipo_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"110111"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero_sequencial_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"versao_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cancelamento"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"protocolo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"141180000026777"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"justificativa"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Informe aqui a sua justificativa para realizar o cancelamento da NFe."</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"protocolo_cancelamento"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"versao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ambiente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"versao_aplicativo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PR-v3_8_7"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_orgao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"41"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"motivo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a NF-e"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"91180177643353000172550030000000251381549464"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tipo_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"110111"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cancelamento"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-01-17T16:00:31-02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero_protocolo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"141180000026777"</span><span class="w">
  </span><span class="p">},</span><span class="w">
   </span><span class="s2">"requisicao_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"versao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"id_tag"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID1101109118017764335300017255003000000025138154946401"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_orgao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"41"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ambiente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CNPJ_DO_EMITENTE"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"91180177643353000172550030000000251381549464"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-01-17T15:59:34-02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tipo_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"110110"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero_sequencial_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"versao_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Carta de Correcao"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"correcao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Informe aqui os campos que foram corrigidos na NFe."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"condicoes_uso"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A Carta de Correcao e disciplinada pelo paragrafo 1o-A do art. 7o do Convenio S/N, de 15 de dezembro de 1970 e pode ser utilizada para regularizacao de erro ocorrido na emissao de documento fiscal, desde que o erro nao esteja relacionado com: I - as variaveis que determinam o valor do imposto tais como: base de calculo, aliquota, diferenca de preco, quantidade, valor da operacao ou da prestacao; II - a correcao de dados cadastrais que implique mudanca do remetente ou do destinatario; III - a data de emissao ou de saida."</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"protocolo_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"versao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ambiente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"versao_aplicativo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PR-v3_8_7"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_orgao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"41"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"motivo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a NF-e"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"91180177643353000172550030000000251381549464"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tipo_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"110110"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Carta de Correção"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-01-17T15:59:37-02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero_protocolo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"141180000026777"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Exemplos de respostas da API por <strong>status</strong> para a requisição de consulta:</p>

<p>autorizado</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"referencia_000899_nfe"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Autorizado o uso da NF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NFe41190607504505000132550010000000221923094166"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"22"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_nota_fiscal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/41190607504505000132550010000000221923094166-nfe.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_danfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/DANFEs/41190607504505000132550010000000221923094166.pdf"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>autorizado (com CCe)</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"referencia_000899_nfe"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a NF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NFe41190607504505000132550010000000221923094166"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"22"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_nota_fiscal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/41190607504505000132550010000000221923094166-nfe.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_danfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/DANFEs/41190607504505000132550010000000221923094166.pdf"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/41190607504505000132550010000000221923094166-cce-01.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_pdf_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/notas_fiscais/NFe41190607504505000132550010000000221923094166/cartas_correcao/1.pdf"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>processando_autorizacao</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"referencia_000899_nfe"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"processando_autorizacao"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>erro_autorizacao</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"referencia_000899_nfe"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"erro_autorizacao"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"598"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NF-e emitida em ambiente de homologacao com Razao Social do destinatario diferente de NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>cancelado</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"referencia_000899_nfe"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cancelado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a NF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"22"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NFe41190607504505000132550010000000221923094166"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_nota_fiscal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/41190607504505000132550010000000221923094166-nfe.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_cancelamento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/41190607504505000132550010000000221923094166-can.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/41190607504505000132550010000000221923094166-cce-02.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_pdf_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/notas_fiscais/NFe41190607504505000132550010000000221923094166/cartas_correcao/2.pdf"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Após emitir uma nota, você poderá usar a operação de consulta para verificar se a nota já foi aceita para processamento, se está
ainda em processamento ou se a nota já foi processada.</p>

<p>Para consultar uma NFe utilize a URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Consultar as informações de uma NFe:</p>

<p><code>https://api.focusnfe.com.br/v2/nfe/REFERENCIA?completa=(0|1)</code></p>

<p>Utilize o comando <strong>HTTP GET</strong> para consultar a sua nota para nossa API.</p>

<table><thead>
<tr>
<th>Parâmetro Opcional</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>completa = 0 ou 1</td>
<td>Habilita a API há mostrar campos adicionais na requisição de consulta.</td>
</tr>
</tbody></table>

<p>Campos de retorno:</p>

<ul>
<li><strong>status</strong>: A situação da NFe, podendo ser:

<ul>
<li><strong>processando_autorizacao</strong>: A nota ainda está em processamento pela API. Você deverá aguardar o processamento pela SEFAZ.</li>
<li><strong>autorizado</strong>: A nota foi autorizada, neste caso é fornecido os dados completos da nota como chave e arquivos para download</li>
<li><strong>cancelado</strong>: O documento foi cancelado, neste caso é fornecido o caminho para download do XML de cancelamento (caminho_xml_cancelamento).</li>
<li><strong>erro_autorizacao</strong>: Houve um erro de autorização por parte da SEFAZ. A mensagem de erro você encontrará nos campos status_sefaz e mensagem_sefaz. É possível fazer o reenvio da nota com a mesma referência se ela estiver neste estado.</li>
<li><strong>denegado</strong>: O documento foi denegado. Uma SEFAZ pode denegar uma nota se houver algum erro cadastral nos dados do destinatário ou do emitente. A mensagem de erro você encontrará nos campos status_sefaz e mensagem_sefaz. Não é possível reenviar a nota caso este estado seja alcançado pois é gerado um número, série, chave de NFe e XML para esta nota. O XML deverá ser armazenado pelo mesmo período de uma nota autorizada ou cancelada.</li>
</ul></li>
<li><strong>status_sefaz</strong>: O status da nota na SEFAZ.</li>
<li><strong>mensagem_sefaz</strong>: Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>serie</strong>: A série da nota fiscal, caso ela tenha sido autorizada.</li>
<li><strong>numero</strong>: O número da nota fiscal, caso ela tenha sido autorizada.</li>
<li><strong>cnpj_emitente</strong>: O CNPJ emitente da nota fiscal (o CNPJ de sua empresa).</li>
<li><strong>ref</strong>:A referência da emissão.</li>
<li><strong>chave_nfe</strong>: A chave da NFe, caso ela tenha sido autorizada.</li>
<li><strong>caminho_xml_nota_fiscal</strong>: caso a nota tenha sido autorizada, retorna o caminho para download do XML.</li>
<li><strong>caminho_danfe</strong>: caso a nota tenha sido autorizada retorna o caminho para download do DANFe.</li>
<li><strong>caminho_xml_carta_correcao</strong>: caso tenha sido emitida alguma carta de correção, aqui aparecerá o caminho para fazer o download do XML.</li>
<li><strong>caminho_pdf_carta_correcao</strong>: caso tenha sido emitida alguma carta de correção, aqui aparecerá o caminho para fazer o download do PDF da carta.</li>
<li><strong>numero_carta_correcao</strong>: o número da carta de correção, caso tenha sido emitida.</li>
<li><strong>caminho_xml_cancelamento</strong>: Caso a nota esteja cancelada, é fornecido o caminho para fazer o download do XML de cancelamento.</li>
</ul>

<p>Caso na requisição seja passado o parâmetro <code>completa=1</code> será adicionado mais 6 campos:</p>

<ul>
<li><strong>requisicao_nota_fiscal</strong>: Inclui os dados completos da requisição da nota fiscal, da mesma forma que constam no XML da nota.</li>
<li><strong>protocolo_nota_fiscal</strong>: Inclui os dados completos do protocolo devolvido pela SEFAZ.</li>
<li><strong>requisicao_cancelamento</strong>: Inclui os dados completos da requisição de cancelamento da nota fiscal.</li>
<li><strong>protocolo_cancelamento</strong>: Inclui os dados completos do protocolo devolvido pela SEFAZ.</li>
<li><strong>requisicao_carta_correcao</strong>: Inclui os dados completos da requisição de Carta de Correção Eletrônica da NFe.</li>
<li><strong>protocolo_carta_correcao</strong>: Inclui os dados completos do protocolo devolvido pela SEFAZ.</li>
</ul>
<h3 id='nfe_reenvio-automatico-em-contingencia-algumas-consideracoes'>Reenvio Automático em Contingência – algumas considerações</h3>
<p>Quando houver uma tentativa anterior de emissão, conforme descrito na seção “Reenvio automático em contingência”. A API irá devolver a chave <code>tentativa_anterior</code> que irá conter os seguintes campos:</p>

<ul>
<li>status: autorizado, processando_autorizacao ou cancelado. A API irá automaticamente proceder com o cancelamento quando necessário</li>
<li>serie</li>
<li>numero</li>
<li>chave_nfe</li>
<li>caminho_xml_nota_fiscal</li>
<li>caminho_xml_cancelamento</li>
</ul>
<h3 id='nfe_download-do-xml-da-nfe'>Download do XML da NFe</h3>
<p>Após a autorização da nota fiscal eletrônica será disponibilizado os campos:</p>

<p>caminho_xml_nota_fiscal - Representa o caminho para montar a URL para download do XML. Por exemplo, se você utilizou o ambiente de produção (https://api.focusnfe.com.br) e o caminho_xml_nota_fiscal contém o caminho &quot;/arquivos_development/77623353000000/201201/XMLs/91180177643353000172550030000000251381549464-nfe.xml&quot; você poderá acessar o XML pela URL completa https://api.focusnfe.com.br/arquivos_development/77623353000000/201201/XMLs/91180177643353000172550030000000251381549464-nfe.xml</p>

<p>Utilize o método <strong>HTTP GET</strong> para essa consulta.</p>

<p>Existe obrigatoriedade legal para armazenar o XML de todas as notas NFe (modelo 55) por pelo menos 5 anos após a data de autorização da nota. Nossa API faz a guarda automática dos arquivos por esse período.</p>
<h2 id='nfe_cancelamento'>Cancelamento</h2><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X DELETE -d <span class="s1">'{"justificativa":"Teste de cancelamento de nota"}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfe/12345
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="cm">/* Você deve definir isso globalmente para sua aplicação.
Para ambiente de produção utilize e a variável abaixo:
$server = "https://api.focusnfe.com.br"; */</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="c1">// Substituir a variável, ref, pela sua identificação interna de nota.
</span><span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
<span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
<span class="nv">$justificativa</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span><span class="s2">"justificativa"</span> <span class="o">=&gt;</span> <span class="s2">"Teste de cancelamento de nota"</span><span class="p">);</span>
<span class="c1">// Inicia o processo de envio das informações usando o cURL.
</span><span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span> <span class="o">.</span> <span class="s2">"/v2/nfe/"</span> <span class="o">.</span> <span class="nv">$ref</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_CUSTOMREQUEST</span><span class="p">,</span> <span class="s2">"DELETE"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$justificativa</span><span class="p">));</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFeCancelamento</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfe/"</span><span class="o">+</span><span class="n">ref</span><span class="o">);</span>
        <span class="cm">/* Aqui criamos um hashmap para receber a chave "justificativa" e o valor desejado. */</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">justificativa</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">justificativa</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"justificativa"</span><span class="o">,</span> <span class="s">"Informe aqui a sua justificativa para realizar o cancelamento da NFe."</span><span class="o">);</span>

        <span class="cm">/* Criamos um objeto JSON para receber a hash com os dados esperado pela API. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">justificativa</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

       <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
        * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfe/"</span> <span class="o">+</span> <span class="n">ref</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">justificativa_cancelamento</span> <span class="o">=</span> <span class="p">{</span>  
  <span class="ss">justificativa: </span><span class="s2">"Informe aqui a sua justificativa para realizar o cancelamento da NFe."</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Delete a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Delete</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos a hash de justificativa do cancelamento para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">justificativa_cancelamento</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota.</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfe/"</span><span class="o">+</span> <span class="nx">ref</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'DELETE'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">cancelar</span> <span class="o">=</span> <span class="p">{</span>

    <span class="s2">"justificativa"</span><span class="p">:</span> <span class="s2">"Sua justificativa aqui!"</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">cancelar</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfe/"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="s">'''
Usamos um dicionario para armazenar os campos e valores que em seguida,
serao convertidos a JSON e enviados para nossa API
'''</span>
<span class="n">justificativa</span><span class="o">=</span><span class="p">{}</span>
<span class="n">justificativa</span><span class="p">[</span><span class="s">"justificativa"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Sua justificativa aqui!"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">justificativa</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre>
<p>Para cancelar uma NFe, basta fazer uma requisição à URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Cancelar uma NFe já autorizada:</p>

<p><code>https://api.focusnfe.com.br/v2/nfe/REFERENCIA</code></p>

<p>Utilize o comando <strong>HTTP DELETE</strong> para cancelar a sua nota para nossa API. Este método é síncrono, ou seja, a comunicação com a SEFAZ será feita imediatamente e devolvida a resposta na mesma requisição.</p>

<p>O parâmetro de cancelamento deverá ser enviado da seguinte forma:</p>

<ul>
<li><strong>justificativa</strong>: Justificativa do cancelamento. Deverá conter de 15 a 255 caracteres.</li>
</ul>

<p>A API irá em seguida devolver os seguintes campos:</p>

<ul>
<li><strong>status</strong>: cancelado, se a nota pode ser cancelada, ou erro_cancelamento, se houve algum erro ao cancelar a nota.</li>
<li><strong>status_sefaz</strong>: O status do cancelamento na SEFAZ.</li>
<li><strong>mensagem_sefaz</strong>: Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>caminho_xml_cancelamento</strong>: Caso a nota tenha sido cancelada, será informado aqui o caminho para download do XML de cancelamento.</li>
</ul>
<h3 id='nfe_prazo-de-cancelamento'>Prazo de cancelamento</h3>
<p>A NFe poderá ser cancelada em até 24 horas após a emissão. No entanto, alguns estados podem permitir um prazo maior para o cancelamento.</p>

<blockquote>
<p>Exemplos de respostas da API por <strong>status</strong> para a requisição de cancelamento:</p>

<p>cancelado</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a NF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cancelado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_cancelamento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/41190607504505000132550010000000221923094166-can.xml"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>requisicao_invalida</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"requisicao_invalida"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Parâmetro </span><span class="se">\"</span><span class="s2">justificativa</span><span class="se">\"</span><span class="s2"> deve ter entre 15 e 255 caracteres"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='nfe_carta-de-correcao-eletronica'>Carta de Correção Eletrônica</h2><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -d <span class="s1">'{"correcao":"Teste de carta de correcao"}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfe/12345/carta_correcao
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="cm">/* Você deve definir isso globalmente para sua aplicação.
Para ambiente de produção utilize e a variável abaixo:
$server = "https://api.focusnfe.com.br"; */</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="c1">// Substituir a variável, ref, pela sua identificação interna de nota.
</span><span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
<span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
<span class="nv">$correcao</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
  <span class="s2">"correcao"</span> <span class="o">=&gt;</span> <span class="s2">"Teste de carta de correcao"</span><span class="p">,</span>
<span class="p">);</span>
<span class="c1">// Inicia o processo de envio das informações usando o cURL.
</span><span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span> <span class="o">.</span> <span class="s2">"/v2/nfe/"</span> <span class="o">.</span> <span class="nv">$ref</span>  <span class="o">.</span> <span class="s2">"/carta_correcao"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$correcao</span><span class="p">));</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFeCCe</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfe/"</span><span class="o">+</span><span class="n">ref</span><span class="o">+</span><span class="s">"/carta_correcao"</span><span class="o">);</span>

        <span class="cm">/* Aqui criamos um hashmap para receber a chave "correcao" e o valor desejado. */</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">correcao</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">correcao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"correcao"</span><span class="o">,</span> <span class="s">"Informe aqui os campos que foram corrigidos na NFe."</span><span class="o">);</span>

        <span class="cm">/* Criamos um objeto JSON para receber a hash com os dados esperado pela API. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">correcao</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

       <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
        * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfe/"</span> <span class="o">+</span> <span class="n">ref</span> <span class="o">+</span> <span class="s2">"/carta_correcao"</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">correcao</span> <span class="o">=</span> <span class="p">{</span>  
  <span class="ss">correcao: </span><span class="s2">"Informe aqui os campos que foram corrigidos na NFe."</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos a hash de justificativa do cancelamento para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">correcao</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota.</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfe/"</span><span class="o">+</span> <span class="nx">ref</span> <span class="o">+</span> <span class="s2">"/carta_correcao"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">cce</span> <span class="o">=</span> <span class="p">{</span>

    <span class="s2">"correcao"</span><span class="p">:</span> <span class="s2">"A sua correção aqui!"</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">cce</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfe/"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="s">'''
Usamos um dicionario para armazenar os campos e valores que em seguida,
serao convertidos a JSON e enviados para nossa API
'''</span>
<span class="n">cce</span><span class="o">=</span><span class="p">{}</span>
<span class="n">cce</span><span class="p">[</span><span class="s">"correcao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"A sua correção aqui!"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">ref</span><span class="o">+</span><span class="s">"/carta_correcao"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cce</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>Exemplos de respostas da API por <strong>status</strong> para a requisição de carta de correção:</p>

<p>autorizado</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a NF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/41190607504505000132550010000000221923094166-cce-01.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_pdf_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/notas_fiscais/NFe41190607504505000132550010000000221923094166/cartas_correcao/1.pdf"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Uma Carta de Correção eletrônica (CCe) pode ser utilizada para corrigir eventuais erros na NFe. As seguintes informações <strong>não podem ser corrigidas</strong>:</p>

<ul>
<li>As variáveis que determinam o valor do imposto tais como: base de cálculo, alíquota, diferença de preço, quantidade, valor da operação ou da prestação;</li>
<li>A correção de dados cadastrais que implique mudança do remetente ou do destinatário;</li>
<li>A data de emissão ou de saída.</li>
</ul>

<p>Não existe prazo especificado para emissão de cartas de correção. É possível enviar até 20 correções diferentes, sendo que será válido sempre a última correção enviada.</p>
<h3 id='nfe_emissao-de-cce'>Emissão de CCe</h3>
<p><code>https://api.focusnfe.com.br/v2/nfe/REFERENCIA/carta_correcao</code></p>

<p>Utilize o comando <strong>HTTP POST</strong> para enviar a sua nota para nossa API. Este método é <strong>síncrono</strong>, ou seja, a comunicação com a SEFAZ será feita imediatamente e devolvida a resposta na mesma requisição.</p>

<p>O parâmetros da carta de correção deverão ser enviados da seguinte forma:</p>

<ul>
<li><strong>correcao</strong>: Texto da carta de correção. Deverá conter de 15 a 1000 caracteres.</li>
<li><strong>data_evento</strong>: Campo opcional. Data do evento da carta de correção. Se não informado será usado a data atual</li>
</ul>

<p>A API irá em seguida devolver os seguintes campos:</p>

<ul>
<li><strong>status</strong>: autorizado, se a carta de correção foi aceita pela SEFAZ, ou erro_autorizacao, se houve algum erro ao cancelar a nota.</li>
<li><strong>status_sefaz</strong>: O status da carta de correção na SEFAZ.</li>
<li><strong>mensagem_sefaz</strong>: Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>caminho_xml_carta_correcao</strong>: Informa o caminho do XML da carta de correção, caso ela tenha sido autorizada.</li>
<li><strong>caminho_pdf_carta_correcao</strong>: Informa o caminho do PDF da carta de correção, caso ela tenha sido autorizada.</li>
<li><strong>numero_carta_correcao</strong>: Informa o número da carta de correção, caso ela tenha sido autorizada.</li>
</ul>

<p>Para uma mesma nota fiscal é possível enviar mais de uma carta de correção, até o limite de 20 correções, sendo que a última sempre substitui a anterior.</p>
<h2 id='nfe_reenvio-de-e-mail'>Reenvio de e-mail</h2><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -d <span class="s1">'{"emails":["alguem@example.org"]}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfe/12345/email
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="cm">/* Você deve definir isso globalmente para sua aplicação
Para ambiente de produção utilize e a variável abaixo:
$server = "https://api.focusnfe.com.br"; */</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="c1">// Substituir a variável, ref, pela sua identificação interna de nota.
</span><span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
<span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
<span class="nv">$email</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
  <span class="s2">"emails"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="s2">"email@email.com"</span>
    <span class="p">)</span>
  <span class="p">);</span>
<span class="c1">// Inicia o processo de envio das informações usando o cURL.
</span><span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/nfe/"</span> <span class="o">.</span> <span class="nv">$ref</span> <span class="o">.</span> <span class="s2">"/email"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$email</span><span class="p">));</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFeEnviaEmail</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JSONException</span><span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfe/"</span><span class="o">+</span><span class="n">ref</span><span class="o">+</span><span class="s">"/email"</span><span class="o">);</span>

        <span class="cm">/* Criamos o um objeto JSON que receberá um JSON Array com a lista de e-mails. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">();</span>
        <span class="n">JSONArray</span> <span class="n">listaEmails</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">();</span>
        <span class="n">listaEmails</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"email_01@acras.com.br"</span><span class="o">);</span>
        <span class="n">listaEmails</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"email_02@acras.com.br"</span><span class="o">);</span>
        <span class="n">listaEmails</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"email_03@acras.com.br"</span><span class="o">);</span>
        <span class="n">json</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"emails"</span><span class="o">,</span> <span class="n">listaEmails</span><span class="o">);</span>

        <span class="cm">/* Testar se o JSON gerado está dentro do formato esperado.
        System.out.print(json); */</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfe/"</span> <span class="o">+</span> <span class="n">ref</span> <span class="o">+</span> <span class="s2">"/email"</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">emails_destinatarios</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">emails: </span><span class="p">[</span><span class="s2">"email_01@acras.com.br"</span><span class="p">,</span> <span class="s2">"email_02@acras.com.br"</span><span class="p">,</span> <span class="s2">"email_03@acras.com.br"</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos os dados da nota para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">emails_destinatarios</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
  <span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota.</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfe/"</span> <span class="o">+</span> <span class="nx">ref</span> <span class="o">+</span> <span class="s2">"/email"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">email</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"email1@acras.com.br"</span><span class="p">,</span> <span class="s2">"email2@acras.com.br"</span><span class="p">,</span> <span class="s2">"email3@acras.com.br"</span><span class="p">];</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="s2">"emails"</span><span class="p">:</span> <span class="nx">email</span><span class="p">});</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfe/"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="s">'''
Usamos um dicionario para armazenar os campos e valores que em seguida,
serao convertidos a JSON e enviados para nossa API
'''</span>
<span class="n">emails</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">email</span> <span class="o">=</span> <span class="s">"suporte@acras.com.br"</span>
<span class="n">emails</span><span class="p">[</span><span class="s">"emails"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">email</span><span class="p">]</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">ref</span><span class="o">+</span><span class="s">"/email"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">emails</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre>
<p>Para cada nota autorizada, cancelada ou que tenha sido emitida uma carta de correção o destinatário da nota é notificado via email. Porém eventualmente pode ser necessário enviar a nota fiscal para outras pessoas ou mesmo reenviar o email para o mesmo destinatário.</p>

<p>Para enviar um ou mais emails:</p>

<p><code>https://api.focusnfe.com.br/v2/nfe/REFERENCIA/email</code></p>

<p>Utilize o comando <strong>HTTP POST</strong> para enviar os emails. Esta operação aceita apenas um parâmetro:</p>

<ul>
<li><strong>emails</strong>: Array com uma lista de emails que deverão receber uma cópia da nota. Limitado a 10 emails por vez.</li>
</ul>

<p>A API imediatamente devolve a requisição com a confirmação dos emails. Os emails serão enviados em segundo plano, por isso pode levar alguns minutos até que eles cheguem à caixa postal.</p>
<h2 id='nfe_inutilizacao'>Inutilização</h2><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -d <span class="s1">'{"cnpj":"51916585000125","serie":"1","numero_inicial":"7","numero_final":"9","justificativa":"Teste de inutilizacao de nota"}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfe/inutilizacao
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="cm">/* Você deve definir isso globalmente para sua aplicação.
Para ambiente de produção utilize e a variável abaixo:
$server = "https://api.focusnfe.com.br"; */</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="c1">// Substituir a variável, ref, pela sua identificação interna de nota.
</span><span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
<span class="nv">$inutiliza</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
  <span class="s2">"cnpj"</span> <span class="o">=&gt;</span> <span class="s2">"51916585000125"</span><span class="p">,</span>
  <span class="s2">"serie"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
  <span class="s2">"numero_inicial"</span> <span class="o">=&gt;</span> <span class="s2">"7"</span><span class="p">,</span>
  <span class="s2">"numero_final"</span> <span class="o">=&gt;</span> <span class="s2">"9"</span><span class="p">,</span>
  <span class="s2">"justificativa"</span> <span class="o">=&gt;</span> <span class="s2">"Teste de inutilizacao denota"</span>  
<span class="p">);</span>
<span class="c1">// Inicia o processo de envio das informações usando o cURL.
</span><span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/nfe/inutilizacao"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$inutiliza</span><span class="p">));</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFeInutilizacao</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JSONException</span><span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfe/inutilizacao"</span><span class="o">);</span>

        <span class="cm">/* Aqui criamos um hash que irá receber as chaves e valores esperados para gerar a inutilização. */</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">dadosInutilizacao</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cnpj"</span><span class="o">,</span> <span class="s">"51916585009999"</span><span class="o">);</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"serie"</span><span class="o">,</span> <span class="s">"9"</span><span class="o">);</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero_inicial"</span><span class="o">,</span> <span class="s">"7730"</span><span class="o">);</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero_final"</span><span class="o">,</span> <span class="s">"7732"</span><span class="o">);</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"justificativa"</span><span class="o">,</span> <span class="s">"Informe aqui a justificativa para realizar a inutilizacao da numeracao."</span><span class="o">);</span>

        <span class="cm">/* Criamos um objeto JSON que irá receber o input dos dados, para então enviar a requisição. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">dadosInutilizacao</span><span class="o">);</span>

        <span class="cm">/* Testar se o JSON gerado está dentro do formato esperado.
        System.out.print(json); */</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">hHttpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

         <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
          * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">hHttpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfe/inutilizacao"</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">dados_inutilizacao</span> <span class="o">=</span> <span class="p">{</span>  
  <span class="ss">cnpj: </span><span class="s2">"51916585009999"</span><span class="p">,</span>
  <span class="ss">serie: </span><span class="s2">"9"</span><span class="p">,</span>
  <span class="ss">numero_inicial: </span><span class="s2">"7730"</span><span class="p">,</span>
  <span class="ss">numero_final: </span><span class="s2">"7732"</span><span class="p">,</span>
  <span class="ss">justificativa: </span><span class="s2">"Informe aqui a justificativa para realizar a inutilizacao da numeracao."</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos a hash de justificativa do cancelamento para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">dados_inutilizacao</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfe/inutilizacao"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">inutiliza</span> <span class="o">=</span> <span class="p">{</span>
<span class="s2">"cnpj"</span><span class="p">:</span> <span class="s2">"51916585000125"</span><span class="p">,</span>
<span class="s2">"serie"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
<span class="s2">"numero_inicial"</span><span class="p">:</span> <span class="s2">"700"</span><span class="p">,</span>
<span class="s2">"numero_final"</span><span class="p">:</span> <span class="s2">"703"</span><span class="p">,</span>
<span class="s2">"justificativa"</span><span class="p">:</span> <span class="s2">"Teste de inutilizacao de nota"</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">inutiliza</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfe/inutilizacao"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="s">'''
Usamos um dicionario para armazenar os campos e valores que em seguida,
serao convertidos a JSON e enviados para nossa API
'''</span>
<span class="n">inutilizacao</span><span class="o">=</span><span class="p">{}</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"cnpj"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"CNPJ da empresa emitente"</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"serie"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Serie da numeracao da NFCe que tera uma faixa de numeracao inutilizada"</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"numero_inicial"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Numero inicial a ser inutilizado"</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"numero_final"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Numero final a ser inutilizado"</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"justificativa"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Justificativa da inutilizacao (minimo 15 caracteres)"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">inutilizacao</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre>
<p>Em uma situação normal você não precisará informar ao SEFAZ a inutilização de um número da NFe, pois a API controla automaticamente a numeração das notas. Porém, se por alguma situação específica for necessário a inutilização de alguma faixa de números você poderá chamar as seguintes operações:</p>

<p>Envio de inutilização de faixa de numeração:</p>

<p><code>https://api.focusnfe.com.br/v2/nfe/inutilizacao</code></p>

<p>Utilize o comando <strong>HTTP POST</strong> para enviar a sua inutilização para nossa API. Este método é <strong>síncrono</strong>, ou seja, a comunicação com a SEFAZ será feita imediatamente e devolvida a resposta na mesma requisição.</p>

<p>A inutilização precisa dos seguintes parâmetros obrigatórios:</p>

<ul>
<li><strong>cnpj</strong>: CNPJ da empresa emitente</li>
<li><strong>serie</strong>: Série da numeração da NFe que terá uma faixa de numeração inutilizada</li>
<li><strong>numero_inicial</strong>: Número inicial a ser inutilizado</li>
<li><strong>numero_final</strong>: Número final a ser inutilizado</li>
<li><strong>justificativa</strong>: Justificativa da inutilização (mínimo 15 caracteres)</li>
</ul>

<p>A API irá enviar uma resposta com os seguintes campos:</p>

<ul>
<li><strong>status</strong>: autorizado, se a inutilização foi aceita pela SEFAZ, ou erro_autorizacao, se houve algum erro ao inutilizar os números.</li>
<li><strong>status_sefaz</strong>: O status da carta de correção na SEFAZ.</li>
<li><strong>mensagem_sefaz</strong>: Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>serie</strong>: Série da numeração da NFe que terá uma faixa de numeração inutilizada</li>
<li><strong>numero_inicial</strong>: Número inicial a ser inutilizado</li>
<li><strong>numero_final</strong>: Número final a ser inutilizado</li>
<li><strong>cnpj:</strong> CNPJ da empresa</li>
<li><strong>modelo:</strong> Modelo do documento (55 para NFe)</li>
<li><strong>caminho_xml</strong>: Caminho do XML para download caso a inutilização tenha sido autorizada pela SEFAZ.</li>
</ul>

<p>Em algumas situações em que sejam identificados erros de emissão de forma tardia, nossa API pode decidir pela inutilização de números ao invés de reutilizá-los para outras emissões. Desta forma você pode criar um gatilho (webhook) para ser notificado sempre que houver a inutilização de alguma faixa de numeração. Consulte a <a href="https://focusnfe.com.br/doc/#gatilhos-webhooks_gatilhos-webhooks">seção de gatilhos</a> e utilize o evento chamado &quot;inutilizacao&quot;.</p>

<blockquote>
<p>Exemplos de respostas da API por status para a requisição de inutilização:</p>

<p>autorizado</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"102"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Inutilizacao de numero homologado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_inicial"</span><span class="p">:</span><span class="w"> </span><span class="s2">"999"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_final"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1000"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"modelo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"55"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1807504505000130"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/190750450500013255001000000999000001000-inu.xml"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>erro_autorizacao</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"256"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Uma NF-e da faixa ja esta inutilizada na Base de dados da SEFAZ"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_inicial"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1000"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_final"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1000"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"erro_autorizacao"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='nfe_outras-documentacoes'>Outras documentações</h2><h3 id='nfe_enviador-de-arquivos'>Enviador de Arquivos</h3>
<p>Uma das formas de se comunicar com o Focus NFe é gerando um arquivo texto no formato especificado.</p>

<p>Para sistemas desktop que não desejam implementar uma comunicação direta com nossos web services criamos um agente de comunicação que lê os arquivos gerados em uma pasta e envia para o Focus NFe. Em um segundo momento o próprio agente consulta o status da nota e faz o download dos arquivos do DANFe e XML da nota.</p>

<p><strong>Como Funciona</strong></p>

<p>Sempre que o comunicador é chamado ele irá seguir os passos abaixo:</p>

<ol>
<li> <strong>Enviar os arquivos de NFe</strong> que estão no diretório de envio e criar uma pendência de retorno para esta nota.</li>
<li> <strong>Enviar os arquivos de cancelamento</strong> que estão no diretório de envio e criar uma pendência de retorno para este cancelamento.</li>
<li> <strong>Consultando os retornos pendentes</strong>.

<ol>
<li> <strong>Havendo retorno</strong> o comunicador irá <strong>gravar o arquivo de retorno</strong> com o nome do identificador e a extensão (.ret). Por exemplo, para uma NFe com identificador único 99887766 será gravado o arquivo 99887766.ret no diretório de retorno.</li>
<li>Se o retorno é referente a uma <strong>emissão de NFe e esta nota foi autorizada</strong>, o comunicador já irá fazer o download do <strong>DANFe e do XML</strong> gravando os dois arquivos em um subdiretório do diretório de retorno. Para o DANFe o nome do subdiretório será DANFEs e para o XML será XMLs.</li>
</ol></li>
</ol>

<p><strong>Envio do arquivo para emissão da NFe</strong></p>

<p>A aplicação do cliente deverá gravar um arquivo contendo o conteúdo da NFe e cujo nome é composto de um identificador único e com extensão NFe. Por exemplo, se o identificador único da nota no sistema cliente é 99887766 deverá ser gravado no diretório de envio com a extensão nfe, ou seja 99887766.nfe.</p>

<p><strong>Envio do arquivo para cancelamento de NFe</strong></p>

<p>A aplicação cliente deverá gravar um arquivo contendo um texto de justificativa de cancelamento. O arquivo deverá ser nomeado com o identificador único da nota e com extensão (.can). Em nosso exemplo acima o nome do arquivo seria 99887766.can. Este arquivo deverá ser gravado no diretório de envio de dados.</p>

<p><strong>Envio do carta de correção eletrônica (CCe)</strong></p>

<p>A aplicação cliente deverá gravar um arquivo contendo um texto da correção a ser aplicada. O arquivo deverá ser nomeado com o identificador único da nota e com extensão (.cce) e gravar no diretório de envio de dados.</p>

<p>O PDF e XML da carta de correção serão gravados no diretório de retorno, subdiretório CCes.</p>

<p><strong>Reconsulta de nfe</strong></p>

<p>O comunicador faz adiciona pendências de consulta automaticamente para todo envio e cancelamento comandado. Se por algum motivo houver a necessidade de comandar novamente uma consulta, basta acionar o comunicador com o parâmetro ref e o valor sendo o id único da nota. Por exemplo, para comandar a reconsulta da nota com id único 99887766 basta chamar o comunicador como na linha de comando a seguir:</p>

<p><code>$ focusNFeFileCommunicator ref=99887766</code></p>

<p><strong>Importante</strong></p>

<p>O comunicador possui uma execução linear e ao final é desativado. Isto quer dizer que ele não repete as consultas até que as notas estejam em estado final. É de responsabilidade da aplicação do cliente chamar o comunicador de tempos em tempos até que tenha as respostas para seus envios.</p>

<p><strong>Configuração</strong></p>

<p>Após rodar o comunicador pela primeira vez ele irá gerar um arquivo de configuração com informações padrão, como no exemplo ao lado.</p>

<pre>
[Diretorios]
envio =P:envios
retorno =P:retornos
logs=P:logs
[Conexao]
url =https://api.focusnfe.com.br/
token={token-enviado-pelo-suporte-focusnfe}
</pre>

<p>Na seção <strong>Diretorios</strong> são configurados os diretórios de comunicação (envio e retorno) onde a aplicação do cliente irá salvar e ler arquivos respectivamente. Também é configurado o diretório de logs, onde o comunicador irá gravar os logs das operações realizadas por ele.</p>

<p>A seção <strong>Conexão</strong> possui duas configurações cruciais para a correta comunicação com o Focus NFe. A url determina o endereço de comunicação que pode ser o de homologação (https://homologacao.focusnfe.com.br) e produção (https://api.focusnfe.com.br).</p>

<p>O token é a chave de acesso, fornecida pelo suporte, que irá garantir que a aplicação do cliente tem acesso ao Focus NFe.</p>

<p><strong>Download</strong></p>

<p>O comunicador foi desenvolvido para uso em sistema operacional Windows, para fazer o download do comunicador <a href="http://www.focusnfe.com.br/downloads/focusNfeFileCommunicator.exe">clique aqui</a> .</p>
<h1 id='nfce_nfce'>NFCe</h1>
<p>Através da API NFCe é possível:</p>

<ul>
<li>Emitir uma Nota Fiscal de Consumidor Eletrônica (NFCe) para qualquer Estado que aceita o uso deste documento.</li>
<li>Cancelar NFCe.</li>
<li>Consultar NFCe emitidas.</li>
<li>Reenviar uma NFCe por email.</li>
<li>Inutilizar o número de alguma série de NFCe.</li>
</ul>

<p>Todos os processos envolvendo NFCe são <strong>síncronos</strong>. Ou seja, a emissão não é feita em segundo plano, ao contrário da NFe
e NFSe.</p>
<h2 id='nfce_urls'>URLs</h2>
<table><thead>
<tr>
<th>Método</th>
<th>URL (recurso)</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>POST</td>
<td>/ v2/nfce?ref=REFERENCIA</td>
<td>Cria uma nota fiscal e a envia para processamento.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/nfce/REFERENCIA</td>
<td>Consulta a nota fiscal com a referência informada e o seu status de processamento.</td>
</tr>
<tr>
<td>DELETE</td>
<td>/v2/nfce/REFERENCIA</td>
<td>Cancela uma nota fiscal com a referência informada</td>
</tr>
<tr>
<td>POST</td>
<td>/v2/nfce/REFERENCIA/email</td>
<td>Envia um email com uma cópia da nota fiscal com a referência informada</td>
</tr>
<tr>
<td>POST</td>
<td>/v2/nfce/inutilizacao</td>
<td>Inutiliza uma numeração da nota fiscal</td>
</tr>
</tbody></table>
<h2 id='nfce_campos-obrigatorios-de-uma-nfce'>Campos obrigatórios de uma NFCe</h2>
<p>Atualmente, a NFCe possui centenas de campos para os mais variados tipos e formas de operações, por isso, criamos uma página exclusiva que mostra todos os campos da nossa API para o envio de NFCe. Nela, você pode buscar os campos pela TAG XML ou pela nossa tradução para API.</p>

<p><a href="https://focusnfe.com.br/dsl/4.0/NotaFiscalXML.html">Documentação completa dos campos (versão 4.00 da NFe/NFCe)</a></p>

<p>Abaixo, iremos mostrar todos os campos de uso mais comum para emissão de uma NFCe.</p>

<blockquote>
<p>Abaixo um exemplo de dados de uma nota (usando a versão 4.00 da NFCe):</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="s2">"05953016000132"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"data_emissao"</span><span class="p">:</span><span class="s2">"2017-12-06 14:45:10"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"indicador_inscricao_estadual_destinatario"</span><span class="p">:</span><span class="s2">"9"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"modalidade_frete"</span><span class="p">:</span><span class="s2">"9"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"local_destino"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"presenca_comprador"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"natureza_operacao"</span><span class="p">:</span><span class="s2">"VENDA AO CONSUMIDOR"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"items"</span><span class="p">:[</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="s2">"numero_item"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"codigo_ncm"</span><span class="p">:</span><span class="s2">"62044200"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"quantidade_comercial"</span><span class="p">:</span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"quantidade_tributavel"</span><span class="p">:</span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"cfop"</span><span class="p">:</span><span class="s2">"5102"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"valor_unitario_tributavel"</span><span class="p">:</span><span class="s2">"79.00"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"valor_unitario_comercial"</span><span class="p">:</span><span class="s2">"79.00"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"valor_desconto"</span><span class="p">:</span><span class="s2">"0.00"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"descricao"</span><span class="p">:</span><span class="s2">"NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"codigo_produto"</span><span class="p">:</span><span class="s2">"251887"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"icms_origem"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"icms_situacao_tributaria"</span><span class="p">:</span><span class="s2">"102"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"unidade_comercial"</span><span class="p">:</span><span class="s2">"un"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"unidade_tributavel"</span><span class="p">:</span><span class="s2">"un"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"valor_total_tributos"</span><span class="p">:</span><span class="s2">"24.29"</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">],</span><span class="w">
   </span><span class="s2">"formas_pagamento"</span><span class="p">:[</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="s2">"forma_pagamento"</span><span class="p">:</span><span class="s2">"03"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"valor_pagamento"</span><span class="p">:</span><span class="s2">"79.00"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"nome_credenciadora"</span><span class="p">:</span><span class="s2">"Cielo"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"bandeira_operadora"</span><span class="p">:</span><span class="s2">"02"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"numero_autorizacao"</span><span class="p">:</span><span class="s2">"R07242"</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='nfce_geral'>Geral</h3>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Descrição</th>
<th>Validação</th>
</tr>
</thead><tbody>
<tr>
<td>natureza_operacao</td>
<td>texto</td>
<td>sim</td>
<td>Descrição da natureza de operação.</td>
<td>Caso não informado, será utilizado o texto “VENDA AO CONSUMIDOR”.</td>
</tr>
<tr>
<td>data_emissao</td>
<td>data e hora</td>
<td>sim</td>
<td>Data e hora de emissão com timezone.</td>
<td>Utilize o formato ISO, exemplo 2015-11-19T13:54:31-02:00. Diferença máxima permitida de 5 minutos do horário atual.</td>
</tr>
<tr>
<td>presenca_comprador</td>
<td>numérico</td>
<td>sim</td>
<td>Presença do comprador.Valores possíveis:1 – Operação presencial.4 – Entrega a domicílio.</td>
<td></td>
</tr>
<tr>
<td>informacoes_adicionais _contribuinte</td>
<td>texto</td>
<td>não</td>
<td>Informações adicionais.</td>
<td></td>
</tr>
<tr>
<td>cnpj_emitente</td>
<td>texto</td>
<td>sim</td>
<td>CNPJ da empresa que está emitindo a NFCe.</td>
<td>CNPJ válido.</td>
</tr>
</tbody></table>
<h3 id='nfce_destinatario'>Destinatário</h3>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Descrição</th>
<th>Validação</th>
</tr>
</thead><tbody>
<tr>
<td>nome_destinatario</td>
<td>texto</td>
<td>não</td>
<td>Nome do consumidor.</td>
<td></td>
</tr>
<tr>
<td>cnpj_destinatario</td>
<td>texto</td>
<td>não</td>
<td>CNPJ do consumidor.</td>
<td>Enviar em branco ou documento válido.</td>
</tr>
<tr>
<td>cpf_destinatario</td>
<td>texto</td>
<td>não</td>
<td>CPF do consumidor.</td>
<td>Enviar em branco ou documento válido.</td>
</tr>
<tr>
<td>telefone_destinatario</td>
<td>texto</td>
<td>não</td>
<td>Telefone do consumidor.</td>
<td></td>
</tr>
<tr>
<td>logradouro_destinatario</td>
<td>texto</td>
<td>não</td>
<td>Logradouro do consumidor.</td>
<td></td>
</tr>
<tr>
<td>numero_destinatario</td>
<td>texto</td>
<td>não</td>
<td>Número do endereço do consumidor.</td>
<td></td>
</tr>
<tr>
<td>bairro_destinatario</td>
<td>texto</td>
<td>não</td>
<td>Bairro do consumidor.</td>
<td></td>
</tr>
<tr>
<td>municipio_destinatario</td>
<td>texto</td>
<td>não</td>
<td>Município do consumidor.</td>
<td></td>
</tr>
<tr>
<td>uf_destinatario</td>
<td>texto</td>
<td>não</td>
<td>Sigla da UF do consumidor.</td>
<td></td>
</tr>
<tr>
<td>cep_destinatario</td>
<td>texto</td>
<td>não</td>
<td>CEP do consumidor.</td>
<td></td>
</tr>
</tbody></table>
<h3 id='nfce_itens'>Itens</h3>
<p>Os dados dos itens da NFCe devem ser enviados dentro de um Array JSON. O nome que este array deve ter é <strong>“itens“</strong>.</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>numero_item</td>
<td>numérico</td>
<td>sim</td>
<td>Número do item. Comece com 1 e aumente sequencialmente para cada item da NFCe.</td>
</tr>
<tr>
<td>codigo_ncm</td>
<td>texto</td>
<td>sim</td>
<td>Código NCM do produto (8 dígitos).</td>
</tr>
<tr>
<td>codigo_produto</td>
<td>texto</td>
<td>sim</td>
<td>Código do produto.</td>
</tr>
<tr>
<td>descricao</td>
<td>texto</td>
<td>sim</td>
<td>Descrição do produto.</td>
</tr>
<tr>
<td>quantidade_comercial</td>
<td>numérico</td>
<td>sim</td>
<td>Quantidade do item.</td>
</tr>
<tr>
<td>quantidade_tributavel</td>
<td>numérico</td>
<td>sim</td>
<td>Quantidade tributável do item.  Caso não se aplique utilize o mesmo valor de quantidade_comercial.</td>
</tr>
<tr>
<td>cfop</td>
<td>texto</td>
<td>sim</td>
<td>Código Fiscal da operação. Utilize algum CFOP da operação válido para Nota ao Consumidor.</td>
</tr>
<tr>
<td>valor_unitario_comercial</td>
<td>numérico</td>
<td>sim</td>
<td>Valor unitário do item.</td>
</tr>
<tr>
<td>valor_unitario_tributavel</td>
<td>numérico</td>
<td>sim</td>
<td>Valor unitário tributável do item. Caso não se aplique utilize o mesmo valor que valor_unitario_comercial.</td>
</tr>
<tr>
<td>valor_bruto</td>
<td>numérico</td>
<td>sim</td>
<td>Valor bruto do item. Calculado como valor_unitario_comercial * quantidade_comercial</td>
</tr>
<tr>
<td>unidade_comercial</td>
<td>texto</td>
<td>sim</td>
<td>Unidade comercial do produto. Você pode utilizar valores como “KG”, “L”, “UN”, etc. Caso não se aplique utilize “UN”.</td>
</tr>
<tr>
<td>unidade_tributavel</td>
<td>texto</td>
<td>sim</td>
<td>Unidade tributável do produto. Caso não se aplique utilize o mesmo valor do campo unidade_comercial.</td>
</tr>
<tr>
<td>icms_origem</td>
<td>valor da lista</td>
<td>sim</td>
<td>Valores Possíveis: <strong>0</strong>: nacional. <strong>1</strong>: estrangeira (importação direta). <strong>2</strong>: estrangeira (adquirida no mercado interno). <strong>3</strong>: nacional com mais de 40% de conteúdo estrangeiro. <strong>4</strong>: nacional produzida através de processos produtivos básicos. <strong>5</strong>: nacional com menos de 40% de conteúdo estrangeiro. <strong>6</strong>: estrangeira (importação direta) sem produto nacional similar. <strong>7</strong>: estrangeira (adquirida no mercado interno) sem produto nacional similar.</td>
</tr>
<tr>
<td>icms_situacao_tributaria</td>
<td>valor da lista</td>
<td>sim</td>
<td>Valores possíveis: Para empresas optantes do SIMPLES: <strong>102</strong> – Tributada pelo Simples Nacional sem permissão de crédito, <strong>300</strong> - Imune, <strong>500</strong> - CMS cobrado anteriormente por substituição tributária (substituído) ou por antecipação. Para empresas não optantes do SIMPLES: <strong>00</strong> – tributada integralmente, <strong>40</strong> – Isenta, <strong>41</strong> - Não tributada, <strong>60</strong> - ICMS cobrado anteriormente por substituição tributária</td>
</tr>
<tr>
<td>icms_aliquota</td>
<td>numérico</td>
<td>Obrigatório se icms_situacao_tributaria = 00</td>
<td>Alíquota do ICMS.  Deve estar entre 0 e 100.</td>
</tr>
<tr>
<td>icms_base_calculo</td>
<td>numérico</td>
<td>Obrigatório se icms_situacao_tributaria = 00</td>
<td>Base de cálculo do ICMS. Normalmente é igual ao valor_bruto.</td>
</tr>
<tr>
<td>icms_modalidade_base _calculo</td>
<td>valor da lista</td>
<td>Obrigatório se icms_situacao_tributaria = 00</td>
<td>Modalidade da base de cálculo do ICMS.Valores possíveis:0 – margem de valor agregado (%).1 – pauta (valor).2 – preço tabelado máximo (valor).3 – valor da operação.</td>
</tr>
<tr>
<td>valor_desconto</td>
<td>numérico</td>
<td></td>
<td>Valor do desconto do item.</td>
</tr>
<tr>
<td>valor_frete</td>
<td>numérico</td>
<td></td>
<td>Valor do frete do item.  Usado apenas se entrega a domicílio. O frete deve ser “rateado” entre todos os itens.</td>
</tr>
</tbody></table>
<h3 id='nfce_transportador'>Transportador</h3>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>cnpj_transportador</td>
<td>string</td>
<td>sim se presenca_comprador = 4</td>
<td>CNPJ do transportador. Se este campo for informado não deverá ser informado cpf_transportador.</td>
</tr>
<tr>
<td>cpf_transportador</td>
<td>string</td>
<td>sim se presenca_comprador = 4</td>
<td>CPF do transportador. Se este campo for informado não deverá ser informado cnpj_transportador.</td>
</tr>
<tr>
<td>nome_transportador</td>
<td>string</td>
<td>sim se presenca_comprador = 4</td>
<td>Nome ou razão social do transportador.</td>
</tr>
<tr>
<td>inscricao_estadual_transportador</td>
<td>string</td>
<td>sim se presenca_comprador = 4</td>
<td>Inscrição Estadual do transportador.</td>
</tr>
<tr>
<td>endereco_transportador</td>
<td>string</td>
<td>sim se presenca_comprador = 4</td>
<td>Endereço (logradouro, número, complemento e bairro) do transportador.</td>
</tr>
<tr>
<td>municipio_transportador</td>
<td>string</td>
<td>sim se presenca_comprador = 4</td>
<td>Município do transportador.</td>
</tr>
<tr>
<td>uf_transportador</td>
<td>string</td>
<td>sim se presenca_comprador = 4</td>
<td>UF do transportador.</td>
</tr>
</tbody></table>
<h3 id='nfce_pagamento'>Pagamento</h3>
<p>Os dados abaixo devem ser enviados dentro de um Array JSON. O nome que este array deve ter é <strong>“formas_pagamento“</strong>.</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>forma_pagamento</td>
<td>valor da lista</td>
<td>sim</td>
<td>Forma do recebimento. Valores possíveis:01: Dinheiro.02: Cheque.03: Cartão de Crédito.04: Cartão de Débito.05: Crédito Loja.10: Vale Alimentação.11: Vale Refeição.12: Vale Presente.13: Vale Combustível.99: Outros</td>
</tr>
<tr>
<td>valor_pagamento</td>
<td>numérico</td>
<td>sim</td>
<td>Valor do recebimento.</td>
</tr>
<tr>
<td>tipo_integracao</td>
<td>valor da lista</td>
<td>não</td>
<td>Tipo de Integração para pagamento. Valores possíveis:1: Pagamento integrado com o sistema de automação da empresa (Ex.: equipamento TEF, Comércio Eletrônico) – Obrigatório informar cnpj_credenciadora e numero_autorizacao.2: Pagamento não integrado com o sistema de automação da empresa (valor padrão).  Informar apenas se forma_pagamento for 03 ou 04.</td>
</tr>
<tr>
<td>cnpj_credenciadora</td>
<td>numérico</td>
<td>Obrigatório se tipo_integracao for 1</td>
<td>CNPJ da credenciadora do cartão de crédito. Somente CNPJ válido.</td>
</tr>
<tr>
<td>numero_autorizacao</td>
<td>string</td>
<td>Obrigatório se tipo_integracao for 1</td>
<td></td>
</tr>
<tr>
<td>bandeira_operadora</td>
<td>string</td>
<td>Obrigatório se forma_pagamento = 03 ou 04 (pagamento em cartão)</td>
<td>Bandeira da operadora de cartão de crédito e/ou débito. Valores possíveis:01: Visa.02: Mastercard.03: American Express.04: Sorocred.99: Outros.</td>
</tr>
</tbody></table>
<h3 id='nfce_totalizadores'>Totalizadores</h3>
<table><thead>
<tr>
<th>Campos</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>valor_produtos</td>
<td>numérico</td>
<td>não</td>
<td>Valor total dos produtos.  Calculado automaticamente se não informado.</td>
</tr>
<tr>
<td>valor_desconto</td>
<td>numérico</td>
<td>não</td>
<td>Valor total dos descontos. Calculado automaticamente se não informado.</td>
</tr>
<tr>
<td>valor_total</td>
<td>numérico</td>
<td>não</td>
<td>Valor líquido dos produtos. Deve ser igual a valor_produtos – valor_desconto. Calculado automaticamente se não informado.</td>
</tr>
<tr>
<td>valor_frete</td>
<td>numérico</td>
<td>não</td>
<td>Valor total do frete. Deve conter o somatório do valor do frete dos itens (usado apenas em entrega a domicílio). Calculado automaticamente se não informado.</td>
</tr>
<tr>
<td>icms_valor_total</td>
<td>numérico</td>
<td>não</td>
<td>Valor total de ICMS dos produtos.  Deve ser o somatório dos valores contidos em icms_valor nos items. Calculado automaticamente se não informado.</td>
</tr>
<tr>
<td>icms_base_calculo</td>
<td>numérico</td>
<td>sim, se algum item tem icms_situacao_tributaria = 00</td>
<td>Valor total da base de cálculo do ICMS dos produtos. Deve ser o somatório dos valores contidos em icms_base_calculo nos items. Calculado automaticamente se não informado.</td>
</tr>
</tbody></table>
<h3 id='nfce_campos-calculados-automaticamente'>Campos calculados automaticamente</h3>
<p>Para simplificar o envio da nota fiscal, alguns campos são calculados automaticamente a partir da versão 4.00 da NFCe. Os campos calculados são somatórios de campos fornecidos nos itens da nota fiscal. Os campos serão calculados apenas se eles não forem informados na API.</p>

<p>A lista de campos calculados automaticamente segue abaixo:</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Somatório de campo dos itens</th>
<th>Observação</th>
</tr>
</thead><tbody>
<tr>
<td>icms_base_calculo</td>
<td>icms_base_calculo</td>
<td></td>
</tr>
<tr>
<td>valor_ipi</td>
<td>ipi_valor</td>
<td></td>
</tr>
<tr>
<td>icms_valor_total_st</td>
<td>icms_valor_st</td>
<td></td>
</tr>
<tr>
<td>issqn_base_calculo</td>
<td>issqn_base_calculo</td>
<td></td>
</tr>
<tr>
<td>issqn_valor_total</td>
<td>issqn_valor</td>
<td></td>
</tr>
<tr>
<td>issqn_valor_total_deducao</td>
<td>issqn_valor_deducao</td>
<td></td>
</tr>
<tr>
<td>issqn_valor_total_outras_retencoes</td>
<td>issqn_valor_outras_retencoes</td>
<td></td>
</tr>
<tr>
<td>issqn_valor_total_desconto_incondicionado</td>
<td>issqn_valor_desconto_incondicionado</td>
<td></td>
</tr>
<tr>
<td>issqn_valor_total_desconto_condicionado</td>
<td>issqn_valor_desconto_condicionado</td>
<td></td>
</tr>
<tr>
<td>issqn_valor_total_retencao</td>
<td>issqn_valor_retencao</td>
<td></td>
</tr>
<tr>
<td>issqn_base_calculo</td>
<td>issqn_base_calculo</td>
<td></td>
</tr>
<tr>
<td>valor_total_ii</td>
<td>ii_valor</td>
<td></td>
</tr>
<tr>
<td>fcp_valor_total</td>
<td>fcp_valor</td>
<td></td>
</tr>
<tr>
<td>fcp_valor_total_uf_destino</td>
<td>fcp_valor_uf_destino</td>
<td></td>
</tr>
<tr>
<td>fcp_valor_total_st</td>
<td>fcp_valor_st</td>
<td></td>
</tr>
<tr>
<td>fcp_valor_total_retido_st</td>
<td>fcp_valor_retido_st</td>
<td></td>
</tr>
<tr>
<td>icms_valor_total_uf_destino</td>
<td>icms_valor_uf_destino</td>
<td></td>
</tr>
<tr>
<td>icms_valor_total_uf_remetente</td>
<td>icms_valor_uf_remetente</td>
<td></td>
</tr>
<tr>
<td>icms_base_calculo</td>
<td>icms_base_calculo</td>
<td></td>
</tr>
<tr>
<td>icms_valor_total</td>
<td>icms_valor</td>
<td></td>
</tr>
<tr>
<td>icms_valor_total_desonerado</td>
<td>icms_valor_desonerado</td>
<td></td>
</tr>
<tr>
<td>icms_base_calculo_st</td>
<td>icms_base_calculo_st</td>
<td></td>
</tr>
<tr>
<td>icms_valor_total_st</td>
<td>icms_valor_st</td>
<td></td>
</tr>
<tr>
<td>valor_frete</td>
<td>valor_frete</td>
<td></td>
</tr>
<tr>
<td>valor_seguro</td>
<td>valor_seguro</td>
<td></td>
</tr>
<tr>
<td>valor_outras_despesas</td>
<td>valor_outras_despesas</td>
<td></td>
</tr>
<tr>
<td>valor_desconto</td>
<td>valor_desconto</td>
<td></td>
</tr>
<tr>
<td>valor_ipi_devolvido</td>
<td>valor_ipi_devolvido</td>
<td></td>
</tr>
<tr>
<td>valor_total_tributos</td>
<td>valor_total_tributos</td>
<td></td>
</tr>
<tr>
<td>valor_produtos</td>
<td>valor_bruto</td>
<td>Apenas se inclui_no_total=1</td>
</tr>
<tr>
<td>valor_total_servicos</td>
<td>valor_bruto</td>
<td>Apenas se inclui_no_total=1 e item de serviço</td>
</tr>
<tr>
<td>icms_valor_total</td>
<td>icms_valor</td>
<td>Apenas se icms_situacao_tributaria diferente de40, 41 e 50.</td>
</tr>
<tr>
<td>valor_pis_servicos</td>
<td>pis_valor</td>
<td>Apenas se item de serviço</td>
</tr>
<tr>
<td>valor_cofins_servicos</td>
<td>cofins_valor</td>
<td>Apenas se item de serviço</td>
</tr>
<tr>
<td>valor_pis</td>
<td>pis_valor</td>
<td>Apenas se não for item de serviço</td>
</tr>
<tr>
<td>valor_cofins</td>
<td>cofins_valor</td>
<td>Apenas se não for item de serviço</td>
</tr>
</tbody></table>

<p>Além disso, caso não seja fornecido, será calculado também o valor total da NFCe (valor_total), calculado da seguinte forma:</p>

<p>valor_produtos – valor_desconto – icms_valor_total_desonerado + icms_valor_total_st + valor_frete + valor_seguro + valor_outras_despesas + valor_total_ii + valor_ipi + valor_total_servicos</p>

<p>Além dos campos acima, os campos abaixo são preenchidos automaticament para NFCe, pois tem apenas um conteúdo válido possível:</p>

<ul>
<li><strong>tipo_documento</strong> = 1, significando “Nota de saída”</li>
<li><strong>consumidor_final</strong> = 1, significando “Nota para consumidor final”</li>
<li><strong>finalidade_emissao</strong> = 1, significando “Nota normal”</li>
</ul>
<h2 id='nfce_status-api'>Status API</h2>
<p>Aqui você encontra os status possíveis para NFCe.</p>

<table><thead>
<tr>
<th>HTTP CODE/STATUS</th>
<th>Status API Focus</th>
<th>Descrição</th>
<th>Correção</th>
</tr>
</thead><tbody>
<tr>
<td>404 - not found</td>
<td>nfce_nao_encontrada</td>
<td>NFCe não encontrada</td>
<td>Verifique se a NFCe informada existe e está autorizada.</td>
</tr>
<tr>
<td>404 - not found</td>
<td>nfce_nao_autorizada</td>
<td>NFCe não autorizada</td>
<td>O cancelamento só é possível para NFCe&#39;s autorizadas.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>justificativa_nao_informada</td>
<td>Parâmetro &quot;justificativa&quot; não informado</td>
<td>É necessário usar o parâmetro &#39;justificativa&#39;. Consulte a nossa documentação.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>forma_emissao_nao_informada</td>
<td>Parâmetro &quot;forma_emissao&quot; inválido ou não informado</td>
<td>Verifique o valor informado no campo &quot;forma_emissao&quot;. Consulte a nossa documentação.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>ref_ausente</td>
<td>Parâmetro &quot;ref&quot; não informado</td>
<td>É necessário usar o parâmetro &#39;ref&#39; nessa requisição com a API. Consulte a nossa documentação.</td>
</tr>
<tr>
<td>422 - unprocessable entity</td>
<td>ambiente_nao_configurado</td>
<td>Ambiente não configurado para emissão de NFCe</td>
<td>O ambiente de emissão de NFCe não foi configurado para o seu emitente. Entre em contato com a nossa equipe de suporte.</td>
</tr>
<tr>
<td>422 - unprocessable entity</td>
<td>empresa_nao_configurada</td>
<td>Empresa não configurada para emissão de NFCe</td>
<td>É necessário informar no cadastro do emitente(Painel API) o CSC e id_token(gerados na Sefaz do Estado do emitente), para emissão de NFCe.</td>
</tr>
</tbody></table>
<h2 id='nfce_envio'>Envio</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfce"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>
<span class="n">ref</span> <span class="o">=</span> <span class="p">{</span><span class="s">"ref"</span><span class="p">:</span><span class="s">"1234"</span><span class="p">}</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="s">'''
Usamos dicionarios para armazenar os campos e valores que em seguida,
serao convertidos em JSON e enviados para nossa API
'''</span>
<span class="n">nfce</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">items</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">formas_pagamento</span><span class="o">=</span><span class="p">{}</span>

<span class="n">nfce</span><span class="p">[</span><span class="s">"cnpj_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"99999999999999"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"nome_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Acme ink"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"nome_fantasia_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Acme ink"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"logradouro_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Rua Tupiniquim"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"numero_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"4000"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"bairro_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Brás"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"municipio_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"São Paulo"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"uf_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"SP"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"cep_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"99997-000"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"inscricao_estadual_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"111111111"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"data_emissao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"2018-03-06T17:11:00.939-03:00"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"natureza_operacao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Venda ao Consumidor"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"tipo_documento"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"presenca_comprador"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"finalidade_emissao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"modalidade_frete"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"9"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"forma_pagamento"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"nome_destinatario"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"cpf_destinatario"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"99999999999"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"informacoes_adicionais_contribuinte"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Informacoes adicionais do contribuinte"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"valor_produtos"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"15.0"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"valor_desconto"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0.00"</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"valor_total"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"15.0"</span>
<span class="n">formas_pagamento</span><span class="p">[</span><span class="s">"forma_pagamento"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"4"</span>
<span class="n">formas_pagamento</span><span class="p">[</span><span class="s">"valor_pagamento"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"15.00"</span>
<span class="n">formas_pagamento</span><span class="p">[</span><span class="s">"bandeira_operadora"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"7"</span>
<span class="n">formas_pagamento</span><span class="p">[</span><span class="s">"troco"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"numero_item"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"codigo_produto"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"353"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"descricao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"codigo_ncm"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"48024090"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"cfop"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"5102"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"valor_desconto"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0.00"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"icms_origem"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"icms_situacao_tributaria"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"400"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"unidade_comercial"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"UN"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"unidade_tributavel"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"UN"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"quantidade_comercial"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"10"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"quantidade_tributavel"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"10"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"valor_unitario_comercial"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.5"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"valor_unitario_tributavel"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.5"</span>
<span class="n">itens</span><span class="p">[</span><span class="s">"valor_bruto"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"15.00"</span>

<span class="c"># Adicionamos os dados das variaveis itens e formas_pagamento como listas ao dicionario principal.</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"items"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">itens</span><span class="p">]</span>
<span class="n">nfce</span><span class="p">[</span><span class="s">"formas_pagamento"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">formas_pagamento</span><span class="p">]</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">nfce</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight shell tab-shell"><code><span class="c"># arquivo.json deve conter os dados da NFCe</span>
curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -T arquivo.json https://homologacao.focusnfe.com.br/v2/nfce
</code></pre><pre class="highlight java tab-java"><code>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFCeAutorizar</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JSONException</span><span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfce?ref="</span><span class="o">+</span> <span class="n">ref</span><span class="o">+</span><span class="s">"&amp;completa=1"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="cm">/* Aqui são criados as hash's que receberão os dados da nota. */</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">nfce</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">itens</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">formasPagamento</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>

        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"data_emissao"</span><span class="o">,</span> <span class="s">"2018-01-15T16:25:00"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"consumidor_final"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"modalidade_frete"</span><span class="o">,</span> <span class="s">"9"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"natureza_operacao"</span><span class="o">,</span> <span class="s">"Venda ao Consumidor"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"tipo_documento"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"finalidade_emissao"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"presenca_comprador"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"indicador_inscricao_estadual_destinatario"</span><span class="o">,</span> <span class="s">"9"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cnpj_emitente"</span><span class="o">,</span> <span class="s">"51916585000125"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cpf_destinatario"</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"id_estrangeiro_destinatario"</span><span class="o">,</span> <span class="s">"1234567"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"nome_destinatario"</span><span class="o">,</span> <span class="s">"NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"informacoes_adicionais_contribuinte"</span><span class="o">,</span> <span class="s">"Documento emitido por ME ou EPP optante pelo Simples Nacional nao gera direito a credito fiscal de ICMS lei 123/2006."</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_produtos"</span><span class="o">,</span> <span class="s">"1.0000"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_desconto"</span><span class="o">,</span> <span class="s">"0.0000"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_total"</span><span class="o">,</span> <span class="s">"1.0000"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"forma_pagamento"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_base_calculo"</span><span class="o">,</span> <span class="s">"0.0000"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_valor_total"</span><span class="o">,</span> <span class="s">"0.0000"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_base_calculo_st"</span><span class="o">,</span> <span class="s">"0.0000"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_valor_total_st"</span><span class="o">,</span> <span class="s">"0.0"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_modalidade_base_calculo"</span><span class="o">,</span> <span class="s">"3"</span><span class="o">);</span>
        <span class="n">nfce</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_frete"</span><span class="o">,</span> <span class="s">"0.0"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero_item"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"unidade_comercial"</span><span class="o">,</span> <span class="s">"PC"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"unidade_tributavel"</span><span class="o">,</span> <span class="s">"PC"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_ncm"</span><span class="o">,</span> <span class="s">"94019090"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_produto"</span><span class="o">,</span> <span class="s">"Div.13350000"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"descricao"</span><span class="o">,</span> <span class="s">"NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cfop"</span><span class="o">,</span> <span class="s">"5102"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_unitario_comercial"</span><span class="o">,</span> <span class="s">"1.0000000000"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_unitario_tributavel"</span><span class="o">,</span> <span class="s">"1.0000000000"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_bruto"</span><span class="o">,</span> <span class="s">"1.0000"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"quantidade_comercial"</span><span class="o">,</span> <span class="s">"1.0000"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"quantidade_tributavel"</span><span class="o">,</span> <span class="s">"1.0000"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"quantidade"</span><span class="o">,</span> <span class="s">"1.0000"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_origem"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_base_calculo"</span><span class="o">,</span> <span class="s">"1.00"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_modalidade_base_calculo"</span><span class="o">,</span> <span class="s">"3"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_frete"</span><span class="o">,</span> <span class="s">"0.0"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_outras_despesas"</span><span class="o">,</span> <span class="s">"0.0"</span><span class="o">);</span>
        <span class="n">itens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_situacao_tributaria"</span><span class="o">,</span> <span class="s">"102"</span><span class="o">);</span>
        <span class="n">formasPagamento</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"forma_pagamento"</span><span class="o">,</span> <span class="s">"99"</span><span class="o">);</span>
        <span class="n">formasPagamento</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_pagamento"</span><span class="o">,</span> <span class="s">"1.0000"</span><span class="o">);</span>

        <span class="cm">/* Depois de fazer o input dos dados, são criados os objetos JSON já com os valores das hash's. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">nfce</span><span class="o">);</span>
        <span class="n">JSONObject</span> <span class="n">jsonItens</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">itens</span><span class="o">);</span>
        <span class="n">JSONObject</span> <span class="n">jsonPagamento</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">formasPagamento</span><span class="o">);</span>

        <span class="cm">/* Aqui adicionamos os objetos JSON nos campos da API como array no JSON principal. */</span>
        <span class="n">json</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"items"</span><span class="o">,</span> <span class="n">jsonItens</span><span class="o">);</span>
        <span class="n">json</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"formas_pagamento"</span><span class="o">,</span> <span class="n">jsonPagamento</span><span class="o">);</span>

        <span class="cm">/* É recomendado verificar como os dados foram gerados em JSON e se ele está seguindo a estrutura especificada em nossa documentação.
        System.out.print(json); */</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas a seguir exibem as informações retornadas pela nossa API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfce?ref="</span> <span class="o">+</span> <span class="n">ref</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">dados_da_nota</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">cnpj_emitente: </span><span class="s2">"05953016000132"</span><span class="p">,</span>
  <span class="ss">data_emissao: </span><span class="s2">"2017-12-06 14:45:10"</span><span class="p">,</span>
  <span class="ss">indicador_inscricao_estadual_destinatario: </span><span class="s2">"9"</span><span class="p">,</span>
  <span class="ss">modalidade_frete: </span><span class="s2">"9"</span><span class="p">,</span>
  <span class="ss">local_destino: </span><span class="s2">"1"</span><span class="p">,</span>
  <span class="ss">presenca_comprador: </span><span class="s2">"1"</span><span class="p">,</span>
  <span class="ss">natureza_operacao: </span><span class="s2">"VENDA AO CONSUMIDOR"</span><span class="p">,</span>
  <span class="ss">items: </span><span class="p">[</span>
    <span class="ss">numero_item: </span><span class="s2">"1"</span><span class="p">,</span>
    <span class="ss">codigo_ncm: </span><span class="s2">"62044200"</span><span class="p">,</span>
    <span class="ss">quantidade_comercial: </span><span class="s2">"1.00"</span><span class="p">,</span>
    <span class="ss">quantidade_tributavel: </span><span class="s2">"1.00"</span><span class="p">,</span>
    <span class="ss">cfop: </span><span class="s2">"5102"</span><span class="p">,</span>
    <span class="ss">valor_unitario_tributavel: </span><span class="s2">"79.00"</span><span class="p">,</span>
    <span class="ss">valor_unitario_comercial: </span><span class="s2">"79.00"</span><span class="p">,</span>
    <span class="ss">valor_desconto: </span><span class="s2">"0.00"</span><span class="p">,</span>
    <span class="ss">descricao: </span><span class="s2">"NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="p">,</span>
    <span class="ss">codigo_produto: </span><span class="s2">"251887"</span><span class="p">,</span>
    <span class="ss">icms_origem: </span><span class="s2">"0"</span><span class="p">,</span>
    <span class="ss">icms_situacao_tributaria: </span><span class="s2">"102"</span><span class="p">,</span>
    <span class="ss">unidade_comercial: </span><span class="s2">"un"</span><span class="p">,</span>
    <span class="ss">unidade_tributavel: </span><span class="s2">"un"</span><span class="p">,</span>
    <span class="ss">valor_total_tributos: </span><span class="s2">"24.29"</span>
  <span class="p">],</span>
  <span class="ss">formas_pagamento: </span><span class="p">[</span>
    <span class="ss">forma_pagamento: </span><span class="s2">"03"</span><span class="p">,</span>
    <span class="ss">valor_pagamento: </span><span class="s2">"79.00"</span><span class="p">,</span>
    <span class="ss">nome_credenciadora: </span><span class="s2">"Cielo"</span><span class="p">,</span>
    <span class="ss">bandeira_operadora: </span><span class="s2">"02"</span><span class="p">,</span>
    <span class="ss">numero_autorizacao: </span><span class="s2">"R07242"</span>
  <span class="p">]</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos os dados da nota para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">dados_da_nota</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="cm">/* Você deve definir isso globalmente para sua aplicação.
Para ambiente de produção utilize e a variável abaixo:
$server = "https://api.focusnfe.com.br"; */</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="c1">// Substituir a variável, ref, pela sua identificação interna de nota.
</span><span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
<span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
<span class="nv">$nfe</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
   <span class="s2">"cnpj_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"51916585000125"</span><span class="p">,</span>
   <span class="s2">"data_emissao"</span> <span class="o">=&gt;</span> <span class="s2">"2017-12-07T12:40:10"</span><span class="p">,</span>
   <span class="s2">"indicador_inscricao_estadual_destinatario"</span> <span class="o">=&gt;</span> <span class="s2">"9"</span><span class="p">,</span>
   <span class="s2">"modalidade_frete"</span> <span class="o">=&gt;</span> <span class="s2">"9"</span><span class="p">,</span>
   <span class="s2">"local_destino"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
   <span class="s2">"presenca_comprador"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
   <span class="s2">"natureza_operacao"</span> <span class="o">=&gt;</span> <span class="s2">"VENDA AO CONSUMIDOR"</span><span class="p">,</span>
  <span class="s2">"itens"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
      <span class="s2">"numero_item"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
         <span class="s2">"codigo_ncm"</span> <span class="o">=&gt;</span> <span class="s2">"62044200"</span><span class="p">,</span>
         <span class="s2">"quantidade_comercial"</span> <span class="o">=&gt;</span> <span class="s2">"1.00"</span><span class="p">,</span>
         <span class="s2">"quantidade_tributavel"</span> <span class="o">=&gt;</span> <span class="s2">"1.00"</span><span class="p">,</span>
         <span class="s2">"cfop"</span> <span class="o">=&gt;</span> <span class="s2">"5102"</span><span class="p">,</span>
         <span class="s2">"valor_unitario_tributavel"</span> <span class="o">=&gt;</span> <span class="s2">"1.00"</span><span class="p">,</span>
         <span class="s2">"valor_unitario_comercial"</span> <span class="o">=&gt;</span> <span class="s2">"1.00"</span><span class="p">,</span>
         <span class="s2">"valor_desconto"</span> <span class="o">=&gt;</span> <span class="s2">"0.00"</span><span class="p">,</span>
         <span class="s2">"descricao"</span> <span class="o">=&gt;</span> <span class="s2">"NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="p">,</span>
         <span class="s2">"codigo_produto"</span> <span class="o">=&gt;</span> <span class="s2">"251887"</span><span class="p">,</span>
         <span class="s2">"icms_origem"</span> <span class="o">=&gt;</span> <span class="s2">"0"</span><span class="p">,</span>
         <span class="s2">"icms_situacao_tributaria"</span> <span class="o">=&gt;</span> <span class="s2">"102"</span><span class="p">,</span>
         <span class="s2">"unidade_comercial"</span> <span class="o">=&gt;</span> <span class="s2">"un"</span><span class="p">,</span>
         <span class="s2">"unidade_tributavel"</span> <span class="o">=&gt;</span> <span class="s2">"un"</span><span class="p">,</span>
         <span class="s2">"valor_total_tributos"</span> <span class="o">=&gt;</span> <span class="s2">"1.00"</span>
    <span class="p">)</span>
  <span class="p">),</span>
  <span class="s2">"formas_pagamento"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
         <span class="s2">"forma_pagamento"</span> <span class="o">=&gt;</span> <span class="s2">"03"</span><span class="p">,</span>
         <span class="s2">"valor_pagamento"</span> <span class="o">=&gt;</span> <span class="s2">"1.00"</span><span class="p">,</span>
         <span class="s2">"nome_credenciadora"</span> <span class="o">=&gt;</span> <span class="s2">"Cielo"</span><span class="p">,</span>
         <span class="s2">"bandeira_operadora"</span> <span class="o">=&gt;</span> <span class="s2">"02"</span><span class="p">,</span>
         <span class="s2">"numero_autorizacao"</span> <span class="o">=&gt;</span> <span class="s2">"R07242"</span>
     <span class="p">)</span>
  <span class="p">),</span>
<span class="p">);</span>
<span class="c1">// Inicia o processo de envio das informações usando o cURL.
</span><span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/nfce?ref="</span> <span class="o">.</span> <span class="nv">$ref</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$nfe</span><span class="p">));</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfce?ref="</span> <span class="o">+</span> <span class="nx">ref</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">nfce</span> <span class="o">=</span> <span class="p">{</span>
<span class="s2">"natureza_operacao"</span><span class="p">:</span><span class="s2">"VENDA AO CONSUMIDOR"</span><span class="p">,</span>
<span class="s2">"data_emissao"</span><span class="p">:</span><span class="s2">"2018-03-21T11:52:00-03:00"</span><span class="p">,</span>
<span class="s2">"tipo_documento"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span>
<span class="s2">"presenca_comprador"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span>
<span class="s2">"consumidor_final"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span>
<span class="s2">"finalidade_emissao"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span>
<span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="s2">"51916585000125"</span><span class="p">,</span>
<span class="s2">"nome_destinatario"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span>
<span class="s2">"cpf_destinatario"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span>
<span class="s2">"informacoes_adicionais_contribuinte"</span><span class="p">:</span><span class="s2">"RETIRADA POR CONTA DO DESTINATÁRIO"</span><span class="p">,</span>
<span class="s2">"valor_produtos"</span><span class="p">:</span><span class="s2">"1.00"</span><span class="p">,</span>
<span class="s2">"valor_desconto"</span><span class="p">:</span><span class="s2">"0.00"</span><span class="p">,</span>
<span class="s2">"valor_total"</span><span class="p">:</span><span class="s2">"1.00"</span><span class="p">,</span>
<span class="s2">"forma_pagamento"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span>
<span class="s2">"icms_valor_total"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span>
<span class="s2">"modalidade_frete"</span><span class="p">:</span> <span class="s2">"9"</span><span class="p">,</span>
<span class="s2">"items"</span><span class="p">:[</span>
    <span class="p">{</span><span class="s2">"numero_item"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span>
     <span class="s2">"codigo_ncm"</span><span class="p">:</span><span class="s2">"84713012"</span><span class="p">,</span>
     <span class="s2">"codigo_produto"</span><span class="p">:</span><span class="s2">"999"</span><span class="p">,</span>
     <span class="s2">"descricao"</span><span class="p">:</span><span class="s2">"NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="p">,</span>
     <span class="s2">"quantidade_comercial"</span><span class="p">:</span><span class="s2">"1.00"</span><span class="p">,</span>
     <span class="s2">"quantidade_tributavel"</span><span class="p">:</span><span class="s2">"1.00"</span><span class="p">,</span>
     <span class="s2">"cfop"</span><span class="p">:</span><span class="s2">"5102"</span><span class="p">,</span>
     <span class="s2">"valor_unitario_comercial"</span><span class="p">:</span><span class="s2">"1.00"</span><span class="p">,</span>
     <span class="s2">"valor_unitario_tributavel"</span><span class="p">:</span><span class="s2">"1.00"</span><span class="p">,</span>
     <span class="s2">"valor_bruto"</span><span class="p">:</span><span class="s2">"1.00"</span><span class="p">,</span>
     <span class="s2">"unidade_comercial"</span><span class="p">:</span><span class="s2">"un"</span><span class="p">,</span>
     <span class="s2">"unidade_tributavel"</span><span class="p">:</span><span class="s2">"un"</span><span class="p">,</span>
     <span class="s2">"icms_origem"</span><span class="p">:</span><span class="s2">"2"</span><span class="p">,</span>
     <span class="s2">"icms_situacao_tributaria"</span><span class="p">:</span><span class="s2">"102"</span><span class="p">,</span>
     <span class="s2">"icms_aliquota"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span>
     <span class="s2">"icms_base_calculo"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span>
     <span class="s2">"icms_modalidade_base_calculo"</span><span class="p">:</span><span class="s2">"3"</span>
    <span class="p">}</span>        
  <span class="p">],</span>
    <span class="s2">"formas_pagamento"</span><span class="p">:[</span>
        <span class="p">{</span><span class="s2">"forma_pagamento"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span>
         <span class="s2">"valor_pagamento"</span><span class="p">:</span><span class="s2">"1.00"</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">nfce</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<p>Para enviar uma NFCe utilize a URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Envia uma NFCe para autorização:</p>

<p><code>https://api.focusnfe.com.br/v2/nfce?ref=REFERENCIA&amp;completa=(0|1)</code></p>

<p>Utilize o comando HTTP POST para enviar a sua nota para nossa API. A URL recebe como parâmetro a referência no campo “ref” e pode ser informado opcionalmente o campo “completa” com o valor 1 (verdadeiro) ou 0 (falso). Este parâmetro indica se será exibida a nota completa caso ela seja autorizada. Esta operação é detalhada na próxima seção.</p>

<p>Envie como corpo do POST os dados em formato JSON da nota fiscal.</p>

<p>A numeração da nota (número e série) pode ser definido automaticamente pela API, nós recomendamos que deixe a sua numeração sob nossa responsabilidade, por questões de simplicidade. Entretanto, você pode controlar o envio destas informações pela sua aplicação, basta informar os campos <strong>“numero”</strong> e <strong>“serie”</strong> nos dados de envio.</p>

<p>O envio de uma NFCe é um processo <strong>síncrono</strong>, ou seja, diferente da NFe a nota é autorizada ou rejeitada na mesma requisição. A resposta da requisição irá conter o mesmo resultado que a operação da consulta, descrita a seguir.</p>

<blockquote>
<p>Exemplos de respostas da API por <strong>status</strong> para a requisição de envio:</p>

<p>autorizado</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"referencia_000899"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Autorizado o uso da NF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NFe41190607504505000132650010000000121743484310"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_nota_fiscal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/41190607504505000132650010000000121743484310-nfe.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_danfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/notas_fiscais_consumidor/NFe41190607504505000132650010000000121743484310.html"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"qrcode_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.fazenda.pr.gov.br/nfce/qrcode/?p=41190607504505000132650010000000121743484310|2|2|1|5E264C0E28D801197219894CDFCF2FCCC5237F08"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"url_consulta_nf"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.fazenda.pr.gov.br/nfce/consulta"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>autorizado em contingência offline e ainda não efetivado</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"referencia_000899"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Autorizado o uso da NF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NFe41190607504505000132650010000000121743484310"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_nota_fiscal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/41190607504505000132650010000000121743484310-nfe.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_danfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/notas_fiscais_consumidor/NFe41190607504505000132650010000000121743484310.html"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"qrcode_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.fazenda.pr.gov.br/nfce/qrcode/?p=41190607504505000132650010000000121743484310|2|2|1|5E264C0E28D801197219894CDFCF2FCCC5237F08"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"url_consulta_nf"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.fazenda.pr.gov.br/nfce/consulta"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"contingencia_offline"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"contingencia_offline_efetivada"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>erro_autorizacao</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"referencia_000899"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"erro_autorizacao"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"591"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Informado CSOSN para emissor que nao e do Simples Nacional (CRT diferente de 1). [nItem:1]"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='nfce_emissao-automatica-em-contingencia-offline'>Emissão automática em contingência offline</h3>
<p>Ao tentar emitir uma NFCe, iremos tentar comunicação com a SEFAZ. Caso a comunicação seja realizada com sucesso, a nota será emitida e a DANFCe gerada. Porém, caso a comunicação não seja possível, iremos imediatamente emitir uma <em>outra nota</em> (com numeração subsequente) em contingência offline, nos estados onde isso for possível. Isso significa gerar um XML e DANFCe temporários até que a comunicação com a SEFAZ seja reestabelecida. Ao final, os dados gerados serão devolvidos na requisição de autorização. Todo este processo é síncrono.</p>

<p>É necessário emitir uma outra nota pois não há garantias de que a SEFAZ não tenha recebido a requisição original. Desta forma, é mais prudente emitir a nota com outro número e posteriormente consultar a nota original para confirmar o seu status, assim evitamos erros de duplicidade de numeração ao fazer a efetivação da contingência quando os servidores da SEFAZ voltarem a responder.</p>

<p>Será de responsabilidade de nossa API, após devolver o XML e DANFCe temporários, tentar reestabelecer comunicação com a SEFAZ ao longo das próximas 24 horas após a emissão. Quando conseguirmos conectividade novamente serão efetuadas duas ações:</p>

<ul>
<li>A nota emitida em contingência será efetividade na SEFAZ e iremos substituir o XML e DANFCe por suas versões definitivas</li>
<li>Iremos consultar o status da requisição original. Caso a nota tenha sido autorizada, é feito o cancelamento da nota. Caso ela realmente não tenha sido autorizada, o número é reaproveitado para as próximas emissões.</li>
</ul>

<p>O sistema cliente da API pode acompanhar este processo de forma transparente, conforme descrito na seção “Consulta” deste manual.</p>
<h3 id='nfce_emissao-manual-em-contingencia-offline'>Emissão manual em contingência offline</h3>
<p>A emissão automática em contingência contempla o caso em que o SEFAZ esteja fora do ar mas não contempla o caso em que <em>sua aplicação</em> esteja sem conexão com a Internet. Neste caso você pode optar por fazer uma emissão manual em contingência nos estados onde isto é autorizado.</p>

<p>De forma resumida, isto poderá ser feito da seguinte forma:</p>

<ol>
<li>Sua aplicação emite uma DANFCe - sem se comunicar com o nosso sistema - em duas vias (uma para ficar no estabelecimento e outra entregue ao cliente)</li>
<li>Após identificar que sua conexão foi reestabelecida, você envia os dados da nota  para nossa API informando todos os dados utilizados na NFCe (incluindo número e
série da nota) e informando o parâmetro &quot;forma_emissao&quot; com o valor &quot;offline&quot;.</li>
</ol>

<p>Para conseguir realizar estas tarefas, sua aplicação deverá manter um controle
de numeração de notas emitidas em contingência. A série utilizada deverá ser diferente
daquela utilizada pelo nosso sistema. Por exemplo: se nosso sistema emite com a
série 1 o seu sistema poderá emitir notas em contingência com a série 600, por
exemplo.</p>

<p>Ao emitir a nota em nossa API, você deverá chamar nossa URL acrescentando o campo &quot;forma_emissao&quot; com o valor &quot;offline&quot;. Por exemplo, se você está fazendo testes no ambiente de homologação, e enviando
a nota com a referência &quot;123&quot;, você deverá chamar a seguinte URL:</p>

<p><code>https://homologacao.focusnfe.com.br/v2/nfce?ref=123&amp;forma_emissao=offline</code></p>

<p>Nos dados JSON da nota, acrescente os seguintes campos:</p>

<ul>
<li>numero - O número da nota</li>
<li>serie - A série de contingência</li>
<li>codigo_unico - O código único (tag cNF) utilizado na geração da chave da NFe</li>
</ul>

<p>Usando esta forma de emissão, a SEFAZ irá autorizar notas mesmo com a data de
emissão retroativa.</p>
<h2 id='nfce_consulta'>Consulta</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfce/"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s">"1234"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="c"># Use este parametro para obter mais informacoes em suas consultas</span>
<span class="n">completa</span> <span class="o">=</span> <span class="s">"completa=1"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">ref</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">completa</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="n">l</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfce/12345
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFCeConsulta</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfce/"</span><span class="o">+</span><span class="n">ref</span><span class="o">+</span><span class="s">"?completa=1"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfce/"</span> <span class="o">+</span> <span class="n">ref</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="cm">/* Você deve definir isso globalmente para sua aplicação.
Para ambiente de produção utilize e a variável abaixo:
$server = "https://api.focusnfe.com.br"; */</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="c1">// Substituir a variável, ref, pela sua identificação interna de nota.
</span><span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
<span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
<span class="c1">// Inicia o processo de envio das informações usando o cURL.
</span><span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/nfce/"</span> <span class="o">.</span> <span class="nv">$ref</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfce/"</span> <span class="o">+</span> <span class="nx">ref</span> <span class="o">+</span> <span class="s2">"?completa=1"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<p>Para consultar uma NFCe utilize a URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Consultar as informações de uma NFCe:</p>

<p><code>https://api.focusnfe.com.br/v2/nfce/REFERENCIA?completa=(0|1)</code></p>

<p>Utilize o comando <strong>HTTP GET</strong> para consultar a sua nota para nossa API.</p>

<table><thead>
<tr>
<th>Parâmetro Opcional</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>completa = 0 ou 1</td>
<td>Habilita a API há mostrar campos adicionais na requisição de consulta.</td>
</tr>
</tbody></table>

<blockquote>
<p>Exemplo de resposta da consulta de NFCe (completa=0):</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
</span><span class="s2">"status"</span><span class="p">:</span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
</span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="s2">"100"</span><span class="p">,</span><span class="w">
</span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="s2">"Autorizado o uso da NF-e"</span><span class="p">,</span><span class="w">
</span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="s2">"SEU_CNPJ"</span><span class="p">,</span><span class="w">
</span><span class="s2">"ref"</span><span class="p">:</span><span class="s2">"REFERENCIA"</span><span class="p">,</span><span class="w">
</span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="s2">"NFe41170777627353999172550010000003871980884091"</span><span class="p">,</span><span class="w">
</span><span class="s2">"numero"</span><span class="p">:</span><span class="s2">"387"</span><span class="p">,</span><span class="w">
</span><span class="s2">"serie"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
</span><span class="s2">"caminho_xml_nota_fiscal"</span><span class="p">:</span><span class="s2">"/arquivos/733530172/201704/XMLs/41170777627353999172550010000003871980884091-nfe.xml"</span><span class="p">,</span><span class="w">
</span><span class="s2">"caminho_danfe"</span><span class="p">:</span><span class="s2">"/arquivos/733530172/201704/DANFEs/41170777627353999172550010000003871980884091.pdf"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Campos de retorno:</p>

<ul>
<li><strong>status:</strong> A situação da NFCe, podendo ser:

<ul>
<li><strong>autorizado:</strong> A nota foi autorizada, neste caso é fornecido os dados completos da nota como chave e arquivos para download</li>
<li><strong>cancelado:</strong> O documento foi cancelado, neste caso é fornecido o caminho para download do XML de cancelamento (caminho_xml_cancelamento).</li>
<li><strong>erro_autorizacao:</strong> Houve um erro de autorização por parte da SEFAZ. A mensagem de erro você encontrará nos campos status_sefaz e mensagem_sefaz. É possível fazer o reenvio da nota com a mesma referência se ela estiver neste estado.</li>
<li><strong>denegado:</strong> O documento foi denegado. Uma SEFAZ pode denegar uma nota se houver algum erro cadastral nos dados do destinatário ou do emitente. A mensagem de erro você encontrará nos campos status_sefaz e mensagem_sefaz. Não é possível reenviar a nota caso este estado seja alcançado pois é gerado um número, série, chave de NFe e XML para esta nota. O XML deverá ser armazenado pelo mesmo período de uma nota autorizada ou cancelada.</li>
</ul></li>
<li><strong>status_sefaz:</strong> O status da nota na SEFAZ.</li>
<li><strong>mensagem_sefaz:</strong> Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>serie:</strong> A série da nota fiscal, caso ela tenha sido autorizada.</li>
<li><strong>numero:</strong> O número da nota fiscal, caso ela tenha sido autorizada.</li>
<li><strong>cnpj_emitente:</strong> O CNPJ emitente da nota fiscal (o CNPJ de sua empresa).</li>
<li><strong>ref:</strong> A referência da emissão.</li>
<li><strong>chave_nfe:</strong> A chave da NFe, caso ela tenha sido autorizada.</li>
<li><strong>caminho_xml_nota_fiscal:</strong> caso a nota tenha sido autorizada, retorna o caminho para download do XML.</li>
<li><strong>caminho_danfe:</strong> caso a nota tenha sido autorizada retorna o caminho para download do DANFe.</li>
<li><strong>caminho_xml_cancelamento:</strong> Caso a nota esteja cancelada, é fornecido o caminho para fazer o download do XML de cancelamento.</li>
<li><strong>contingencia_offline</strong> Este campo irá aparecer apenas quando a nota tiver sido emitida em contingência offline.</li>
<li><strong>contingencia_offline_efetivada</strong> Quando a nota tiver sido emitida em contingência offline, este campo irá mostrar se a nota já foi efetivada (transmitida para a SEFAZ) ou não.</li>
<li><strong>tentativa_anterior</strong>: Nos casos de contingência offline, esta chave irá conter outros campos quando conseguirmos determinar o que houve com a tentativa original. Esta seção poderá conter os seguintes campos:

<ul>
<li>status: autorizado, processando_autorizacao ou cancelado. A API irá automaticamente proceder com o cancelamento quando necessário</li>
<li>serie</li>
<li>numero</li>
<li>chave_nfe</li>
<li>caminho_xml_nota_fiscal</li>
<li>caminho_xml_cancelamento</li>
</ul></li>
</ul>

<p>Caso na requisição seja passado o parâmetro <code>completa=1</code> será adicionado mais 6 campos:</p>

<ul>
<li><strong>requisicao_nota_fiscal</strong>: Inclui os dados completos da requisição da nota fiscal, da mesma forma que constam no XML da nota.</li>
<li><strong>protocolo_nota_fiscal</strong>: Inclui os dados completos do protocolo devolvido pela SEFAZ.</li>
<li><strong>requisicao_cancelamento</strong>: Inclui os dados completos da requisição de cancelamento da nota fiscal.</li>
<li><strong>protocolo_cancelamento</strong>: Inclui os dados completos do protocolo devolvido pela SEFAZ.</li>
<li><strong>requisicao_carta_correcao</strong>: Inclui os dados completos da requisição de Carta de Correção Eletrônica da NFe.</li>
<li><strong>protocolo_carta_correcao</strong>: Inclui os dados completos do protocolo devolvido pela SEFAZ.</li>
</ul>

<blockquote>
<p>Exemplo de resposta usando o parâmetro opcional, completa, recebendo o valor &quot;1&quot;:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"requisicao_cancelamento"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"versao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"id_tag"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID1101119118017764335300017255003000000025138154946401"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_orgao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"41"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ambiente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CNPJ_DO_EMITENTE"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"91180177643353000172550030000000251381549464"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-01-17T16:00:28-02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tipo_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"110111"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero_sequencial_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"versao_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cancelamento"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"protocolo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"141180000026777"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"justificativa"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Informe aqui a sua justificativa para realizar o cancelamento da NFe."</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"protocolo_cancelamento"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"versao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ambiente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"versao_aplicativo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PR-v3_8_7"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_orgao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"41"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"motivo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a NF-e"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"91180177643353000172550030000000251381549464"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tipo_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"110111"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cancelamento"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-01-17T16:00:31-02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero_protocolo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"141180000026777"</span><span class="w">
  </span><span class="p">},</span><span class="w">
   </span><span class="s2">"requisicao_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"versao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"id_tag"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID1101109118017764335300017255003000000025138154946401"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_orgao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"41"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ambiente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CNPJ_DO_EMITENTE"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"91180177643353000172550030000000251381549464"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-01-17T15:59:34-02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tipo_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"110110"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero_sequencial_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"versao_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Carta de Correcao"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"correcao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Informe aqui os campos que foram corrigidos na NFe."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"condicoes_uso"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A Carta de Correcao e disciplinada pelo paragrafo 1o-A do art. 7o do Convenio S/N, de 15 de dezembro de 1970 e pode ser utilizada para regularizacao de erro ocorrido na emissao de documento fiscal, desde que o erro nao esteja relacionado com: I - as variaveis que determinam o valor do imposto tais como: base de calculo, aliquota, diferenca de preco, quantidade, valor da operacao ou da prestacao; II - a correcao de dados cadastrais que implique mudanca do remetente ou do destinatario; III - a data de emissao ou de saida."</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"protocolo_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"versao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ambiente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"versao_aplicativo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PR-v3_8_7"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_orgao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"41"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"motivo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a NF-e"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"91180177643353000172550030000000251381549464"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tipo_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"110110"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Carta de Correção"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-01-17T15:59:37-02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero_protocolo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"141180000026777"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='nfce_download-do-xml-da-nfce'>Download do XML da NFCe</h3>
<p>Após a autorização da nota fiscal de consumidor eletrônica será disponibilizado os campos:</p>

<p>caminho_xml_nota_fiscal - Representa o caminho para montar a URL para download do XML. Por exemplo, se você utilizou o ambiente de produção (https://api.focusnfe.com.br) e o caminho_xml_nota_fiscal contém o caminho &quot;/arquivos/733530172/201704/XMLs/41170777627353999172550010000003871980884091-nfe.xml&quot; você poderá acessar o XML pela URL completa https://api.focusnfe.com.br/arquivos/733530172/201704/XMLs/41170777627353999172550010000003871980884091-nfe.xml</p>

<p>Utilize o método <strong>HTTP GET</strong> para essa consulta.</p>

<p>Existe obrigatoriedade legal para armazenar o XML de todas as notas NFCe (modelo 65) por pelo menos 5 anos após a data de autorização da nota. Nossa API faz a guarda automática dos arquivos por esse período.</p>

<blockquote>
<p>Exemplos de respostas da API por <strong>status</strong> para a requisição de consulta:</p>

<p>autorizado</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"referencia_000899"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Autorizado o uso da NF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NFe41190607504505000132650010000000121743484310"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_nota_fiscal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/41190607504505000132650010000000121743484310-nfe.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_danfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/notas_fiscais_consumidor/NFe41190607504505000132650010000000121743484310.html"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"qrcode_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.fazenda.pr.gov.br/nfce/qrcode/?p=41190607504505000132650010000000121743484310|2|2|1|5E264C0E28D801197219894CDFCF2FCCC5237F08"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"url_consulta_nf"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.fazenda.pr.gov.br/nfce/consulta"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>erro_autorizacao</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"referencia_0008992"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"erro_autorizacao"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"591"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Informado CSOSN para emissor que nao e do Simples Nacional (CRT diferente de 1). [nItem:1]"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>cancelado</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"referencia_000899"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cancelado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a NF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NFe41190607504505000132650010000000121743484310"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_nota_fiscal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/41190607504505000132650010000000121743484310-nfe.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_cancelamento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/41190607504505000132650010000000121743484310-can.xml"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='nfce_cancelamento'>Cancelamento</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfce/"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="s">'''
Usamos um dicionario para armazenar os campos e valores que em seguida,
serao convertidos a JSON e enviados para nossa API
'''</span>
<span class="n">justificativa</span><span class="o">=</span><span class="p">{}</span>
<span class="n">justificativa</span><span class="p">[</span><span class="s">"justificativa"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Sua justificativa aqui!"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">justificativa</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X DELETE -d <span class="s1">'{"justificativa":"Teste de cancelamento de nota"}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfce/12345
</code></pre><pre class="highlight java tab-java"><code>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFCeCancelamento</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfce/"</span><span class="o">+</span><span class="n">ref</span><span class="o">);</span>

        <span class="cm">/* Aqui criamos um hashmap para receber a chave "justificativa" e o valor desejado. */</span>      
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">justificativa</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">justificativa</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"justificativa"</span><span class="o">,</span> <span class="s">"Informe aqui a sua justificativa para realizar o cancelamento da NFCe."</span><span class="o">);</span>

        <span class="cm">/* Criamos um objeto JSON para receber a hash com os dados esperado pela API. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">justificativa</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

       <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
        * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfce/"</span> <span class="o">+</span> <span class="n">ref</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">justificativa_cancelamento</span> <span class="o">=</span> <span class="p">{</span>  
  <span class="ss">justificativa: </span><span class="s2">"Informe aqui a sua justificativa para realizar o cancelamento da NFCe."</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Delete a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Delete</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos a hash de justificativa do cancelamento para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">justificativa_cancelamento</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="cm">/* Você deve definir isso globalmente para sua aplicação.
Para ambiente de produção utilize e a variável abaixo:
$server = "https://api.focusnfe.com.br"; */</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="c1">// Substituir a variável, ref, pela sua identificação interna de nota.
</span><span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
<span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
<span class="nv">$justificativa</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span><span class="s2">"justificativa"</span> <span class="o">=&gt;</span> <span class="s2">"Teste de cancelamento de nota"</span><span class="p">);</span>
<span class="c1">// Inicia o processo de envio das informações usando o cURL.
</span><span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span> <span class="o">.</span> <span class="s2">"/v2/nfce/"</span> <span class="o">.</span> <span class="nv">$ref</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_CUSTOMREQUEST</span><span class="p">,</span> <span class="s2">"DELETE"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$justificativa</span><span class="p">));</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota.</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfe/"</span><span class="o">+</span> <span class="nx">ref</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'DELETE'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">cancelar</span> <span class="o">=</span> <span class="p">{</span>

    <span class="s2">"justificativa"</span><span class="p">:</span> <span class="s2">"Sua justificativa aqui!"</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">cancelar</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<p>Para cancelar uma NFCe, basta fazer uma requisição à URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Cancelar uma NFCe já autorizada:</p>

<p><code>https://api.focusnfe.com.br/v2/nfce/REFERENCIA</code></p>

<p>Utilize o comando HTTP <strong>DELETE</strong> para cancelar a sua nota para nossa API. Este método é síncrono, ou seja, a comunicação com a SEFAZ será feita imediatamente e devolvida a resposta na mesma requisição.</p>

<p>O parâmetro de cancelamento deverá ser enviado da seguinte forma:</p>

<ul>
<li><strong>justificativa:</strong> Justificativa do cancelamento. Deverá conter de 15 a 255 caracteres.</li>
</ul>

<p>A API irá em seguida devolver os seguintes campos:</p>

<ul>
<li><strong>status:</strong> cancelado, se a nota pode ser cancelada, ou erro_cancelamento, se houve algum erro ao cancelar a nota.</li>
<li><strong>status_sefaz:</strong> O status do cancelamento na SEFAZ.</li>
<li><strong>mensagem_sefaz:</strong> Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>caminho_xml_cancelamento:</strong> Caso a nota tenha sido cancelada, será informado aqui o caminho para download do XML de cancelamento.</li>
</ul>

<p><strong>Prazo de cancelamento</strong></p>

<p>A NFCe poderá ser cancelada em até 30 minutos após a emissão.</p>

<blockquote>
<p>Exemplos de respostas da API por <strong>status</strong> para a requisição de cancelamento:</p>

<p>cancelado</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a NF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cancelado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_cancelamento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/41190607504505000132650010000000121743484310-can.xml"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>requisicao_invalida</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"requisicao_invalida"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Parâmetro </span><span class="se">\"</span><span class="s2">justificativa</span><span class="se">\"</span><span class="s2"> deve ter entre 15 e 255 caracteres"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>nfe_nao_autorizada</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nfe_nao_autorizada"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nota fiscal não autorizada"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='nfce_inutilizacao'>Inutilização</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfce/inutilizacao"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="s">'''
Usamos dicionarios e listas para armazenar os campos e valores que em seguida,
serao convertidos em JSON e enviados para nossa API
'''</span>
<span class="n">inutilizacao</span><span class="o">=</span><span class="p">{}</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"cnpj"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"CNPJ da empresa emitente"</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"serie"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Serie da numeracao da NFCe que tera uma faixa de numeracao inutilizada"</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"numero_inicial"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Numero inicial a ser inutilizado"</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"numero_final"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Numero final a ser inutilizado"</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"justificativa"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Justificativa da inutilizacao (minimo 15 caracteres)"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">inutilizacao</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -d <span class="s1">'{"cnpj":"51916585009999","serie":"9","numero_inicial":"7730","numero_final":"7732","justificativa":"Teste de inutilizacao de nota"}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfce/inutilizacao
</code></pre><pre class="highlight java tab-java"><code>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFCeInutilizacao</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JSONException</span><span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfce/inutilizacao"</span><span class="o">);</span>

        <span class="cm">/* Aqui criamos um hash que irá receber as chaves e valores esperados para gerar a inutilização. */</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">dadosInutilizacao</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cnpj"</span><span class="o">,</span> <span class="s">"51916585009999"</span><span class="o">);</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"serie"</span><span class="o">,</span> <span class="s">"9"</span><span class="o">);</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero_inicial"</span><span class="o">,</span> <span class="s">"7730"</span><span class="o">);</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero_final"</span><span class="o">,</span> <span class="s">"7732"</span><span class="o">);</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"justificativa"</span><span class="o">,</span> <span class="s">"Informe aqui a justificativa para realizar a inutilizacao da numeracao."</span><span class="o">);</span>

        <span class="cm">/* Criamos um objeto JSON que irá receber o input dos dados, para então enviar a requisição. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">dadosInutilizacao</span><span class="o">);</span>

        <span class="cm">/* Testar se o JSON gerado está dentro do formato esperado.
        System.out.print(json); */</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>       

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

       <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
        * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfce/inutilizacao"</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">dados_inutilizacao</span> <span class="o">=</span> <span class="p">{</span>  
  <span class="ss">cnpj: </span><span class="s2">"51916585009999"</span><span class="p">,</span>
  <span class="ss">serie: </span><span class="s2">"9"</span><span class="p">,</span>
  <span class="ss">numero_inicial: </span><span class="s2">"7730"</span><span class="p">,</span>
  <span class="ss">numero_final: </span><span class="s2">"7732"</span><span class="p">,</span>
  <span class="ss">justificativa: </span><span class="s2">"Informe aqui a justificativa para realizar a inutilizacao da numeracao."</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos a hash de justificativa do cancelamento para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">dados_inutilizacao</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="cm">/* Você deve definir isso globalmente para sua aplicação.
Para ambiente de produção utilize e a variável abaixo:
$server = "https://api.focusnfe.com.br"; */</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
<span class="nv">$inutiliza</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
  <span class="s2">"cnpj"</span> <span class="o">=&gt;</span> <span class="s2">"51916585000125"</span><span class="p">,</span>
  <span class="s2">"serie"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
  <span class="s2">"numero_inicial"</span> <span class="o">=&gt;</span> <span class="s2">"107"</span><span class="p">,</span>
  <span class="s2">"numero_final"</span> <span class="o">=&gt;</span> <span class="s2">"109"</span><span class="p">,</span>
  <span class="s2">"justificativa"</span> <span class="o">=&gt;</span> <span class="s2">"Teste+de+inutilizacao+de+nota"</span>  
<span class="p">);</span>
<span class="c1">// Inicia o processo de envio das informações usando o cURL.
</span><span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/nfce/inutilizacao"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$inutiliza</span><span class="p">));</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfce/inutilizacao"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">inutiliza</span> <span class="o">=</span> <span class="p">{</span>
<span class="s2">"cnpj"</span><span class="p">:</span> <span class="s2">"51916585000125"</span><span class="p">,</span>
<span class="s2">"serie"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
<span class="s2">"numero_inicial"</span><span class="p">:</span> <span class="s2">"700"</span><span class="p">,</span>
<span class="s2">"numero_final"</span><span class="p">:</span> <span class="s2">"703"</span><span class="p">,</span>
<span class="s2">"justificativa"</span><span class="p">:</span> <span class="s2">"Teste de inutilizacao de nota"</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">inutiliza</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<p>Em uma situação normal você não precisará informar ao SEFAZ a inutilização de um número da NFCe, pois a API controla automaticamente a numeração das notas. Porém, se por alguma situação específica for necessário a inutilização de alguma faixa de números você poderá chamar as seguintes operações:</p>

<p>Envio de inutilização de faixa de numeração:</p>

<p><code>https://api.focusnfe.com.br/v2/nfce/inutilizacao</code></p>

<p>Utilize o comando HTTP <strong>POST</strong> para enviar a sua inutilização para nossa API. Este método é <strong>síncrono</strong>, ou seja, a comunicação com a SEFAZ será feita imediatamente e devolvida a resposta na mesma requisição.</p>

<p>A inutilização precisa dos seguintes parâmetros obrigatórios:</p>

<ul>
<li><strong>cnpj:</strong> CNPJ da empresa emitente</li>
<li><strong>serie:</strong> Série da numeração da NFCe que terá uma faixa de numeração inutilizada</li>
<li><strong>numero_inicial:</strong> Número inicial a ser inutilizado</li>
<li><strong>numero_final:</strong> Número final a ser inutilizado</li>
<li><strong>justificativa:</strong> Justificativa da inutilização (mínimo 15 caracteres)</li>
</ul>

<p>A API irá enviar uma resposta com os seguintes campos:</p>

<ul>
<li><strong>status:</strong> autorizado, se a inutilização foi aceita pela SEFAZ, ou erro_autorizacao, se houve algum erro ao inutilizar os números.</li>
<li><strong>status_sefaz:</strong> O status da carta de correção na SEFAZ.</li>
<li><strong>mensagem_sefaz:</strong> Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>serie:</strong> Série da numeração da NFCe que terá uma faixa de numeração inutilizada</li>
<li><strong>numero_inicial:</strong> Número inicial a ser inutilizado</li>
<li><strong>numero_final:</strong> Número final a ser inutilizado</li>
<li><strong>cnpj:</strong> CNPJ da empresa</li>
<li><strong>modelo:</strong> Modelo do documento (65 para NFCe)</li>
<li><strong>caminho_xml:</strong> Caminho do XML para download caso a inutilização tenha sido autorizada pela SEFAZ.</li>
</ul>

<p>Em algumas situações em que sejam identificados erros de emissão de forma tardia, nossa API pode decidir pela inutilização de números ao invés de reutilizá-los para outras emissões. Desta forma você pode criar um gatilho (webhook) para ser notificado sempre que houver a inutilização de alguma faixa de numeração. Consulte a <a href="https://focusnfe.com.br/doc/#gatilhos-webhooks_gatilhos-webhooks">seção de gatilhos</a> e utilize o evento chamado &quot;inutilizacao&quot;.</p>

<blockquote>
<p>Exemplos de respostas da API por <strong>status</strong> para a requisição de inutilização:</p>

<p>autorizado</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"102"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Inutilizacao de numero homologado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_inicial"</span><span class="p">:</span><span class="w"> </span><span class="s2">"999"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_final"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1000"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"modelo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"65"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1807504405000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/07504505000132/201906/XMLs/190750450500013265001000000999000001000-inu.xml"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>erro_autorizacao</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"241"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Um numero da faixa ja foi utilizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_inicial"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_final"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"erro_autorizacao"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='nfce_reenvio-de-e-mail'>Reenvio de e-mail</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfce/"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="s">'''
Usamos um dicionario para armazenar os campos e valores que em seguida,
serao convertidos a JSON e enviados para nossa API
'''</span>
<span class="n">emails</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">email</span> <span class="o">=</span> <span class="s">"suporte@acras.com.br"</span>
<span class="n">emails</span><span class="p">[</span><span class="s">"emails"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">email</span><span class="p">]</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">ref</span><span class="o">+</span><span class="s">"/email"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">emails</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="n">l</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -d <span class="s1">'{"emails":["alguem@example.org"]}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfce/12345/email
</code></pre><pre class="highlight java tab-java"><code>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFCeEnviaEmail</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JSONException</span><span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfce/"</span><span class="o">+</span><span class="n">ref</span><span class="o">+</span><span class="s">"/email"</span><span class="o">);</span>

        <span class="cm">/* Criamos o um objeto JSON que receberá um JSON Array com a lista de e-mails. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">();</span>
        <span class="n">JSONArray</span> <span class="n">listaEmails</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">();</span>
        <span class="n">listaEmails</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"email_01@acras.com.br"</span><span class="o">);</span>
        <span class="n">listaEmails</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"email_02@acras.com.br"</span><span class="o">);</span>
        <span class="n">listaEmails</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"email_03@acras.com.br"</span><span class="o">);</span>
        <span class="n">json</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"emails"</span><span class="o">,</span> <span class="n">listaEmails</span><span class="o">);</span>

        <span class="cm">/* Testar se o JSON gerado está dentro do formato esperado.
        System.out.print(json); */</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfce/"</span> <span class="o">+</span> <span class="n">ref</span> <span class="o">+</span> <span class="s2">"/email"</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">emails_destinatarios</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">emails: </span><span class="p">[</span><span class="s2">"email_01@acras.com.br"</span><span class="p">,</span> <span class="s2">"email_02@acras.com.br"</span><span class="p">,</span> <span class="s2">"email_03@acras.com.br"</span><span class="p">]</span>
<span class="p">}</span>
<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos os dados da nota para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">emails_destinatarios</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="cm">/* Você deve definir isso globalmente para sua aplicação.
Para ambiente de produção utilize e a variável abaixo:
$server = "https://api.focusnfe.com.br"; */</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="c1">// Substituir a variável, ref, pela sua identificação interna de nota.
</span><span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
<span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
<span class="nv">$email</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
  <span class="s2">"emails"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="s2">"email@email.com"</span>
    <span class="p">)</span>
  <span class="p">);</span>
<span class="c1">// Inicia o processo de envio das informações usando o cURL.
</span><span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/nfce/"</span> <span class="o">.</span> <span class="nv">$ref</span> <span class="o">.</span> <span class="s2">"/email"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$email</span><span class="p">));</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota.</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfce/"</span> <span class="o">+</span> <span class="nx">ref</span> <span class="o">+</span> <span class="s2">"/email"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">email</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"email1@acras.com.br"</span><span class="p">,</span> <span class="s2">"email2@acras.com.br"</span><span class="p">,</span> <span class="s2">"email3@acras.com.br"</span><span class="p">];</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="s2">"emails"</span><span class="p">:</span> <span class="nx">email</span><span class="p">});</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<p>Para cada nota autorizada, cancelada ou que tenha sido emitida uma carta de correção o destinatário da nota é notificado via email. Porém eventualmente pode ser necessário enviar a nota fiscal para outras pessoas ou mesmo reenviar o email para o mesmo destinatário.</p>

<p>Para enviar um ou mais emails:</p>

<p><code>https://api.focusnfe.com.br/v2/nfce/REFERENCIA/email</code></p>

<p>Utilize o comando HTTP <strong>POST</strong> para enviar os emails. Esta operação aceita apenas um parâmetro:</p>

<ul>
<li><strong>emails:</strong> Array com uma lista de emails que deverão receber uma cópia da nota. Limitado a 10 emails por vez.</li>
</ul>

<p>A API imediatamente devolve a requisição com a confirmação dos emails. Os emails serão enviados em segundo plano, por isso pode levar alguns minutos até que eles cheguem à caixa postal.</p>
<h1 id='enviador-de-arquivos-s-t-nfce_enviador-de-arquivos-s-t-nfce'>Enviador de Arquivos S@T / NFCe</h1>
<p>Para os usuários de tecnologias que não permitem o acesso à API via Web Services ou que não desejam programar o acesso HTTP, disponibilizamos um comunicador standalone (desktop) que realiza toda comunicação com a nossa API.</p>
<h2 id='enviador-de-arquivos-s-t-nfce_visao-geral'>Visão Geral</h2>
<p>O Enviador de Arquivos, quando é executado, consulta o conteúdo de algumas pastas com descrições especificas que podem ser criados a partir do diretório escolhido pelo usuário, chamamos estes diretórios de &#39;Diretórios de Comunicação&#39;.
Desta forma, seu programa poderá apenas criar um arquivo em uma pasta específica, contendo o JSON com os dados necessários para emitir a nota.
O enviador por sua vez consulta esta pasta e armazena o resultado (PDF, XML) em outra pasta para consulta.</p>

<aside class="warning">
O diretório de comunicação deve ser um local onde o usuário terá plenos direitos de acesso dentro do sistema operacional. Recomendamos o diretório: C:\\Comunicador\
</aside>

<p><strong>Diretórios de Comunicação</strong></p>

<p>Abaixo a descrição de cada pasta e a sua finalidade:</p>

<ul>
<li><strong>envios</strong>: diretório inicial do processo de envio. O Enviador irá procurar os arquivos com extensão .nfce ou .cfe para fazer a emissão ou cancelamento.</li>
<li><strong>enviados</strong>: todos os arquivos lidos no diretório &#39;envios&#39; serão movidos para este diretório.</li>
<li><strong>tmp</strong>: neste diretório é gerado um arquivo no formato XML para o envio dos dados ao aparelho S@T. Na emissão de NFCe essa etapa não acontece, pois é utilizada a nossa API de NFCe.</li>
<li><strong>processados</strong>: neste diretório o Enviador de Arquivos irá armazenar as respostas &#39;cruas&#39; recebidas da Sefaz, ele irá adicionar a extensão &#39;.resp.raw.json&#39; nos arquivos .cfe/.cfecanc, .nfce/.canc.</li>
<li><strong>retornos</strong>: aqui é gerado um novo arquivo com a resposta da Sefaz formatada (mesmo conteúdo presente no arquivo do diretório &#39;processados&#39;), porém com a extensão .cfe/.cfecanc, .nfce/.canc.</li>
<li><strong>xml</strong>: neste diretório é salvo o XML gerado pela Sefaz, tanto para CFe S@T como para NFCe (emissão e cancelamento).</li>
<li><strong>pdf</strong>: aqui é salvo a DANFCe e a impressão do CFe do S@T. Não é gerado impressão quando o documento fiscal é cancelado.</li>
</ul>

<p>No diagrama abaixo mostramos como será o fluxo de acesso aos diretórios citados anteriormente:</p>

<p><img src="images/diagrama_enviador_electron.png" alt="Diagrama enviador electron" /></p>
<h2 id='enviador-de-arquivos-s-t-nfce_documentos-suportados'>Documentos Suportados</h2>
<p>Os documentos fiscais suportados atualmente são o Cupom Fiscal Eletrônico gerado por aparelhos S@T do Estado de São Paulo e a Nota Fiscal de Consumidor Eletrônica ou NFCe que pode ser emitida em todos os Estados brasileiros, com exceção de Santa Catarina.</p>

<p>Para cada documento, será esperado um arquivo com formato diferente. Nele, estarão os dados da nota que serão enviados para a Sefaz do Estado.</p>
<h2 id='enviador-de-arquivos-s-t-nfce_cfe-s-t'>CFe S@T</h2>
<p>Para emissão dos cupons fiscais com o S@T será necessário, primeiramente, o cumprimento das premissas abaixo:</p>

<ul>
<li>Ter um aparelho S@T de uma marca homologada com o nosso sistema (consultar aqui).</li>
<li>O S@T deve estar vinculado ao emitente na Sefaz do Estado de São Paulo.</li>
<li>O aparelho deve ser atividado, conforme as orientações do fabricante.</li>
<li>Configurado a Assinatura AC no aparelho S@T, através do seu respectivo software de ativação.</li>
</ul>

<p>A partir disso, será possível utilizar o nosso Enviador. Ressaltamos que todas as etapas são importantes e, quando não cumpridas, impedem a emissão do documento fiscal.</p>

<p>O arquivo com os dados do CFe S@T deve seguir a estrutura de um arquivo do formato JSON, mas com a extensão <strong>.cfe</strong> (emissão) e <strong>.cfecanc</strong> (cancelamento).</p>
<h3 id='enviador-de-arquivos-s-t-nfce_campos'>Campos</h3>
<blockquote>
<p>Dados de exemplo (campos obrigatórios) <strong>.cfe</strong>:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"codigo_ncm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"21069090"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"codigo_produto"</span><span class="p">:</span><span class="w"> </span><span class="s2">"L055"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Descricao produto"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"quantidade"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"cfop"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5102"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"valor_unitario"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w">
            </span><span class="s2">"valor_bruto"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unidade_comercial"</span><span class="p">:</span><span class="w"> </span><span class="s2">"un"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"icms_situacao_tributaria"</span><span class="p">:</span><span class="w"> </span><span class="s2">"40"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Dados de exemplo (campos não obrigatórios) <strong>.cfe</strong>:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"nome_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ACRAS TECNOLOGIA DA INFORMACAO LTDA"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cnpj_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"codigo_ncm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"21069090"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"codigo_produto"</span><span class="p">:</span><span class="w"> </span><span class="s2">"L055"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Descricao produto"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"quantidade"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"cfop"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5102"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"valor_unitario"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.00</span><span class="p">,</span><span class="w">
            </span><span class="s2">"valor_bruto"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.00</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unidade_comercial"</span><span class="p">:</span><span class="w"> </span><span class="s2">"un"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"icms_situacao_tributaria"</span><span class="p">:</span><span class="w"> </span><span class="s2">"40"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"icms_aliquota"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"valor_total_tributos"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"pis_situacao_tributaria"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"pis_aliquota_porcentual"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"cofins_situacao_tributaria"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"cofins_aliquota_porcentual"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"forma_pagamento"</span><span class="p">:[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"forma_pagamento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"03"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"valor_pagamento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.50"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"forma_pagamento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"02"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"valor_pagamento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.50"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Abaixo os campos mínimos que utilizamos para a emissão de um Cupom Fiscal Eletrônicos S@T:</p>

<p>Campos do grupo &#39;<strong>itens</strong>&#39;:</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>codigo_ncm</td>
<td>código NCM do produto.</td>
</tr>
<tr>
<td>codigo_produto</td>
<td>código interno do produto.</td>
</tr>
<tr>
<td>descricao</td>
<td>descrição do produto.</td>
</tr>
<tr>
<td>quantidade</td>
<td>quantidade do produto.</td>
</tr>
<tr>
<td>cfop</td>
<td>código CFOP da operação.</td>
</tr>
<tr>
<td>valor_unitario</td>
<td>valor unitário da produto.</td>
</tr>
<tr>
<td>valor_bruto</td>
<td>valor bruto do produto.</td>
</tr>
<tr>
<td>unidade_comercial</td>
<td>unidade de medida comercial do produto.</td>
</tr>
<tr>
<td>icms_situacao_tributaria</td>
<td>código da situação tributário do ICMS. Valores possíveis: 00, 20, 40, 60, 102, 103, 300, 500 ou 900.</td>
</tr>
</tbody></table>

<p>Para mais detalhes sobre os valores possívels em <strong>icms_situacao_tributaria</strong> consulte nossa documentação de campos da API NFe/NFCe <a href="https://focusnfe.com.br/dsl/4.0/ItemNotaFiscalXML.html">aqui</a>.</p>
<h3 id='enviador-de-arquivos-s-t-nfce_campos-omitidos-nao-obrigatorios'>Campos omitidos / não obrigatórios</h3>
<p>Abaixo os campos respectivos ao destinatário do CFe:</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>cnpj_destinatario</td>
<td>CNPJ do destinatário. Não informar se for preenchido o campo cpf_destinatario.</td>
</tr>
<tr>
<td>cpf_destinatario</td>
<td>CPF do destinatário. Não informar se for preenchido o campo cnpj_destinatario.</td>
</tr>
<tr>
<td>nome_destinatario</td>
<td>Nome ou Razão Social do destinatário.</td>
</tr>
</tbody></table>

<p>Estes campos são preenchidos automaticamente quando omitidos:</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Descrição</th>
<th>Valor padrão</th>
</tr>
</thead><tbody>
<tr>
<td>icms_aliquota</td>
<td>alíquota do ICMS.</td>
<td>0.00</td>
</tr>
<tr>
<td>pis_situacao_tributaria</td>
<td>código da situação tributário do PIS. Valores possíveis: 01, 02, 03, 04, 05, 06, 07, 08 e 09.</td>
<td>07 / 49</td>
</tr>
<tr>
<td>pis_aliquota_porcentual</td>
<td>alíquota do PIS.</td>
<td>0.00</td>
</tr>
<tr>
<td>cofins_situacao_tributaria</td>
<td>código da situação tributário do COFINS. Valores possíveis: 01, 02, 03, 04, 05, 06, 07, 08 e 09.</td>
<td>07 / 49</td>
</tr>
<tr>
<td>cofins_aliquota_porcentual</td>
<td>alíquota do COFINS.</td>
<td>0.00</td>
</tr>
</tbody></table>

<p>Campos do grupo &#39;<strong>formas_pagamento</strong>&#39;:</p>

<p>Quando omitido, será considerado a forma de pagamento dinheiro e o valor total do cupom.</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>forma_pagamento</td>
<td>forma de pagamento utilizado na venda. Valores possíveis: 01, 02, 03, 04, 05, 10, 11, 12, 13 ou 99.</td>
</tr>
<tr>
<td>valor_pagamento</td>
<td>valor total utilizado para essa forma de pagamento.</td>
</tr>
</tbody></table>

<p>Para mais detalhes sobre os valores possívels em <strong>forma_pagamento</strong> consulte nossa documentação de campos da API NFe/NFCe <a href="https://focusnfe.com.br/dsl/4.0/FormaPagamentoXML.html">aqui</a>.</p>

<p><strong>Emissão</strong></p>

<blockquote>
<p>Arquivo <strong>.cfe</strong> de exemplo:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"codigo_ncm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"21069090"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"codigo_produto"</span><span class="p">:</span><span class="w"> </span><span class="s2">"L055"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Descricao produto"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"quantidade"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="s2">"cfop"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5102"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"valor_unitario"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w">
            </span><span class="s2">"valor_bruto"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unidade_comercial"</span><span class="p">:</span><span class="w"> </span><span class="s2">"un"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"icms_situacao_tributaria"</span><span class="p">:</span><span class="w"> </span><span class="s2">"40"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>O Enviador de Arquivos utiliza a descrição do arquivo no formato &#39;.cfe&#39; para realizar a emissão do cupom fiscal. Essa descrição nós chamamos de referência ou REF, você pode ler mais sobre ela <a href="#introducao_referencia">aqui</a>.</p>

<p>É importante observar que o Enviador de Arquivos não possui qualquer inteligência com relação à referência utilizada, por isso, seu sistema deve garantir a criação das REF&#39;s, de modo que nunca seja criado uma mesma referência para o mesmo emitente. Se isso acontecer, você receberá um retorno informando que a nota já foi autorizada.</p>

<p><strong>Cancelamento</strong></p>

<blockquote>
<p>Arquivo <strong>.cfecanc</strong> de exemplo:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"chave"</span><span class="p">:</span><span class="w"> </span><span class="s2">"77781082373077987991599000999380000289999993"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Arquivo <strong>.cfecanc</strong> de exemplo (quando informado o CNPJ ou CPF do destinatário):</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"chave"</span><span class="p">:</span><span class="w"> </span><span class="s2">"77781082373077987991599000999380000289999993"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Utilizamos a mesma referência de emissão para o cancelamento, contudo, sua extensão é alterada para <strong>.cfecanc</strong> e, em seu conteúdo, deve ser enviado a chave de acesso do Cupom Fiscal Eletrônico. Caso seja informado o documento de identificação do destinatário (CNPJ ou CPF) na emissão, o mesmo terá de ser informado no arquivo de cancelamento.</p>

<p>Após processado o cancelamento um arquivo com o mesmo nome será gravado no diretório &quot;retornos&quot; contendo um JSON simples com o resultado da operação indicando se houve sucesso ou erro.</p>

<p><strong>Reimpressão do Cupom Fiscal Eletrônico</strong></p>

<p>O arquivo de impressão do CFe S@T fica armazenado na pasta &#39;pdf&#39;, basta acessar esse diretório para realizar a reimpressão de Cupons Fiscais já emitidos.</p>
<h2 id='enviador-de-arquivos-s-t-nfce_nfce'>NFCe</h2>
<p>Para emissão da Nota Fiscal de Consumidor Eletrônica será necessário, primeiramente, o cumprimento das premissas abaixo:</p>

<ul>
<li>Possuir Certificado Digital modelo A1.</li>
<li>Habilitar a emissão de NFCe na Sefaz do Estado do emitente.</li>
<li>Gerar os códigos CSC e ID_TOKEN na Sefaz.</li>
<li>Realizar o cadastro da empresa emitente em nossa base (<a href="https://focusnfe.com.br/cadastro/">site Focus NFe</a>, <a href="https://app.focusnfe.com.br/">Painel da API</a> ou <a href="#revenda_revenda">API de Revenda</a>).</li>
<li>Informar os códigos CSC e ID_TOKEN no cadastro do emitente.</li>
<li>Importar o Certificado Digital através do Painel da API ou solicitar ao nosso Suporte (suporte@acras.com.br).</li>
</ul>

<p>A partir disso, será possível utilizar o nosso Enviador. Ressaltamos que todas as etapas são importantes e, quando não cumpridas, impedem a emissão do documento fiscal.</p>

<p>O arquivo com os dados da NFCe deve seguir a estrutura de um arquivo do formato JSON, mas com a extensão <strong>.nfce</strong> (emissão) e <strong>.canc</strong> (cancelamento).</p>
<h3 id='enviador-de-arquivos-s-t-nfce_campos-2'>Campos</h3>
<p>Os campos utilizados para emissão da NFCe são os mesmos que utilizamos em nossa API de NFCe, veja os campos obrigatórios <a href="#nfce_campos-obrigatorios-de-uma-nfce">aqui</a>.</p>

<p>Abaixo os campos referentes aos dados do emitente na DANFCe:</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>nome_emitente</td>
<td>nome da empresa emitente.</td>
</tr>
<tr>
<td>cnpj_emitente</td>
<td>CNPJ da empresa que está emitindo a NFCe.</td>
</tr>
<tr>
<td>telefone_emitente</td>
<td>telefone do emitente.</td>
</tr>
<tr>
<td>municipio_emitente</td>
<td>município do emitente.</td>
</tr>
<tr>
<td>logradouro_emitente</td>
<td>logradouro do emitente.</td>
</tr>
<tr>
<td>numero_emitente</td>
<td>numero do logradouro do emitente.</td>
</tr>
<tr>
<td>bairro_emitente</td>
<td>bairro do emitente</td>
</tr>
<tr>
<td>cep_emitente</td>
<td>CEP do emitente.</td>
</tr>
<tr>
<td>uf_emitente</td>
<td>UF do Estado do emitente.</td>
</tr>
</tbody></table>

<aside class="notice">
Atualmente nosso Enviador não faz os cálculos dos impostos apróximados da Lei da Transparência, mas você pode informá-lo através do campo <b>valor_total_tributos</b> nos totais da nota.
</aside>

<p><strong>Emissão</strong></p>

<blockquote>
<p>Arquivo <strong>.nfce</strong> de exemplo:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"nome_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ACME LTDA"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"51916585000125"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"telefone_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4139995050"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"municipio_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ponta Grossa"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"logradouro_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Av. XV de Novembro"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12343"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"bairro_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Centro"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cep_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"84015500"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"uf_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PR"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"valor_total"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"valor_troco"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_emissao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-03-26T10:47:00-0300"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cpf_destinatario"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cnpj_destinatario"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nome_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"indicador_inscricao_estadual_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"modalidade_frete"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"local_destino"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"presenca_comprador"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"formas_pagamento"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"forma_pagamento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"01"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"valor_pagamento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5.00"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"codigo_produto"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0007"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"numero_item"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"codigo_ncm"</span><span class="p">:</span><span class="s2">"62044200"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"cfop"</span><span class="p">:</span><span class="s2">"5102"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"icms_origem"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"icms_situacao_tributaria"</span><span class="p">:</span><span class="s2">"102"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NOTA FISCAL EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"quantidade_comercial"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"unidade_comercial"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UN"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"valor_unitario_comercial"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.00"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>O Enviador de Arquivos utiliza a descrição do arquivo no formato &#39;.nfce&#39; para realizar a emissão da Nota Fiscal de Consumidor. Essa descrição nós chamamos de referência ou REF, você pode ler mais sobre ela <a href="#introducao_referencia">aqui</a>.</p>

<p>É importante observar que o Enviador de Arquivos não possui qualquer inteligência com relação à referência utilizada, por isso, seu sistema deve garantir a criação das REF&#39;s, de modo que nunca seja criado uma mesma referência para o mesmo emitente. Se isso acontecer, você receberá um retorno informando que a nota já foi autorizada.</p>

<p><strong>Cancelamento</strong></p>

<p>Utilizamos a mesma referência de emissão para o cancelamento, contudo, sua extensão é alterada para <strong>.canc</strong> e, em seu conteúdo, deve ser enviado a justificativa do cancelamento da nota contendo de 15 à 200 caracteres.</p>

<p>Após processado o cancelamento um arquivo com o mesmo nome será gravado no diretório &quot;retornos&quot; contendo um JSON simples com o resultado da operação indicando se houve sucesso ou erro.</p>

<blockquote>
<p>Arquivo de cancelamento da NFCe <strong>.canc</strong>:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"justificativa"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Motivo por solicitar o cancelamento da sua NFCe."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>Reimpressão da DANFCe</strong></p>

<p>O arquivo de impressão da NFCe fica armazenado na pasta &#39;pdf&#39;, basta acessar esse diretório para realizar a reimpressão de uma nota já emitida.</p>

<p>Outra forma de realizar este processo é criar um arquivo sem conteúdo com a mesma descrição (REF) usada na emissão da nota, com o acréscimo do sufixo &quot;_nfce&quot;, e com a extensão de arquivo <strong>.reimp.</strong>. Ele deverá ser colocado no diretório &#39;envios&#39;, com isso, o Enviador irá fazer uma chamada na impressora configurada enviando a DANFCe para impressão.</p>
<h2 id='enviador-de-arquivos-s-t-nfce_cfe-mfe'>CFe MFe</h2>
<p>Para emissão do Cupom Fiscal Eletrônico no estado do Ceará será necessário, primeiramente, o cumprimento das premissas abaixo:</p>

<ul>
<li>Seguir as instruções da seção de &#39;contribuinte&#39; presentes no documento &#39;Manual do Portal CFe destinado aos Contribuintes - Software Houses - Consumidor Final&#39;, que pode ser encontrado <a href="https://servicos.sefaz.ce.gov.br/internet/download/projetomfe/Manual_Manual_PortalCFe_Rev_26.pdf">aqui</a>, ou acessando a área de downloads no Portal da Sefaz do Ceará.</li>
<li>Possuir acesso a <a href="https://cfe.sefaz.ce.gov.br/mfe/portal#/login?type=TAXPAYER">área restrita</a> do contribuinte no Portal da Sefaz do Ceará.</li>
<li>Vincular o equipamento MFe (Módulo Fiscal Eletrônico) ao CNPJ do contribuinte e assinar o &#39;Termo de Aceite e Requisição de Certificado Digital da SEFAZ-CE&#39; na área restrita do contribuinte.</li>
<li>Solicitar para o suporte a vinculação do CNPJ do contribuinte com o Aplicativo Comercial (Comunicador Focus NFe).</li>
</ul>

<p>Após a vinculação do Comunicador Focus NFe com o CNPJ do Contribuinte, o funcionamento do processo, assim como os campos utilizados, segue os mesmos padrões descritos na seção CFe S@T.</p>
<h2 id='enviador-de-arquivos-s-t-nfce_api-local'>API Local</h2><pre class="highlight shell tab-shell"><code><span class="c"># Consultar status</span>
curl -XGET -T http://localhost:55555/fiscal/sat/status
</code></pre>
<blockquote>
<p>Exemplo de resposta da API local após consultar o <strong>status</strong> do equipamento:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_sat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"08000"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SAT em operação"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_sessao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"768630"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"raw_response"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="err">Resposta</span><span class="w"> </span><span class="err">sem</span><span class="w"> </span><span class="err">tratamento</span><span class="w"> </span><span class="err">retornada</span><span class="w"> </span><span class="err">pelo</span><span class="w"> </span><span class="err">equipamento.</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="c"># Extrair logs</span>
curl -XGET -T http://localhost:55555/fiscal/sat/logs
</code></pre>
<blockquote>
<p>Exemplo de resposta da API local após extrair os <strong>logs</strong> do equipamento:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_sat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"15000"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="s2">"arquivo_log_base64"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">em</span><span class="w"> </span><span class="err">base</span><span class="mi">64</span><span class="w"> </span><span class="err">contendo</span><span class="w"> </span><span class="err">os</span><span class="w"> </span><span class="err">logs</span><span class="w"> </span><span class="err">retornados</span><span class="w"> </span><span class="err">pelo</span><span class="w"> </span><span class="err">equipamento</span><span class="w">
  </span><span class="s2">"raw_response"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="err">Resposta</span><span class="w"> </span><span class="err">sem</span><span class="w"> </span><span class="err">tratamento</span><span class="w"> </span><span class="err">retornada</span><span class="w"> </span><span class="err">pelo</span><span class="w"> </span><span class="err">equipamento.</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code>curl -XPOST --header <span class="s1">'Content-Type: application/json'</span> http://localhost:55555/fiscal/sat/ -T arquivo.json
</code></pre>
<blockquote>
<p>Exemplo de resposta da API local após <strong>emissão</strong> do cupom fiscal pelo equipamento SAT/MFe:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Emitido com sucesso + conteudo notas."</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cpf_cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="s2">"chave_cfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CFe77781082373077987991599000999380000289999993"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"arquivo_cfe_base64"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">em</span><span class="w"> </span><span class="err">base</span><span class="mi">64</span><span class="w"> </span><span class="err">contento</span><span class="w"> </span><span class="err">o</span><span class="w"> </span><span class="err">xml</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">cupom</span><span class="w"> </span><span class="err">fiscal</span><span class="w"> </span><span class="err">retornado</span><span class="w"> </span><span class="err">pelo</span><span class="w"> </span><span class="err">equipamento.</span><span class="w">
  </span><span class="s2">"data_emissao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"20200824185237"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"valor_total_cfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10.99"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"arquivo_cfe_pdf_base64"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">em</span><span class="w"> </span><span class="err">base</span><span class="mi">64</span><span class="w"> </span><span class="err">contento</span><span class="w"> </span><span class="err">o</span><span class="w"> </span><span class="err">pdf</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">cupom</span><span class="w"> </span><span class="err">fiscal.</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code>curl -XDELETE --header <span class="s1">'Content-Type: application/json'</span> http://localhost:55555/fiscal/sat/ -T arquivo.json
</code></pre>
<blockquote>
<p>Exemplo de resposta da API local após <strong>cancelamento</strong> do cupom fiscal pelo equipamento SAT/MFe:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cancelado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cupom cancelado com sucesso + conteudo CF-E-SAT cancelado."</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cpf_cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="s2">"chave_cfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CFe77781082373077987991599000999380000289991234"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"001754"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"arquivo_cfe_base64"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">em</span><span class="w"> </span><span class="err">base</span><span class="mi">64</span><span class="w"> </span><span class="err">contento</span><span class="w"> </span><span class="err">o</span><span class="w"> </span><span class="err">xml</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">cupom</span><span class="w"> </span><span class="err">fiscal</span><span class="w"> </span><span class="err">retornado</span><span class="w"> </span><span class="err">pelo</span><span class="w"> </span><span class="err">equipamento.</span><span class="w">
  </span><span class="s2">"data_emissao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"20200824185237"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"valor_total_cfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10.99"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"arquivo_cfe_pdf_base64"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Além do sistema de comunicação via diretórios, o Comunicador Focus NFe também disponibiliza uma API local para comunicação direta. 
Através da API Local é possível: </p>

<ul>
<li>Verificar o status do equipamento (SAT/MFe).</li>
<li>Extrair os logs do equipamento (SAT/MFe).</li>
<li>Emissão do cupom fiscal (SAT/MFe).</li>
<li>Cancalemento do cupom fiscal (SAT/MFe).</li>
</ul>
<h3 id='enviador-de-arquivos-s-t-nfce_urls'>URLs</h3>
<table><thead>
<tr>
<th>Método</th>
<th>URL (recurso)</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>GET</td>
<td>http://localhost:PORTA/fiscal/sat/status</td>
<td>Retorna o status do equipamento.</td>
</tr>
<tr>
<td>GET</td>
<td>http://localhost:PORTA/fiscal/sat/logs</td>
<td>Extrai os logs do equipamento.</td>
</tr>
<tr>
<td>POST</td>
<td>http://localhost:PORTA/fiscal/sat/</td>
<td>Emite um cupom fiscal eletrônico.</td>
</tr>
<tr>
<td>DELETE</td>
<td>http://localhost:PORTA/fiscal/sat/</td>
<td>Cancela um cupom fiscal eletrônico.</td>
</tr>
</tbody></table>

<ul>
<li>Obs 1: A valor de &#39;PORTA&#39; é definido nas configurações do Comunicador Focus NFe. Caso não seja atribuído um número válido, será escolhido um valor de porta aleatório válido.</li>
<li>Obs 2: O body das requisições para emissão do cupom fiscal e para o cancelamento segue exatamente o mesmo padrão utilizado nos arquivos &#39;.cfe&#39; e &#39;.cfecanc&#39; exemplificados anteriormente.</li>
</ul>
<h3 id='enviador-de-arquivos-s-t-nfce_consultar-status'>Consultar Status</h3>
<p>A consulta de status retorna o status do equipamento SAT/MFe conectado no computador do usuário. O modelo do equipamento e o código de ativação devem ser devidamente configurados no Comunicador Focus NFe para o correto funcionamento da consulta. </p>
<h3 id='enviador-de-arquivos-s-t-nfce_extrair-logs'>Extrair logs</h3>
<p>A extração dos logs retorna os logs do equipamento SAT/MFe conectado no computador do usuário. Devido ao tamanho do arquivo, os dados são retornados em base64.</p>
<h3 id='enviador-de-arquivos-s-t-nfce_emitir-cupom-fiscal'>Emitir cupom fiscal</h3>
<p>A emissão de um cupom retorna um json com os detalhes da autorização feita pelo equipamento SAT/MFe conectado no computador do usuário. Os arquivos xmls gerados, assim como o pdf são retornados em base64.</p>
<h3 id='enviador-de-arquivos-s-t-nfce_cancelar-cupom-fiscal'>Cancelar cupom fiscal</h3>
<p>O cancelamento de um cupom retorna um json com os detalhes do cancelamento feito pelo equipamento SAT/MFe conectado no computador do usuário. Os arquivos xmls gerados são retornados em base64.</p>
<h2 id='enviador-de-arquivos-s-t-nfce_download'>Download</h2>
<p>Para te acesso ao instalador do Enviador de Arquivos, entre em contato com a nossa equipe no email comercial@acras.com.br.</p>
<h1 id='nfse_nfse'>NFSe</h1>
<p>Através da API NFSe é possível:</p>

<ul>
<li>Emitir NFSe para qualquer município utilizando um único modelo de dados. Este processo é <strong>assíncrono</strong>. Ou seja, após a emissão a nota será enfileirada para processamento.</li>
<li>Cancelar NFSe</li>
<li>Consultar NFSe’s emitidas</li>
<li>Encaminhar uma NFSe autorizada por email</li>
</ul>
<h2 id='nfse_urls'>URLs</h2>
<table><thead>
<tr>
<th>Método</th>
<th>URL (recurso)</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>POST</td>
<td>/v2/nfse?ref=REFERENCIA</td>
<td>Cria uma nota fiscal e a envia para processamento.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/nfse/REFERENCIA</td>
<td>Consulta a nota fiscal com a referência informada e o seu status de processamento</td>
</tr>
<tr>
<td>DELETE</td>
<td>/v2/nfse/REFERENCIA</td>
<td>Cancela uma nota fiscal com a referência informada</td>
</tr>
<tr>
<td>POST</td>
<td>/v2/nfse/REFERENCIA/email</td>
<td>Envia um email com uma cópia da nota fiscal com a referência informada</td>
</tr>
</tbody></table>
<h2 id='nfse_campos'>Campos</h2>
<p>Cada prefeitura pode utilizar um formato diferente de XML, mas utilizando nossa API você utiliza
um formato único de campos para todas as prefeituras. A listagem dos campos segue abaixo.</p>
<h3 id='nfse_geral'>Geral</h3>
<blockquote>
<p>Exemplo de um arquivo JSON:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">  
   </span><span class="s2">"data_emissao"</span><span class="p">:</span><span class="s2">"2017-09-21T22:15:00"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"prestador"</span><span class="p">:{</span><span class="w">  
      </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="s2">"18765499000199"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"inscricao_municipal"</span><span class="p">:</span><span class="s2">"12345"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"codigo_municipio"</span><span class="p">:</span><span class="s2">"3516200"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="s2">"tomador"</span><span class="p">:{</span><span class="w">  
      </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"razao_social"</span><span class="p">:</span><span class="s2">"Acras Tecnologia da Informação LTDA"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"contato@acras.com.br"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"endereco"</span><span class="p">:{</span><span class="w">  
         </span><span class="s2">"logradouro"</span><span class="p">:</span><span class="s2">"Rua Dias da Rocha Filho"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"numero"</span><span class="p">:</span><span class="s2">"999"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"complemento"</span><span class="p">:</span><span class="s2">"Prédio 04 - Sala 34C"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"bairro"</span><span class="p">:</span><span class="s2">"Alto da XV"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"codigo_municipio"</span><span class="p">:</span><span class="s2">"4106902"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"uf"</span><span class="p">:</span><span class="s2">"PR"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"cep"</span><span class="p">:</span><span class="s2">"80045165"</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="s2">"servico"</span><span class="p">:{</span><span class="w">  
      </span><span class="s2">"aliquota"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w">
      </span><span class="s2">"discriminacao"</span><span class="p">:</span><span class="s2">"Nota fiscal referente a serviços prestados"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"iss_retido"</span><span class="p">:</span><span class="s2">"false"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"item_lista_servico"</span><span class="p">:</span><span class="s2">"0107"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"codigo_tributario_municipio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"620910000"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"valor_servicos"</span><span class="p">:</span><span class="mf">1.0</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<ul>
<li><strong>data_emissao</strong>(*): (Data) Data/hora de emissão da NFSe. Alguns municípios como São Paulo não utilizam hora e ela será descartada caso seja fornecida. Formato padrão ISO, exemplo: “2016-12-25T12:00-0300”.</li>
<li><strong>natureza_operacao</strong>(*): (String) Natureza da operação. Informar um dos códigos abaixo. Campo ignorado para o município de São Paulo.

<ul>
<li><strong>1</strong>: Tributação no município;</li>
<li><strong>2</strong>: Tributação fora do município;</li>
<li><strong>3</strong>: Isenção;</li>
<li><strong>4</strong>: Imune;</li>
<li><strong>5</strong>: Exigibilidade suspensa por decisão judicial;</li>
<li><strong>6</strong>: Exigibilidade suspensa por procedimento administrativo (Valor padrão: 1).</li>
</ul></li>
<li><strong>regime_especial_tributacao</strong>: (String) Informar o código de identificação do regime especial de tributação conforme abaixo. Campo ignorado para o município de São Paulo.

<ul>
<li><strong>1</strong>: Microempresa municipal;</li>
<li><strong>2</strong>: Estimativa;</li>
<li><strong>3</strong>: Sociedade de profissionais;</li>
<li><strong>4</strong>: Cooperativa;</li>
<li><strong>5</strong>: MEI - Simples Nacional;</li>
<li><strong>6</strong>: ME EPP- Simples Nacional;</li>
</ul></li>
<li><strong>optante_simples_nacional</strong>(*): (Boolean) Informar verdadeiro ou falso se a empresa for optante pelo Simples Nacional. Campo ignorado pelo município de São Paulo.</li>
<li><strong>incentivador_cultural</strong>: (Boolean) Informe verdadeiro ou falso. Valor padrão: falso. Campo ignorado para o município de São Paulo.</li>
<li><strong>tributacao_rps</strong>: (String) Usado apenas pelo município de São Paulo. Informe o tipo de tributação:

<ul>
<li><strong>T</strong>: Tributado em São Paulo;</li>
<li><strong>F</strong>: Tributado Fora de São Paulo;</li>
<li><strong>A</strong>: Tributado em São Paulo, porém Isento;</li>
<li><strong>B</strong>: Tributado Fora de São Paulo, porém Isento;</li>
<li><strong>M</strong>: Tributado em São Paulo, porém Imune;</li>
<li><strong>N</strong>: Tributado Fora de São Paulo, porém Imune;</li>
<li><strong>X</strong>: Tributado em São Paulo, porém Exigibilidade Suspensa;</li>
<li><strong>V</strong>: Tributado Fora de São Paulo, porém Exigibilidade Suspensa;</li>
<li><strong>P</strong>: Exportação de Serviços.</li>
</ul></li>
<li><strong>codigo_obra</strong>: (String) Código da obra quando construção civil. Tamanho: 15 caracteres.</li>
<li><strong>art</strong>: (String) Código ART quando construção civil. Este campo é ignorado pelo município de São Paulo. Tamanho: 15 caracteres.</li>
<li><strong>numero_rps_substituido</strong>: (String) Caso o município permita a substituição de notas, aqui você poderá
informar o número do RPS que será substituído. Municípios que seguem o padrão ABRASF poderão usar esta operação.</li>
<li><strong>serie_rps_substituido</strong>: (String) Obrigatório se informado o campo numero_rps_substituido. Indica a série do RPS a ser substituído.</li>
<li><strong>tipo_rps_substituido</strong>: (String) Obrigatório se informado o campo numero_rps_substituido. Indica o tipo do RPS a ser substituído. Caso desconheça este valor, utiliza o valor &quot;1&quot;.</li>
</ul>
<h3 id='nfse_prestador'>Prestador</h3>
<ul>
<li><strong>prestador</strong>:

<ul>
<li><strong>cnpj</strong>(*): (String). CNPJ do prestador de serviços. Caracteres não numéricos são ignorados.</li>
<li><strong>codigo_municipio</strong>(*): (String). Código IBGE de 7 dígitos do município do prestador.</li>
<li><strong>inscricao_municipal</strong>(*): (String). Inscrição municipal do prestador de serviços. Caracteres não numéricos são ignorados.</li>
</ul></li>
</ul>
<h3 id='nfse_tomador'>Tomador</h3>
<ul>
<li><strong>tomador</strong>:

<ul>
<li><strong>cpf</strong>(*): (String) CPF do tomador, se aplicável. Caracteres não numéricos são ignorados.</li>
<li><strong>cnpj</strong>(*): (String) CNPJ do tomador, se aplicável. Caracteres não numéricos são ignorados.</li>
<li><strong>inscricao_municipal</strong>: (String) Inscrição municipal do tomador. Caracteres não numéricos são ignorados.</li>
<li><strong>razao_social</strong>: (String) Razão social ou nome do tomador. Tamanho: 115 caracteres.</li>
<li><strong>telefone</strong>: (String) Telefone do tomador. Campo ignorado para o município de São Paulo. Tamanho: 11 caracteres.</li>
<li><strong>email</strong>: (String) Email do tomador. Tamanho: 80 caracteres.</li>
<li><strong>endereco</strong>:

<ul>
<li><strong>logradouro</strong>: (String) Nome do logradouro. Tamanho: 125 caracteres.</li>
<li><strong>tipo_logradouro</strong>: (String) Tipo do logradouro. Usado apenas para o município de São Paulo. Valor padrão: os 3 primeiros caracteres do logradouro. Tamanho: 3 caracteres.</li>
<li><strong>numero</strong>: (String) Número do endereço. Tamanho: 10 caracteres.</li>
<li><strong>complemento</strong>: (String) Complemento do endereço. Tamanho: 60 caracteres.</li>
<li><strong>bairro</strong>: Bairro. (String) Tamanho: 60 caracteres.</li>
<li><strong>codigo_municipio</strong>: (String) Código IBGE do município.</li>
<li><strong>uf</strong>: (String) UF do endereço. Tamanho: 2 caracteres.</li>
<li><strong>cep</strong>: (String) CEP do endereço. Caracteres não numéricos são ignorados.</li>
</ul></li>
</ul></li>
</ul>
<h3 id='nfse_servico'>Serviço</h3>
<ul>
<li><strong>servico</strong>:

<ul>
<li><strong>valor_servicos</strong>(*): (Decimal) Valor dos serviços.</li>
<li><strong>valor_deducoes</strong>: (Decimal) Valor das deduções.</li>
<li><strong>valor_pis</strong>: (Decimal) Valor do PIS.</li>
<li><strong>valor_cofins</strong>: (Decimal) Valor do COFINS.</li>
<li><strong>valor_inss</strong>: (Decimal) Valor do INSS.</li>
<li><strong>valor_ir</strong>: (Decimal) Valor do IRRF.</li>
<li><strong>valor_csll</strong>: (Decimal) Valor do CSLL</li>
<li><strong>iss_retido</strong>(*): (Boolean) Informar verdadeiro ou falso se o ISS foi retido.</li>
<li><strong>valor_iss</strong>: (Decimal) Valor do ISS. Campo ignorado pelo município de São Paulo.</li>
<li><strong>valor_iss_retido</strong>: (Decimal) Valor do ISS Retido. Campo ignorado pelo município de São Paulo.</li>
<li><strong>outras_retencoes</strong>: (Decimal) Valor de outras retenções. Campo ignorado pelo município de São Paulo.</li>
<li><strong>base_calculo</strong>: (Decimal) Base de cálculo do ISS, valor padrão igual ao valor_servicos. Campo ignorado pelo município de São Paulo.</li>
<li><strong>aliquota</strong>: (Decimal) Aliquota do ISS. Algumas cidades permitem usar 4 dígitos decimais.</li>
<li><strong>desconto_incondicionado</strong>: (Decimal) Valor do desconto incondicionado. Campo ignorado pelo município de São Paulo.</li>
<li><strong>desconto_condicionado</strong>: (Decimal) Valor do desconto condicionado. Campo ignorado pelo município de São Paulo.</li>
<li><strong>item_lista_servico</strong>(*): (String) Informar o código da lista de serviços, de acordo com a Lei Complementar 116/2003. Utilize outra tabela para o município de São Paulo.</li>
<li><strong>codigo_cnae</strong>: (String) Informar o código CNAE de 8 dígitos. Campo ignorado pelo município de São Paulo.</li>
<li><strong>codigo_tributario_municipio</strong>: (String) Informar o código tributário de acordo com a tabela de cada município (não há um padrão). Campo ignorado pelo município de São Paulo.</li>
<li><strong>discriminacao</strong>(*): (String) Discriminação dos serviços. Tamanho: 2000 caracteres.</li>
<li><strong>codigo_municipio</strong>(*): (String) Informar o código IBGE de 7 dígitos do município de prestação do serviço.</li>
<li><strong>percentual_total_tributos</strong>: (Decimal) Percentual aproximado de todos os impostos, de acordo com a Lei da Transparência. No momento disponível apenas para São Paulo.</li>
<li><strong>fonte_total_tributos</strong>: (String) Fonte de onde foi retirada a informação de total de impostos, por exemplo, “IBPT”. No momento disponível apenas para São Paulo.</li>
</ul></li>
</ul>
<h3 id='nfse_intermediario'>Intermediário</h3>
<ul>
<li><strong>intermediario</strong> (esta seção é ignorada pelo município de São Paulo)

<ul>
<li><strong>razao_social</strong>: (String) Razão social do intermediário do serviço. Tamanho: 115 caracteres.</li>
<li><strong>cpf</strong>: (String) CPF do intermediário do serviço, se aplicável. Caracteres não numéricos são ignorados.</li>
<li><strong>cnpj</strong>: (String) CNPJ do intermediário do serviço, se aplicável. Caracteres não numéricos são ignorados.</li>
<li><strong>inscricao_municipal</strong>: (String) Inscrição municipal do intermediário do serviço, se aplicável. Caracteres não numéricos são ignorados.</li>
</ul></li>
</ul>

<p>Alguns municípios podem ter campos adicionais ou algumas regras específicas para preenchimento de campos. Uma boa prática é consultar a nossa <a href="https://focusnfe.com.br/cidades-atendidas/">lista de municípios atendidos</a> e ver se existe algum artigo escrito sobre especificidades do seu município.</p>
<h2 id='nfse_status-api'>Status API</h2>
<p>Aqui você encontra os status possíveis para NFSe.</p>

<table><thead>
<tr>
<th>HTTP CODE/STATUS</th>
<th>Status API Focus</th>
<th>Descrição</th>
<th>Correção</th>
</tr>
</thead><tbody>
<tr>
<td>404 - not found</td>
<td>nao_encontrado</td>
<td>Nota fiscal não encontrada</td>
<td>Verifique o método utilizado (deve-se usar POST) ou a nota fiscal não foi encontrada.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>nfe_cancelada</td>
<td>Nota fiscal já cancelada</td>
<td>Não é possível realizar a operação solicitada, pois a nota fiscal já foi cancelada.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>nfe_nao_autorizada</td>
<td>Nota fiscal não autorizada não pode ser cancelada</td>
<td>O cancelamento só é possível para NFSe&#39;s autorizadas.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td></td>
<td>Sua requisição é inválida porque alguns dos paramêtros básicos não foram cumpridos. Consulte a nossa documentação.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>empresa_nao_habilitada</td>
<td>Emitente ainda não habilitado para emissão de NFSe</td>
<td>Configure a emissão de NFSe através do Painel API e tente novamente.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>certificado_vencido</td>
<td>O certificado do emitente está vencido</td>
<td>É necessário renovar ou adquirir um novo certificado digital modelo A1.</td>
</tr>
<tr>
<td>422 - unprocessable entity</td>
<td>nfe_autorizada</td>
<td>Nota fiscal já autorizada</td>
<td>A operação solicitada não pode ser realizada, pois a NFSe já foi autorizada.</td>
</tr>
<tr>
<td>422 - unprocessable entity</td>
<td>em_processamento</td>
<td>Nota fiscal em processamento</td>
<td>Sua nota está sendo processada pela prefeitura, aguarde alguns minutos antes de consultá-la novamente.</td>
</tr>
</tbody></table>
<h2 id='nfse_envio'>Envio</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfse"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>
<span class="n">ref</span> <span class="o">=</span> <span class="p">{</span><span class="s">"ref"</span><span class="p">:</span><span class="s">"12345"</span><span class="p">}</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="s">'''
Usamos dicionarios para armazenar os campos e valores que em seguida,
serao convertidos em JSON e enviados para nossa API
'''</span>
<span class="n">nfse</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"prestador"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"endereco"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">nfse</span><span class="p">[</span><span class="s">"razao_social"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"ACME INK"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"data_emissao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"2018-02-26T12:00:00-03:00"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"incentivador_cultural"</span><span class="p">]</span> <span class="o">=</span>  <span class="s">"false"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"natureza_operacao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"optante_simples_nacional"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"true"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"status"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"prestador"</span><span class="p">][</span><span class="s">"cnpj"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"99999999999999"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"prestador"</span><span class="p">][</span><span class="s">"inscricao_municipal"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"99999999"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"prestador"</span><span class="p">][</span><span class="s">"codigo_municipio"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"9999999"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"aliquota"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"2.92"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"base_calculo"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"discriminacao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"SERVICOS E MAO DE OBRA"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"iss_retido"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"item_lista_servico"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1412"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"valor_iss"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"11.68"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"valor_liquido"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"valor_servicos"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"cnpj"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"99999999999999"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"razao_social"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Parkinson da silva coelho JR"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"endereco"</span><span class="p">][</span><span class="s">"bairro"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"São Miriti"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"endereco"</span><span class="p">][</span><span class="s">"cep"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"31999-000"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"endereco"</span><span class="p">][</span><span class="s">"codigo_municipio"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"9999999"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"endereco"</span><span class="p">][</span><span class="s">"logradouro"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"João Batista Netos"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"endereco"</span><span class="p">][</span><span class="s">"numero"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"34"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"endereco"</span><span class="p">][</span><span class="s">"uf"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"MG"</span>

<span class="c">#print (json.dumps(nfse))</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">nfse</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


</code></pre><pre class="highlight shell tab-shell"><code><span class="c"># arquivo.json deve conter os dados da NFSe</span>
curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -T arquivo.json https://homologacao.focusnfe.com.br/v2/nfse
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFSeAutorizar</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JSONException</span><span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfse?ref="</span><span class="o">+</span><span class="n">ref</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="cm">/* Aqui são criados as hash's que receberão os dados da nota. */</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">nfse</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">prestador</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">tomador</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">tomadorEndereco</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">servico</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>

        <span class="n">nfse</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"data_emissao"</span><span class="o">,</span> <span class="s">"2018-01-15T17:40:00"</span><span class="o">);</span>
        <span class="n">nfse</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"natureza_operacao"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
        <span class="n">prestador</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cnpj"</span><span class="o">,</span> <span class="s">"51916585000125"</span><span class="o">);</span>
        <span class="n">prestador</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"inscricao_municipal"</span><span class="o">,</span> <span class="s">"123456"</span><span class="o">);</span>
        <span class="n">prestador</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_municipio"</span><span class="o">,</span> <span class="s">"4128104"</span><span class="o">);</span>
        <span class="n">tomador</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cpf"</span><span class="o">,</span> <span class="s">"51966818092"</span><span class="o">);</span>
        <span class="n">tomador</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"razao_social"</span><span class="o">,</span> <span class="s">"ACME LTDA"</span><span class="o">);</span>
        <span class="n">tomador</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"email"</span><span class="o">,</span> <span class="s">"email-do-tomador@google.com.br"</span><span class="o">);</span>
        <span class="n">tomadorEndereco</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"bairro"</span><span class="o">,</span> <span class="s">"Jardim America"</span><span class="o">);</span>
        <span class="n">tomadorEndereco</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cep"</span><span class="o">,</span> <span class="s">"82620150"</span><span class="o">);</span>
        <span class="n">tomadorEndereco</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_municipio"</span><span class="o">,</span> <span class="s">"4106902"</span><span class="o">);</span>
        <span class="n">tomadorEndereco</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"logradouro"</span><span class="o">,</span> <span class="s">"Rua Paulo Centrone"</span><span class="o">);</span>
        <span class="n">tomadorEndereco</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero"</span><span class="o">,</span> <span class="s">"168"</span><span class="o">);</span>
        <span class="n">tomadorEndereco</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"uf"</span><span class="o">,</span> <span class="s">"PR"</span><span class="o">);</span>
        <span class="n">servico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"discriminacao"</span><span class="o">,</span> <span class="s">"Teste de servico"</span><span class="o">);</span>
        <span class="n">servico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"aliquota"</span><span class="o">,</span> <span class="s">"3.00"</span><span class="o">);</span>
        <span class="n">servico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"base_calculo"</span><span class="o">,</span> <span class="s">"1.0"</span><span class="o">);</span>
        <span class="n">servico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_iss"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
        <span class="n">servico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"iss_retido"</span><span class="o">,</span> <span class="s">"false"</span><span class="o">);</span>
        <span class="n">servico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_tributario_municipio"</span><span class="o">,</span> <span class="s">"080101"</span><span class="o">);</span>
        <span class="n">servico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"item_lista_servico"</span><span class="o">,</span> <span class="s">"0801"</span><span class="o">);</span>
        <span class="n">servico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_servicos"</span><span class="o">,</span> <span class="s">"1.0"</span><span class="o">);</span>
        <span class="n">servico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_liquido"</span><span class="o">,</span> <span class="s">"1.0"</span><span class="o">);</span>

        <span class="cm">/* Depois de fazer o input dos dados, são criados os objetos JSON já com os valores das hash's. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">nfse</span><span class="o">);</span>
        <span class="n">JSONObject</span> <span class="n">jsonPrestador</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">prestador</span><span class="o">);</span>
        <span class="n">JSONObject</span> <span class="n">jsonTomador</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">tomador</span><span class="o">);</span>
        <span class="n">JSONObject</span> <span class="n">jsonTomadorEndereco</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">tomadorEndereco</span><span class="o">);</span>
        <span class="n">JSONObject</span> <span class="n">jsonServico</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">servico</span><span class="o">);</span>

        <span class="cm">/* Aqui adicionamos os objetos JSON nos campos da API como array no JSON principal. */</span>
        <span class="n">json</span><span class="o">.</span><span class="na">accumulate</span><span class="o">(</span><span class="s">"prestador"</span><span class="o">,</span> <span class="n">jsonPrestador</span><span class="o">);</span>
        <span class="n">json</span><span class="o">.</span><span class="na">accumulate</span><span class="o">(</span><span class="s">"tomador"</span><span class="o">,</span> <span class="n">jsonTomador</span><span class="o">);</span>
        <span class="n">jsonTomador</span><span class="o">.</span><span class="na">accumulate</span><span class="o">(</span><span class="s">"endereco"</span><span class="o">,</span> <span class="n">jsonTomadorEndereco</span><span class="o">);</span>
        <span class="n">json</span><span class="o">.</span><span class="na">accumulate</span><span class="o">(</span><span class="s">"servico"</span><span class="o">,</span> <span class="n">jsonServico</span><span class="o">);</span>

        <span class="cm">/* É recomendado verificar como os dados foram gerados em JSON e se ele está seguindo a estrutura especificada em nossa documentação.
        System.out.print(json); */</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas a seguir exibem as informações retornadas pela nossa API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfse?ref="</span> <span class="o">+</span> <span class="n">ref</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">dados_da_nota</span> <span class="o">=</span> <span class="p">{</span>  
  <span class="ss">data_emissao: </span><span class="s2">"2017-09-21T22:15:00"</span><span class="p">,</span>
  <span class="ss">prestador: </span><span class="p">{</span>  
      <span class="ss">cnpj: </span><span class="s2">"18765499000199"</span><span class="p">,</span>
      <span class="ss">inscricao_municipal: </span><span class="s2">"12345"</span><span class="p">,</span>
      <span class="ss">codigo_municipio: </span><span class="s2">"3516200"</span>
  <span class="p">},</span>
  <span class="ss">tomador: </span><span class="p">{</span>  
      <span class="ss">cnpj: </span><span class="s2">"07504505000132"</span><span class="p">,</span>
      <span class="ss">razao_social: </span><span class="s2">"Acras Tecnologia da Informação LTDA"</span><span class="p">,</span>
      <span class="ss">email: </span><span class="s2">"contatoacras.com.br"</span><span class="p">,</span>
      <span class="ss">endereco: </span><span class="p">{</span>  
        <span class="ss">logradouro: </span><span class="s2">"Rua Dias da Rocha Filho"</span><span class="p">,</span>
        <span class="ss">numero: </span><span class="s2">"999"</span><span class="p">,</span>
        <span class="ss">complemento: </span><span class="s2">"Prédio 04 - Sala 34C"</span><span class="p">,</span>
        <span class="ss">bairro: </span><span class="s2">"Alto da XV"</span><span class="p">,</span>
        <span class="ss">codigo_municipio: </span><span class="s2">"4106902"</span><span class="p">,</span>
        <span class="ss">uf: </span><span class="s2">"PR"</span><span class="p">,</span>
        <span class="ss">cep: </span><span class="s2">"80045165"</span>
      <span class="p">}</span>
  <span class="p">},</span>
  <span class="ss">servico: </span><span class="p">{</span>  
      <span class="ss">aliquota: </span><span class="mi">3</span><span class="p">,</span>
      <span class="ss">discriminacao: </span><span class="s2">"Nota fiscal referente a serviços prestados"</span><span class="p">,</span>
      <span class="ss">iss_retido: </span><span class="s2">"false"</span><span class="p">,</span>
      <span class="ss">item_lista_servico: </span><span class="s2">"0107"</span><span class="p">,</span>
      <span class="ss">codigo_tributario_municipio: </span><span class="s2">"620910000"</span><span class="p">,</span>
      <span class="ss">valor_servicos: </span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos os dados da nota para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">dados_da_nota</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
 <span class="c1">// Você deve definir isso globalmente para sua aplicação
</span> <span class="c1">// Para ambiente de produção use a variável abaixo:
</span> <span class="c1">// $server = "https://api.focusnfe.com.br";
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
 <span class="c1">// Substituir pela sua identificação interna da nota
</span> <span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
 <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
 <span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
 <span class="nv">$nfse</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
    <span class="s2">"data_emissao"</span> <span class="o">=&gt;</span> <span class="s2">"2017-12-27T17:43:14-3:00"</span><span class="p">,</span>
    <span class="s2">"incentivador_cultural"</span> <span class="o">=&gt;</span> <span class="s2">"false"</span><span class="p">,</span>
    <span class="s2">"natureza_operacao"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
    <span class="s2">"optante_simples_nacional"</span> <span class="o">=&gt;</span> <span class="s2">"false"</span><span class="p">,</span>
    <span class="s2">"prestador"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s2">"cnpj"</span> <span class="o">=&gt;</span> <span class="s2">"51916585000125"</span><span class="p">,</span>
        <span class="s2">"inscricao_municipal"</span> <span class="o">=&gt;</span> <span class="s2">"12345"</span><span class="p">,</span>
        <span class="s2">"codigo_municipio"</span> <span class="o">=&gt;</span> <span class="s2">"4119905"</span>
        <span class="p">),</span>
    <span class="s2">"tomador"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
      <span class="s2">"cnpj"</span> <span class="o">=&gt;</span> <span class="s2">"07504505000132"</span><span class="p">,</span>
        <span class="s2">"razao_social"</span> <span class="o">=&gt;</span> <span class="s2">"Acras Tecnologia da Informação LTDA"</span><span class="p">,</span>
        <span class="s2">"email"</span> <span class="o">=&gt;</span> <span class="s2">"contato@acras.com.br"</span><span class="p">,</span>
        <span class="s2">"endereco"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
          <span class="s2">"bairro"</span> <span class="o">=&gt;</span> <span class="s2">"Jardim America"</span><span class="p">,</span>
          <span class="s2">"cep"</span> <span class="o">=&gt;</span> <span class="s2">"81530900"</span><span class="p">,</span>
          <span class="s2">"codigo_municipio"</span> <span class="o">=&gt;</span> <span class="s2">"4119905"</span><span class="p">,</span>
          <span class="s2">"logradouro"</span> <span class="o">=&gt;</span> <span class="s2">"Rua ABC"</span><span class="p">,</span>
          <span class="s2">"numero"</span> <span class="o">=&gt;</span> <span class="s2">"16"</span><span class="p">,</span>
          <span class="s2">"uf"</span> <span class="o">=&gt;</span> <span class="s2">"PR"</span>
         <span class="p">)</span>
    <span class="p">),</span>
    <span class="s2">"servico"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
           <span class="s2">"discriminacao"</span> <span class="o">=&gt;</span> <span class="s2">"Exemplo Servi\u00e7o"</span><span class="p">,</span>
           <span class="s2">"iss_retido"</span> <span class="o">=&gt;</span> <span class="s2">"false"</span><span class="p">,</span>
           <span class="s2">"item_lista_servico"</span> <span class="o">=&gt;</span> <span class="s2">"106"</span><span class="p">,</span>
           <span class="s2">"codigo_cnae"</span> <span class="o">=&gt;</span> <span class="s2">"6319400"</span><span class="p">,</span>
           <span class="s2">"valor_servicos"</span> <span class="o">=&gt;</span> <span class="s2">"1.00"</span>
    <span class="p">),</span>
  <span class="p">);</span>
 <span class="c1">// Inicia o processo de envio das informações usando o cURL
</span> <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/nfse?ref="</span> <span class="o">.</span> <span class="nv">$ref</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$nfse</span><span class="p">));</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
 <span class="c1">//as três linhas abaixo imprimem as informações retornadas pela API, aqui o seu sistema deverá
</span> <span class="c1">//interpretar e lidar com o retorno
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
 <span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
 <span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
 <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfse?ref="</span> <span class="o">+</span> <span class="nx">ref</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">nfse</span> <span class="o">=</span> <span class="p">{</span>  
   <span class="s2">"data_emissao"</span><span class="p">:</span><span class="s2">"2018-03-21"</span><span class="p">,</span>
   <span class="s2">"prestador"</span><span class="p">:{</span>  
      <span class="s2">"cnpj"</span><span class="p">:</span><span class="s2">"51916585000125"</span><span class="p">,</span>
      <span class="s2">"inscricao_municipal"</span><span class="p">:</span><span class="s2">"12345"</span><span class="p">,</span>
      <span class="s2">"codigo_municipio"</span><span class="p">:</span><span class="s2">"3518800"</span>
   <span class="p">},</span>
   <span class="s2">"tomador"</span><span class="p">:{</span>  
      <span class="s2">"cnpj"</span><span class="p">:</span><span class="s2">"07504505000132"</span><span class="p">,</span>
      <span class="s2">"razao_social"</span><span class="p">:</span><span class="s2">"Acras Tecnologia da Informacao LTDA"</span><span class="p">,</span>
      <span class="s2">"email"</span><span class="p">:</span><span class="s2">"contato@acras.com.br"</span><span class="p">,</span>
      <span class="s2">"endereco"</span><span class="p">:{</span>  
         <span class="s2">"logradouro"</span><span class="p">:</span><span class="s2">"Rua Filho da Rocha Bage"</span><span class="p">,</span>
         <span class="s2">"numero"</span><span class="p">:</span><span class="s2">"750"</span><span class="p">,</span>
         <span class="s2">"complemento"</span><span class="p">:</span><span class="s2">"Sala 07"</span><span class="p">,</span>
         <span class="s2">"bairro"</span><span class="p">:</span><span class="s2">"Alto da Rua XV"</span><span class="p">,</span>
         <span class="s2">"codigo_municipio"</span><span class="p">:</span><span class="s2">"4106902"</span><span class="p">,</span>
         <span class="s2">"uf"</span><span class="p">:</span><span class="s2">"PR"</span><span class="p">,</span>
         <span class="s2">"cep"</span><span class="p">:</span><span class="s2">"80045165"</span>
      <span class="p">}</span>
   <span class="p">},</span>
   <span class="s2">"servico"</span><span class="p">:{</span>  
      <span class="s2">"aliquota"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
      <span class="s2">"discriminacao"</span><span class="p">:</span><span class="s2">"Nota fiscal referente a servicos prestados"</span><span class="p">,</span>
      <span class="s2">"iss_retido"</span><span class="p">:</span><span class="s2">"false"</span><span class="p">,</span>
      <span class="s2">"item_lista_servico"</span><span class="p">:</span><span class="s2">"1401"</span><span class="p">,</span>
      <span class="s2">"codigo_tributario_municipio"</span><span class="p">:</span> <span class="s2">"452000100"</span><span class="p">,</span>
      <span class="s2">"valor_servicos"</span><span class="p">:</span><span class="mf">1.0</span>
   <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">nfse</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<blockquote>
<p>Exemplos de respostas da API por <strong>status</strong> para a requisição de envio:</p>

<p><strong>processando_autorizacao</strong> (requisição enviada com sucesso para API)</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_prestador"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CNPJ_PRESTADOR"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"REFERENCIA"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"processando_autorizacao"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p><strong>requisicao_invalida</strong> (requisição com campos faltantes/erro de estrutura no JSON)</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"requisicao_invalida"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Parâmetro </span><span class="se">\"</span><span class="s2">prestador.codigo_municipio</span><span class="se">\"</span><span class="s2"> não informado"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Para enviar uma NFSe utilize a URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Envia uma NFSe para autorização:</p>

<p><code>https://api.focusnfe.com.br/v2/nfse?ref=REFERENCIA</code></p>

<p>Utilize o comando <strong>HTTP POST</strong> para enviar a sua nota para nossa API.</p>

<p>Nesta etapa, é feita uma primeira validação dos dados da nota. Caso ocorra algum problema, por exemplo, algum campo faltante, formato incorreto
ou algum problema com o prestador a nota <strong>não será aceita para processamento</strong> e será devolvida a mensagem de erro apropriada. Veja a seção <a href="#introducao_erros">erros</a>.</p>

<p>Caso a nota seja validada corretamente, a nota será <strong>aceita para processamento</strong>. Isto significa que a nota irá para uma fila de processamento
onde eventualmente será processada (processamento assíncrono). Com isto, a nota poderá ser autorizada ou ocorrer um erro na autorização de acordo com a validação da prefeitura.</p>

<p>Para verificar se a nota já foi autorizada, você terá que efetuar uma <a href="#nfse_consulta">consulta</a> ou se utilizar de <a href="#gatilhos_gatilhos">gatilhos</a>.</p>
<h2 id='nfse_consulta'>Consulta</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfse/"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">ref</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">completa</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfse/12345
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFSeConsulta</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfse/"</span><span class="o">+</span><span class="n">ref</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="o">(</span><span class="n">ClientResponse</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfse/"</span> <span class="o">+</span> <span class="n">ref</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
 <span class="c1">// Você deve definir isso globalmente para sua aplicação
</span> <span class="c1">//Substituir pela sua identificação interna da nota
</span> <span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
 <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
 <span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
 <span class="c1">// Para ambiente de produção use a variável abaixo:
</span> <span class="c1">// $server = "https://api.focusnfe.com.br";
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span> <span class="c1">// Servidor de homologação
</span> <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/nfse/"</span> <span class="o">.</span> <span class="nv">$ref</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
 <span class="c1">//as três linhas abaixo imprimem as informações retornadas pela API, aqui o seu sistema deverá
</span> <span class="c1">//interpretar e lidar com o retorno
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
 <span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
 <span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
 <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfse/"</span> <span class="o">+</span> <span class="nx">ref</span> <span class="o">+</span> <span class="s2">"?completa=0"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<blockquote>
<p>Exemplos de respostas da API por <strong>status</strong> para a requisição de consulta:</p>

<p><strong>autorizado</strong></p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_prestador"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nfs-2"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_rps"</span><span class="p">:</span><span class="w"> </span><span class="s2">"224"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie_rps"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"233"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_verificacao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DU1M-M2Y"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data_emissao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-05-27T00:00:00-03:00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://200.189.192.82/PilotoNota_Portal/Default.aspx?doc=07504505000132&amp;num=233&amp;cod=DUMMY"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_nota_fiscal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/notas_fiscais_servico/NFSe075045050001324106902-004949940-433-DUMMY.xml"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p><strong>cancelado</strong></p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_prestador"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nfs-2"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_rps"</span><span class="p">:</span><span class="w"> </span><span class="s2">"224"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie_rps"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cancelado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"233"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_verificacao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DU1M-M2Y"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data_emissao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-05-27T00:00:00-03:00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://200.189.192.82/PilotoNota_Portal/Default.aspx?doc=07504505000132&amp;num=233&amp;cod=DUMMY"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_nota_fiscal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/notas_fiscais_servico/NFSe075045050001324106902-004949940-433-DUMMY.xml"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p><strong>erro_autorizacao</strong></p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_prestador"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nfs-2"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_rps"</span><span class="p">:</span><span class="w"> </span><span class="s2">"224"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie_rps"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"erro_autorizacao"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"erros"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"E145"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"mensagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Regime Especial de Tributação ausente/inválido."</span><span class="p">,</span><span class="w">
      </span><span class="s2">"correcao"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p><strong>processando_autorizacao</strong></p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_prestador"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nfs-2"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_rps"</span><span class="p">:</span><span class="w"> </span><span class="s2">"224"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie_rps"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"processando_autorizacao"</span><span class="p">,</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Após emitir uma nota, você poderá usar a operação de consulta para verificar se a nota já foi aceita para processamento, se está
ainda em processamento ou se a nota já foi processada.</p>

<p>Para consultar uma NFSe utilize a URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Recupera informações sobre a NFSe:</p>

<p><code>https://api.focusnfe.com.br/v2/nfse/REFERENCIA</code></p>

<p>Utilize o comando <strong>HTTP GET</strong> para consultar a sua nota para nossa API.</p>

<ul>
<li><strong>status:</strong> Indica a etapa do processamento interno da nota fiscal (API Focus NFe e/ou Prefeitura), podendo ser:

<ul>
<li><strong>autorizado:</strong> A NFSe foi autorizada com sucesso, neste caso, é fornecido os caminhos para acessar a DANFSe e XML.</li>
<li><strong>cancelado:</strong> Indica que a operação de cancelamento do documento foi realizada com sucesso.</li>
<li><strong>erro_autorizacao:</strong> Houve algum erro durante a emissão da NFSe. A mensagem de erro você encontrará dentro do campo &quot;erros&quot;. É possível reenviar a nota com a mesma referência após realizar as correções indicadas.</li>
<li><strong>processando_autorizacao:</strong> A NFSe está sendo processada internamente (API Focus NFe) e/ou pela prefeitura, consulte após alguns minutos.</li>
<li><strong>substituido:</strong> Este documento foi substituído por outra NFSe. Consulte o campo numero_nfse_substituta.</li>
</ul></li>
<li><strong>cnpj_prestador:</strong> O CNPJ emitente da nota fiscal (conhecido também como &quot;prestador do serviço&quot;).</li>
<li><strong>ref:</strong> Essa é a referência usada na sua requisição.</li>
<li><strong>numero_rps:</strong> Número do RPS de controle da Prefeitura.</li>
<li><strong>serie_rps:</strong> A série do RPS de controle da Prefeitura.</li>
<li><strong>tipo_rps:</strong> O tipo do RPS de controle da Prefeitura.</li>
<li><strong>erros:</strong> Quando ocorrerem erros na emissão, será aqui que mostraremos a orientação da Prefeitura.</li>
<li><strong>url:</strong> URL para acesso do espelho da nota (versão HTML). Quando a prefeitura disponibiliza uma URL pública, utilizamos o link da própria prefeitura, caso contrário criamos o nosso próprio espelho através de um link interno.</li>
<li><strong>url_danfse:</strong> URL para acesso e download do DANFSe (versão PDF). A versão em PDF está disponível no momento apenas para alguns municípios. Entre em contato conosco caso precise da versão em PDF para o seu município.</li>
<li><strong>data_emissao:</strong> Data da emissão da nota fiscal.</li>
<li><strong>caminho_xml_nota_fiscal:</strong> Caminho para acesso e download do XML da nota fiscal.</li>
<li><strong>codigo_verificacao:</strong> Código de verificação para consulta da NFSe, pode ser usado no portal da cidade para consulta.</li>
<li><strong>numero_nfse_substituida</strong> Caso a nota seja autorizada e seja uma nota de substituição, este campo irá indicar o número da NFSe substituída.</li>
<li><strong>numero_nfse_substituta</strong> Caso a nota seja autorizada e alguma outra nota substituta tenha sido emitido pela nossa API este campo irá indicar o seu número. No momento só é possível fazer esta associação se a nota substituta for emitida pela nossa API.</li>
</ul>
<h3 id='nfse_download-do-xml-e-consulta-do-documento-auxiliar-da-nfse'>Download do XML e consulta do documento auxiliar da NFSe</h3>
<p>Após a autorização da nota fiscal de serviço eletrônica será disponibilizado os campos:</p>

<ul>
<li> <strong>caminho_xml_nota_fiscal</strong> - Representa o caminho para montar a URL para download do XML. Por exemplo, se você utilizou o servidor api.focusnfe.com.br e o caminho_xml_nota_fiscal contém o caminho &quot;/notas_fiscais_servico/NFSe075045050001324106902-004940940-428-DUMMY.xml&quot; você poderá acessar o XML pela URL completa https://api.focusnfe.com.br/notas_fiscais_servico/NFSe075045050001324106902-004940940-428-DUMMY.xml</li>
<li><strong>url</strong>. A URL para consultar a NFSe direto no portal da prefeitura em formato <strong>HTML</strong>.</li>
</ul>

<p>Utilize o método <strong>HTTP GET</strong> para ambas as consultas.</p>

<p>Não há obrigatoriedade legal de salvar o XML da nota, salvo quando o município utiliza NFe (modelo 55) ou
NFCe (modelo 65) para emissão de notas de prestação de serviços. Nestes casos nossa API faz a guarda automática
dos arquivos.</p>
<h2 id='nfse_cancelamento'>Cancelamento</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfse/"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="s">'''
Usamos um dicionario para armazenar os campos e valores que em seguida,
serao convertidos a JSON e enviados para nossa API
'''</span>
<span class="n">justificativa</span><span class="o">=</span><span class="p">{}</span>
<span class="n">justificativa</span><span class="p">[</span><span class="s">"justificativa"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Sua justificativa aqui!"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">justificativa</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X DELETE -d <span class="s1">'{"justificativa":"Teste de cancelamento de nota"}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfse/12345
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFSeCancelamento</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfse/"</span><span class="o">+</span><span class="n">ref</span><span class="o">);</span>

        <span class="cm">/* Aqui criamos um hashmap para receber a chave "justificativa" e o valor desejado. */</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">justificativa</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">justificativa</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"justificativa"</span><span class="o">,</span> <span class="s">"Informe aqui a sua justificativa para realizar o cancelamento da NFSe."</span><span class="o">);</span>

        <span class="cm">/* Criamos um objeto JSON para receber a hash com os dados esperado pela API. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">justificativa</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfse/"</span> <span class="o">+</span> <span class="n">ref</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">justificativa_cancelamento</span> <span class="o">=</span> <span class="p">{</span>  
  <span class="ss">justificativa: </span><span class="s2">"Informe aqui a sua justificativa para realizar o cancelamento da NFSe."</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Delete a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Delete</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos a hash de justificativa do cancelamento para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">justificativa_cancelamento</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
 <span class="c1">// Você deve definir isso globalmente para sua aplicação
</span> <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="c1">// Substituir pela sua identificação interna da nota
</span> <span class="nv">$ref</span>   <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
 <span class="c1">// Para ambiente de produção use a variável abaixo:
</span> <span class="c1">// $server = "https://api.focusnfe.com.br";
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
 <span class="nv">$justificativa</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span><span class="s2">"justificativa"</span> <span class="o">=&gt;</span> <span class="s2">"Teste de cancelamento de nota"</span><span class="p">);</span>
 <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
 <span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span> <span class="o">.</span> <span class="s2">"/v2/nfse/"</span> <span class="o">.</span> <span class="nv">$ref</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_CUSTOMREQUEST</span><span class="p">,</span> <span class="s2">"DELETE"</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$justificativa</span><span class="p">));</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$result</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
 <span class="c1">//as três linhas abaixo imprimem as informações retornadas pela API, aqui o seu sistema deverá
</span> <span class="c1">//interpretar e lidar com o retorno
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$result</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
 <span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
 <span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
 <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota.</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfse/"</span><span class="o">+</span> <span class="nx">ref</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'DELETE'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">cancelar</span> <span class="o">=</span> <span class="p">{</span>

    <span class="s2">"justificativa"</span><span class="p">:</span> <span class="s2">"Sua justificativa aqui!"</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">cancelar</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<blockquote>
<p>Exemplos de respostas da API por <strong>status</strong> para a requisição de cancelamento:</p>

<p><strong>cancelado</strong> (requisição realizada com sucesso)</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cancelado"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p><strong>erro_cancelamento</strong> (requisição com erro)</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"erro_cancelamento"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"erros"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"E523"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"mensagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nota que você está tentando cancelar está fora do prazo permitido para cancelamento"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"correcao"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p><strong>nfe_cancelada</strong> (quando a nota já consta como cancelada)</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nfe_cancelada"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nota Fiscal já cancelada"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Para cancelar uma NFSe, basta fazer uma requisição à URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p><strong>Cancelar uma NFSe já autorizada:</strong></p>

<p><code>https://api.focusnfe.com.br/v2/nfse/REFERENCIA</code></p>

<p>Utilize o comando <strong>HTTP DELETE</strong> para cancelar a sua nota para nossa API.
Este método é síncrono, ou seja, a comunicação com a prefeitura será feita imediatamente e devolvida a resposta na mesma requisição.</p>

<p>O parâmetro de cancelamento deverá ser enviado da seguinte forma:</p>

<ul>
<li><strong>justificativa</strong>: Justificativa do cancelamento. Deverá conter de 15 a 255 caracteres.</li>
</ul>

<p>A API irá em seguida devolver os seguintes campos:</p>

<ul>
<li><strong>status</strong>: cancelado, se a nota pode ser cancelada, ou erro_cancelamento, se houve algum erro ao cancelar a nota.</li>
<li><strong>erros</strong>: um array de mensagens de erro que impedem que a nota seja cancelada .</li>
</ul>

<p><strong>Prazo de cancelamento</strong>
A NFSe não possui um prazo padrão para cancelamento como vemos na NFCe, por exemplo. Outro detalhe importante é que como alguns municípios não possuem ambiente de homologação, é preciso emitir as notas de teste em produção. Sendo assim, recomendamos que sempre consulte o seu município antes de emitir uma NFSe.</p>
<h2 id='nfse_reenvio-de-email'>Reenvio de email</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfse/"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="s">'''
Usamos um dicionario para armazenar os campos e valores que em seguida,
serao convertidos a JSON e enviados para nossa API
'''</span>
<span class="n">emails</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">email</span> <span class="o">=</span> <span class="s">"suporte@acras.com.br"</span>
<span class="n">emails</span><span class="p">[</span><span class="s">"emails"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">email</span><span class="p">]</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">ref</span><span class="o">+</span><span class="s">"/email"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">emails</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -d <span class="s1">'{"emails":["alguem@example.org"]}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfse/12345/email
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFSeEnviaEmail</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JSONException</span><span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfse/"</span><span class="o">+</span><span class="n">ref</span><span class="o">+</span><span class="s">"/email"</span><span class="o">);</span>

        <span class="cm">/* Criamos o um objeto JSON que receberá um JSON Array com a lista de e-mails. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">();</span>
        <span class="n">JSONArray</span> <span class="n">listaEmails</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">();</span>
        <span class="n">listaEmails</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"email_01@acras.com.br"</span><span class="o">);</span>
        <span class="n">listaEmails</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"email_02@acras.com.br"</span><span class="o">);</span>
        <span class="n">listaEmails</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"email_03@acras.com.br"</span><span class="o">);</span>
        <span class="n">json</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"emails"</span><span class="o">,</span> <span class="n">listaEmails</span><span class="o">);</span>

        <span class="cm">/* Testar se o JSON gerado está dentro do formato esperado.
        System.out.print(json); */</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfse/"</span> <span class="o">+</span> <span class="n">ref</span> <span class="o">+</span> <span class="s2">"/email"</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">emails_destinatarios</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">emails: </span><span class="p">[</span><span class="s2">"email_01@acras.com.br"</span><span class="p">,</span> <span class="s2">"email_02@acras.com.br"</span><span class="p">,</span> <span class="s2">"email_03@acras.com.br"</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos os dados da nota para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">emails_destinatarios</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
 <span class="c1">// Você deve definir isso globalmente para sua aplicação
</span> <span class="c1">// Para ambiente de produção use a variável abaixo:
</span> <span class="c1">// $server = "https://api.focusnfe.com.br";
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
 <span class="c1">// Substituir pela sua identificação interna da nota
</span> <span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
 <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
 <span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
 <span class="nv">$email</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
   <span class="s2">"emails"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
     <span class="s2">"email@email.com"</span>
     <span class="p">)</span>
   <span class="p">);</span>
 <span class="c1">// Inicia o processo de envio das informações usando o cURL
</span> <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/nfse/"</span> <span class="o">.</span> <span class="nv">$ref</span> <span class="o">.</span> <span class="s2">"/email"</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$email</span><span class="p">));</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
 <span class="c1">//as três linhas abaixo imprimem as informações retornadas pela API, aqui o seu sistema deverá
</span> <span class="c1">//interpretar e lidar com o retorno
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
 <span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
 <span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
 <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota.</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfse/"</span> <span class="o">+</span> <span class="nx">ref</span> <span class="o">+</span> <span class="s2">"/email"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">email</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"email1@acras.com.br"</span><span class="p">,</span> <span class="s2">"email2@acras.com.br"</span><span class="p">,</span> <span class="s2">"email3@acras.com.br"</span><span class="p">];</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="s2">"emails"</span><span class="p">:</span> <span class="nx">email</span><span class="p">});</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<p>Para cada nota autorizada, cancelada ou que tenha sido emitida uma carta de correção o destinatário da nota é notificado via email. Porém eventualmente pode ser necessário enviar a nota fiscal para outras pessoas ou mesmo reenviar o email para o mesmo destinatário.</p>

<p>Para enviar um ou mais emails:</p>

<p><code>https://api.focusnfe.com.br/v2/nfse/REFERENCIA/email</code></p>

<p>Utilize o comando <strong>HTTP POST</strong> para enviar os emails. Esta operação aceita apenas um parâmetro:</p>

<ul>
<li><strong>emails</strong>: Array com uma lista de emails que deverão receber uma cópia da nota. Limitado a 10 emails por vez.</li>
</ul>

<p>A API imediatamente devolve a requisição com a confirmação dos emails. Os emails serão enviados em segundo plano, por isso pode levar alguns minutos até que eles cheguem à caixa postal.</p>
<h1 id='emissao-nfse-por-arquivo_emissao-nfse-por-arquivo'>Emissão NFSe por arquivo</h1>
<blockquote>
<p>Exemplo de um arquivo JSON:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">  
  </span><span class="s2">"prestador"</span><span class="p">:{</span><span class="w">  
    </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="s2">"18765499000199"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inscricao_municipal"</span><span class="p">:</span><span class="s2">"12345"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_municipio"</span><span class="p">:</span><span class="s2">"3516200"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"lista_nfse"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"data_emissao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-03-19T12:07:26-03:00"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"natureza_operacao"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"servico"</span><span class="p">:{</span><span class="w">  
        </span><span class="s2">"aliquota"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w">
        </span><span class="s2">"discriminacao"</span><span class="p">:</span><span class="s2">"Nota fiscal referente a serviços prestados"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"iss_retido"</span><span class="p">:</span><span class="s2">"false"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"item_lista_servico"</span><span class="p">:</span><span class="s2">"0107"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"codigo_tributario_municipio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"620910000"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"valor_servicos"</span><span class="p">:</span><span class="mf">1.0</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"tomador"</span><span class="p">:{</span><span class="w">  
        </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"razao_social"</span><span class="p">:</span><span class="s2">"Acras Tecnologia da Informação LTDA"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"contato@acras.com.br"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"endereco"</span><span class="p">:{</span><span class="w">  
          </span><span class="s2">"logradouro"</span><span class="p">:</span><span class="s2">"Rua Dias da Rocha Filho"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"numero"</span><span class="p">:</span><span class="s2">"999"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"complemento"</span><span class="p">:</span><span class="s2">"Prédio 04 - Sala 34C"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"bairro"</span><span class="p">:</span><span class="s2">"Alto da XV"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"codigo_municipio"</span><span class="p">:</span><span class="s2">"4106902"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"uf"</span><span class="p">:</span><span class="s2">"PR"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"cep"</span><span class="p">:</span><span class="s2">"80045165"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Algumas prefeituras possuem nota fiscal eletrônica de serviços mas não possuem a possibilidade de integrar com outros sistemas através de webservices. Nestes casos a prefeitura disponibiliza uma forma de importar vários RPS (Recibo Provisório de Serviço) que serão convertidos em notas de serviço, evitando o trabalho de digitar e autorizar cada NFSe de forma manual.</p>

<p>A API do Focus NFe atende essas situações fornecendo uma interface padronizada para geração destes arquivos, usando um formato muito similar com o já usado para autorizar NFSe’s individualmente.</p>

<p>A maior mudança é que o campo &quot;prestador&quot; fica em primeiro nível na nota, enquanto campos referentes a nota, como &quot;servico&quot;, &quot;tomador&quot;, &quot;data_emissao&quot; e demais, ficam aninhados dentro do campo &quot;lista_nfse&quot;, que abriga as notas emitidas. Ao lado, mostramos um exemplo de como fica o JSON para gerar o lote.</p>
<h2 id='emissao-nfse-por-arquivo_envio'>Envio</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br/v2/lotes_rps"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/lotes_rps"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>
<span class="n">ref</span> <span class="o">=</span> <span class="p">{</span><span class="s">"ref"</span><span class="p">:</span><span class="s">"12345"</span><span class="p">}</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="s">'''
Usamos dicionarios para armazenar os campos e valores que em seguida,
serao convertidos em JSON e enviados para nossa API
'''</span>
<span class="n">lote_nfse</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">lote_nfse</span><span class="p">[</span><span class="s">"prestador"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">lote_nfse</span><span class="p">[</span><span class="s">"lista_nfse"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">lote_nfse</span><span class="p">[</span><span class="s">"prestador"</span><span class="p">][</span><span class="s">"cnpj"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"99999999999999"</span>
<span class="n">lote_nfse</span><span class="p">[</span><span class="s">"prestador"</span><span class="p">][</span><span class="s">"inscricao_municipal"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"99999999"</span>
<span class="n">lote_nfse</span><span class="p">[</span><span class="s">"prestador"</span><span class="p">][</span><span class="s">"codigo_municipio"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"9999999"</span>

<span class="n">nfse</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"data_emissao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"2018-02-26T12:00:00-03:00"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"natureza_operacao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"cnpj"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"99999999999999"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"razao_social"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Parkinson da silva coelho JR"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"endereco"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"endereco"</span><span class="p">][</span><span class="s">"bairro"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"São Miriti"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"endereco"</span><span class="p">][</span><span class="s">"cep"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"31999-000"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"endereco"</span><span class="p">][</span><span class="s">"codigo_municipio"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"9999999"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"endereco"</span><span class="p">][</span><span class="s">"logradouro"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"João Batista Netos"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"endereco"</span><span class="p">][</span><span class="s">"numero"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"34"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"tomador"</span><span class="p">][</span><span class="s">"endereco"</span><span class="p">][</span><span class="s">"uf"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"MG"</span>  
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"aliquota"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"2.92"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"base_calculo"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"discriminacao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"SERVICOS E MAO DE OBRA"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"iss_retido"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"item_lista_servico"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1412"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"valor_iss"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"11.68"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"valor_liquido"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">nfse</span><span class="p">[</span><span class="s">"servico"</span><span class="p">][</span><span class="s">"valor_servicos"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>

<span class="n">lote_nfse</span><span class="p">[</span><span class="s">"lista_nfse"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nfse</span><span class="p">)</span>

<span class="c">#print (json.dumps(nfse))</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">lote_nfse</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Salvar os dados da resposta em arquivo destino a importação no sistima da prefeitura</span>

<span class="n">arquivo_lote_rps</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'arquivo_lote_rps.txt'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="n">arquivo_lote_rps</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resposta</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">arquivo_lote_rps</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


</code></pre><pre class="highlight shell tab-shell"><code><span class="c"># arquivo.json deve conter os dados da NFSe</span>
curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -T arquivo.json https://homologacao.focusnfe.com.br/v2/lotes_rps &gt; arquivo_lote_rps.txt
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFSeAutorizar</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>

    <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

    <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
    <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

    <span class="cm">/* Para ambiente de produção use a variável abaixo:
    String server = "https://api.focusnfe.com.br/"; */</span>
    <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

    <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/lotes_rps?ref="</span><span class="o">+</span><span class="n">ref</span><span class="o">);</span>

    <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
    <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
    <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
    <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

    <span class="cm">/* Aqui são criados as hash's que receberão os dados da nota. */</span>
    <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">nfse</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">prestador</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">tomador</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">tomadorEndereco</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">servico</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>

    <span class="n">dadosNfse</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"data_emissao"</span><span class="o">,</span> <span class="s">"2018-01-15T17:40:00"</span><span class="o">);</span>
    <span class="n">dadosNfse</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"natureza_operacao"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
    <span class="n">dadosPrestador</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cnpj"</span><span class="o">,</span> <span class="s">"51916585000125"</span><span class="o">);</span>
    <span class="n">dadosPrestador</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"inscricao_municipal"</span><span class="o">,</span> <span class="s">"123456"</span><span class="o">);</span>
    <span class="n">dadosPrestador</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_municipio"</span><span class="o">,</span> <span class="s">"4128104"</span><span class="o">);</span>
    <span class="n">dadosTomador</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cpf"</span><span class="o">,</span> <span class="s">"51966818092"</span><span class="o">);</span>
    <span class="n">dadosTomador</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"razao_social"</span><span class="o">,</span> <span class="s">"ACME LTDA"</span><span class="o">);</span>
    <span class="n">dadosTomador</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"email"</span><span class="o">,</span> <span class="s">"email-do-tomador@google.com.br"</span><span class="o">);</span>
    <span class="n">dadosTomadorEndereco</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"bairro"</span><span class="o">,</span> <span class="s">"Jardim America"</span><span class="o">);</span>
    <span class="n">dadosTomadorEndereco</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cep"</span><span class="o">,</span> <span class="s">"82620150"</span><span class="o">);</span>
    <span class="n">dadosTomadorEndereco</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_municipio"</span><span class="o">,</span> <span class="s">"4106902"</span><span class="o">);</span>
    <span class="n">dadosTomadorEndereco</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"logradouro"</span><span class="o">,</span> <span class="s">"Rua Paulo Centrone"</span><span class="o">);</span>
    <span class="n">dadosTomadorEndereco</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero"</span><span class="o">,</span> <span class="s">"168"</span><span class="o">);</span>
    <span class="n">dadosTomadorEndereco</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"uf"</span><span class="o">,</span> <span class="s">"PR"</span><span class="o">);</span>
    <span class="n">dadosServico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"discriminacao"</span><span class="o">,</span> <span class="s">"Teste de servico"</span><span class="o">);</span>
    <span class="n">dadosServico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"aliquota"</span><span class="o">,</span> <span class="s">"3.00"</span><span class="o">);</span>
    <span class="n">dadosServico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"base_calculo"</span><span class="o">,</span> <span class="s">"1.0"</span><span class="o">);</span>
    <span class="n">dadosServico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_iss"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
    <span class="n">dadosServico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"iss_retido"</span><span class="o">,</span> <span class="s">"false"</span><span class="o">);</span>
    <span class="n">dadosServico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_tributario_municipio"</span><span class="o">,</span> <span class="s">"080101"</span><span class="o">);</span>
    <span class="n">dadosServico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"item_lista_servico"</span><span class="o">,</span> <span class="s">"0801"</span><span class="o">);</span>
    <span class="n">dadosServico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_servicos"</span><span class="o">,</span> <span class="s">"1.0"</span><span class="o">);</span>
    <span class="n">dadosServico</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_liquido"</span><span class="o">,</span> <span class="s">"1.0"</span><span class="o">);</span>

    <span class="cm">/* Depois de fazer o input dos dados, são criados os objetos JSON já com os valores das hash's. */</span>
    <span class="n">JSONObject</span>  <span class="n">loteNfse</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">();</span>
    <span class="n">JSONArray</span>   <span class="n">listaNfse</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">();</span>
    <span class="n">JSONObject</span>  <span class="n">nfse</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">dadosNfse</span><span class="o">);</span>
    <span class="n">JSONObject</span>  <span class="n">prestador</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">dadosPrestador</span><span class="o">);</span>
    <span class="n">JSONObject</span>  <span class="n">tomador</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">dadosTomador</span><span class="o">);</span>
    <span class="n">JSONObject</span>  <span class="n">tomadorEndereco</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">dadosTomadorEndereco</span><span class="o">);</span>
    <span class="n">JSONObject</span>  <span class="n">servico</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">dadosServico</span><span class="o">);</span>

    <span class="cm">/* Aqui adicionamos os objetos JSON nos campos da API como array no JSON principal. */</span>
    <span class="n">listaNfse</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">nfse</span><span class="o">)</span>
    <span class="n">loteNfse</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"prestador"</span><span class="o">,</span> <span class="n">prestador</span><span class="o">);</span>
    <span class="n">loteNfse</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"listaNfse"</span><span class="o">,</span> <span class="n">listaNfse</span><span class="o">)</span>
    <span class="n">tomador</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"endereco"</span><span class="o">,</span> <span class="n">tomadorEndereco</span><span class="o">);</span>
    <span class="n">nfse</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"tomador"</span><span class="o">,</span> <span class="n">tomador</span><span class="o">);</span>
    <span class="n">nfse</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"servico"</span><span class="o">,</span> <span class="n">servico</span><span class="o">);</span>

    <span class="cm">/* É recomendado verificar como os dados foram gerados em JSON e se ele está seguindo a estrutura especificada em nossa documentação.
    System.out.print(json); */</span>

    <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

    <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

    <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

    <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="cm">/* Salvar os dados da resposta em arquivo destino a importação no sistima da prefeitura. */</span>
    <span class="n">BufferedWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="s">"arquivo_lote_rps.txt"</span><span class="o">));</span>
    <span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/lotes_rps?ref="</span> <span class="o">+</span> <span class="n">ref</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">lote_nfse</span> <span class="o">=</span> <span class="p">{</span>  
  <span class="ss">prestador: </span><span class="p">{</span>  
    <span class="ss">cnpj: </span><span class="s2">"18765499000199"</span><span class="p">,</span>
    <span class="ss">inscricao_municipal: </span><span class="s2">"12345"</span><span class="p">,</span>
    <span class="ss">codigo_municipio: </span><span class="s2">"3516200"</span>
  <span class="p">},</span>
  <span class="s2">"lista_nfse"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="ss">data_emissao: </span><span class="s2">"2017-09-21T22:15:00"</span><span class="p">,</span>
      <span class="ss">natureza_operacao: </span><span class="mi">1</span><span class="p">,</span>
      <span class="ss">tomador: </span><span class="p">{</span>  
        <span class="ss">cnpj: </span><span class="s2">"07504505000132"</span><span class="p">,</span>
        <span class="ss">razao_social: </span><span class="s2">"Acras Tecnologia da Informação LTDA"</span><span class="p">,</span>
        <span class="ss">email: </span><span class="s2">"contatoacras.com.br"</span><span class="p">,</span>
        <span class="ss">endereco: </span><span class="p">{</span>  
          <span class="ss">logradouro: </span><span class="s2">"Rua Dias da Rocha Filho"</span><span class="p">,</span>
          <span class="ss">numero: </span><span class="s2">"999"</span><span class="p">,</span>
          <span class="ss">complemento: </span><span class="s2">"Prédio 04 - Sala 34C"</span><span class="p">,</span>
          <span class="ss">bairro: </span><span class="s2">"Alto da XV"</span><span class="p">,</span>
          <span class="ss">codigo_municipio: </span><span class="s2">"4106902"</span><span class="p">,</span>
          <span class="ss">uf: </span><span class="s2">"PR"</span><span class="p">,</span>
          <span class="ss">cep: </span><span class="s2">"80045165"</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="ss">servico: </span><span class="p">{</span>  
        <span class="ss">aliquota: </span><span class="mi">3</span><span class="p">,</span>
        <span class="ss">discriminacao: </span><span class="s2">"Nota fiscal referente a serviços prestados"</span><span class="p">,</span>
        <span class="ss">iss_retido: </span><span class="s2">"false"</span><span class="p">,</span>
        <span class="ss">item_lista_servico: </span><span class="s2">"0107"</span><span class="p">,</span>
        <span class="ss">codigo_tributario_municipio: </span><span class="s2">"620910000"</span><span class="p">,</span>
        <span class="ss">valor_servicos: </span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos os dados da nota para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">lote_nfse</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># Salvar os dados da resposta em arquivo destino a importação no sistima da prefeitura.</span>
<span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s1">'arquivo_lote_rps.txt'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">arquivo</span><span class="o">|</span> <span class="n">arquivo</span><span class="p">.</span><span class="nf">puts</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span> <span class="p">}</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
 <span class="c1">// Você deve definir isso globalmente para sua aplicação
</span> <span class="c1">// Para ambiente de produção use a variável abaixo:
</span> <span class="c1">// $server = "https://api.focusnfe.com.br";
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
 <span class="c1">// Substituir pela sua identificação interna da nota
</span> <span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
 <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
 <span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
 <span class="nv">$lote_nfse</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
   <span class="s2">"prestador"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
     <span class="s2">"cnpj"</span> <span class="o">=&gt;</span> <span class="s2">"51916585000125"</span><span class="p">,</span>
      <span class="s2">"inscricao_municipal"</span> <span class="o">=&gt;</span> <span class="s2">"12345"</span><span class="p">,</span>
      <span class="s2">"codigo_municipio"</span> <span class="o">=&gt;</span> <span class="s2">"4119905"</span>
    <span class="p">),</span>
    <span class="s2">"lista_nfse"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
      <span class="k">array</span><span class="p">(</span>
        <span class="s2">"data_emissao"</span> <span class="o">=&gt;</span> <span class="s2">"2017-12-27T17:43:14-3:00"</span><span class="p">,</span>
        <span class="s2">"natureza_operacao"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
        <span class="s2">"tomador"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
          <span class="s2">"cnpj"</span> <span class="o">=&gt;</span> <span class="s2">"07504505000132"</span><span class="p">,</span>
          <span class="s2">"razao_social"</span> <span class="o">=&gt;</span> <span class="s2">"Acras Tecnologia da Informação LTDA"</span><span class="p">,</span>
          <span class="s2">"email"</span> <span class="o">=&gt;</span> <span class="s2">"contato@acras.com.br"</span><span class="p">,</span>
          <span class="s2">"endereco"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s2">"bairro"</span> <span class="o">=&gt;</span> <span class="s2">"Jardim America"</span><span class="p">,</span>
            <span class="s2">"cep"</span> <span class="o">=&gt;</span> <span class="s2">"81530900"</span><span class="p">,</span>
            <span class="s2">"codigo_municipio"</span> <span class="o">=&gt;</span> <span class="s2">"4119905"</span><span class="p">,</span>
            <span class="s2">"logradouro"</span> <span class="o">=&gt;</span> <span class="s2">"Rua ABC"</span><span class="p">,</span>
            <span class="s2">"numero"</span> <span class="o">=&gt;</span> <span class="s2">"16"</span><span class="p">,</span>
            <span class="s2">"uf"</span> <span class="o">=&gt;</span> <span class="s2">"PR"</span>
          <span class="p">)</span>
        <span class="p">),</span>
        <span class="s2">"servico"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
          <span class="s2">"discriminacao"</span> <span class="o">=&gt;</span> <span class="s2">"Exemplo Serviço"</span><span class="p">,</span>
          <span class="s2">"iss_retido"</span> <span class="o">=&gt;</span> <span class="s2">"false"</span><span class="p">,</span>
          <span class="s2">"item_lista_servico"</span> <span class="o">=&gt;</span> <span class="s2">"106"</span><span class="p">,</span>
          <span class="s2">"codigo_cnae"</span> <span class="o">=&gt;</span> <span class="s2">"6319400"</span><span class="p">,</span>
          <span class="s2">"valor_servicos"</span> <span class="o">=&gt;</span> <span class="s2">"1.00"</span>
        <span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">);</span>
 <span class="c1">// Inicia o processo de envio das informações usando o cURL
</span> <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/lotes_rps?ref="</span> <span class="o">.</span> <span class="nv">$ref</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$lote_nfse</span><span class="p">));</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>

  <span class="c1">// Salvar os dados da resposta em arquivo destino a importação no sistima da prefeitura.
</span>  <span class="nv">$arquivo_lote_rps</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s2">"arquivo_lote_rps.txt"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s2">"Não foi possível abrir o arquivo!"</span><span class="p">);</span>
  <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$arquivo_lote_rps</span><span class="p">,</span> <span class="nv">$body</span><span class="p">);</span>
  <span class="nb">fclose</span><span class="p">(</span><span class="nv">$arquivo_lote_rps</span><span class="p">);</span>
 <span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">let</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">)</span>

<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota</span>
<span class="kd">let</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/lotes_rps?ref="</span> <span class="o">+</span> <span class="nx">ref</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">lote_nfse</span> <span class="o">=</span> <span class="p">{</span>  
  <span class="s2">"prestador"</span><span class="p">:{</span>  
    <span class="s2">"cnpj"</span><span class="p">:</span><span class="s2">"51916585000125"</span><span class="p">,</span>
    <span class="s2">"inscricao_municipal"</span><span class="p">:</span><span class="s2">"12345"</span><span class="p">,</span>
    <span class="s2">"codigo_municipio"</span><span class="p">:</span><span class="s2">"3518800"</span>
  <span class="p">},</span>
  <span class="s2">"lista_nfse"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">"data_emissao"</span><span class="p">:</span><span class="s2">"2018-03-21"</span><span class="p">,</span>
      <span class="s2">"natureza_operacao"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span>
      <span class="s2">"tomador"</span><span class="p">:{</span>  
        <span class="s2">"cnpj"</span><span class="p">:</span><span class="s2">"07504505000132"</span><span class="p">,</span>
        <span class="s2">"razao_social"</span><span class="p">:</span><span class="s2">"Acras Tecnologia da Informacao LTDA"</span><span class="p">,</span>
        <span class="s2">"email"</span><span class="p">:</span><span class="s2">"contato@acras.com.br"</span><span class="p">,</span>
        <span class="s2">"endereco"</span><span class="p">:{</span>  
          <span class="s2">"logradouro"</span><span class="p">:</span><span class="s2">"Rua Filho da Rocha Bage"</span><span class="p">,</span>
          <span class="s2">"numero"</span><span class="p">:</span><span class="s2">"750"</span><span class="p">,</span>
          <span class="s2">"complemento"</span><span class="p">:</span><span class="s2">"Sala 07"</span><span class="p">,</span>
          <span class="s2">"bairro"</span><span class="p">:</span><span class="s2">"Alto da Rua XV"</span><span class="p">,</span>
          <span class="s2">"codigo_municipio"</span><span class="p">:</span><span class="s2">"4106902"</span><span class="p">,</span>
          <span class="s2">"uf"</span><span class="p">:</span><span class="s2">"PR"</span><span class="p">,</span>
          <span class="s2">"cep"</span><span class="p">:</span><span class="s2">"80045165"</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="s2">"servico"</span><span class="p">:{</span>  
        <span class="s2">"aliquota"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
        <span class="s2">"discriminacao"</span><span class="p">:</span><span class="s2">"Nota fiscal referente a servicos prestados"</span><span class="p">,</span>
        <span class="s2">"iss_retido"</span><span class="p">:</span><span class="s2">"false"</span><span class="p">,</span>
        <span class="s2">"item_lista_servico"</span><span class="p">:</span><span class="s2">"1401"</span><span class="p">,</span>
        <span class="s2">"codigo_tributario_municipio"</span><span class="p">:</span> <span class="s2">"452000100"</span><span class="p">,</span>
        <span class="s2">"valor_servicos"</span><span class="p">:</span><span class="mf">1.0</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">lote_nfse</span><span class="p">));</span>

<span class="c1">// Salvar os dados da resposta em arquivo destino a importação no sistima da prefeitura.</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="s1">'arquivo_lote_rps.txt'</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<p>Para gerar o arquivo do lote RPS, o envio dos dados é feito utilizando a URL abaixo (caso o envio seja em homologação, alterar para a URL correspondente):</p>

<p><code>https://api.focusnfe.com.br/v2/lotes_rps?ref=REFERENCIA</code></p>

<p>Os dados que devem ir no POST é um arquivo JSON muito similar ao arquivo de autorização de NFSe. Caso não haja nenhuma falha, a API retornará os dados para geração do arquivo. As informações que devem ser enviadas consistem nos seguintes campos:</p>

<ul>
<li><strong>prestador</strong>:

<ul>
<li><strong>cnpj</strong>: CNPJ do prestador de serviços.</li>
<li><strong>codigo_municipio</strong>: Código IBGE do município do prestador</li>
<li><strong>inscricao_municipal</strong>: Inscrição municipal do prestador de serviços.</li>
</ul></li>
<li><strong>lista_nfse</strong>:

<ul>
<li>Array com  as notas a serem geradas, usando o mesmo formato do arquivo de NFSe omitindo apenas a seção “prestador”.</li>
</ul></li>
</ul>

<p>A solicitação é síncrona e pode retornar os seguintes status HTTP:</p>

<table><thead>
<tr>
<th>HTTP CODE/STATUS</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>HTTP status 201 (Created)</td>
<td>Arquivo de importação gerado. É devolvido o conteúdo do arquivo como resposta</td>
</tr>
<tr>
<td>HTTP status 415 (Unsupported Media Type)</td>
<td>Formato de arquivo YAML inválido</td>
</tr>
<tr>
<td>HTTP status 422 (Unprocessable Entity)</td>
<td>Campos obrigatórios não preenchidos ou em formato incorreto</td>
</tr>
<tr>
<td>HTTP status 400 (Bad Request )</td>
<td>Requisição rejeitada devido a CNPJ ou token inválido (mensagem de erro apropriada é exibida)</td>
</tr>
</tbody></table>
<h2 id='emissao-nfse-por-arquivo_consulta'>Consulta</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/lotes_rps/"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">ref</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Salvar os dados da resposta em arquivo destino a importação no sistima da prefeitura</span>

<span class="n">arquivo_lote_rps</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'arquivo_lote_rps.txt'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="n">arquivo_lote_rps</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resposta</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">arquivo_lote_rps</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X GET https://homologacao.focusnfe.com.br/v2/lotes_rps/12345 &gt; arquivo_lote_rps.txt
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NFSeConsulta</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>

    <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

    <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
    <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

    <span class="cm">/* Para ambiente de produção use a variável abaixo:
    String server = "https://api.focusnfe.com.br/"; */</span>
    <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

    <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/lotes_rps/"</span><span class="o">+</span><span class="n">ref</span><span class="o">);</span>

    <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
    <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
    <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
    <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

    <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

    <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="o">(</span><span class="n">ClientResponse</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

    <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="cm">/* Salvar os dados da resposta em arquivo destino a importação no sistima da prefeitura. */</span>
    <span class="n">BufferedWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="s">"arquivo_lote_rps.txt"</span><span class="o">));</span>
    <span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/lotes_rps/"</span> <span class="o">+</span> <span class="n">ref</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># Salvar os dados da resposta em arquivo destino a importação no sistima da prefeitura.</span>
<span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s1">'arquivo_lote_rps.txt'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">arquivo</span><span class="o">|</span> <span class="n">arquivo</span><span class="p">.</span><span class="nf">puts</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span> <span class="p">}</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
 <span class="c1">// Você deve definir isso globalmente para sua aplicação
</span> <span class="c1">//Substituir pela sua identificação interna da nota
</span> <span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
 <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
 <span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
 <span class="c1">// Para ambiente de produção use a variável abaixo:
</span> <span class="c1">// $server = "https://api.focusnfe.com.br";
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span> <span class="c1">// Servidor de homologação
</span> <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/lotes_rps/"</span> <span class="o">.</span> <span class="nv">$ref</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>

  <span class="c1">// Salvar os dados da resposta em arquivo destino a importação no sistima da prefeitura.
</span>  <span class="nv">$arquivo_lote_rps</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s2">"arquivo_lote_rps.txt"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s2">"Não foi possível abrir o arquivo!"</span><span class="p">);</span>
  <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$arquivo_lote_rps</span><span class="p">,</span> <span class="nv">$body</span><span class="p">);</span>
  <span class="nb">fclose</span><span class="p">(</span><span class="nv">$arquivo_lote_rps</span><span class="p">);</span>
 <span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">let</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">)</span>

<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">let</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota</span>
<span class="kd">let</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/lotes_rps/"</span> <span class="o">+</span> <span class="nx">ref</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Salvar os dados da resposta em arquivo destino a importação no sistima da prefeitura.</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="s1">'arquivo_lote_rps.txt'</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<p>Para os lotes que já foram gerados, é possível fazer a consulta do mesmo. O retorno para a requisição será igual ao do envio, ou seja, serão retornardo os dados para gerar o arquivo para realizar a importação no site da prefeitura.</p>

<p>Esta operação está disponível na URL abaixo:</p>

<p><code>https://api.focusnfe.com.br/v2/lotes_rps/REFERENCIA</code></p>

<ul>
<li><strong>retorno:</strong>

<ul>
<li><strong>HTTP status 200 (OK)</strong> – É devolvido o conteúdo do arquivo de importação como resposta</li>
<li><strong>HTTP status 404 (Not found)</strong> – Lote não encontrado com referência informada</li>
</ul></li>
</ul>
<h2 id='emissao-nfse-por-arquivo_resposta-opcional'>Resposta (opcional)</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/lotes_rps/"</span> <span class="o">+</span> <span class="n">ref</span> <span class="o">+</span> <span class="s">"/resposta"</span>

<span class="c"># Substituir pela sua identificação interna da nota</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="c"># Aqui é feita a leitura do conteúdo do arquivo de retorno baixado no site da prefeitura</span>
<span class="n">arquivo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"caminho/arquivo_retorno.txt"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">arquivo</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST https://homologacao.focusnfe.com.br/v2/lotes_rps/12345/resposta -T caminho/arquivo_retorno.txt
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">java.nio.file.Files</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.file.Paths</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoteNFSeConsulta</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>

    <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

    <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
    <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

    <span class="cm">/* Para ambiente de produção use a variável abaixo:
    String server = "https://api.focusnfe.com.br/"; */</span>
    <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

    <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/lotes_rps/"</span><span class="o">+</span><span class="n">ref</span><span class="o">);</span>

    <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
    <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
    <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
    <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

    <span class="c1">// Aqui é feita a leitura do conteúdo do arquivo de retorno baixado no site da prefeitura</span>
    <span class="n">String</span> <span class="n">retorno</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">(</span><span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"caminho/arquivo_retorno.txt"</span><span class="o">)));</span>

    <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">retorno</span><span class="o">);</span>

    <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="o">(</span><span class="n">ClientResponse</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

    <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
      * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/lotes_rps/"</span> <span class="o">+</span> <span class="n">ref</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="sr">//</span> <span class="no">Aqui</span> <span class="err">é</span> <span class="n">feita</span> <span class="n">a</span> <span class="n">leitura</span> <span class="k">do</span> <span class="n">conte</span><span class="err">ú</span><span class="k">do</span> <span class="k">do</span> <span class="n">arquivo</span> <span class="n">de</span> <span class="n">retorno</span> <span class="n">baixado</span> <span class="n">no</span> <span class="n">site</span> <span class="n">da</span> <span class="n">prefeitura</span>
<span class="n">retorno</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'caminho/arquivo_retorno.txt'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span>

<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">retorno</span><span class="p">.</span><span class="nf">to_s</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
  <span class="c1">// Você deve definir isso globalmente para sua aplicação
</span>  <span class="c1">//Substituir pela sua identificação interna da nota
</span>  <span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>
  <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"token obtido no cadastro da empresa"</span><span class="p">;</span>
  <span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>

  <span class="c1">// Aqui é feita a leitura do conteúdo do arquivo de retorno baixado no site da prefeitura
</span>  <span class="nv">$retorno</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">"caminho/arquivo_retorno.txt"</span><span class="p">);</span>

  <span class="c1">// Para ambiente de produção use a variável abaixo:
</span>  <span class="c1">// $server = "https://api.focusnfe.com.br";
</span>  <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span> <span class="c1">// Servidor de homologação
</span>  <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/lotes_rps/"</span> <span class="o">.</span> <span class="nv">$ref</span> <span class="o">.</span> <span class="s2">"/resposta"</span><span class="p">);</span>
  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$retorno</span><span class="p">);</span>
  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
  <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
  <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
  <span class="c1">//as três linhas abaixo imprimem as informações retornadas pela API, aqui o seu sistema deverá
</span>  <span class="c1">//interpretar e lidar com o retorno
</span>  <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
  <span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
  <span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
  <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">let</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">let</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interna da nota</span>
<span class="kd">let</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/lotes_rps/"</span> <span class="o">+</span> <span class="nx">ref</span> <span class="o">+</span> <span class="s2">"/resposta"</span><span class="p">;</span>

<span class="c1">// Aqui é feita a leitura do conteúdo do arquivo de retorno baixado no site da prefeitura</span>
<span class="kd">let</span> <span class="nx">retorno</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s1">'caminho/arquivo_retorno.txt'</span><span class="p">);</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">retorno</span><span class="p">);</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<p>Algumas prefeituras disponibilizam um arquivo de resposta, que poderá informar erros no arquivo enviado ou informar dados da nota fiscal gerada (por exemplo número e código de verificação). Quando implementado, é possível enviar a resposta da prefeitura para nossa API, utilizando a URL abaixo, e iremos gerar a resposta de acordo com o padrão da nossa API:</p>

<p><code>https://api.focusnfe.com.br/v2/lotes_rps/REFERENCIA/resposta</code></p>

<ul>
<li><strong>retorno:</strong>

<ul>
<li><strong>HTTP status 201 (Created)</strong> – Arquivo de importação gerado. É devolvido o status de cada nota enviada. Nenhuma nota é processada se alguma nota tiver algum erro.</li>
<li><strong>HTTP status 415 (Unsupported Media Type)</strong> – Formato de arquivo inválido</li>
<li><strong>HTTP status 400 (Bad Request )</strong> – Requisição rejeitada devido a CNPJ ou token inválido (mensagem de erro apropriada é exibida)</li>
</ul></li>
</ul>

<blockquote>
<p>Exemplo de resposta para o envio do arquivo de retorno do Lote NFSe:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="s2">"9999"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_verificacao"</span><span class="p">:</span><span class="s2">"311299647"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data_emissao"</span><span class="p">:</span><span class="s2">"2017-09-09T10:20:00-03:00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"uri"</span><span class="p">:</span><span class="s2">"https://www.barueri.sp.gov.br/nfe/"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_nota_fiscal"</span><span class="p">:</span><span class="s2">"/notas_fiscais_servico/NFSe191517072001883518800-1898781-9999-312276647.xml"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h1 id='nfses-recebidas-beta_nfses-recebidas-beta'>NFSes recebidas (beta)</h1>
<p>Da mesma forma que a manifestação de NFe, a API para busca de NFSes recebidas do sistema Focus permite que você consulte as notas de serviço onde sua empresa é a tomadora do serviço nos municípios onde isso é possível. No caso da NFSe, não existe a operação de manifestação. No momento a busca de notas está sendo possível apenas no município de São Paulo.</p>

<p>Através desta documentação deverá ser possível fazer a integração com a API do Focus NFe, caso alguma dúvida permaneça você pode entrar em contato com o suporte através do e-mail suporte@acras.com.br. Através deste canal você pode também solicitar a implementação de algum município que possibilite a busca de notas recebidas de forma automática.</p>
<h2 id='nfses-recebidas-beta_urls'>URLs</h2>
<table><thead>
<tr>
<th>Método</th>
<th>URL (recurso)</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>GET</td>
<td>/v2/nfses_recebidas?cnpj=CNPJ</td>
<td>Busca os dados de todas as NFSes recebidas.</td>
</tr>
</tbody></table>
<h2 id='nfses-recebidas-beta_status-api'>Status API</h2>
<p>Aqui você encontra os status possíveis para MDe.</p>

<table><thead>
<tr>
<th>HTTP CODE/STATUS</th>
<th>Status API Focus</th>
<th>Descrição</th>
<th>Correção</th>
</tr>
</thead><tbody>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>CNPJ do emitente não autorizado ou não informado.</td>
<td>Verifique no Painel API se esse emitente está habilitado para realizar a busca de NFSes recebidas. Verifique se o CNPJ foi informado no JSON de envio.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>CNPJ/UF do emitente não autorizado ou não informado.</td>
<td>Verifique no Painel API se esse emitente está habilitado para realizar a busca de NFSes recebidas. Verifique se o CNPJ foi informado no JSON de envio.</td>
</tr>
<tr>
<td>403 - forbidden</td>
<td>permissao_negada</td>
<td>CNPJ do emitente não autorizado.</td>
<td>O emitente utilizado não está autorizado a realizar a operação de busca ou foi informado o CNPJ do emitente incorretamente no JSON.</td>
</tr>
</tbody></table>
<h2 id='nfses-recebidas-beta_consulta-de-nfse-recebidas'>Consulta de NFSe Recebidas</h2>
<p>Uma NFSe pode ser cancelada após ter sido recebida. Por este motivo as NFSes recebidas possuem um campo chamado “<strong>versao</strong>” que é único entre todos os documentos do mesmo CNPJ e que é atualizado a cada alteração nesta NFSe. Isto facilita a busca apenas dos documentos que seu sistema ainda não conhece, sendo necessário que você armazene apenas um número por CNPJ.</p>

<p>Por exemplo, se você recebe uma NFSe com versao = 60, e ela posteriormente for cancelada, sua versão será atualizada para algum número maior que 60.</p>

<p>A API busca as últimas atualizações das prefeituras uma vez ao dia.</p>

<p><strong>Método de consulta</strong></p>

<blockquote>
<p>Exemplo de como consultar todas as notas recebidas de uma empresa.</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfses_recebidas?cnpj="</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">cnpj</span> <span class="o">=</span> <span class="s">"cnpj_do_destinatario_da_nota"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">cnpj</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfses_recebidas?cnpj=SEU_CNPJ"</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsultarTodosManifestos</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">cnpj</span> <span class="o">=</span> <span class="s">"CNPJ_da_sua_empresa"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfses_recebidas?cnpj="</span><span class="o">+</span><span class="n">cnpj</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span>  <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="n">cnpj</span> <span class="o">=</span> <span class="s2">"CNPJ_da_sua_empresa"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfses_recebidas?cnpj="</span> <span class="o">+</span> <span class="n">cnpj</span>

<span class="c1"># criamos uma objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// Solicite o seu token para realizar as requisições com nossa equipe de suporte.
</span> <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
 <span class="nv">$cnpj</span> <span class="o">=</span> <span class="s2">"CNPJ_da_sua_empresa"</span><span class="p">;</span>
<span class="c1">// Para ambiente de Produção, utilize a URL: https://api.focusnfe.com.br/.  
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span><span class="p">;</span>

 <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
   <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"v2/nfses_recebidas?cnpj="</span><span class="o">.</span><span class="nv">$cnpj</span><span class="p">);</span>
   <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
   <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="cm">/* Métodos para realizar a autenticação básica do HTTP.
   Não é necessário informar campo senha, apenas o campo login. */</span>  
   <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
   <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">"</span><span class="p">);</span>

 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// Mostra na tela o HTTP Code da sua requisição.
</span>   <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="p">);</span>
<span class="c1">// Mostra na tela a mensagem de retorno da API.   
</span>   <span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="p">);</span>
   <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
A orientacao a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">cnpj</span> <span class="o">=</span> <span class="s2">"cnpj_do_destinatario_da_nota"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfses_recebidas?cnpj="</span> <span class="o">+</span> <span class="nx">cnpj</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<p>Para consultar os documentos fiscais recebidos, utilize o endereço abaixo:</p>

<p><code>https://api.focusnfe.com.br/v2/nfses_recebidas?cnpj=CNPJ</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para consultar as notas. Esta requisição aceita os seguintes parâmetros que deverão ser enviados na URL:</p>

<ul>
<li><strong>cnpj</strong>(*): CNPJ da empresa. Campo obrigatório.</li>
<li><strong>versao</strong>: Se informado, irá buscar apenas os documentos cuja versão seja maior que o parâmetro recebido. Utilize este parâmetro para buscar apenas as notas que seu sistema ainda não conhece.</li>
</ul>

<p>Serão devolvidas as 100 primeiras notas encontradas. Para recuperar as demais notas você deverá fazer uma nova requisição alterando o campo versão.</p>

<blockquote>
<p>Exemplo dos dados de resposta:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="mi">3240</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero_rps"</span><span class="p">:</span><span class="w"> </span><span class="mi">3187</span><span class="p">,</span><span class="w">
    </span><span class="s2">"serie_rps"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UNICA"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_emissao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-11-01T09:53:01-03:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_emissao_rps"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-11-01T00:00:00-03:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"valor_total"</span><span class="p">:</span><span class="w"> </span><span class="mf">63.5</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizada"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"documento_prestador"</span><span class="p">:</span><span class="w"> </span><span class="s2">"11131112000133"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nome_prestador"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"inscricao_municipal_prestador"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12224222"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"versao"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_verificacao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"IAAAXAAB"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://nfe.prefeitura.sp.gov.br/contribuinte/notaprint.aspx?inscricao=12224222&amp;nf=3240&amp;verificacao=IAAAXAAA"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"url_xml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://focusnfe.s3-sa-east-1.amazonaws.com/arquivos/11110100000111/201911/NFSeRecebidas/NFSe111101000001113220308-12224222-3240-IAAAXAAA.xml"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nome_municipio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"São Paulo"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"sigla_uf"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SP"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_municipio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3550308"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p><strong>Dados devolvidos</strong></p>

<p>A API irá devolver os seguintes cabeçalhos HTTP:</p>

<ul>
<li><strong>X-Total-Count</strong>: O número total de registros (incluindo aqueles que não foram devolvidos pelo limite de 100 registros)</li>
<li><strong>X-Max-Version</strong>: Valor máximo da versão dos documentos devolvidos. Utilize este cabeçalho para utilizar na próxima busca de versão, caso seja necessário.</li>
</ul>

<p>Os dados devolvidos no corpo da requisição serão um array de objetos em JSON no seguinte formato:</p>

<ul>
<li><strong>numero</strong>: Número da NFSe.</li>
<li><strong>numero_rps</strong>: Número do RPS, se existir.</li>
<li><strong>serie_rps</strong>: Série do RPS, se existir.</li>
<li><strong>data_emissao</strong>: Data de emissão da NFSe.</li>
<li><strong>data_emissao_rps</strong>: Data de emissão do RPS, se existir.</li>
<li><strong>valor_total</strong>: Valor total da NFSe.</li>
<li><strong>situacao</strong>: Situação da NFSe. Pode ser: autorizada ou cancelada.</li>
<li><strong>documento_prestador</strong>: CNPJ ou CPF do emitente do documento fiscal.</li>
<li><strong>inscricao_municipal_prestador</strong>: CNPJ ou CPF do emitente do documento fiscal.</li>
<li><strong>versao</strong>: Versão do documento fiscal. Este número irá mudar apenas se o documento for alterado de alguma forma.</li>
<li><strong>codigo_verificacao</strong>: Código de verificação da NFSe.</li>
<li><strong>url</strong>: URL para visualização da NFSe no site da prefeitura.</li>
<li><strong>url_xml</strong>: URL para download do XML da NFSe.</li>
<li><strong>nome_municipio</strong>: Nome do município do prestador.</li>
<li><strong>sigla_uf</strong>: UF do prestador.</li>
<li><strong>codigo_municipio</strong>: Código IBGE do município do prestador.</li>
</ul>

<p>Você pode também configurar o gatilho &quot;nfse_recebida&quot; para receber estes dados diretamente em sua aplicação assim que estiverem disponíveis na API. Consulte a seção de <a href="#gatilhos-webhooks_gatilhos-webhooks">Gatilhos / Webhooks</a></p>
<h1 id='cte-e-cte-os_cte-e-cte-os'>CTe e CTe OS</h1>
<p>Através da API CTe é possível:</p>

<ul>
<li>Emitir CTe (Conhecimento de Transporte Eletrônico) utilizando dados simplificados. Este processo é <strong>assíncrono</strong>. Ou seja, após a emissão a nota será enfileirada para processamento.</li>
<li>Emitir CTe OS (outros serviços) utilizando dados simplificados. Este processo é <strong>síncrono</strong>. Ou seja, na mesma requisição é feito processamento da CTe.</li>
<li>Cancelar uma CTe de qualquer modelo.</li>
<li>Consultar o status de CTe emitidas.</li>
<li>Emitir os eventos: carta de correção, prestação em desacordo, registro multimodal e informações GTV (apenas CTe OS)</li>
<li>Inutilizar uma faixa de numeração de CTe de qualquer modelo</li>
</ul>
<h2 id='cte-e-cte-os_urls'>URLs</h2>
<table><thead>
<tr>
<th>Método</th>
<th>URL (recurso)</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>POST</td>
<td>/v2/cte?ref=REFERENCIA</td>
<td>Cria uma CTe a envia para processamento.</td>
</tr>
<tr>
<td>POST</td>
<td>/v2/cte_os?ref=REFERENCIA</td>
<td>Emite uma CTe OS.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/cfe/REFERENCIA</td>
<td>Consulta a CTe com a referência informada e o seu status de processamento</td>
</tr>
<tr>
<td>DELETE</td>
<td>/v2/cfe/REFERENCIA</td>
<td>Cancela uma CTe com a referência informada</td>
</tr>
<tr>
<td>POST</td>
<td>/v2/cte/REFERENCIA/carta_correcao</td>
<td>Cria uma carta de correção para a CTe com a referência informada.</td>
</tr>
<tr>
<td>POST</td>
<td>/v2/cte/inutilizacao</td>
<td>Inutiliza uma numeração da CTe</td>
</tr>
</tbody></table>
<h2 id='cte-e-cte-os_campos-de-um-cte'>Campos de um CTe</h2>
<blockquote>
<p>Abaixo um exemplo de dados de uma CTe:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="s2">"modal_aereo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"numero_minuta"</span><span class="p">:</span><span class="w"> </span><span class="s2">"000001234"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero_operacional"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345678901"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_prevista_entrega"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-01-01"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"dimensao_carga"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1234X1234X1234"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"informacoes_manuseio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"03"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"classe_tarifa"</span><span class="p">:</span><span class="w"> </span><span class="s2">"G"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_tarifa"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"valor_tarifa"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123.00"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"cfop"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5353"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"natureza_operacao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PREST. DE SERV. TRANSPORTE A ESTAB. COMERCIAL"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data_emissao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-05-17T11:13:04-03:00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"tipo_documento"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_municipio_envio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2927408"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"municipio_envio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Salvador"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"uf_envio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BA"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_municipio_inicio"</span><span class="p">:</span><span class="w"> </span><span class="mi">2927408</span><span class="p">,</span><span class="w">
  </span><span class="s2">"tipo_servico"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"municipio_inicio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Salvador"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"uf_inicio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BA"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_municipio_fim"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2927408"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"municipio_fim"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Salvador"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"uf_fim"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BA"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"retirar_mercadoria"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"detalhes_retirar"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Teste detalhes retirar"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"indicador_inscricao_estadual_tomador"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"tomador"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caracterisca_adicional_transporte"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c.adic.transp."</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caracterisca_adicional_servico"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Teste caract add servico"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"funcionario_emissor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"func.emiss"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_interno_origem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Teste codigo interno origem"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_interno_passagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"codIntPass"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_interno_destino"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Teste codigo interno destino"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_rota"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cod rota"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"tipo_programacao_entrega"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"sem_hora_tipo_hora_programada"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"11111451000111"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cpf_remetente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"08111727908"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"nome_remetente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CT-E EMITIDO EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"telefone_remetente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7734629600"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"logradouro_remetente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"R. XYZ"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_remetente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1205"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"bairro_remetente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Vila Perneta"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_municipio_remetente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4119152"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"municipio_remetente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pinhais"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"uf_remetente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PR"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cep_remetente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"83124310"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_pais_remetente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1058"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"pais_remetente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Brasil"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cnpj_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00112222000149"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"inscricao_estadual_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"02220020926081"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"nome_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CT-E EMITIDO EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"telefone_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7333332600"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"logradouro_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"R. Alto Parana"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"190"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"bairro_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Sao Cristovao"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_municipio_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2927408"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"municipio_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Salvador"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"uf_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BA"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cep_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"83222380"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_pais_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1058"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"pais_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Brasil"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"email_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fiscal@example.com"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"valor_total"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1500.00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"valor_receber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"750.00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"icms_situacao_tributaria"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"icms_base_calculo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"50635.27"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"icms_aliquota"</span><span class="p">:</span><span class="w"> </span><span class="s2">"17.00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"icms_valor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8608.00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"valor_total_carga"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200000.00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"produto_predominante"</span><span class="p">:</span><span class="w"> </span><span class="s2">"teste produto carga"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"outras_caracteristicas_carga"</span><span class="p">:</span><span class="w"> </span><span class="s2">"teste caracteristicas carga"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"quantidades"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"codigo_unidade_medida"</span><span class="p">:</span><span class="w"> </span><span class="s2">"01"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"tipo_medida"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PESO BRUTO"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"quantidade"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0000"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"codigo_unidade_medida"</span><span class="p">:</span><span class="w"> </span><span class="s2">"02"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"tipo_medida"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PESO BRUTO"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"quantidade"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0000"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"valor_carga_averbacao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200000.00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"nfes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"35122225222278000855550010000002821510931504"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"pin_suframa"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1234"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"data_prevista"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-05-07"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"valor_original_fatura"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12000.00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"valor_desconto_fatura"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1000.00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"valor_liquido_fatura"</span><span class="p">:</span><span class="w"> </span><span class="s2">"11000.00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"duplicatas"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"data_vencimento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-05-07"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"valor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"13000.00"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>A CTe possui vários campos para os mais variados tipos e formas de operações, por isso, criamos uma página exclusiva que mostra todos os campos da nossa API para o envio de CTe. Nela, você pode buscar os campos pela TAG XML ou pela nossa tradução para API.</p>

<p><a href="https://focusnfe.com.br/dsl/3.0/ConhecimentoTransporteXML.html">Documentação completa dos campos CTe</a></p>

<p><a href="https://focusnfe.com.br/dsl/3.0/ConhecimentoTransporteOsXML.html">Documentação completa dos campos CTe OS</a></p>

<p>Além dos campos descritos acima, cada CTe deverá obrigatoriamente informar um <strong>modal</strong>, que é a forma de transporte da carga. Você deverá informar uma das seguintes chaves nos dados, clique em cada link para visualizar os campos completos:</p>

<ul>
<li>modal_rodoviario para transporte rodoviário. <a href="https://focusnfe.com.br/dsl/3.0/TransporteRodoviarioXML.html">Consulte campos para CTe</a> e <a href="https://focusnfe.com.br/dsl/3.0/TransporteRodoviarioOsXML.html">Consulte campos para CTe OS</a></li>
<li>modal_aereo <a href="https://focusnfe.com.br/dsl/3.0/TransporteAereoXML.html">para transporte aéreo.</a></li>
<li>modal_aquaviario <a href="https://focusnfe.com.br/dsl/3.0/TransporteAquaviarioXML.html">para transporte aquaviário.</a></li>
<li>modal_ferroviario <a href="https://focusnfe.com.br/dsl/3.0/TransporteFerroviarioXML.html">para transporte ferroviário.</a></li>
<li>modal_dutoviario <a href="https://focusnfe.com.br/dsl/3.0/TransporteDutoviarioXML.html">para transporte dutoviário.</a></li>
<li>modal_multimodal <a href="https://focusnfe.com.br/dsl/3.0/TransporteMultimodalXML.html">para transporte que utilize mais de um modal.</a></li>
</ul>

<p>Para CTe-OS é necessário informar dados adicionais do modal <strong>apenas quando este for rodoviário</strong>. Nos outros casos não é necessário.</p>
<h2 id='cte-e-cte-os_status-api'>Status API</h2>
<p>Aqui você encontra os status possíveis para CTe e CTe OS.</p>

<table><thead>
<tr>
<th>HTTP CODE/STATUS</th>
<th>Status API Focus</th>
<th>Descrição</th>
<th>Correção</th>
</tr>
</thead><tbody>
<tr>
<td>422 - unprocessable entity</td>
<td>erro_validacao_schema</td>
<td>Erro na validação do Schema XML</td>
<td>Verifique o detalhamento do erro na resposta da API.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>forma_emissao_invalida</td>
<td>A forma de emissão utilizada é inválida</td>
<td>As formas de emissão disponíveis estão contidas na documentação da API.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>campos_invalidos</td>
<td>O parâmetro &#39;numero&#39; não foi informado</td>
<td>É necessário informar o número do CTe, use o campo &quot;numero&quot; em seu JSON.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>campos_invalidos</td>
<td>O parâmetro &#39;serie&#39; não foi informado</td>
<td>É necessário informar a série do CTe, use o campo &quot;serie&quot; em seu JSON.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>campos_invalidos</td>
<td>OCampo &#39;X não é válido</td>
<td>Onde X é o nome do campo inválido. Verifique a documentação dos campos da API para CTe ou CTe OS.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>modelo_invalido</td>
<td>Para esta URL só é permitida a emissão de CT-e modelo 57</td>
<td>Será exibida essa mensagem quando for usado a URL de CTe para emissão de CTe OS ou vice-versa. Consulte as documentações sobre esses documentos.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>campos_invalidos_modal</td>
<td>Esse status indica erros nos campos do modal usado. Verifique os campos informados e compare com a nossa documentação de campos.</td>
<td></td>
</tr>
<tr>
<td>400 - bad request</td>
<td>empresa_nao_habilitada</td>
<td>Empresa ainda não habilitada para emissão de CT-e</td>
<td>Verifique o cadastro do emitente no Painel API, deve-se habilitar CTe e/ou CTe OS para começar a emitir este documento.</td>
</tr>
<tr>
<td>409 - conflict</td>
<td>cte_ja_autorizado</td>
<td>Já existe um CT-e autorizado utilizando esta referência</td>
<td>Altere a referência da requisição e tente novamente.</td>
</tr>
<tr>
<td>409 - conflict</td>
<td>cte_em_processamento</td>
<td>Já existe um CT-e utilizando essa referencia e ele está em processamento</td>
<td>Altere a referência da requisição e tente novamente.</td>
</tr>
<tr>
<td>404 - not found</td>
<td>nao_encontrado</td>
<td>CT-e não encontrado</td>
<td>CT-e informado na requisição não foi encontrado.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>nao_autorizado</td>
<td>CT-e não autorizado</td>
<td>CT-e informado na requisição não foi autorizado, informe o evento GTV apenas para CTe O.S(modelo 67).</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>Sua requisição é inválida porque alguns dos paramêtros básicos não foram cumpridos. Entre em contato com o nosso suporte.</td>
<td></td>
</tr>
</tbody></table>
<h2 id='cte-e-cte-os_envio'>Envio</h2><pre class="highlight shell tab-shell"><code><span class="c"># arquivo.json deve conter os dados da CTe</span>
curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -T cte.json https://homologacao.focusnfe.com.br/v2/cte?ref<span class="o">=</span>12345
curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -T cte_os.json https://homologacao.focusnfe.com.br/v2/cte_os?ref<span class="o">=</span>12345
</code></pre><pre class="highlight java tab-java"><code>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Autorizar</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JSONException</span><span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interno do CTe. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/cte_os?ref="</span><span class="o">+</span><span class="n">ref</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="cm">/* Aqui são criados as hash's que receberão os dados do CTe. */</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">cte</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">seguroCarga</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">documentosReferenciados</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>

        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"bairro_emitente"</span><span class="o">,</span><span class="s">"Sao Cristova"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"bairro_tomador"</span><span class="o">,</span><span class="s">"Bacacheri"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cep_emitente"</span><span class="o">,</span><span class="s">"99880077"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cep_tomador"</span><span class="o">,</span><span class="s">"88991188"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cfop"</span><span class="o">,</span><span class="s">"5353"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cnpj_emitente"</span><span class="o">,</span><span class="s">"51916585000125"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cnpj_tomador"</span><span class="o">,</span><span class="s">"51966818092777"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_municipio_emitente"</span><span class="o">,</span><span class="s">"2927408"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_municipio_envio"</span><span class="o">,</span><span class="s">"5200050"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_municipio_fim"</span><span class="o">,</span><span class="s">"3100104"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_municipio_inicio"</span><span class="o">,</span><span class="s">"5200050"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_municipio_tomador"</span><span class="o">,</span><span class="s">"4106902"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"codigo_pais_tomador"</span><span class="o">,</span><span class="s">"1058"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"complemento_emitente"</span><span class="o">,</span><span class="s">"Andar 19 - sala 23"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"data_emissao"</span><span class="o">,</span><span class="s">"2018-06-18T09:17:00"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"descricao_servico"</span><span class="o">,</span><span class="s">"Descricao do seu servico aqui"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"funcionario_emissor"</span><span class="o">,</span><span class="s">"Nome do funcionario que fez a emissao"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_aliquota"</span><span class="o">,</span><span class="s">"17.00"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_base_calculo"</span><span class="o">,</span><span class="s">"1.00"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_situacao_tributaria"</span><span class="o">,</span><span class="s">"00"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"icms_valor"</span><span class="o">,</span><span class="s">"0.17"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"indicador_inscricao_estadual_tomador"</span><span class="o">,</span><span class="s">"9"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"inscricao_estadual_emitente"</span><span class="o">,</span><span class="s">"12345678"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"logradouro_emitente"</span><span class="o">,</span><span class="s">"Aeroporto Internacional de Salvador"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"logradouro_tomador"</span><span class="o">,</span><span class="s">"Rua Joao Dalegrave"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"modal"</span><span class="o">,</span><span class="s">"02"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"municipio_emitente"</span><span class="o">,</span><span class="s">"Salvador"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"municipio_envio"</span><span class="o">,</span><span class="s">"Abadia de Goias"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"municipio_fim"</span><span class="o">,</span><span class="s">"Abadia dos Dourados"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"municipio_inicio"</span><span class="o">,</span><span class="s">"Abadia de Goias"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"municipio_tomador"</span><span class="o">,</span><span class="s">"Curitiba"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"natureza_operacao"</span><span class="o">,</span><span class="s">"PREST. DE SERV. TRANSPORTE A ESTAB. COMERCIAL"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"nome_emitente"</span><span class="o">,</span><span class="s">"ACME LTDA"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"nome_fantasia_emitente"</span><span class="o">,</span><span class="s">"ACME"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"nome_fantasia_tomador"</span><span class="o">,</span><span class="s">"Nome do tomador do servico aqui"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"nome_tomador"</span><span class="o">,</span><span class="s">"NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero_emitente"</span><span class="o">,</span><span class="s">"S/N"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero_fatura"</span><span class="o">,</span><span class="s">"1"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero_tomador"</span><span class="o">,</span><span class="s">"1"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"pais_tomador"</span><span class="o">,</span><span class="s">"BRASIL"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"quantidade"</span><span class="o">,</span><span class="s">"1.0000"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"telefone_emitente"</span><span class="o">,</span><span class="s">"4133336666"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"tipo_documento"</span><span class="o">,</span><span class="s">"0"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"tipo_servico"</span><span class="o">,</span><span class="s">"6"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"uf_emitente"</span><span class="o">,</span><span class="s">"BA"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"uf_envio"</span><span class="o">,</span><span class="s">"GO"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"uf_fim"</span><span class="o">,</span><span class="s">"MG"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"uf_inicio"</span><span class="o">,</span><span class="s">"GO"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"uf_tomador"</span><span class="o">,</span><span class="s">"PR"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_desconto_fatura"</span><span class="o">,</span><span class="s">"0.00"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_inss"</span><span class="o">,</span><span class="s">"0.10"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_liquido_fatura"</span><span class="o">,</span><span class="s">"1.00"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_original_fatura"</span><span class="o">,</span><span class="s">"1.00"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_receber"</span><span class="o">,</span><span class="s">"1.00"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_total"</span><span class="o">,</span><span class="s">"1.00"</span><span class="o">);</span>
        <span class="n">cte</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_total_tributos"</span><span class="o">,</span><span class="s">"0.00"</span><span class="o">);</span>
        <span class="n">segurosCarga</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"nome_seguradora"</span><span class="o">,</span><span class="s">"Nome da seguradora aqui"</span><span class="o">);</span>
        <span class="n">segurosCarga</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero_apolice"</span><span class="o">,</span><span class="s">"12345"</span><span class="o">);</span>
        <span class="n">segurosCarga</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"responsavel_seguro"</span><span class="o">,</span><span class="s">"4"</span><span class="o">);</span>
        <span class="n">documentosReferenciados</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"data_emissao"</span><span class="o">,</span><span class="s">"2018-06-18"</span><span class="o">);</span>
        <span class="n">documentosReferenciados</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero"</span><span class="o">,</span><span class="s">"1"</span><span class="o">);</span>
        <span class="n">documentosReferenciados</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"serie"</span><span class="o">,</span><span class="s">"1"</span><span class="o">);</span>
        <span class="n">documentosReferenciados</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"subserie"</span><span class="o">,</span><span class="s">"1"</span><span class="o">);</span>
        <span class="n">documentosReferenciados</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor"</span><span class="o">,</span><span class="s">"1.00"</span><span class="o">);</span>

        <span class="cm">/* Depois de fazer o input dos dados, são criados os objetos JSON já com os valores das hash's. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">cte</span><span class="o">);</span>
        <span class="n">JSONObject</span> <span class="n">jsonSegurosCarga</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">segurosCarga</span><span class="o">);</span>
        <span class="n">JSONObject</span> <span class="n">jsonDocumentosReferenciados</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">documentosReferenciados</span><span class="o">);</span>

        <span class="cm">/* Aqui adicionamos os objetos JSON nos campos da API como array no JSON principal. */</span>
        <span class="n">json</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"segurosCarga"</span><span class="o">,</span> <span class="n">jsonSegurosCarga</span><span class="o">);</span>
        <span class="n">json</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"documentosReferenciados"</span><span class="o">,</span> <span class="n">jsonDocumentosReferenciados</span><span class="o">);</span>

        <span class="cm">/* É recomendado verificar como os dados foram gerados em JSON e se ele está seguindo a estrutura especificada em nossa documentação.*/</span>
        <span class="c1">//System.out.print(json);</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas a seguir exibem as informações retornadas pela nossa API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/cte?ref="</span> <span class="o">+</span> <span class="n">ref</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">cte</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">bairro_emitente: </span><span class="s2">"Sao Cristovao"</span><span class="p">,</span>
  <span class="ss">bairro_tomador: </span><span class="s2">"Bacacheri"</span><span class="p">,</span>
  <span class="ss">cep_emitente: </span><span class="s2">"99880077"</span><span class="p">,</span>
  <span class="ss">cep_tomador: </span><span class="s2">"88991188"</span><span class="p">,</span>
  <span class="ss">cfop: </span><span class="s2">"5353"</span><span class="p">,</span>
  <span class="ss">cnpj_emitente: </span><span class="s2">"51916585000125"</span><span class="p">,</span>
  <span class="ss">cnpj_tomador: </span><span class="s2">"51966818092777"</span><span class="p">,</span>
  <span class="ss">codigo_municipio_emitente: </span><span class="s2">"2927408"</span><span class="p">,</span>
  <span class="ss">codigo_municipio_envio: </span><span class="s2">"5200050"</span><span class="p">,</span>
  <span class="ss">codigo_municipio_fim: </span><span class="s2">"3100104"</span><span class="p">,</span>
  <span class="ss">codigo_municipio_inicio: </span><span class="s2">"5200050"</span><span class="p">,</span>
  <span class="ss">codigo_municipio_tomador: </span><span class="s2">"4106902"</span><span class="p">,</span>
  <span class="ss">codigo_pais_tomador: </span><span class="s2">"1058"</span><span class="p">,</span>
  <span class="ss">complemento_emitente: </span><span class="s2">"Andar 19 - sala 23"</span><span class="p">,</span>
  <span class="ss">data_emissao: </span><span class="s2">"2018-06-18T09:17:00"</span><span class="p">,</span>
  <span class="ss">descricao_servico: </span><span class="s2">"Descricao do seu servico aqui"</span><span class="p">,</span>
  <span class="ss">documentos_referenciados: </span><span class="p">[</span>
    <span class="p">{</span>  
      <span class="ss">data_emissao: </span><span class="s2">"2018-06-10"</span><span class="p">,</span>
      <span class="ss">numero: </span><span class="s2">"1"</span><span class="p">,</span>
      <span class="ss">serie: </span><span class="s2">"1"</span><span class="p">,</span>
      <span class="ss">subserie: </span><span class="s2">"1"</span><span class="p">,</span>
      <span class="ss">valor: </span><span class="s2">"1.00"</span>
    <span class="p">}</span>
  <span class="p">]</span>
  <span class="ss">funcionario_emissor: </span><span class="s2">"Nome do funcionario que fez a emissao"</span><span class="p">,</span>
  <span class="ss">icms_aliquota: </span><span class="s2">"17.00"</span><span class="p">,</span>
  <span class="ss">icms_base_calculo: </span><span class="s2">"1.00"</span><span class="p">,</span>
  <span class="ss">icms_situacao_tributaria: </span><span class="s2">"00"</span><span class="p">,</span>
  <span class="ss">icms_valor: </span><span class="s2">"0.17"</span><span class="p">,</span>
  <span class="ss">indicador_inscricao_estadual_tomador: </span><span class="s2">"9"</span><span class="p">,</span>
  <span class="ss">inscricao_estadual_emitente: </span><span class="s2">"12345678"</span><span class="p">,</span>
  <span class="ss">logradouro_emitente: </span><span class="s2">"Aeroporto Internacional de Salvador"</span><span class="p">,</span>
  <span class="ss">logradouro_tomador: </span><span class="s2">"Rua Joao Dalegrave"</span><span class="p">,</span>
  <span class="ss">modal: </span><span class="s2">"02"</span><span class="p">,</span>
  <span class="ss">municipio_emitente: </span><span class="s2">"Salvador"</span><span class="p">,</span>
  <span class="ss">municipio_envio: </span><span class="s2">"Abadia de Goias"</span><span class="p">,</span>
  <span class="ss">municipio_fim: </span><span class="s2">"Abadia dos Dourados"</span><span class="p">,</span>
  <span class="ss">municipio_inicio: </span><span class="s2">"Abadia de Goias"</span><span class="p">,</span>
  <span class="ss">municipio_tomador: </span><span class="s2">"Curitiba"</span><span class="p">,</span>
  <span class="ss">natureza_operacao: </span><span class="s2">"PREST. DE SERV. TRANSPORTE A ESTAB. COMERCIAL"</span><span class="p">,</span>
  <span class="ss">nome_emitente: </span><span class="s2">"ACME LTDA"</span><span class="p">,</span>
  <span class="ss">nome_fantasia_emitente: </span><span class="s2">"ACME"</span><span class="p">,</span>
  <span class="ss">nome_fantasia_tomador: </span><span class="s2">"Nome do tomador do servico aqui"</span><span class="p">,</span>
  <span class="ss">nome_tomador: </span><span class="s2">"NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="p">,</span>
  <span class="ss">numero_emitente: </span><span class="s2">"S/N"</span><span class="p">,</span>
  <span class="ss">numero_fatura: </span><span class="s2">"1"</span><span class="p">,</span>
  <span class="ss">numero_tomador: </span><span class="s2">"1"</span><span class="p">,</span>
  <span class="ss">pais_tomador: </span><span class="s2">"BRASIL"</span><span class="p">,</span>
  <span class="ss">quantidade: </span><span class="s2">"1.00"</span><span class="p">,</span>
  <span class="ss">seguros_carga: </span><span class="p">[</span>
    <span class="p">{</span>
      <span class="ss">nome_seguradora: </span><span class="s2">"Nome da seguradora aqui"</span><span class="p">,</span>
      <span class="ss">numero_apolice: </span><span class="s2">"12345"</span><span class="p">,</span>
      <span class="ss">responsavel_seguro: </span><span class="mi">4</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="ss">telefone_emitente: </span><span class="s2">"4133336666"</span><span class="p">,</span>
  <span class="ss">tipo_documento: </span><span class="mi">0</span><span class="p">,</span>
  <span class="ss">tipo_servico: </span><span class="mi">6</span><span class="p">,</span>
  <span class="ss">uf_emitente: </span><span class="s2">"BA"</span><span class="p">,</span>
  <span class="ss">uf_envio: </span><span class="s2">"GO"</span><span class="p">,</span>
  <span class="ss">uf_fim: </span><span class="s2">"MG"</span><span class="p">,</span>
  <span class="ss">uf_inicio: </span><span class="s2">"GO"</span><span class="p">,</span>
  <span class="ss">uf_tomador: </span><span class="s2">"PR"</span><span class="p">,</span>
  <span class="ss">valor_desconto_fatura: </span><span class="s2">"0.00"</span><span class="p">,</span>
  <span class="ss">valor_inss: </span><span class="s2">"0.10"</span><span class="p">,</span>
  <span class="ss">valor_liquido_fatura: </span><span class="s2">"1.00"</span><span class="p">,</span>
  <span class="ss">valor_original_fatura: </span><span class="s2">"1.00"</span><span class="p">,</span>
  <span class="ss">valor_receber: </span><span class="s2">"1.00"</span><span class="p">,</span>
  <span class="ss">valor_total: </span><span class="s2">"1.00"</span><span class="p">,</span>
  <span class="ss">valor_total_tributos: </span><span class="s2">"0.00"</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>

<span class="c1"># convertemos os dados da nota para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">cte</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight javascript tab-javascript"><code><span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interno do CTe.</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/cte_os?ref="</span> <span class="o">+</span> <span class="nx">ref</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API.
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">cte</span> <span class="o">=</span> <span class="p">{</span>  
   <span class="s2">"bairro_emitente"</span><span class="p">:</span><span class="s2">"S\u00e3o Cristov\u00e3o"</span><span class="p">,</span>
   <span class="s2">"bairro_tomador"</span><span class="p">:</span><span class="s2">"Bacacheri"</span><span class="p">,</span>
   <span class="s2">"cep_emitente"</span><span class="p">:</span><span class="s2">"99880077"</span><span class="p">,</span>
   <span class="s2">"cep_tomador"</span><span class="p">:</span><span class="s2">"88991188"</span><span class="p">,</span>
   <span class="s2">"cfop"</span><span class="p">:</span><span class="s2">"5353"</span><span class="p">,</span>
   <span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="s2">"51916585000125"</span><span class="p">,</span>
   <span class="s2">"cnpj_tomador"</span><span class="p">:</span><span class="s2">"51966818092777"</span><span class="p">,</span>
   <span class="s2">"codigo_municipio_emitente"</span><span class="p">:</span><span class="s2">"2927408"</span><span class="p">,</span>
   <span class="s2">"codigo_municipio_envio"</span><span class="p">:</span><span class="s2">"5200050"</span><span class="p">,</span>
   <span class="s2">"codigo_municipio_fim"</span><span class="p">:</span><span class="s2">"3100104"</span><span class="p">,</span>
   <span class="s2">"codigo_municipio_inicio"</span><span class="p">:</span><span class="s2">"5200050"</span><span class="p">,</span>
   <span class="s2">"codigo_municipio_tomador"</span><span class="p">:</span><span class="s2">"4106902"</span><span class="p">,</span>
   <span class="s2">"codigo_pais_tomador"</span><span class="p">:</span><span class="s2">"1058"</span><span class="p">,</span>
   <span class="s2">"complemento_emitente"</span><span class="p">:</span><span class="s2">"Andar 19 - sala 23"</span><span class="p">,</span>
   <span class="s2">"data_emissao"</span><span class="p">:</span><span class="s2">"2018-06-18T09:17:00"</span><span class="p">,</span>
   <span class="s2">"descricao_servico"</span><span class="p">:</span><span class="s2">"Descricao do seu servico aqui"</span><span class="p">,</span>
   <span class="s2">"documentos_referenciados"</span><span class="p">:[</span>  
      <span class="p">{</span>  
         <span class="s2">"data_emissao"</span><span class="p">:</span><span class="s2">"2018-06-10"</span><span class="p">,</span>
         <span class="s2">"numero"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span>
         <span class="s2">"serie"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span>
         <span class="s2">"subserie"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span>
         <span class="s2">"valor"</span><span class="p">:</span><span class="s2">"1.00"</span>
      <span class="p">}</span>
   <span class="p">],</span>
   <span class="s2">"funcionario_emissor"</span><span class="p">:</span><span class="s2">"Nome do funcionario que fez a emissao"</span><span class="p">,</span>
   <span class="s2">"icms_aliquota"</span><span class="p">:</span><span class="s2">"17.00"</span><span class="p">,</span>
   <span class="s2">"icms_base_calculo"</span><span class="p">:</span><span class="s2">"1.00"</span><span class="p">,</span>
   <span class="s2">"icms_situacao_tributaria"</span><span class="p">:</span><span class="s2">"00"</span><span class="p">,</span>
   <span class="s2">"icms_valor"</span><span class="p">:</span><span class="s2">"0.17"</span><span class="p">,</span>
   <span class="s2">"indicador_inscricao_estadual_tomador"</span><span class="p">:</span><span class="s2">"9"</span><span class="p">,</span>
   <span class="s2">"inscricao_estadual_emitente"</span><span class="p">:</span><span class="s2">"12345678"</span><span class="p">,</span>
   <span class="s2">"logradouro_emitente"</span><span class="p">:</span><span class="s2">"Aeroporto Internacional de Salvador"</span><span class="p">,</span>
   <span class="s2">"logradouro_tomador"</span><span class="p">:</span><span class="s2">"Rua Jo\u00e3o Dalegrave"</span><span class="p">,</span>
   <span class="s2">"modal"</span><span class="p">:</span><span class="s2">"02"</span><span class="p">,</span>
   <span class="s2">"municipio_emitente"</span><span class="p">:</span><span class="s2">"Salvador"</span><span class="p">,</span>
   <span class="s2">"municipio_envio"</span><span class="p">:</span><span class="s2">"Abadia de Goi\u00e1s"</span><span class="p">,</span>
   <span class="s2">"municipio_fim"</span><span class="p">:</span><span class="s2">"Abadia dos Dourados"</span><span class="p">,</span>
   <span class="s2">"municipio_inicio"</span><span class="p">:</span><span class="s2">"Abadia de Goi\u00e1s"</span><span class="p">,</span>
   <span class="s2">"municipio_tomador"</span><span class="p">:</span><span class="s2">"Curitiba"</span><span class="p">,</span>
   <span class="s2">"natureza_operacao"</span><span class="p">:</span><span class="s2">"PREST. DE SERV. TRANSPORTE A ESTAB. COMERCIAL"</span><span class="p">,</span>
   <span class="s2">"nome_emitente"</span><span class="p">:</span><span class="s2">"ACME LTDA"</span><span class="p">,</span>
   <span class="s2">"nome_fantasia_emitente"</span><span class="p">:</span><span class="s2">"ACME"</span><span class="p">,</span>
   <span class="s2">"nome_fantasia_tomador"</span><span class="p">:</span><span class="s2">"Nome do tomador do servico aqui"</span><span class="p">,</span>
   <span class="s2">"nome_tomador"</span><span class="p">:</span><span class="s2">"NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="p">,</span>
   <span class="s2">"numero_emitente"</span><span class="p">:</span><span class="s2">"S/N"</span><span class="p">,</span>
   <span class="s2">"numero_fatura"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span>
   <span class="s2">"numero_tomador"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span>
   <span class="s2">"pais_tomador"</span><span class="p">:</span><span class="s2">"BRASIL"</span><span class="p">,</span>
   <span class="s2">"quantidade"</span><span class="p">:</span><span class="s2">"1.00"</span><span class="p">,</span>
   <span class="s2">"seguros_carga"</span><span class="p">:[</span>  
      <span class="p">{</span>  
         <span class="s2">"nome_seguradora"</span><span class="p">:</span><span class="s2">"Nome da seguradora aqui"</span><span class="p">,</span>
         <span class="s2">"numero_apolice"</span><span class="p">:</span><span class="s2">"12345"</span><span class="p">,</span>
         <span class="s2">"responsavel_seguro"</span><span class="p">:</span><span class="mi">4</span>
      <span class="p">}</span>
   <span class="p">],</span>
   <span class="s2">"telefone_emitente"</span><span class="p">:</span><span class="s2">"4133336666"</span><span class="p">,</span>
   <span class="s2">"tipo_documento"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
   <span class="s2">"tipo_servico"</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span>
   <span class="s2">"uf_emitente"</span><span class="p">:</span><span class="s2">"BA"</span><span class="p">,</span>
   <span class="s2">"uf_envio"</span><span class="p">:</span><span class="s2">"GO"</span><span class="p">,</span>
   <span class="s2">"uf_fim"</span><span class="p">:</span><span class="s2">"MG"</span><span class="p">,</span>
   <span class="s2">"uf_inicio"</span><span class="p">:</span><span class="s2">"GO"</span><span class="p">,</span>
   <span class="s2">"uf_tomador"</span><span class="p">:</span><span class="s2">"PR"</span><span class="p">,</span>
   <span class="s2">"valor_desconto_fatura"</span><span class="p">:</span><span class="s2">"0.00"</span><span class="p">,</span>
   <span class="s2">"valor_inss"</span><span class="p">:</span><span class="s2">"0.10"</span><span class="p">,</span>
   <span class="s2">"valor_liquido_fatura"</span><span class="p">:</span><span class="s2">"1.00"</span><span class="p">,</span>
   <span class="s2">"valor_original_fatura"</span><span class="p">:</span><span class="s2">"1.00"</span><span class="p">,</span>
   <span class="s2">"valor_receber"</span><span class="p">:</span><span class="s2">"1.00"</span><span class="p">,</span>
   <span class="s2">"valor_total"</span><span class="p">:</span><span class="s2">"1.00"</span><span class="p">,</span>
   <span class="s2">"valor_total_tributos"</span><span class="p">:</span><span class="s2">"0.00"</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados do CTe e enviamos para API.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">cte</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>

<span class="c1">// Para ambiente de produção use a variável abaixo:
// $server = "https://api.focusnfe.com.br/";
</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interno do CTe.
</span><span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>

<span class="nv">$cte</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
   <span class="s2">"bairro_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"S\u00e3o Cristov\u00e3o"</span><span class="p">,</span>
   <span class="s2">"bairro_tomador"</span> <span class="o">=&gt;</span> <span class="s2">"Bacacheri"</span><span class="p">,</span>
   <span class="s2">"cep_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"99880077"</span><span class="p">,</span>
   <span class="s2">"cep_tomador"</span> <span class="o">=&gt;</span> <span class="s2">"88991188"</span><span class="p">,</span>
   <span class="s2">"cfop"</span> <span class="o">=&gt;</span> <span class="s2">"5353"</span><span class="p">,</span>
   <span class="s2">"cnpj_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"51916585000125"</span><span class="p">,</span>
   <span class="s2">"cnpj_tomador"</span> <span class="o">=&gt;</span> <span class="s2">"51966818092777"</span><span class="p">,</span>
   <span class="s2">"codigo_municipio_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"2927408"</span><span class="p">,</span>
   <span class="s2">"codigo_municipio_envio"</span> <span class="o">=&gt;</span> <span class="s2">"5200050"</span><span class="p">,</span>
   <span class="s2">"codigo_municipio_fim"</span> <span class="o">=&gt;</span> <span class="s2">"3100104"</span><span class="p">,</span>
   <span class="s2">"codigo_municipio_inicio"</span> <span class="o">=&gt;</span> <span class="s2">"5200050"</span><span class="p">,</span>
   <span class="s2">"codigo_municipio_tomador"</span> <span class="o">=&gt;</span> <span class="s2">"4106902"</span><span class="p">,</span>
   <span class="s2">"codigo_pais_tomador"</span> <span class="o">=&gt;</span> <span class="s2">"1058"</span><span class="p">,</span>
   <span class="s2">"complemento_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"Andar 19 - sala 23"</span><span class="p">,</span>
   <span class="s2">"data_emissao"</span> <span class="o">=&gt;</span> <span class="s2">"2018-06-18T09:17:00"</span><span class="p">,</span>
   <span class="s2">"descricao_servico"</span> <span class="o">=&gt;</span> <span class="s2">"Descricao do seu servico aqui"</span><span class="p">,</span>
   <span class="s2">"documentos_referenciados"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>  
      <span class="k">array</span> <span class="p">(</span>  
         <span class="s2">"data_emissao"</span> <span class="o">=&gt;</span> <span class="s2">"2018-06-10"</span><span class="p">,</span>
         <span class="s2">"numero"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
         <span class="s2">"serie"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
         <span class="s2">"subserie"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
         <span class="s2">"valor"</span> <span class="o">=&gt;</span> <span class="s2">"1.00"</span>
      <span class="p">)</span>
   <span class="p">),</span>
   <span class="s2">"funcionario_emissor"</span> <span class="o">=&gt;</span> <span class="s2">"Nome do funcionario que fez a emissao"</span><span class="p">,</span>
   <span class="s2">"icms_aliquota"</span> <span class="o">=&gt;</span> <span class="s2">"17.00"</span><span class="p">,</span>
   <span class="s2">"icms_base_calculo"</span> <span class="o">=&gt;</span> <span class="s2">"1.00"</span><span class="p">,</span>
   <span class="s2">"icms_situacao_tributaria"</span> <span class="o">=&gt;</span> <span class="s2">"00"</span><span class="p">,</span>
   <span class="s2">"icms_valor"</span> <span class="o">=&gt;</span> <span class="s2">"0.17"</span><span class="p">,</span>
   <span class="s2">"indicador_inscricao_estadual_tomador"</span> <span class="o">=&gt;</span> <span class="s2">"9"</span><span class="p">,</span>
   <span class="s2">"inscricao_estadual_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"12345678"</span><span class="p">,</span>
   <span class="s2">"logradouro_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"Aeroporto Internacional de Salvador"</span><span class="p">,</span>
   <span class="s2">"logradouro_tomador"</span> <span class="o">=&gt;</span> <span class="s2">"Rua Jo\u00e3o Dalegrave"</span><span class="p">,</span>
   <span class="s2">"modal"</span> <span class="o">=&gt;</span> <span class="s2">"02"</span><span class="p">,</span>
   <span class="s2">"municipio_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"Salvador"</span><span class="p">,</span>
   <span class="s2">"municipio_envio"</span> <span class="o">=&gt;</span> <span class="s2">"Abadia de Goi\u00e1s"</span><span class="p">,</span>
   <span class="s2">"municipio_fim"</span> <span class="o">=&gt;</span> <span class="s2">"Abadia dos Dourados"</span><span class="p">,</span>
   <span class="s2">"municipio_inicio"</span> <span class="o">=&gt;</span> <span class="s2">"Abadia de Goi\u00e1s"</span><span class="p">,</span>
   <span class="s2">"municipio_tomador"</span> <span class="o">=&gt;</span> <span class="s2">"Curitiba"</span><span class="p">,</span>
   <span class="s2">"natureza_operacao"</span> <span class="o">=&gt;</span> <span class="s2">"PREST. DE SERV. TRANSPORTE A ESTAB. COMERCIAL"</span><span class="p">,</span>
   <span class="s2">"nome_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"ACME LTDA"</span><span class="p">,</span>
   <span class="s2">"nome_fantasia_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"ACME"</span><span class="p">,</span>
   <span class="s2">"nome_fantasia_tomador"</span> <span class="o">=&gt;</span> <span class="s2">"Nome do tomador do servico aqui"</span><span class="p">,</span>
   <span class="s2">"nome_tomador"</span> <span class="o">=&gt;</span> <span class="s2">"NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span><span class="p">,</span>
   <span class="s2">"numero_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"S/N"</span><span class="p">,</span>
   <span class="s2">"numero_fatura"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
   <span class="s2">"numero_tomador"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
   <span class="s2">"pais_tomador"</span> <span class="o">=&gt;</span> <span class="s2">"BRASIL"</span><span class="p">,</span>
   <span class="s2">"quantidade"</span> <span class="o">=&gt;</span> <span class="s2">"1.00"</span><span class="p">,</span>
   <span class="s2">"seguros_carga"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>  
      <span class="k">array</span> <span class="p">(</span>  
         <span class="s2">"nome_seguradora"</span> <span class="o">=&gt;</span> <span class="s2">"Nome da seguradora aqui"</span><span class="p">,</span>
         <span class="s2">"numero_apolice"</span> <span class="o">=&gt;</span> <span class="s2">"12345"</span><span class="p">,</span>
         <span class="s2">"responsavel_seguro"</span> <span class="o">=&gt;</span> <span class="mi">4</span>
      <span class="p">)</span>
   <span class="p">),</span>
   <span class="s2">"telefone_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"4133336666"</span><span class="p">,</span>
   <span class="s2">"tipo_documento"</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
   <span class="s2">"tipo_servico"</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span>
   <span class="s2">"uf_emitente"</span> <span class="o">=&gt;</span> <span class="s2">"BA"</span><span class="p">,</span>
   <span class="s2">"uf_envio"</span> <span class="o">=&gt;</span> <span class="s2">"GO"</span><span class="p">,</span>
   <span class="s2">"uf_fim"</span> <span class="o">=&gt;</span> <span class="s2">"MG"</span><span class="p">,</span>
   <span class="s2">"uf_inicio"</span> <span class="o">=&gt;</span> <span class="s2">"GO"</span><span class="p">,</span>
   <span class="s2">"uf_tomador"</span> <span class="o">=&gt;</span> <span class="s2">"PR"</span><span class="p">,</span>
   <span class="s2">"valor_desconto_fatura"</span> <span class="o">=&gt;</span> <span class="s2">"0.00"</span><span class="p">,</span>
   <span class="s2">"valor_inss"</span> <span class="o">=&gt;</span> <span class="s2">"0.10"</span><span class="p">,</span>
   <span class="s2">"valor_liquido_fatura"</span> <span class="o">=&gt;</span> <span class="s2">"1.00"</span><span class="p">,</span>
   <span class="s2">"valor_original_fatura"</span> <span class="o">=&gt;</span> <span class="s2">"1.00"</span><span class="p">,</span>
   <span class="s2">"valor_receber"</span> <span class="o">=&gt;</span> <span class="s2">"1.00"</span><span class="p">,</span>
   <span class="s2">"valor_total"</span> <span class="o">=&gt;</span> <span class="s2">"1.00"</span><span class="p">,</span>
   <span class="s2">"valor_total_tributos"</span> <span class="o">=&gt;</span> <span class="s2">"0.00"</span>
<span class="p">);</span>

<span class="c1">// Inicia o processo de envio das informações usando o cURL
</span><span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/cte?ref="</span> <span class="o">.</span> <span class="nv">$ref</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$cte</span><span class="p">));</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>

<span class="c1">//As três linhas abaixo imprimem as informações retornadas pela API, aqui o seu sistema devera interpretar e lidar com o retorno.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>



</code></pre><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/cte_os"</span>

<span class="c"># Substituir pela sua identificação interno do CTe.</span>
<span class="n">ref</span> <span class="o">=</span> <span class="p">{</span><span class="s">"ref"</span><span class="p">:</span><span class="s">"12345"</span><span class="p">}</span>

<span class="n">token</span><span class="o">=</span><span class="s">"Token_obtido_no_cadastro_da_empresa"</span>

<span class="s">'''
Usamos dicionarios para armazenar os campos e valores que em seguida,
serao convertidos em JSON e enviados para nossa API.
'''</span>
<span class="n">cte_os</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">seguros_carga</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">documentos_referenciados</span> <span class="o">=</span><span class="p">{}</span>

<span class="n">cte_os</span><span class="p">[</span><span class="s">"bairro_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"S</span><span class="se">\u00e3</span><span class="s">o Cristov</span><span class="se">\u00e3</span><span class="s">o"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"bairro_tomador"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Bacacheri"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"cep_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"99880077"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"cep_tomador"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"88991188"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"cfop"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"5353"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"cnpj_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"51916585000125"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"cnpj_tomador"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"51966818092777"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"codigo_municipio_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"2927408"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"codigo_municipio_envio"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"5200050"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"codigo_municipio_fim"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"3100104"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"codigo_municipio_inicio"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"5200050"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"codigo_municipio_tomador"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"4106902"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"codigo_pais_tomador"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1058"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"complemento_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Andar 19 - sala 23"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"data_emissao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"2018-06-18T09:17:00"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"descricao_servico"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Descricao do seu servico aqui"</span>
<span class="n">documentos_referenciados</span><span class="p">[</span><span class="s">"data_emissao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"2018-06-10"</span>
<span class="n">documentos_referenciados</span><span class="p">[</span><span class="s">"numero"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">documentos_referenciados</span><span class="p">[</span><span class="s">"serie"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">documentos_referenciados</span><span class="p">[</span><span class="s">"subserie"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">documentos_referenciados</span><span class="p">[</span><span class="s">"valor"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"funcionario_emissor"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Nome do funcionario que fez a emissao"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"icms_aliquota"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"17.00"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"icms_base_calculo"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"icms_situacao_tributaria"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"00"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"icms_valor"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0.17"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"indicador_inscricao_estadual_tomador"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"9"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"inscricao_estadual_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"12345678"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"logradouro_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Aeroporto Internacional de Salvador"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"logradouro_tomador"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Rua Jo</span><span class="se">\u00e3</span><span class="s">o"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"modal"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"02"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"municipio_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Salvador"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"municipio_envio"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Abadia de Goi</span><span class="se">\u00e1</span><span class="s">s"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"municipio_fim"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Abadia dos Dourados"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"municipio_inicio"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Abadia de Goi</span><span class="se">\u00e1</span><span class="s">s"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"municipio_tomador"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Curitiba"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"natureza_operacao"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"PREST. DE SERV. TRANSPORTE A ESTAB. COMERCIAL"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"nome_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"ACME LTDA"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"nome_fantasia_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"ACME"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"nome_fantasia_tomador"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Nome do tomador do servico aqui"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"nome_tomador"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"numero_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"S/N"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"numero_fatura"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"numero_tomador"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"pais_tomador"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"BRASIL"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"quantidade"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">seguros_carga</span><span class="p">[</span><span class="s">"nome_seguradora"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Nome da seguradora aqui"</span>
<span class="n">seguros_carga</span><span class="p">[</span><span class="s">"numero_apolice"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"12345"</span>
<span class="n">seguros_carga</span><span class="p">[</span><span class="s">"responsavel_seguro"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"4"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"telefone_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"4133336666"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"tipo_documento"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"tipo_servico"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"6"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"uf_emitente"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"BA"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"uf_envio"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"GO"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"uf_fim"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"MG"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"uf_inicio"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"GO"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"uf_tomador"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"PR"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"valor_desconto_fatura"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0.00"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"valor_inss"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0.10"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"valor_liquido_fatura"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"valor_original_fatura"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"valor_receber"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"valor_total"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1.00"</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"valor_total_tributos"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"0.00"</span>

<span class="c"># Adicionamos os dados das variaveis seguros_carga e documentos_referenciados como listas ao dicionario principal.</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"seguros_carga"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">seguros_carga</span><span class="p">]</span>
<span class="n">cte_os</span><span class="p">[</span><span class="s">"documentos_referenciados"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">documentos_referenciados</span><span class="p">]</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cte_os</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API.</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre>
<p>Para enviar uma CTe utilize a URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Envia uma <strong>CTe</strong> para autorização:</p>

<p><code>https://api.focusnfe.com.br/v2/cte?ref=REFERENCIA</code></p>

<p>Utilize o comando <strong>HTTP POST</strong> para enviar a sua nota para nossa API. Envie como corpo do POST os dados em formato JSON da CTe.</p>

<p>Nesta etapa, é feita uma primeira validação dos dados da nota. Caso ocorra algum problema, por exemplo, algum campo faltante, formato incorreto
ou algum problema com o emitente a nota <strong>não será aceita para processamento</strong> e será devolvida a mensagem de erro apropriada. Veja a seção <a href="#introducao_erros">erros</a>.</p>

<p>Caso a nota seja validada corretamente, a nota será <strong>aceita para processamento</strong>. Isto significa que a nota irá para uma fila de processamento
onde eventualmente será processada (processamento assíncrono). Com isto, a nota poderá ser autorizada ou ocorrer um erro na autorização, de acordo com a validação da SEFAZ.</p>

<p>Para verificar se a nota já foi autorizada, você terá que efetuar uma <a href="#cte_consulta">consulta</a>.</p>

<p>Envia uma <strong>CTe OS</strong> para autorização:</p>

<p><code>https://api.focusnfe.com.br/v2/cte_os?ref=REFERENCIA</code></p>

<p>Utilize o comando <strong>HTTP POST</strong> para enviar a sua nota para nossa API.
Ao contrátio da CTe convencional, a CTe OS é processada de forma <strong>síncrona</strong>, na mesma requição em que os dados são enviadas.</p>
<h2 id='cte-e-cte-os_consulta'>Consulta</h2><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/cte/12345
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Consulta</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interno do CTe. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/cte/"</span><span class="o">+</span><span class="n">ref</span><span class="o">+</span><span class="s">"?completa=1"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/cte/"</span> <span class="o">+</span> <span class="n">ref</span> <span class="o">+</span> <span class="s2">"?completa=1"</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight javascript tab-javascript"><code><span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interno do CTe.</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/cte/"</span> <span class="o">+</span> <span class="nx">ref</span> <span class="o">+</span> <span class="s2">"?completa=1"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API.
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight php tab-php"><code>
<span class="cp">&lt;?php</span>

<span class="c1">// Substituir pela sua identificação interno do CTe.
</span><span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>

<span class="c1">// Para ambiente de produção use a variável abaixo:
// $server = "https://api.focusnfe.com.br";
</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>

<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/cte/"</span> <span class="o">.</span> <span class="nv">$ref</span><span class="o">.</span><span class="s2">"?completa=1"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>

<span class="c1">//As três linhas abaixo imprimem as informações retornadas pela API, aqui o seu sistema devera interpretar e lidar com o retorno.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/cte/"</span>

<span class="c"># Substituir pela sua identificação interno do CTe.</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"Token_obtido_no_cadastro_da_empresa"</span>

<span class="c"># Use este parametro para obter mais informacoes em suas consultas.</span>
<span class="n">completa</span> <span class="o">=</span> <span class="s">"completa=1"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">ref</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">completa</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API.</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre>
<p>Para consultar uma CTe utilize a URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Consultar as informações de uma CTe:</p>

<p><code>https://api.focusnfe.com.br/v2/cte/REFERENCIA?completa=(0|1)</code></p>

<p>Utilize o comando <strong>HTTP GET</strong> para consultar a sua nota para nossa API.</p>

<table><thead>
<tr>
<th>Parâmetro Opcional</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>completa = 0 ou 1</td>
<td>Habilita a API há mostrar campos adicionais na requisição de consulta.</td>
</tr>
</tbody></table>

<p>Campos de retorno:</p>

<ul>
<li><strong>cnpj_emitente</strong>: O CNPJ emitente da CTe (o CNPJ de sua empresa).</li>
<li><strong>ref</strong>:A referência da emissão.</li>
<li><strong>status</strong>: A situação da CTe, podendo ser:

<ul>
<li><strong>processando_autorizacao</strong>: A nota ainda está em processamento pela API. Você deverá aguardar o processamento pela SEFAZ.</li>
<li><strong>autorizado</strong>: A nota foi autorizada, neste caso é fornecido os dados completos da nota como chave e arquivos para download</li>
<li><strong>cancelado</strong>: O documento foi cancelado, neste caso é fornecido o caminho para download do XML de cancelamento (caminho_xml_cancelamento).</li>
<li><strong>erro_autorizacao</strong>: Houve um erro de autorização por parte da SEFAZ. A mensagem de erro você encontrará nos campos status_sefaz e mensagem_sefaz. É possível fazer o reenvio da nota com a mesma referência se ela estiver neste estado.</li>
<li><strong>denegado</strong>: O documento foi denegado. Uma SEFAZ pode denegar uma nota se houver algum erro cadastral nos dados do destinatário ou do emitente. A mensagem de erro você encontrará nos campos status_sefaz e mensagem_sefaz. Não é possível reenviar a nota caso este estado seja alcançado pois é gerado um número, série, chave de CTe e XML para esta nota. O XML deverá ser armazenado pelo mesmo período de uma nota autorizada ou cancelada.</li>
</ul></li>
<li><strong>status_sefaz</strong>: O status da nota na SEFAZ.</li>
<li><strong>mensagem_sefaz</strong>: Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>serie</strong>: A série da CTe, caso ela tenha sido autorizada.</li>
<li><strong>numero</strong>: O número da CTe, caso ela tenha sido autorizada.</li>
<li><strong>modelo</strong>: O modelo da CTe, caso ela tenha sido autorizada.</li>
<li><strong>chave_cte</strong>: A chave da CTe, caso ela tenha sido autorizada.</li>
<li><strong>caminho_xml_nota_fiscal</strong>: caso a nota tenha sido autorizada, retorna o caminho para download do XML.</li>
<li><strong>caminho_danfe</strong>: caso a nota tenha sido autorizada retorna o caminho para download do DACTe.</li>
<li><strong>caminho_xml</strong>: caso tenha sido emitida alguma carta de correção, aqui aparecerá o caminho para fazer o download do XML.</li>
<li><strong>caminho_xml_carta_correcao</strong>: caso tenha sido emitida alguma carta de correção, aqui aparecerá o caminho para fazer o download do XML da carta.</li>
<li><strong>caminho_xml_cancelamento</strong>: Caso a nota esteja cancelada, é fornecido o caminho para fazer o download do XML de cancelamento.</li>
</ul>

<p>Caso na requisição seja passado o parâmetro <code>completo=1</code> será adicionado mais 6 campos:</p>

<ul>
<li><strong>requisicao</strong>: Inclui os dados completos da requisição da CTe, da mesma forma que constam no XML da nota.</li>
<li><strong>protocolo</strong>: Inclui os dados completos do protocolo devolvido pela SEFAZ.</li>
<li><strong>requisicao_cancelamento</strong>: Inclui os dados completos da requisição de cancelamento da CTe.</li>
<li><strong>protocolo_cancelamento</strong>: Inclui os dados completos do protocolo devolvido pela SEFAZ.</li>
<li><strong>requisicao_carta_correcao</strong>: Inclui os dados completos da requisição de Carta de Correção Eletrônica da CTe.</li>
<li><strong>protocolo_carta_correcao</strong>: Inclui os dados completos do protocolo devolvido pela SEFAZ.</li>
</ul>

<blockquote>
<p>Exemplo de resposta da consulta de CTe:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"11111151000119"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ref123"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Autorizado o uso do CT-e"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CTe21111114611151000119570010000000111973476363"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"11"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"modelo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"57"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"caminho_xml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://focusnfe.s3-sa-east-1.amazonaws.com/arquivos_development/11111151000119/201805/XMLs/311110000007009_v03.00-protCTe.xml"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"caminho_xml_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://focusnfe.s3-sa-east-1.amazonaws.com/arquivos_development/11111151000119/201805/XMLs/311110000007012_v03.00-eventoCTe.xml"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Exemplo de resposta com o parâmetro, completa, recebendo o valor &quot;1&quot;:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">

  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"11111151000119"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ref123"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Autorizado o uso do CT-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"chave"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CTe21111114611151000119570010000000111973476363"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"11"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"modelo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"57"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://focusnfe.s3-sa-east-1.amazonaws.com/arquivos_development/11111151000119/201805/XMLs/311110000007009_v03.00-protCTe.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://focusnfe.s3-sa-east-1.amazonaws.com/arquivos_development/11111151000119/201805/XMLs/311110000007012_v03.00-eventoCTe.xml"</span><span class="w">
  </span><span class="s2">"requisicao"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="err">/*</span><span class="w"> </span><span class="err">campos</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">CTe</span><span class="w"> </span><span class="err">aqui</span><span class="w"> </span><span class="err">omitida</span><span class="w"> </span><span class="err">*/</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="s2">"protocolo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"versao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"id_tag"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CTe329180000007009"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ambiente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"versao_aplicativo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RS20180430143216"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave"</span><span class="p">:</span><span class="w"> </span><span class="s2">"21111114611151000119570010000000111973476363"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_recimento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-05-10T15:23:36-03:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"protocolo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"329180000007009"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"digest_value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PsPzcf7bCOwvNW+v2F+ZAzJPXJE="</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"motivo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Autorizado o uso do CT-e"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"requisicao_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"versao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"id_tag"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID21111114611151000119570010000000111973476363"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_orgao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"29"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ambiente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="w"> </span><span class="s2">"14674451000119"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave_cte"</span><span class="p">:</span><span class="w"> </span><span class="s2">"21111114611151000119570010000000111973476363"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-05-10T16:25:42-03:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tipo_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"110110"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero_sequencial_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"versao_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.00"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"protocolo_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"versao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"id_tag"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID329180000007012"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ambiente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"versao_aplicativo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RS20171205135830"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_orgao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"29"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"motivo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a CT-e"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave_cte"</span><span class="p">:</span><span class="w"> </span><span class="s2">"21111114611151000119570010000000111973476363"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tipo_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"110110"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Carta Correção Registrada"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero_sequencial_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_evento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-05-10T16:25:43-03:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"protocolo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"329180000007012"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='cte-e-cte-os_cancelamento'>Cancelamento</h2><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cancelar</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interno do CTe. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/cte/"</span><span class="o">+</span><span class="n">ref</span><span class="o">);</span>
        <span class="cm">/* Aqui criamos um hashmap para receber a chave "justificativa" e o valor desejado. */</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">justificativa</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">justificativa</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"justificativa"</span><span class="o">,</span> <span class="s">"Informe aqui a sua justificativa para realizar o cancelamento da NFe."</span><span class="o">);</span>

        <span class="cm">/* Criamos um objeto JSON para receber a hash com os dados esperado pela API. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">justificativa</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

       <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
        * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/cte/"</span> <span class="o">+</span> <span class="n">ref</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">justificativa_cancelamento</span> <span class="o">=</span> <span class="p">{</span>  
  <span class="ss">justificativa: </span><span class="s2">"Informe aqui a sua justificativa para realizar o cancelamento da NFe."</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Delete a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Delete</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos a hash de justificativa do cancelamento para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">justificativa_cancelamento</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight javascript tab-javascript"><code><span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interno do CTe.</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/cte/"</span><span class="o">+</span> <span class="nx">ref</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da AP
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'DELETE'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">cancelar</span> <span class="o">=</span> <span class="p">{</span>

  <span class="s2">"justificativa"</span><span class="p">:</span> <span class="s2">"Sua justificativa aqui!"</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com o campo de cancelamento e enviamos para API.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">cancelar</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>

<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>

<span class="c1">// Substituir pela sua identificação interno do CTe.
</span><span class="nv">$ref</span>   <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="c1">// Para ambiente de produção use a variável abaixo:
// $server = "https://api.focusnfe.com.br";
</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>

<span class="nv">$justificativa</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span><span class="s2">"justificativa"</span> <span class="o">=&gt;</span> <span class="s2">"A sua justificativa de cancelamento aqui."</span><span class="p">);</span>

<span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>

<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span> <span class="o">.</span> <span class="s2">"/v2/cte/"</span> <span class="o">.</span> <span class="nv">$ref</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_CUSTOMREQUEST</span><span class="p">,</span> <span class="s2">"DELETE"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$justificativa</span><span class="p">));</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>

<span class="c1">//As três linhas abaixo imprimem as informações retornadas pela API, aqui o seu sistema devera interpretar e lidar com o retorno.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$result</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>

</code></pre><pre class="highlight python tab-python"><code>
<span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/cte/"</span>

<span class="c"># Substituir pela sua identificação interno do CTe.</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"Token_obtido_no_cadastro_da_empresa"</span>

<span class="s">'''
Usamos um dicionario para armazenar os campos e valores que em seguida,
serao convertidos a JSON e enviados para nossa API.
'''</span>
<span class="n">justificativa</span><span class="o">=</span><span class="p">{}</span>
<span class="n">justificativa</span><span class="p">[</span><span class="s">"justificativa"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Sua justificativa aqui!"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">justificativa</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API.</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X DELETE -d <span class="s1">'{"justificativa":"Teste de cancelamento de nota"}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/cte/12345
</code></pre>
<blockquote>
<p>Resposta da API para a requisição de cancelamento:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a CT-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cancelado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://focusnfe.s3-sa-east-1.amazonaws.com/arquivos_development/14674451000119/201805/XMLs/329180000006929_v03.00-eventoCTe.xml"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Para cancelar uma CTe, basta fazer uma requisição à URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Cancelar uma CTe já autorizada:</p>

<p><code>https://api.focusnfe.com.br/v2/cte/REFERENCIA</code></p>

<p>Utilize o comando <strong>HTTP DELETE</strong> para cancelar a sua nota para nossa API. Este método é síncrono, ou seja, a comunicação com a SEFAZ será feita imediatamente e devolvida a resposta na mesma requisição.</p>

<p>O parâmetro de cancelamento deverá ser enviado da seguinte forma:</p>

<ul>
<li><strong>justificativa</strong>: Justificativa do cancelamento. Deverá conter de 15 a 255 caracteres.</li>
</ul>

<p>A API irá em seguida devolver os seguintes campos:</p>

<ul>
<li><strong>status</strong>: cancelado, se a nota pode ser cancelada, ou erro_cancelamento, se houve algum erro ao cancelar a nota.</li>
<li><strong>status_sefaz</strong>: O status do cancelamento na SEFAZ.</li>
<li><strong>mensagem_sefaz</strong>: Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>caminho_xml</strong>: Caso a nota tenha sido cancelada, será informado aqui o caminho para download do XML de cancelamento.</li>
</ul>
<h3 id='cte-e-cte-os_prazo-de-cancelamento'>Prazo de cancelamento</h3>
<p>A CTe poderá ser cancelada em até 7 dias após a emissão, na maioria dos Estados.</p>
<h2 id='cte-e-cte-os_carta-de-correcao-eletronica'>Carta de Correção Eletrônica</h2>
<p>Uma Carta de Correção eletrônica (CCe) pode ser utilizada para corrigir eventuais erros na CTe. As seguintes informações <strong>não podem ser corrigidas</strong>:</p>

<ul>
<li>As variáveis que determinam o valor do imposto tais como: base de cálculo, alíquota, diferença de preço, quantidade, valor da operação ou da prestação;</li>
<li>A correção de dados cadastrais que implique mudança do remetente ou do destinatário;</li>
<li>A data de emissão ou de saída.</li>
</ul>

<p>Não existe prazo especificado para emissão de cartas de correção. É possível enviar até 20 correções diferentes, sendo que será válido sempre a última correção enviada.</p>
<h3 id='cte-e-cte-os_emissao-de-cce'>Emissão de CCe</h3><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmitirCce</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interno do CTe. */</span>
        <span class="n">String</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/cte/"</span><span class="o">+</span><span class="n">ref</span><span class="o">+</span><span class="s">"/carta_correcao"</span><span class="o">);</span>

        <span class="cm">/* Aqui criamos um hashmap para receber a chave "correcao" e o valor desejado. */</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">correcao</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">correcao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"campo_corrigido"</span><span class="o">,</span> <span class="s">"uf_inicio"</span><span class="o">);</span>
        <span class="n">correcao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"valor_corrigido"</span><span class="o">,</span> <span class="s">"PR"</span><span class="o">);</span>

        <span class="cm">/* Criamos um objeto JSON para receber a hash com os dados esperado pela API. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">correcao</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

       <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
        * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># referência da nota - deve ser única para cada nota enviada</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s2">"id_referencia_nota"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/cte/"</span> <span class="o">+</span> <span class="n">ref</span> <span class="o">+</span> <span class="s2">"/carta_correcao"</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">correcao</span> <span class="o">=</span> <span class="p">{</span>  
  <span class="ss">campo_correcao: </span><span class="s2">"Informe aqui o titulo do campo que será corrigido na CTe."</span><span class="p">,</span>
  <span class="ss">valor_correcao: </span><span class="s2">"Informe aqui o valor para o campo que será corrigido."</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos a hash de justificativa do cancelamento para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">correcao</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight javascript tab-javascript"><code><span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interno do CTe.</span>
<span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">cce</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"campo_corrigido"</span><span class="p">:</span> <span class="s2">"uf_inicio"</span><span class="p">,</span> <span class="s2">"valor_corrigido"</span><span class="p">:</span> <span class="s2">"PR"</span><span class="p">};</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/cte/"</span><span class="o">+</span> <span class="nx">ref</span> <span class="o">+</span> <span class="s2">"/carta_correcao"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API.
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os campos de CCe e enviamos para API.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">cce</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>

<span class="c1">// Para ambiente de produção use a variável abaixo:
// $server = "https://api.focusnfe.com.br";
</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>

<span class="c1">// Substituir pela sua identificação interno do CTe.
</span><span class="nv">$ref</span> <span class="o">=</span> <span class="s2">"12345"</span><span class="p">;</span>

<span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>

<span class="nv">$correcao</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
  <span class="s2">"campo_corrigido"</span> <span class="o">=&gt;</span> <span class="s2">"uf_inicio"</span><span class="p">,</span>
  <span class="s2">"valor_corrigido"</span> <span class="o">=&gt;</span> <span class="s2">"PR"</span>
<span class="p">);</span>

<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span> <span class="o">.</span> <span class="s2">"/v2/cte/"</span> <span class="o">.</span> <span class="nv">$ref</span>  <span class="o">.</span> <span class="s2">"/carta_correcao"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$correcao</span><span class="p">));</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>

<span class="c1">//As três linhas abaixo imprimem as informações retornadas pela API, aqui o seu sistema devera interpretar e lidar com o retorno.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/cte/"</span>

<span class="c"># Substituir pela sua identificação interno do CTe.</span>
<span class="n">ref</span> <span class="o">=</span> <span class="s">"12345"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"Token_obtido_no_cadastro_da_empresa"</span>

<span class="s">'''
Usamos um dicionario para armazenar os campos e valores que em seguida,
serao convertidos a JSON e enviados para nossa API.
'''</span>
<span class="n">cce</span> <span class="o">=</span> <span class="p">{</span><span class="s">"campo_corrigido"</span><span class="p">:</span> <span class="s">"uf_inicio"</span><span class="p">,</span> <span class="s">"valor_corrigido"</span><span class="p">:</span> <span class="s">"PR"</span><span class="p">}</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">ref</span><span class="o">+</span><span class="s">"/carta_correcao"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cce</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API.</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -d <span class="s1">'{"campo_corrigido":"observacoes","valor_corrigido":"Nova observação"}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/cte/12345/carta_correcao
</code></pre>
<blockquote>
<p>Resposta da API para a requisição de CCe:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a CT-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://focusnfe.s3-sa-east-1.amazonaws.com/arquivos_development/11111151000119/201805/XMLs/321110000006913_v03.00-eventoCTe.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>
<p><code>https://api.focusnfe.com.br/v2/cte/REFERENCIA/carta_correcao</code></p>

<p>Utilize o comando <strong>HTTP POST</strong> para enviar a sua correção para nossa API. Este método é <strong>síncrono</strong>, ou seja, a comunicação com a SEFAZ será feita imediatamente e devolvida a resposta na mesma requisição.</p>

<p>Ao contrário da NFe, na CTe é obrigatório informar especificamente o campo que será alterado. Você poderá usar os próprios nomes
dos campos da API.</p>

<p>O parâmetros da carta de correção deverão ser enviados da seguinte forma:</p>

<ul>
<li><strong>grupo_corrigido</strong>: Opcional. Indica o grupo onde se encontra o campo, por exemplo &quot;cargas&quot;. Pode ser omitido se não houver grupo relacionado.</li>
<li><strong>campo_corrigido</strong>: Indica o campo a ser corrigido.</li>
<li><strong>valor_corrigido</strong>: Indica o novo valor do campo.</li>
<li><strong>numero_item_grupo_corrigido</strong>: Opcional. Caso o campo pertença a uma lista de itens, o número do item a ser corrigido é informado aqui. O primeiro número começa em 1.</li>
<li><strong>campo_api</strong>: Opcional. Se igual a 1 será usado o nome do campo da API nos campos &#39;grupo_corrigido&#39; e &#39;campo_corrigido&#39;. Se igual a 0 você deverá informar a tag XML. Valor default é 1.</li>
</ul>

<p>A API irá em seguida devolver os seguintes campos:</p>

<ul>
<li><strong>status</strong>: autorizado, se a carta de correção foi aceita pela SEFAZ, ou erro_autorizacao, se houve algum erro ao cancelar a nota.</li>
<li><strong>status_sefaz</strong>: O status da carta de correção na SEFAZ.</li>
<li><strong>mensagem_sefaz</strong>: Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>caminho_xml</strong>: Informa o caminho do XML da carta de correção, caso ela tenha sido autorizada.</li>
<li><strong>numero_carta_correcao</strong>: Informa o número da carta de correção, caso ela tenha sido autorizada.</li>
</ul>

<p>Para uma mesma CTe é possível enviar mais de uma carta de correção, sendo que a última sempre substitui a anterior.</p>
<h2 id='cte-e-cte-os_inutilizacao'>Inutilização</h2><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Inutilizar</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JSONException</span><span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/cte/inutilizacao"</span><span class="o">);</span>

        <span class="cm">/* Aqui criamos um hash que irá receber as chaves e valores esperados para gerar a inutilização. */</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">dadosInutilizacao</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cnpj"</span><span class="o">,</span> <span class="s">"51916585000125"</span><span class="o">);</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"serie"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero_inicial"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"numero_final"</span><span class="o">,</span> <span class="s">"3"</span><span class="o">);</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"justificativa"</span><span class="o">,</span> <span class="s">"Informe aqui a justificativa para realizar a inutilizacao da numeracao."</span><span class="o">);</span>
        <span class="n">dadosInutilizacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"modelo"</span><span class="o">,</span> <span class="s">"67"</span><span class="o">);</span>

        <span class="cm">/* Criamos um objeto JSON que irá receber o input dos dados, para então enviar a requisição. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">dadosInutilizacao</span><span class="o">);</span>

        <span class="cm">/* Testar se o JSON gerado está dentro do formato esperado.
        System.out.print(json); */</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

         <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
          * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/cte/inutilizacao"</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">dados_inutilizacao</span> <span class="o">=</span> <span class="p">{</span>  
  <span class="ss">cnpj: </span><span class="s2">"51916585000125"</span><span class="p">,</span>
  <span class="ss">serie: </span><span class="s2">"1"</span><span class="p">,</span>
  <span class="ss">numero_inicial: </span><span class="s2">"1"</span><span class="p">,</span>
  <span class="ss">numero_final: </span><span class="s2">"3"</span><span class="p">,</span>
  <span class="ss">justificativa: </span><span class="s2">"Informe aqui a justificativa para realizar a inutilizacao da numeracao."</span><span class="p">,</span>
  <span class="ss">modelo: </span><span class="s2">"67"</span>
<span class="p">}</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos a hash de justificativa do cancelamento para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">dados_inutilizacao</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight javascript tab-javascript"><code><span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/cte/inutilizacao"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">inutiliza</span> <span class="o">=</span> <span class="p">{</span>
<span class="s2">"cnpj"</span><span class="p">:</span> <span class="s2">"14674451000119"</span><span class="p">,</span>
<span class="s2">"serie"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
<span class="s2">"numero_inicial"</span><span class="p">:</span> <span class="s2">"700"</span><span class="p">,</span>
<span class="s2">"numero_final"</span><span class="p">:</span> <span class="s2">"703"</span><span class="p">,</span>
<span class="s2">"justificativa"</span><span class="p">:</span> <span class="s2">"Teste de inutilizacao de nota"</span><span class="p">,</span>
<span class="s2">"modelo"</span><span class="p">:</span> <span class="mi">67</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os de inutilizacao e enviamos para API.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">inutiliza</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>

<span class="c1">// Para ambiente de produção use a variável abaixo:
// $server = "https://api.focusnfe.com.br";
</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>

<span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>

<span class="nv">$inutiliza</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
  <span class="s2">"cnpj"</span> <span class="o">=&gt;</span> <span class="s2">"51916585000125"</span><span class="p">,</span>
  <span class="s2">"serie"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
  <span class="s2">"numero_inicial"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
  <span class="s2">"numero_final"</span> <span class="o">=&gt;</span> <span class="s2">"3"</span><span class="p">,</span>
  <span class="s2">"justificativa"</span> <span class="o">=&gt;</span> <span class="s2">"A sua justificativa de cancelamento aqui."</span><span class="p">,</span>
  <span class="s2">"modelo"</span> <span class="o">=&gt;</span> <span class="mi">67</span>  
<span class="p">);</span>

<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/cte/inutilizacao"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$inutiliza</span><span class="p">));</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>

<span class="c1">//As três linhas abaixo imprimem as informações retornadas pela API, aqui o seu sistema devera interpretar e lidar com o retorno.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>



</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/cte/inutilizacao"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"Token_obtido_no_cadastro_da_empresa"</span>

<span class="s">'''
Usamos um dicionario para armazenar os campos e valores que em seguida,
serao convertidos a JSON e enviados para nossa API.
'''</span>
<span class="n">inutilizacao</span><span class="o">=</span><span class="p">{}</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"cnpj"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"51916585000125"</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"serie"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"numero_inicial"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"numero_final"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"3"</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"justificativa"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Justificativa da inutilizacao minimo 15 caracteres"</span>
<span class="n">inutilizacao</span><span class="p">[</span><span class="s">"modelo"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"67"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">inutilizacao</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API.</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre>
<blockquote>
<p>Resposta da API para a requisição de inutilização:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"102"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Inutilizacao de numero homologado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_inicial"</span><span class="p">:</span><span class="w"> </span><span class="s2">"800"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero_final"</span><span class="p">:</span><span class="w"> </span><span class="s2">"801"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://focusnfe.s3-sa-east-1.amazonaws.com/arquivos_development/11111353000900/207701/XMLs/999992335309999955003000000800000000801-inu.xml"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Em uma situação normal você não precisará informar ao SEFAZ a inutilização de um número da CTe, pois a API controla automaticamente a numeração das notas. Porém, se por alguma situação específica for necessário a inutilização de alguma faixa de números você poderá chamar as seguintes operações:</p>

<p>Envio de inutilização de faixa de numeração:</p>

<p><code>https://api.focusnfe.com.br/v2/cte/inutilizacao</code></p>

<p>Utilize o comando <strong>HTTP POST</strong> para enviar a sua inutilização para nossa API. Este método é <strong>síncrono</strong>, ou seja, a comunicação com a SEFAZ será feita imediatamente e devolvida a resposta na mesma requisição.</p>

<p>A inutilização precisa dos seguintes parâmetros obrigatórios:</p>

<ul>
<li><strong>cnpj</strong>: CNPJ da empresa emitente</li>
<li><strong>serie</strong>: Série da numeração da CTe que terá uma faixa de numeração inutilizada</li>
<li><strong>numero_inicial</strong>: Número inicial a ser inutilizado</li>
<li><strong>numero_final</strong>: Número final a ser inutilizado</li>
<li><strong>justificativa</strong>: Justificativa da inutilização (mínimo 15 caracteres)</li>
<li><strong>modelo</strong>: Informe o modelo da CTe. Se igual a 57 será a CTe normal, se igual a 67 será a CTe OS. Valor default é 57.</li>
</ul>

<p>A API irá enviar uma resposta com os seguintes campos:</p>

<ul>
<li><strong>status</strong>: autorizado, se a inutilização foi aceita pela SEFAZ, ou erro_autorizacao, se houve algum erro ao inutilizar os números.</li>
<li><strong>status_sefaz</strong>: O status da carta de correção na SEFAZ.</li>
<li><strong>mensagem_sefaz</strong>: Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>serie</strong>: Série da numeração da CTe que terá uma faixa de numeração inutilizada</li>
<li><strong>numero_inicial</strong>: Número inicial a ser inutilizado</li>
<li><strong>numero_final</strong>: Número final a ser inutilizado</li>
<li><strong>caminho_xml</strong>: Caminho do XML para download caso a inutilização tenha sido autorizada pela SEFAZ.</li>
</ul>
<h1 id='mdf-e-beta_mdf-e-beta'>MDF-e (beta)</h1>
<p>A MDF-e (Manifesto Eletrônico de Documentos Fiscais) é utilizada para rastrear a circulação física da carga em transportes interestaduais, transporte de carga fracionada ou por transporte de bens que utilizam mais de uma NFe.</p>

<p>As seguintes operações estão disponíveis:</p>

<ul>
<li>Emissão de MDF-e com geração da DAMDF-e</li>
<li>Inclusão de condutor</li>
<li>Cancelamento de MDF-e</li>
<li>Encerramento de MDF-e</li>
</ul>

<p>Através da API MDF-e é possível:</p>

<ul>
<li>Emitir MDF-e (Conhecimento de Transporte Eletrônico) utilizando dados simplificados. Este processo é <strong>assíncrono</strong>. Ou seja, após a emissão a nota será enfileirada para processamento.</li>
<li>Cancelar uma MDF-e</li>
<li>Consultar o status de MDF-e emitidas.</li>
<li>Emitir os eventos: inclusão de condutor e encerramento.</li>
</ul>
<h2 id='mdf-e-beta_urls'>URLs</h2>
<table><thead>
<tr>
<th>Método</th>
<th>URL (recurso)</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>POST</td>
<td>/v2/mdfe?ref=REFERENCIA</td>
<td>Cria uma MDF-e e envia para processamento.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/mdfe/REFERENCIA</td>
<td>Consulta a MDF-e com a referência informada e o seu status de processamento</td>
</tr>
<tr>
<td>DELETE</td>
<td>/v2/mdfe/REFERENCIA</td>
<td>Cancela uma MDF-e com a referência informada</td>
</tr>
<tr>
<td>POST</td>
<td>/v2/mdfe/REFERENCIA/inclusao_condutor</td>
<td>Inclui um novo condutor.</td>
</tr>
<tr>
<td>POST</td>
<td>/v2/mdfe/REFERENCIA/encerramento</td>
<td>Encerra uma MDF-e</td>
</tr>
</tbody></table>
<h2 id='mdf-e-beta_campos-de-um-mdf-e'>Campos de um MDF-e</h2>
<blockquote>
<p>Abaixo um exemplo de dados de uma MDF-e:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="s2">"modal_aereo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"marca_nacionalidade_aeronave"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ABCD"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"marca_matricula_aeronave"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123456"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero_voo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AB1234"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"aerodromo_embarque"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OACI"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"aerodromo_destino"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OACI"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_voo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-15"</span><span class="w">

  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"tipo_transporte"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"modo_transporte"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data_emissao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-01-30"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"uf_inicio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BA"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"uf_fim"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PR"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"municipios_carregamento"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2927408"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"nome"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Salvador"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"percursos"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"uf_percurso"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PR"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"data_hora_previsto_inicio_viagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-01-16"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"22274451000119"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"inscricao_estadual_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"25231737"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"municipios_descarregamento"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4119152"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"nome"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pinhais"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"conhecimentos_transporte"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"chave_cte"</span><span class="p">:</span><span class="w"> </span><span class="s2">"21111100317911000149570011000000051123456786"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"quantidade_total_cte"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"valor_total_carga"</span><span class="p">:</span><span class="w"> </span><span class="s2">"20000.00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"codigo_unidade_medida_peso_bruto"</span><span class="p">:</span><span class="w"> </span><span class="s2">"01"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"peso_bruto"</span><span class="p">:</span><span class="w"> </span><span class="s2">"11.0000"</span><span class="w">
</span><span class="p">}</span><span class="w">


</span></code></pre>
<p>Abaixo você poderá consultar os campos da MDF-e. Nesta página, você pode buscar os campos pela TAG XML ou pela nossa tradução para API.</p>

<p><a href="https://focusnfe.com.br/dsl/mdfe3.0/MDFeXML.html">Documentação completa dos campos MDF-e</a></p>

<p>Além dos campos descritos acima, cada MDF-e deverá obrigatoriamente informar um <strong>modal</strong>, que é a forma de transporte da carga. Você deverá informar uma das seguintes chaves nos dados, clique em cada link para visualizar os campos completos:</p>

<ul>
<li>modal_rodoviario <a href="https://focusnfe.com.br/dsl/mdfe3.0/TransporteRodoviarioXML.html">para transporte rodoviário.</a></li>
<li>modal_aereo <a href="https://focusnfe.com.br/dsl/mdfe3.0/TransporteAereoXML.html">para transporte aéreo.</a></li>
<li>modal_aquaviario <a href="https://focusnfe.com.br/dsl/mdfe3.0/TransporteAquaviarioXML.html">para transporte aquaviário.</a></li>
<li>modal_ferroviario <a href="https://focusnfe.com.br/dsl/mdfe3.0/TransporteFerroviarioXML.html">para transporte ferroviário.</a></li>
</ul>
<h2 id='mdf-e-beta_status-api'>Status API</h2>
<p>Aqui você encontra os status possíveis</p>

<table><thead>
<tr>
<th>HTTP CODE/STATUS</th>
<th>Status API Focus</th>
<th>Descrição</th>
<th>Correção</th>
</tr>
</thead><tbody>
<tr>
<td>422 - unprocessable entity</td>
<td>erro_validacao_schema</td>
<td>Erro na validação do Schema XML</td>
<td>Verifique o detalhamento do erro na resposta da API.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>forma_emissao_invalida</td>
<td>A forma de emissão utilizada é inválida</td>
<td>As formas de emissão disponíveis estão contidas na documentação da API.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>campos_invalidos</td>
<td>OCampo &#39;X não é válido</td>
<td>Onde X é o nome do campo inválido. Verifique a documentação dos campos da API para MDF-e.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>campos_invalidos_modal</td>
<td>Esse status indica erros nos campos do modal usado. Verifique os campos informados e compare com a nossa documentação de campos.</td>
<td></td>
</tr>
<tr>
<td>400 - bad request</td>
<td>empresa_nao_habilitada</td>
<td>Empresa ainda não habilitada para emissão de MDF-e</td>
<td>Verifique o cadastro do emitente no Painel API, deve-se habilitar MDF-e para começar a emitir este documento.</td>
</tr>
<tr>
<td>409 - conflict</td>
<td>mdfe_ja_autorizado</td>
<td>Já existe um MDF-e autorizado utilizando esta referência</td>
<td>Altere a referência da requisição e tente novamente.</td>
</tr>
<tr>
<td>409 - conflict</td>
<td>mdfe_em_processamento</td>
<td>Já existe um MDF-e utilizando essa referencia e ele está em processamento</td>
<td>Altere a referência da requisição e tente novamente.</td>
</tr>
<tr>
<td>404 - not found</td>
<td>nao_encontrado</td>
<td>MDF-e não encontrado</td>
<td>MDF-e informado na requisição não foi encontrado.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>Sua requisição é inválida porque alguns dos paramêtros básicos não foram cumpridos. Entre em contato com o nosso suporte.</td>
<td></td>
</tr>
</tbody></table>
<h2 id='mdf-e-beta_envio'>Envio</h2><pre class="highlight shell tab-shell"><code><span class="c"># arquivo.json deve conter os dados da MDF-e</span>
curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -T arquivo.json https://homologacao.focusnfe.com.br/v2/mdfe?ref<span class="o">=</span>12345
</code></pre>
<p>Para enviar uma MDF-e utilize a URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Envia uma <strong>MDF-e</strong> para autorização:</p>

<p><code>https://api.focusnfe.com.br/v2/mdfe?ref=REFERENCIA</code></p>

<p>Utilize o comando <strong>HTTP POST</strong> para enviar a sua nota para nossa API. Envie como corpo do POST os dados em formato JSON da MDF-e.</p>

<p>Nesta etapa, é feita uma primeira validação dos dados da nota. Caso ocorra algum problema, por exemplo, algum campo faltante, formato incorreto
ou algum problema com o emitente a nota <strong>não será aceita para processamento</strong> e será devolvida a mensagem de erro apropriada. Veja a seção <a href="#introducao_erros">erros</a>.</p>

<p>Caso a nota seja validada corretamente, a nota será <strong>aceita para processamento</strong>. Isto significa que a nota irá para uma fila de processamento
onde eventualmente será processada (processamento assíncrono). Com isto, a nota poderá ser autorizada ou ocorrer um erro na autorização, de acordo com a validação da SEFAZ.</p>

<p>Para verificar se a nota já foi autorizada, você terá que efetuar uma <a href="#mdfe_consulta">consulta</a>.</p>
<h2 id='mdf-e-beta_consulta'>Consulta</h2><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/mdfe/12345
</code></pre>
<p>Para consultar uma MDF-e utilize a URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Consultar as informações de uma MDF-e:</p>

<p><code>https://api.focusnfe.com.br/v2/mdfe/REFERENCIA?completa=(0|1)</code></p>

<p>Utilize o comando <strong>HTTP GET</strong> para consultar a sua nota para nossa API.</p>

<table><thead>
<tr>
<th>Parâmetro Opcional</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>completa = 0 ou 1</td>
<td>Habilita a API há mostrar campos adicionais na requisição de consulta.</td>
</tr>
</tbody></table>

<p>Campos de retorno:</p>

<ul>
<li><strong>cnpj_emitente</strong>: O CNPJ emitente da MDF-e (o CNPJ de sua empresa).</li>
<li><strong>ref</strong>:A referência da emissão.</li>
<li><strong>status</strong>: A situação da MDF-e, podendo ser:

<ul>
<li><strong>processando_autorizacao</strong>: A nota ainda está em processamento pela API. Você deverá aguardar o processamento pela SEFAZ.</li>
<li><strong>autorizado</strong>: A nota foi autorizada, neste caso é fornecido os dados completos da nota como chave e arquivos para download</li>
<li><strong>cancelado</strong>: O documento foi cancelado, neste caso é fornecido o caminho para download do XML de cancelamento (caminho_xml_cancelamento).</li>
<li><strong>encerrado</strong>: O documento foi autorizado e posteriormente encerrado, neste caso é fornecido o caminho para download do XML de encerramento (caminho_xml_encerramento).</li>
<li><strong>erro_autorizacao</strong>: Houve um erro de autorização por parte da SEFAZ. A mensagem de erro você encontrará nos campos status_sefaz e mensagem_sefaz. É possível fazer o reenvio da nota com a mesma referência se ela estiver neste estado.</li>
<li><strong>denegado</strong>: O documento foi denegado. Uma SEFAZ pode denegar uma nota se houver algum erro cadastral nos dados do destinatário ou do emitente. A mensagem de erro você encontrará nos campos status_sefaz e mensagem_sefaz. Não é possível reenviar a nota caso este estado seja alcançado pois é gerado um número, série, chave de MDF-e e XML para esta nota. O XML deverá ser armazenado pelo mesmo período de uma nota autorizada ou cancelada.</li>
</ul></li>
<li><strong>status_sefaz</strong>: O status da nota na SEFAZ.</li>
<li><strong>mensagem_sefaz</strong>: Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>serie</strong>: A série da MDF-e, caso ela tenha sido autorizada.</li>
<li><strong>numero</strong>: O número da MDF-e, caso ela tenha sido autorizada.</li>
<li><strong>modelo</strong>: O modelo da MDF-e, caso ela tenha sido autorizada. No momento sempre assume o valor 58.</li>
<li><strong>chave_mdfe</strong>: A chave da MDF-e, caso ela tenha sido autorizada.</li>
<li><strong>caminho_xml_nota_fiscal</strong>: caso a nota tenha sido autorizada, retorna o caminho para download do XML.</li>
<li><strong>caminho_damdfe</strong>: caso a nota tenha sido autorizada retorna o caminho para download do DAMDF-e.</li>
<li><strong>caminho_xml</strong>: caso tenha sido emitida alguma carta de correção, aqui aparecerá o caminho para fazer o download do XML.</li>
<li><strong>caminho_xml_cancelamento</strong>: Caso a MDFe esteja cancelada, é fornecido o caminho para fazer o download do XML de cancelamento.</li>
<li><strong>caminho_xml_encerramento</strong>: Caso a MDFe esteja encerrada, é fornecido o caminho para fazer o download do XML de encerramento.</li>
</ul>

<p>Caso na requisição seja passado o parâmetro <code>completa=1</code> será adicionado mais 6 campos:</p>

<ul>
<li><strong>requisicao</strong>: Inclui os dados completos da requisição da MDF-e, da mesma forma que constam no XML da nota.</li>
<li><strong>protocolo</strong>: Inclui os dados completos do protocolo devolvido pela SEFAZ.</li>
<li><strong>requisicao_cancelamento</strong>: Inclui os dados completos da requisição de cancelamento da MDF-e.</li>
<li><strong>protocolo_cancelamento</strong>: Inclui os dados completos do protocolo devolvido pela SEFAZ.</li>
<li><strong>requisicao_encerramento</strong>: Inclui os dados completos da requisição de cancelamento da MDF-e.</li>
<li><strong>protocolo_encerramento</strong>: Inclui os dados completos do protocolo devolvido pela SEFAZ.</li>
<li><strong>condutores_incluidos</strong>: Inclui uma lista de dados de condutores que foram incluídos posteriormente. Cada chave contém:
** <strong>requisicao</strong>: Inclui os dados completos da requisição de inclusão de condutores
** <strong>protocolo</strong>: Inclui os dados completos do protocolo devolvido pela SEFAZ.</li>
</ul>

<blockquote>
<p>Exemplo de resposta da consulta de MDF-e:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"11111151000119"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ref123"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Autorizado o uso do MDF-e"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MDFe21111114611151000119570010000000111973476363"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"11"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"modelo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"58"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"caminho_xml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://focusnfe.s3-sa-east-1.amazonaws.com/arquivos_development/11111151000119/201805/XMLs/311110000007009_v03.00-protMDF-e.xml"</span><span class="p">,</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Exemplo de resposta com o parâmetro, completa, recebendo o valor &quot;1&quot;:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">

  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"11111151000119"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ref123"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Autorizado o uso do CT-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"chave"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MDF-e21111114611151000119570010000000111973476363"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"11"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"modelo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"57"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://focusnfe.s3-sa-east-1.amazonaws.com/arquivos_development/11111151000119/201805/XMLs/311110000007009_v03.00-protMDF-e.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://focusnfe.s3-sa-east-1.amazonaws.com/arquivos_development/11111151000119/201805/XMLs/311110000007012_v03.00-eventoMDF-e.xml"</span><span class="w">
  </span><span class="s2">"requisicao"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="err">/*</span><span class="w"> </span><span class="err">campos</span><span class="w"> </span><span class="err">da</span><span class="w"> </span><span class="err">MDF-e</span><span class="w"> </span><span class="err">aqui</span><span class="w"> </span><span class="err">omitida</span><span class="w"> </span><span class="err">*/</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="s2">"protocolo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"versao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"id_tag"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MDFe329180000007009"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ambiente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"versao_aplicativo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RS20180430143216"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave"</span><span class="p">:</span><span class="w"> </span><span class="s2">"21111114611151000119570010000000111973476363"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_recimento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-05-10T15:23:36-03:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"protocolo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"329180000007009"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"digest_value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PsPzcf7bCOwvNW+v2F+ZAzJPXJE="</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"motivo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Autorizado o uso do MDF-e"</span><span class="w">
  </span><span class="p">},</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='mdf-e-beta_cancelamento'>Cancelamento</h2><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X DELETE -d <span class="s1">'{"justificativa":"Teste de cancelamento"}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/mdfe/12345
</code></pre>
<blockquote>
<p>Resposta da API para a requisição de cancelamento:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a MDF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cancelado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://focusnfe.s3-sa-east-1.amazonaws.com/arquivos_development/14674451000119/201805/XMLs/329180000006929_v03.00-eventoMDF-e.xml"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Para cancelar uma MDF-e, basta fazer uma requisição à URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Cancelar uma MDF-e já autorizada:</p>

<p><code>https://api.focusnfe.com.br/v2/mdfe/REFERENCIA</code></p>

<p>Utilize o comando <strong>HTTP DELETE</strong> para cancelar a sua nota para nossa API. Este método é síncrono, ou seja, a comunicação com a SEFAZ será feita imediatamente e devolvida a resposta na mesma requisição.</p>

<p>O parâmetros de cancelamento deverão ser enviados da seguinte forma:</p>

<ul>
<li><strong>justificativa</strong>: Justificativa do cancelamento. Deverá conter de 15 a 255 caracteres.</li>
</ul>

<p>A API irá em seguida devolver os seguintes campos:</p>

<ul>
<li><strong>status</strong>: cancelado, se a nota pode ser cancelada, ou erro_cancelamento, se houve algum erro ao cancelar a nota.</li>
<li><strong>status_sefaz</strong>: O status do cancelamento na SEFAZ.</li>
<li><strong>mensagem_sefaz</strong>: Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>caminho_xml</strong>: Caso a nota tenha sido cancelada, será informado aqui o caminho para download do XML de cancelamento.</li>
</ul>
<h3 id='mdf-e-beta_prazo-de-cancelamento'>Prazo de cancelamento</h3>
<p>A MDF-e poderá ser cancelada em até 24 horas após a emissão.</p>
<h2 id='mdf-e-beta_inclusao-de-condutor'>Inclusão de Condutor</h2><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -d <span class="s1">'{"nome":"João da Silva","cpf":"68971569140"}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/mdfe/12345/inclusao_condutor
</code></pre>
<blockquote>
<p>Resposta da API para a requisição de cancelamento:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a MDF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"incluido"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://focusnfe.s3-sa-east-1.amazonaws.com/arquivos_development/14674451000119/201805/XMLs/329180000006929_v03.00-eventoMDF-e.xml"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Para incluir um condutor adicional em uma MDF-e autorizada, basta fazer uma requisição à URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Incluir um condutor em uma MDF-e autorizada:</p>

<p><code>https://api.focusnfe.com.br/v2/mdfe/REFERENCIA/inclusao_condutor</code></p>

<p>Utilize o comando <strong>HTTP POST</strong> para incluir um condutor. Este método é síncrono, ou seja, a comunicação com a SEFAZ será feita imediatamente e devolvida a resposta na mesma requisição.</p>

<p>Os parâmetros de inclusão deverão ser enviados da seguinte forma:</p>

<ul>
<li><strong>nome</strong>: Nome completo do condutor</li>
<li><strong>cpf</strong>: CPF do condutor</li>
</ul>

<p>A API irá em seguida devolver os seguintes campos:</p>

<ul>
<li><strong>status</strong>: incluido, se o condutor foi incluído com sucesso, ou erro_inclusao, se houve algum erro ao incluir o condutor</li>
<li><strong>status_sefaz</strong>: O status da operação na SEFAZ.</li>
<li><strong>mensagem_sefaz</strong>: Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>caminho_xml</strong>: Caso o condutor tenha sido incluído, será informado aqui o caminho para download do XML de inclusão.</li>
</ul>
<h2 id='mdf-e-beta_encerramento'>Encerramento</h2><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -d <span class="s1">'{"data":"2019-03-05","sigla_uf":"SP","nome_municipio":"São Paulo"}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/mdfe/12345/encerramento
</code></pre>
<blockquote>
<p>Resposta da API para a requisição de encerramento:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a MDF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"encerrado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://focusnfe.s3-sa-east-1.amazonaws.com/arquivos_development/14674451000119/201805/XMLs/329180000006929_v03.00-eventoMDF-e.xml"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Após o término da operação, o MDFe terá que ser obrigatoriamente encerrado. Para isso basta fazer uma requisição à URL abaixo, alterando o ambiente de produção para homologação, caso esteja emitindo notas de teste.</p>

<p>Encerrar uma MDF-e autorizada:</p>

<p><code>https://api.focusnfe.com.br/v2/mdfe/REFERENCIA/encerrar</code></p>

<p>Utilize o comando <strong>HTTP POST</strong> para incluir um condutor. Este método é síncrono, ou seja, a comunicação com a SEFAZ será feita imediatamente e devolvida a resposta na mesma requisição.</p>

<p>Os parâmetros de encerramento deverão ser enviados da seguinte forma:</p>

<ul>
<li><strong>data</strong>: Data do encerramento</li>
<li><strong>sigla_uf</strong>: UF do município de encerramento</li>
<li><strong>nome_municipio</strong>: Nome do município de encerramento</li>
</ul>

<p>A API irá em seguida devolver os seguintes campos:</p>

<ul>
<li><strong>status</strong>: encerrado, se o MDFe foi encerrado com sucesso, ou erro_encerramento, se houve algum erro ao encerrar o MDFe</li>
<li><strong>status_sefaz</strong>: O status da operação na SEFAZ.</li>
<li><strong>mensagem_sefaz</strong>: Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>caminho_xml</strong>: Caso o encerramento tenha sido realizado, será informado aqui o caminho para download do XML.</li>
</ul>
<h1 id='manifestacao-nfe_manifestacao-nfe'>Manifestação - NFe</h1>
<p>A API para manifestação do sistema Focus permite que você consulte todas as notas recebidas pela sua empresa (modelo 55) e permite que você realize a manifestação frente a receita, informando se a operação descrita na nota foi realizada ou não. A API faz ainda a guarda de todos os documentos recebidos para que você consulte quando precisar.</p>

<p>Através desta documentação deverá ser possível fazer a integração com a API do Focus NFe, caso alguma dúvida permaneça você pode entrar em contato com o suporte especializado através do e-mail suporte@acras.com.br.</p>
<h2 id='manifestacao-nfe_urls'>URLs</h2>
<table><thead>
<tr>
<th>Método</th>
<th>URL (recurso)</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>POST</td>
<td>/v2/nfes_recebidas/CHAVE/manifesto</td>
<td>Realiza um manifesto na nota informada.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/nfes_recebidas?cnpj=CNPJ</td>
<td>Busca informações resumidas de todas as NFe’s recebidas.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/nfes_recebidas/CHAVE/manifesto</td>
<td>Consulta o último manifesto válido na nota fiscal informada.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/nfes_recebidas/CHAVE.json</td>
<td>Consulta as informações da nota fiscal em formato JSON.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/nfes_recebidas/CHAVE.xml</td>
<td>Consulta as informações da nota fiscal em formato XML.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/nfes_recebidas/CHAVE/cancelamento.xml</td>
<td>Se existir, baixa o XML de cancelamento da nota fiscal informada.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/nfes_recebidas/CHAVE/carta_correcao.xml</td>
<td>Se existir, baixa o XML da última carta de correção da nota fiscal informada.</td>
</tr>
</tbody></table>
<h2 id='manifestacao-nfe_status-api'>Status API</h2>
<p>Aqui você encontra os status possíveis para MDe.</p>

<table><thead>
<tr>
<th>HTTP CODE/STATUS</th>
<th>Status API Focus</th>
<th>Descrição</th>
<th>Correção</th>
</tr>
</thead><tbody>
<tr>
<td>400 - bad request</td>
<td>manifestacao_nao_aplicavel</td>
<td>Esta Nota Fiscal não pode ser manifestada.</td>
<td>Procure a nossa equipe de suporte para mais detalhes.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>manifestacao_ja_vinculada</td>
<td>Este tipo de manifestação já foi vinculado à Nota Fiscal.</td>
<td>Consulte as manifestações registradas na NFe antes de realizar uma nova tentativa.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>Tipo de manifestação não informado</td>
<td>O tipo de manifestação não foi informado ou é inválido. Consulte a nossa documentação.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>A justificativa deve conter pelo menos 15 caracteres</td>
<td>Sua justificativa possui menos caracteres que o mínimo. Consulte a nossa documentação.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>Para manifestação de operação não realizada é obrigatório informar o parâmetro &#39;justificativa&#39;.</td>
<td>Consulte a nossa documentação.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>CNPJ do emitente não autorizado ou não informado.</td>
<td>Verifique no Painel API se esse emitente está habilitado para realizar MDe. Verifique se o CNPJ foi informado no JSON de envio.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>CNPJ/UF do emitente não autorizado ou não informado.</td>
<td>Verifique no Painel API se esse emitente está habilitado para realizar MDe. Verifique se o CNPJ foi informado no JSON de envio.</td>
</tr>
<tr>
<td>404 - not found</td>
<td>nao_encontrado</td>
<td>Nota Fiscal ou Manifesto não encontrado</td>
<td>Verifique se a nota fiscal está autorizada e/ou se o manifesto foi registrado na nota fiscal.</td>
</tr>
<tr>
<td>403 - forbidden</td>
<td>permissao_negada</td>
<td>CNPJ do emitente não autorizado.</td>
<td>O emitente utilizado não está autorizado a emitir MDe ou foi informado o CNPJ do emitente incorretamente no JSON.</td>
</tr>
</tbody></table>
<h2 id='manifestacao-nfe_manifestacao'>Manifestação</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfes_recebidas/"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s">"chave_da_nota_fiscal"</span>

<span class="s">'''
Usamos um dicionario para armazenar os campos e valores que em seguida,
serao convertidos a JSON e enviados para nossa API
'''</span>
<span class="n">manifesto</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">manifesto</span><span class="p">[</span><span class="s">"tipo"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"ciencia"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/manifesto"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">manifesto</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


</code></pre><pre class="highlight shell tab-shell"><code>
<span class="c"># substitua CHAVE pela chave da nota</span>
curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -d <span class="s1">'{"tipo":"confirmacao"}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfes_recebidas/CHAVE/manifesto
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Manifestar</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">chave</span> <span class="o">=</span> <span class="s">"Chave_de_identificação_da_NFe"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfes_recebidas/"</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/manifesto"</span><span class="o">);</span>

        <span class="cm">/* Aqui criamos um hashmap para receber a chave "tipo" e o valor que pode ser: ciencia, confirmacao, desconhecimento ou nao_realizada. */</span>       
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">tipoManifestacao</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">tipoManifestacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"tipo"</span><span class="o">,</span> <span class="s">"nao_realizada"</span><span class="o">);</span>

        <span class="cm">/* Caso escolha o tipo "nao_realizada", é preciso informar o campo/chave "justificativa".
         * TipoManifestacao.put("justificativa", "Informe aqui a sua justificativa do motivo da não realização da operação."); */</span>

        <span class="cm">/* Criamos um objeto JSON para receber a hash com os dados esperado pela API. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">TipoManifestacao</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span>  <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s2">"chave_de_identificacao_da_NFe"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfes_recebidas/"</span> <span class="o">+</span> <span class="n">chave</span> <span class="o">+</span> <span class="s2">"/manifesto"</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">tipo_manifestacao</span> <span class="o">=</span> <span class="p">{</span>  
  <span class="ss">tipo: </span><span class="s2">"nao_realizada"</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># caso escolha o tipo "nao_realizada", é preciso informar o campo/chave "justificativa"</span>
<span class="c1"># justificativa: "Informe aqui a sua justificativa do motivo da não realização da operação."</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos a hash de justificativa do cancelamento para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">tipo_manifestacao</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// Solicite o seu token para realizar as requisições com nossa equipe de suporte.
</span> <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
 <span class="nv">$chave</span> <span class="o">=</span> <span class="s2">"Chave_de_identificação_da_NFe"</span><span class="p">;</span>
<span class="cm">/* Aqui enviamos o tipo de manifestação que desejamos realizar.
   Consulte nossa documentação, para conhecer os demais tipos possíveis: https://goo.gl/a9o7hm */</span>
 <span class="nv">$tipo</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">"tipo"</span> <span class="o">=&gt;</span> <span class="s2">"confirmacao"</span><span class="p">);</span>
<span class="c1">// Para ambiente de Produção, utilize a URL: https://api.focusnfe.com.br/.  
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span><span class="p">;</span>
 <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"v2/nfes_recebidas/"</span><span class="o">.</span><span class="nv">$chave</span><span class="o">.</span><span class="s2">"/manifesto"</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$tipo</span><span class="p">));</span>

<span class="cm">/* Métodos para realizar a autenticação básica do HTTP.
   Não é necessário informar campo senha, apenas o campo login. */</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// Mostra na tela o HTTP Code da sua requisição.
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="p">);</span>
<span class="c1">// Mostra na tela a mensagem de retorno da API.   
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="p">);</span>
 <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">chave</span> <span class="o">=</span> <span class="s2">"chave_da_nota_fiscal"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfes_recebidas/"</span> <span class="o">+</span> <span class="nx">chave</span> <span class="o">+</span> <span class="s2">"/manifesto"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">manifesto</span> <span class="o">=</span> <span class="p">{</span>

    <span class="s2">"tipo"</span><span class="p">:</span> <span class="s2">"ciencia"</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">manifesto</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<blockquote>
<p>Outro exemplo de dados enviados</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"tipo"</span><span class="p">:</span><span class="s2">"nao_realizada"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"justificativa"</span><span class="p">:</span><span class="s2">"Fornecedor cancelou a operação devido a falta dos produtos em estoque"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Você pode realizar as seguintes operações de manifestação em uma NFe recebida:</p>

<ul>
<li><strong>Ciência da operação</strong>: Significa que a operação é conhecida pela empresa, mas ainda não há informações suficientes para saber se ela foi concluída ou não.</li>
<li><strong>Desconhecimento da operação</strong>: Significa que a empresa não reconhece a nota fiscal emitida.</li>
<li><strong>Operação realizada</strong>(confirmação): – Significa que a operação é conhecida e foi realizada com sucesso.</li>
<li><strong>Operação não realizada</strong>: Significa que a operação é conhecida e por algum motivo não foi realizada.</li>
</ul>

<p>Para realizar a manifestação, utilize a URL:</p>

<p><code>https://api.focusnfe.com.br/v2/nfes_recebidas/CHAVE/manifesto</code></p>

<p>Utilize o método <strong>HTTP POST</strong> para enviar os parâmetros à API.</p>

<p>Na URL, informe em <strong>CHAVE</strong> a chave da nota fiscal recebida. No corpo da requisição, informe objeto JSON com os seguintes parâmetros:</p>

<ul>
<li><strong>tipo</strong>: Tipo da manifestação podendo ser <strong>ciencia</strong>, <strong>confirmacao</strong>, <strong>desconhecimento</strong> ou <strong>nao_realizada</strong>.</li>
<li><strong>justificativa</strong>: Caso o tipo seja nao_realizada, você deverá informar a justificativa (mínimo de 15 caracteres e máximo de 255).</li>
</ul>

<blockquote>
<p>Exemplo de dados de resposta:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a NF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"evento_registrado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"protocolo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"891170005150285"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"tipo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nao_realizada"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"justificativa"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Fornecedor cancelou a operação devido a falta dos produtos em estoque"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>Dados devolvidos</strong></p>

<p>A API irá devolver um objeto JSON com os seguintes parâmetros:</p>

<ul>
<li><strong>status_sefaz</strong>:Código de status da SEFAZ.</li>
<li><strong>mensagem_sefaz</strong>: Mensagem da SEFAZ.</li>
<li><strong>status</strong>: erro se não foi possível fazer a manifestação (consulte a mensagem de erro em mensagem_sefaz) ou evento_registrado se a manifestação foi registrada com sucesso à NFe.</li>
<li><strong>protocolo</strong>: Protocolo do recebimento na SEFAZ.</li>
<li><strong>tipo</strong>: Tipo da manifestação informado.</li>
<li><strong>justificativa</strong>: Justificativa da manifestação informada, se existente.</li>
</ul>

<p>É possível realizar mais de uma manifestação na nota fiscal, ficando válida apenas a última manifestação realizada com sucesso, não sendo possível repetir o tipo de manifestação já realizado. Caso queria consultar a última manifestação válida, utilize o seguinte endereço:</p>

<p><code>https://api.focusnfe.com.br/v2/nfes_recebidas/CHAVE/manifesto</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para consultar os dados da nota fiscal.</p>

<p>Na URL, informe em <strong>CHAVE</strong> a chave da nota fiscal recebida. O retorno será o mesmo que a operação de manifestação.</p>

<blockquote>
<p>Exemplo de como consultar a última manifestação de uma Nota Fiscal Eletrônica.</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfes_recebidas/"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s">"chave_da_nota_fiscal"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/manifesto"</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsultarUltimaManifestacao</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">chave</span> <span class="o">=</span> <span class="s">"Chave_de_identificação_da_NFe"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfes_recebidas/"</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/manifesto"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span>  <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s2">"chave_de_identificacao_da_NFe"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfes_recebidas/"</span> <span class="o">+</span> <span class="n">chave</span> <span class="o">+</span> <span class="s2">"/manifesto"</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// Solicite o seu token para realizar as requisições com nossa equipe de suporte.
</span> <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
 <span class="nv">$chave</span> <span class="o">=</span> <span class="s2">"Chave_de_identificação_da_NFe"</span><span class="p">;</span>
<span class="c1">// Para ambiente de Produção, utilize a URL: https://api.focusnfe.com.br/.  
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span><span class="p">;</span>

 <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"v2/nfes_recebidas/"</span><span class="o">.</span><span class="nv">$chave</span><span class="o">.</span><span class="s2">"/manifesto"</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="cm">/* Métodos para realizar a autenticação básica do HTTP.
   Não é necessário informar campo senha, apenas o campo login. */</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// Mostra na tela o HTTP Code da sua requisição.
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="p">);</span>
<span class="c1">// Mostra na tela a mensagem de retorno da API.   
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="p">);</span>
 <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><h2 id='manifestacao-nfe_consulta-de-nfe-recebidas'>Consulta de NFe Recebidas</h2>
<p>Uma nota fiscal recebida pode ter suas informações atualizadas ao longo do tempo. Quando a receita informa que uma nota fiscal foi emitida contra a empresa, recebemos apenas o “cabeçalho” da nota fiscal com os dados mais importantes. Se for manifestada ciência da operação, poderemos receber os demais dados. Da mesma forma, a receita poderá notificar quando a nota recebe uma carta de correção ou quando ela é cancelada.</p>

<p>Por isso as notas fiscais recebidas possuem um campo chamado “<strong>versao</strong>” que é único entre todos os documentos do mesmo CNPJ e que é atualizado a cada alteração nesta nota fiscal. Isto facilita a busca apenas dos documentos que seu sistema ainda não conhece, sendo necessário que você armazene apenas um número por CNPJ.</p>

<p>Por exemplo, se você recebe uma nota fiscal, com versao = 60, e ela posteriormente receber uma carta de correção ou for cancelada, sua versão será atualizada para algum número maior que 60.</p>

<p>A API busca as últimas atualizações da SEFAZ de hora em hora.</p>

<p><strong>Método de consulta</strong></p>

<blockquote>
<p>Exemplo de como consultar todas as notas recebidas de uma empresa.</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfes_recebidas?cnpj="</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">cnpj</span> <span class="o">=</span> <span class="s">"cnpj_do_destinatario_da_nota"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">cnpj</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfes_recebidas?cnpj=SEU_CNPJ"</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsultarTodosManifestos</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">cnpj</span> <span class="o">=</span> <span class="s">"CNPJ_da_sua_empresa"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfes_recebidas?cnpj="</span><span class="o">+</span><span class="n">cnpj</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span>  <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="n">cnpj</span> <span class="o">=</span> <span class="s2">"CNPJ_da_sua_empresa"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfes_recebidas?cnpj="</span> <span class="o">+</span> <span class="n">cnpj</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// Solicite o seu token para realizar as requisições com nossa equipe de suporte.
</span> <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
 <span class="nv">$cnpj</span> <span class="o">=</span> <span class="s2">"CNPJ_da_sua_empresa"</span><span class="p">;</span>
<span class="c1">// Para ambiente de Produção, utilize a URL: https://api.focusnfe.com.br/.  
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span><span class="p">;</span>

 <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
   <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"v2/nfes_recebidas?cnpj="</span><span class="o">.</span><span class="nv">$cnpj</span><span class="p">);</span>
   <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
   <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="cm">/* Métodos para realizar a autenticação básica do HTTP.
   Não é necessário informar campo senha, apenas o campo login. */</span>  
   <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
   <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">"</span><span class="p">);</span>

 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// Mostra na tela o HTTP Code da sua requisição.
</span>   <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="p">);</span>
<span class="c1">// Mostra na tela a mensagem de retorno da API.   
</span>   <span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="p">);</span>
   <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
A orientacao a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">cnpj</span> <span class="o">=</span> <span class="s2">"cnpj_do_destinatario_da_nota"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfes_recebidas?cnpj="</span> <span class="o">+</span> <span class="nx">cnpj</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<p>Para consultar os documentos fiscais recebidos, utilize o endereço abaixo:</p>

<p><code>https://api.focusnfe.com.br/v2/nfes_recebidas?cnpj=CNPJ</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para consultar as notas. Esta requisição aceita os seguintes parâmetros que deverão ser enviados na URL:</p>

<ul>
<li><strong>cnpj</strong>(*): CNPJ da empresa. Campo obrigatório.</li>
<li><strong>versao</strong>: Se informado, irá buscar apenas os documentos cuja versão seja maior que o parâmetro recebido. Utilize este parâmetro para buscar apenas as notas que seu sistema ainda não conhece.</li>
<li><strong>pendente</strong>: Se este parâmetro for informado, serão listadas apenas as notas que estão pendentes de manifestação.</li>
</ul>

<p>Serão devolvidas as 100 primeiras notas encontradas. Para recuperar as demais notas você deverá fazer uma nova requisição alterando o campo versão.</p>

<blockquote>
<p>Exemplo dos dados de resposta:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"nome_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Empresa emitente Ltda."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"documento_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"79160190000193"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"41171179060190000182550010000002661875685069"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"valor_total"</span><span class="p">:</span><span class="w"> </span><span class="s2">"24560.00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_emissao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-11-07T01:00:00-02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"situacao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizada"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"manifestacao_destinatario"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ciencia"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nfe_completa"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tipo_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"versao"</span><span class="p">:</span><span class="w"> </span><span class="mi">73</span><span class="p">,</span><span class="w">
    </span><span class="s2">"digest_value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/C5IuK5fCNVQV2rbwV0d8W12zsk="</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numero_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Algum texto da carta de correção."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_carta_correcao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-11-07T14:31:48-02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_cancelamento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-11-07T14:45:14-02:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"justificativa_cancelamento"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nota cancelada por algum motivo"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p><strong>Dados devolvidos</strong></p>

<p>A API irá devolver os seguintes cabeçalhos HTTP:</p>

<ul>
<li><strong>X-Total-Count</strong>: O número total de registros (incluindo aqueles que não foram devolvidos pelo limite de 100 registros)</li>
<li><strong>X-Max-Version</strong>: Valor máximo da versão dos documentos devolvidos. Utilize este cabeçalho para utilizar na próxima busca de versão, caso seja necessário.</li>
</ul>

<p>Os dados devolvidos no corpo da requisição serão um array de objetos em JSON no seguinte formato:</p>

<ul>
<li><strong>nome_emitente</strong>: Nome do emitente da nota fiscal.</li>
<li><strong>documento_emitente</strong>: CNPJ ou CPF do emitente da nota fiscal.</li>
<li><strong>cnpj_destinatario</strong>: CNPJ do destinatário da nota fiscal (o CNPJ de sua empresa).</li>
<li><strong>chave_nfe</strong>: Chave da NFe.</li>
<li><strong>valor_total</strong>: Valor total da NFe.</li>
<li><strong>data_emissao</strong>: Data de emissão da NFe.</li>
<li><strong>situacao</strong>: Situação da NFe. Pode ser: autorizada, cancelada ou denegada.</li>
<li><strong>manifestacao_destinatario</strong>: Situação atual da manifestação, pode ser:

<ul>
<li><strong>nulo</strong>: Se não houve manifestação ainda;</li>
<li><strong>ciencia</strong>: Se foi confirmada a ciência da operação;</li>
<li><strong>confirmacao</strong>: Se foi manifestado confirmação da operação;</li>
<li><strong>desconhecimento</strong>: Se foi manifestado desconhecimento da operação;</li>
<li><strong>nao_realizada</strong>: Se foi manifestado que operação é conhecida, porém por algum motivo não foi realizada.</li>
</ul></li>
<li><strong>nfe_completa</strong>: Se verdadeiro, indica que temos o XML completo da nota, caso contrário o sistema possui apenas o cabeçalho da nota.</li>
<li><strong>tipo_nfe</strong>:

<ul>
<li><strong>1</strong>: Saída;</li>
<li><strong>2</strong>: Entrada.</li>
</ul></li>
<li><strong>versao</strong>: Versão da nota fiscal. Este número irá mudar apenas se a nota fiscal for alterada de alguma forma.</li>
<li><strong>digest_value</strong>: Valor do resumo digital do XML da nota.</li>
<li><strong>numero_carta_correcao</strong>: Número sequencial da carta de correção, caso tenha sido emitida alguma.</li>
<li><strong>carta_correcao</strong>: Texto da carta de correção, caso tenha sido emitida alguma.</li>
<li><strong>data_carta_correcao</strong>: Data da carta de correção, caso tenha sido emitida alguma.</li>
<li><strong>data_cancelamento</strong>: Data de cancelamento da nota fiscal, caso ela tenha sido cancelada.</li>
<li><strong>justificativa_cancelamento</strong>: Justificativa de cancelamento da nota fiscal, caso ela tenha sido cancelada.</li>
</ul>
<h2 id='manifestacao-nfe_consulta-de-nfe-individuais'>Consulta de NFe individuais</h2>
<p>Disponibilizamos diversos métodos para obter mais informações de uma nota fiscal recebida conforme mostramos a seguir:</p>

<p><strong>Pesquisa de uma nota fiscal por chave</strong></p>

<p>Para pesquisar as informações específicas de uma NFe, consulte:</p>

<p><code>https://api.focusnfe.com.br/v2/nfes_recebidas/CHAVE</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para consultar os dados da nota fiscal.</p>

<p>Isto irá devolver os mesmos campos descritos no item 2.2. Você pode solicitar também os dados completos da nota informando o parâmetro <strong>completa=1</strong>, da seguinte forma:</p>

<p><code>https://api.focusnfe.com.br/v2/nfes_recebidas/CHAVE?completa=1</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para consultar os dados da nota fiscal.</p>

<p>Isto irá adicionar 6 novos campos:</p>

<ul>
<li><strong>requisicao_nota_fiscal</strong>: Dados completos da nota fiscal em formato JSON.</li>
<li><strong>protocolo_nota_fiscal</strong>: Dados completos do retorno do SEFAZ em formato JSON.</li>
<li><strong>requisicao_carta_correcao</strong>: Dados completos da carta de correção em formato JSON se aplicável.</li>
<li><strong>protocolo_carta_correcao</strong>: Dados completos do retorno do envio da carta de correção em formato JSON se aplicável.</li>
<li><strong>requisicao_cancelamento</strong>: Dados completos do cancelamento em formato JSON se aplicável.</li>
<li><strong>protocolo_cancelamento</strong>: Dados completos do retorno do cancelamento em formato JSON se aplicável.</li>
</ul>
<h2 id='manifestacao-nfe_download-de-xml'>Download de XML</h2>
<blockquote>
<p>Exemplo de como realizar o download do XML de uma Nota Fiscal Eletrônica especifica.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">chave</span> <span class="o">=</span> <span class="s2">"chave_da_nota_fiscal"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfes_recebidas/"</span> <span class="o">+</span> <span class="nx">chave</span> <span class="o">+</span> <span class="s2">".xml"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfes_recebidas/"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s">"chave_da_nota_fiscal"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">".xml"</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfes_recebidas/CHAVE.xml
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DownloadNotaEspecificaXml</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">chave</span> <span class="o">=</span> <span class="s">"Chave_de_identificação_da_NFe"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfes_recebidas/"</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">".xml"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span>  <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s2">"chave_de_identificacao_da_NFe"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfes_recebidas/"</span> <span class="o">+</span> <span class="n">chave</span> <span class="o">+</span> <span class="s2">".xml"</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// Solicite o seu token para realizar as requisições com nossa equipe de suporte.
</span> <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
 <span class="nv">$chave</span> <span class="o">=</span> <span class="s2">"Chave_de_identificação_da_NFe"</span><span class="p">;</span>
<span class="c1">// Para ambiente de Produção, utilize a URL: https://api.focusnfe.com.br/.  
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span><span class="p">;</span>
 <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"v2/nfes_recebidas/"</span><span class="o">.</span><span class="nv">$chave</span><span class="o">.</span><span class="s2">".xml"</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="cm">/* Métodos para realizar a autenticação básica do HTTP.
   Não é necessário informar campo senha, apenas o campo login. */</span>  
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// Mostra na tela o HTTP Code da sua requisição.
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="p">);</span>
<span class="c1">// Converte os dados de XML para objeto, mostrando o retorno bruto.
</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nb">simplexml_load_string</span><span class="p">(</span><span class="nv">$body</span><span class="p">));</span>
 <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre>
<blockquote>
<p>Exemplo de como fazer o download, no formato JSON, do XML de uma Nota Fiscal Eletrônica especifica.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">chave</span> <span class="o">=</span> <span class="s2">"chave_da_nota_fiscal"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfes_recebidas/"</span> <span class="o">+</span> <span class="nx">chave</span> <span class="o">+</span> <span class="s2">".json?completa=1"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfes_recebidas/"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s">"chave_da_nota_fiscal"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">".json?completa=1"</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="n">l</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfes_recebidas/CHAVE.json?completa=1"</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DownloadNotaEspecifica</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">chave</span> <span class="o">=</span> <span class="s">"Chave_de_identificação_da_NFe"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfes_recebidas/"</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">".json?completa=1"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span>  <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s2">"chave_de_identificacao_da_NFe"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfes_recebidas/"</span> <span class="o">+</span> <span class="n">chave</span> <span class="o">+</span> <span class="s2">".json?completa=1"</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// Solicite o seu token para realizar as requisições com nossa equipe de suporte.
</span> <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
 <span class="nv">$chave</span> <span class="o">=</span> <span class="s2">"Chave_de_identificação_da_NFe"</span><span class="p">;</span>
<span class="c1">// Para ambiente de Produção, utilize a URL: https://api.focusnfe.com.br/.  
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span><span class="p">;</span>
 <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"v2/nfes_recebidas/"</span><span class="o">.</span><span class="nv">$chave</span><span class="o">.</span><span class="s2">".json?completa=1"</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="cm">/* Métodos para realizar a autenticação básica do HTTP.
   Não é necessário informar campo senha, apenas o campo login. */</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// Mostra na tela o HTTP Code da sua requisição.
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="p">);</span>
<span class="c1">// Mostra na tela a mensagem de retorno da API.   
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="p">);</span>
 <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre>
<blockquote>
<p>Exemplo de como fazer o download do XML de cancelamento de uma Nota Fiscal Eletrônica.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">chave</span> <span class="o">=</span> <span class="s2">"chave_da_nota_fiscal"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfes_recebidas/"</span> <span class="o">+</span> <span class="nx">chave</span> <span class="o">+</span> <span class="s2">"/cancelamento.xml"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfes_recebidas/"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s">"chave_da_nota_fiscal"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/cancelamento.xml"</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfes_recebidas/CHAVE/cancelamento.xml
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DownloadCancelamentoXml</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">chave</span> <span class="o">=</span> <span class="s">"Chave_de_identificação_da_NFe"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfes_recebidas/"</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/cancelamento.xml"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span>  <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s2">"chave_de_identificacao_da_NFe"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfes_recebidas/"</span> <span class="o">+</span> <span class="n">chave</span> <span class="o">+</span> <span class="s2">"/cancelamento.xml"</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// Solicite o seu token para realizar as requisições com nossa equipe de suporte.
</span> <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
 <span class="nv">$chave</span> <span class="o">=</span> <span class="s2">"Chave_de_identificação_da_NFe"</span><span class="p">;</span>
<span class="c1">// Para ambiente de Produção, utilize a URL: https://api.focusnfe.com.br/.  
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span><span class="p">;</span>
 <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"v2/nfes_recebidas/"</span><span class="o">.</span><span class="nv">$chave</span><span class="o">.</span><span class="s2">"/cancelamento.xml"</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="cm">/* Métodos para realizar a autenticação básica do HTTP.
   Não é necessário informar campo senha, apenas o campo login. */</span>   
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// Mostra na tela o HTTP Code da sua requisição.
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="p">);</span>
<span class="c1">// Converte os dados de XML para objeto, mostrando o retorno bruto.
</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nb">simplexml_load_string</span><span class="p">(</span><span class="nv">$body</span><span class="p">));</span>
 <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre>
<blockquote>
<p>Exemplo de como realizar o download do XML de uma Nota Fiscal Eletrônica especifica com Carta de Correção Eletrônica.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">chave</span> <span class="o">=</span> <span class="s2">"chave_da_nota_fiscal"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/nfes_recebidas/"</span> <span class="o">+</span> <span class="nx">chave</span> <span class="o">+</span> <span class="s2">"carta_correcao.xml"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/nfes_recebidas/"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s">"chave_da_nota_fiscal"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/carta_correcao.xml"</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/nfes_recebidas/CHAVE/carta_correcao.xml
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DownloadXmlCce</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">chave</span> <span class="o">=</span> <span class="s">"Chave_de_identificação_da_NFe"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/nfes_recebidas/"</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/carta_correcao.xml"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span>  <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s2">"chave_de_identificacao_da_NFe"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/nfes_recebidas/"</span> <span class="o">+</span> <span class="n">chave</span> <span class="o">+</span> <span class="s2">"/carta_correcao.xml"</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// Solicite o seu token para realizar as requisições com nossa equipe de suporte.
</span> <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
 <span class="nv">$chave</span> <span class="o">=</span> <span class="s2">"Chave_de_identificação_da_NFe"</span><span class="p">;</span>
<span class="c1">// Para ambiente de Produção, utilize a URL: https://api.focusnfe.com.br/.  
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span><span class="p">;</span>
 <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"v2/nfes_recebidas/"</span><span class="o">.</span><span class="nv">$chave</span><span class="o">.</span><span class="s2">"/carta_correcao.xml"</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="c1">// Métodos para realizar a autenticação básica do HTTP.
// Não é necessário informar campo senha, apenas o campo login.
</span> <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// Mostra na tela o HTTP Code da sua requisição.
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="p">);</span>
<span class="c1">// Converte os dados de XML para objeto, mostrando o retorno bruto.
</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nb">simplexml_load_string</span><span class="p">(</span><span class="nv">$body</span><span class="p">));</span>

   <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre>
<p>Também é possível fazer o download do XML das notas fiscais através da API, basta informar a chave de identificação da respectiva nota no parâmetro CHAVE:</p>

<p><strong>Baixar o XML de uma nota fiscal especifica:</strong></p>

<p><code>https://api.focusnfe.com.br/v2/nfes_recebidas/CHAVE.xml</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para obter os dados das notas no formato XML.</p>

<p><strong>Baixar o XML, em formato json, de uma nota fiscal especifica:</strong></p>

<p><code>https://api.focusnfe.com.br/v2/nfes_recebidas/CHAVE.json?completa=1</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para obter os dados das notas no formato XML.</p>

<p><strong>Baixar o XML de cancelamento de uma nota fiscal:</strong></p>

<p><code>https://api.focusnfe.com.br/v2/nfes_recebidas/CHAVE/cancelamento.xml</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para obter os dados das notas no formato XML.</p>

<p><strong>Baixar o XML da última Carta de Correção Eletrônica de uma nota fiscal:</strong></p>

<p><code>https://api.focusnfe.com.br/v2/nfes_recebidas/CHAVE/carta_correcao.xml</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para obter os dados das notas no formato XML.</p>
<h1 id='manifestacao-cte-beta_manifestacao-cte-beta'>Manifestação - CTe (beta)</h1>
<p>Da mesma forma que a manifestação de NFe, a API para manifestação de CTe do sistema Focus permite que você consulte todos os conhecimentos de transporte recebidos pela sua empresa e permite que você realize a manifestação frente a receita. No caso da CTe, é necessário realizar a manifestação apenas se houver algum desacordo com a CTe emitida. A API faz ainda a guarda de todos os documentos recebidos para que você consulte quando precisar e recupera todas as MDFes associadas a CTe.</p>

<p>Através desta documentação deverá ser possível fazer a integração com a API do Focus NFe, caso alguma dúvida permaneça você pode entrar em contato com o suporte especializado através do e-mail suporte@acras.com.br.</p>
<h2 id='manifestacao-cte-beta_urls'>URLs</h2>
<table><thead>
<tr>
<th>Método</th>
<th>URL (recurso)</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>GET</td>
<td>/v2/ctes_recebidas?cnpj=CNPJ</td>
<td>Busca os dados resumidos de todas as CTes recebidas.</td>
</tr>
<tr>
<td>POST</td>
<td>/v2/ctes_recebidas/CHAVE/desacordo</td>
<td>Informa um desacordo na CTe recebida</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/ctes_recebidas/CHAVE/desacordo</td>
<td>Consulta o último desacordo válido para o CTe informado</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/ctes_recebidas/CHAVE.json</td>
<td>Consulta a informações da CTe em formato JSON.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/ctes_recebidas/CHAVE.xml</td>
<td>Consulta as informações da CTe em formato XML.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/ctes_recebidas/CHAVE/cancelamento.xml</td>
<td>Se existir, baixa o XML de cancelamento da CTe informada.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/ctes_recebidas/CHAVE/carta_correcao.xml</td>
<td>Se existir, baixa o XML da última carta de correção da CTe informada.</td>
</tr>
</tbody></table>
<h2 id='manifestacao-cte-beta_status-api'>Status API</h2>
<p>Aqui você encontra os status possíveis para MDe.</p>

<table><thead>
<tr>
<th>HTTP CODE/STATUS</th>
<th>Status API Focus</th>
<th>Descrição</th>
<th>Correção</th>
</tr>
</thead><tbody>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>Desacordo já registrado para este Documento Fiscal</td>
<td>Não é possível informar o desacordo mais de uma vez</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>Parâmetro &quot;observacoes&quot; não informado</td>
<td>Ao informar um desacordo é necessário informar o campo &quot;observacoes&quot; informando o motivo do desacordo</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>Parâmetro &quot;observacoes&quot; deve ter entre 15 e 255 caracteres</td>
<td>Informe o número de caracteres correto para este campo</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>CNPJ do emitente não autorizado ou não informado.</td>
<td>Verifique no Painel API se esse emitente está habilitado para realizar a manifestação. Verifique se o CNPJ foi informado no JSON de envio.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>CNPJ/UF do emitente não autorizado ou não informado.</td>
<td>Verifique no Painel API se esse emitente está habilitado para realizar MDe. Verifique se o CNPJ foi informado no JSON de envio.</td>
</tr>
<tr>
<td>404 - not found</td>
<td>nao_encontrado</td>
<td>Documento Fiscal não encontrado</td>
<td>Verifique se a chave está correta</td>
</tr>
<tr>
<td>403 - forbidden</td>
<td>permissao_negada</td>
<td>CNPJ do emitente não autorizado.</td>
<td>O emitente utilizado não está autorizado a realizar a manifestação ou foi informado o CNPJ do emitente incorretamente no JSON.</td>
</tr>
</tbody></table>
<h2 id='manifestacao-cte-beta_informar-desacordo'>Informar desacordo</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/ctes_recebidas/"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s">"chave_da_nota_fiscal"</span>

<span class="s">'''
Usamos um dicionario para armazenar os campos e valores que em seguida,
serao convertidos a JSON e enviados para nossa API
'''</span>
<span class="n">manifesto</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">manifesto</span><span class="p">[</span><span class="s">"observacoes"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Observações referente ao desacordo informado"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/desacordo"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">manifesto</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


</code></pre><pre class="highlight shell tab-shell"><code>
<span class="c"># substitua CHAVE pela chave da nota</span>
curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -d <span class="s1">'{"observacoes":"Observações referente ao desacordo informado"}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/ctes_recebidas/CHAVE/desacordo
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Manifestar</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">chave</span> <span class="o">=</span> <span class="s">"Chave_de_identificação_da_NFe"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/ctes_recebidas/"</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/desacordo"</span><span class="o">);</span>

        <span class="cm">/* Aqui criamos um hashmap para receber a chave "tipo" e o valor que pode ser: ciencia, confirmacao, desconhecimento ou nao_realizada. */</span>       
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">tipoManifestacao</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">tipoManifestacao</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"observacoes"</span><span class="o">,</span> <span class="s">"Observações referente ao desacordo informado"</span><span class="o">);</span>

        <span class="cm">/* Criamos um objeto JSON para receber a hash com os dados esperado pela API. */</span>
        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">TipoManifestacao</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span>  <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s2">"chave_de_identificacao_da_NFe"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/ctes_recebidas/"</span> <span class="o">+</span> <span class="n">chave</span> <span class="o">+</span> <span class="s2">"/desacordo"</span>

<span class="c1"># altere os campos conforme a nota que será enviada</span>
<span class="n">tipo_manifestacao</span> <span class="o">=</span> <span class="p">{</span>  
  <span class="ss">observacoes: </span><span class="s2">"Observações referente ao desacordo informado"</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># criamos uma objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># convertemos a hash de justificativa do cancelamento para o formato JSON e adicionamos ao corpo da requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">tipo_manifestacao</span><span class="p">.</span><span class="nf">to_json</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// Solicite o seu token para realizar as requisições com nossa equipe de suporte.
</span> <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
 <span class="nv">$chave</span> <span class="o">=</span> <span class="s2">"Chave_de_identificação_da_NFe"</span><span class="p">;</span>
<span class="cm">/* Aqui enviamos o tipo de manifestação que desejamos realizar.
   Consulte nossa documentação, para conhecer os demais tipos possíveis: https://goo.gl/a9o7hm */</span>
 <span class="nv">$tipo</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">"observacoes"</span> <span class="o">=&gt;</span> <span class="s2">"Observações referente ao desacordo informado"</span><span class="p">);</span>
<span class="c1">// Para ambiente de Produção, utilize a URL: https://api.focusnfe.com.br/.  
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span><span class="p">;</span>
 <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"v2/ctes_recebidas/"</span><span class="o">.</span><span class="nv">$chave</span><span class="o">.</span><span class="s2">"/desacordo"</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$tipo</span><span class="p">));</span>

<span class="cm">/* Métodos para realizar a autenticação básica do HTTP.
   Não é necessário informar campo senha, apenas o campo login. */</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// Mostra na tela o HTTP Code da sua requisição.
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="p">);</span>
<span class="c1">// Mostra na tela a mensagem de retorno da API.   
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="p">);</span>
 <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">chave</span> <span class="o">=</span> <span class="s2">"chave_da_nota_fiscal"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/ctes_recebidas/"</span> <span class="o">+</span> <span class="nx">chave</span> <span class="o">+</span> <span class="s2">"/desacordo"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">manifesto</span> <span class="o">=</span> <span class="p">{</span>

    <span class="s2">"observacoes"</span><span class="p">:</span> <span class="s2">"Observações referente ao desacordo informado"</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">manifesto</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<blockquote>
<p>Exemplo de dados enviados</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"observacoes"</span><span class="p">:</span><span class="s2">"Observações referente ao desacordo informado"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>No momento é possível informar apenas o desacordo da operações de conhecimento de transporte. É obrigatório informar o campo &quot;observacoes&quot; contendo os detalhes que motivaram o desacordo.</p>

<p>Para informar o desacordo, utilize a URL:</p>

<p><code>https://api.focusnfe.com.br/v2/ctes_recebidas/CHAVE/desacordo</code></p>

<p>Utilize o método <strong>HTTP POST</strong> para enviar os parâmetros à API.</p>

<p>Na URL, informe em <strong>CHAVE</strong> a chave da CTe recebida. No corpo da requisição, informe objeto JSON com os seguintes parâmetros:</p>

<ul>
<li><strong>observacoes</strong>: detalhes que motivaram o desacordo (mínimo de 15 caracteres e máximo de 255).</li>
</ul>

<blockquote>
<p>Exemplo de dados de resposta:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"135"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Evento registrado e vinculado a CT-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"evento_registrado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"protocolo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"891170005150285"</span><span class="p">,</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>Dados devolvidos</strong></p>

<p>A API irá devolver um objeto JSON com os seguintes parâmetros:</p>

<ul>
<li><strong>status_sefaz</strong>:Código de status da SEFAZ.</li>
<li><strong>mensagem_sefaz</strong>: Mensagem da SEFAZ.</li>
<li><strong>status</strong>: erro se não foi possível fazer a manifestação (consulte a mensagem de erro em mensagem_sefaz) ou evento_registrado se a manifestação foi registrada com sucesso à NFe.</li>
<li><strong>protocolo</strong>: Protocolo do recebimento na SEFAZ.</li>
</ul>

<p>Caso queria consultar o desacordo realizado, utilize o seguinte endereço:</p>

<p><code>https://api.focusnfe.com.br/v2/ctes_recebidas/CHAVE/manifesto</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para consultar os dados da nota fiscal.</p>

<p>Na URL, informe em <strong>CHAVE</strong> a chave da CTe recebida. O retorno será o mesmo que a operação de manifestação.</p>

<blockquote>
<p>Exemplo de como consultar o desacordo de uma CTe</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/ctes_recebidas/"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s">"chave_da_nota_fiscal"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/desacordo"</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsultarUltimaManifestacao</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">chave</span> <span class="o">=</span> <span class="s">"Chave_de_identificação_da_NFe"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/ctes_recebidas/"</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/desacordo"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span>  <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s2">"chave_de_identificacao_da_NFe"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/ctes_recebidas/"</span> <span class="o">+</span> <span class="n">chave</span> <span class="o">+</span> <span class="s2">"/desacordo"</span>

<span class="c1"># criamos uma objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// Solicite o seu token para realizar as requisições com nossa equipe de suporte.
</span> <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
 <span class="nv">$chave</span> <span class="o">=</span> <span class="s2">"Chave_de_identificação_da_NFe"</span><span class="p">;</span>
<span class="c1">// Para ambiente de Produção, utilize a URL: https://api.focusnfe.com.br/.  
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span><span class="p">;</span>

 <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"v2/ctes_recebidas/"</span><span class="o">.</span><span class="nv">$chave</span><span class="o">.</span><span class="s2">"/desacordo"</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="cm">/* Métodos para realizar a autenticação básica do HTTP.
   Não é necessário informar campo senha, apenas o campo login. */</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// Mostra na tela o HTTP Code da sua requisição.
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="p">);</span>
<span class="c1">// Mostra na tela a mensagem de retorno da API.   
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="p">);</span>
 <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><h2 id='manifestacao-cte-beta_consulta-de-cte-recebidas'>Consulta de CTe Recebidas</h2>
<p>Uma CTe recebida pode ter suas informações atualizadas ao longo do tempo. Quando a receita informa que uma CTe foi emitida contra a empresa, recebemos o XML completa desta CTe e a receita poderá posteriormente notificar quando a CTe recebe uma carta de correção ou quando ela é cancelada.</p>

<p>As CTes recebidas possuem um campo chamado “<strong>versao</strong>” que é único entre todos os documentos do mesmo CNPJ e que é atualizado a cada alteração nesta CTe. Isto facilita a busca apenas dos documentos que seu sistema ainda não conhece, sendo necessário que você armazene apenas um número por CNPJ.</p>

<p>Por exemplo, se você recebe uma CTe com versao = 60, e ela posteriormente receber uma carta de correção ou for cancelada, sua versão será atualizada para algum número maior que 60.</p>

<p>A API busca as últimas atualizações da SEFAZ de hora em hora.</p>

<p><strong>Método de consulta</strong></p>

<blockquote>
<p>Exemplo de como consultar todas as notas recebidas de uma empresa.</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/ctes_recebidas?cnpj="</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">cnpj</span> <span class="o">=</span> <span class="s">"cnpj_do_destinatario_da_nota"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">cnpj</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  <span class="s2">"https://homologacao.focusnfe.com.br/v2/ctes_recebidas?cnpj=SEU_CNPJ"</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsultarTodosManifestos</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">cnpj</span> <span class="o">=</span> <span class="s">"CNPJ_da_sua_empresa"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/ctes_recebidas?cnpj="</span><span class="o">+</span><span class="n">cnpj</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span>  <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="n">cnpj</span> <span class="o">=</span> <span class="s2">"CNPJ_da_sua_empresa"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/ctes_recebidas?cnpj="</span> <span class="o">+</span> <span class="n">cnpj</span>

<span class="c1"># criamos uma objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// Solicite o seu token para realizar as requisições com nossa equipe de suporte.
</span> <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
 <span class="nv">$cnpj</span> <span class="o">=</span> <span class="s2">"CNPJ_da_sua_empresa"</span><span class="p">;</span>
<span class="c1">// Para ambiente de Produção, utilize a URL: https://api.focusnfe.com.br/.  
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span><span class="p">;</span>

 <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
   <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"v2/ctes_recebidas?cnpj="</span><span class="o">.</span><span class="nv">$cnpj</span><span class="p">);</span>
   <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
   <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="cm">/* Métodos para realizar a autenticação básica do HTTP.
   Não é necessário informar campo senha, apenas o campo login. */</span>  
   <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
   <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">"</span><span class="p">);</span>

 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// Mostra na tela o HTTP Code da sua requisição.
</span>   <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="p">);</span>
<span class="c1">// Mostra na tela a mensagem de retorno da API.   
</span>   <span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="p">);</span>
   <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
A orientacao a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">cnpj</span> <span class="o">=</span> <span class="s2">"cnpj_do_destinatario_da_nota"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/ctes_recebidas?cnpj="</span> <span class="o">+</span> <span class="nx">cnpj</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<p>Para consultar os documentos fiscais recebidos, utilize o endereço abaixo:</p>

<p><code>https://api.focusnfe.com.br/v2/ctes_recebidas?cnpj=CNPJ</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para consultar as notas. Esta requisição aceita os seguintes parâmetros que deverão ser enviados na URL:</p>

<ul>
<li><strong>cnpj</strong>(*): CNPJ da empresa. Campo obrigatório.</li>
<li><strong>versao</strong>: Se informado, irá buscar apenas os documentos cuja versão seja maior que o parâmetro recebido. Utilize este parâmetro para buscar apenas as notas que seu sistema ainda não conhece.</li>
</ul>

<p>Serão devolvidas as 100 primeiras notas encontradas. Para recuperar as demais notas você deverá fazer uma nova requisição alterando o campo versão.</p>

<blockquote>
<p>Exemplo dos dados de resposta:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"nome_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Empresa emitente Ltda."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"documento_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"79160190000193"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chave"</span><span class="p">:</span><span class="s2">"35191008165642000152570020004201831004201839"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"valor_total"</span><span class="p">:</span><span class="s2">"295.66"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data_emissao"</span><span class="p">:</span><span class="s2">"2019-10-07T23:44:00-03:00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"situacao"</span><span class="p">:</span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tipo_cte"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"versao"</span><span class="p">:</span><span class="mi">1709</span><span class="p">,</span><span class="w">
    </span><span class="s2">"digest_value"</span><span class="p">:</span><span class="s2">"Xa/AO4zX/qSMh13ILIh1V7GTAQ3="</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cnpj_destinatario"</span><span class="p">:</span><span class="s2">"24178617000110"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p><strong>Dados devolvidos</strong></p>

<p>A API irá devolver os seguintes cabeçalhos HTTP:</p>

<ul>
<li><strong>X-Total-Count</strong>: O número total de registros (incluindo aqueles que não foram devolvidos pelo limite de 100 registros)</li>
<li><strong>X-Max-Version</strong>: Valor máximo da versão dos documentos devolvidos. Utilize este cabeçalho para utilizar na próxima busca de versão, caso seja necessário.</li>
</ul>

<p>Os dados devolvidos no corpo da requisição serão um array de objetos em JSON no seguinte formato:</p>

<ul>
<li><strong>nome_emitente</strong>: Nome do emitente do documento fiscal.</li>
<li><strong>documento_emitente</strong>: CNPJ ou CPF do emitente do documento fiscal.</li>
<li><strong>cnpj_destinatario</strong>: CNPJ do destinatário do documento (o CNPJ de sua empresa).</li>
<li><strong>chave</strong>: Chave do documento fiscal.</li>
<li><strong>valor_total</strong>: Valor total da NFe.</li>
<li><strong>data_emissao</strong>: Data de emissão da NFe.</li>
<li><strong>situacao</strong>: Situação do documento. Pode ser: autorizada, cancelada ou denegada.</li>
<li><strong>tipo_cte</strong>:

<ul>
<li><strong>0</strong>: CT-e normal;</li>
<li><strong>1</strong>: CT-e de complementação de valores;</li>
<li><strong>2</strong>: CT-e de anulação;</li>
<li><strong>3</strong>: CT-e substituto.</li>
</ul></li>
<li><strong>versao</strong>: Versão do documento fiscal. Este número irá mudar apenas se o documento for alterado de alguma forma.</li>
<li><strong>digest_value</strong>: Valor do resumo digital do XML do documento.</li>
<li><strong>carta_correcao</strong>: Conteúdo da carta de correção, se houver.</li>
<li><strong>data_carta_correcao</strong>: Data da carta de correção, se houver.</li>
<li><strong>data_cancelamento</strong>: Data do cancelamento, se o documento estiver cancelado.</li>
<li><strong>justificativa_cancelamento</strong>: Justificativa do cancelamento, se o documento estiver cancelado.</li>
</ul>
<h2 id='manifestacao-cte-beta_consulta-de-cte-individuais'>Consulta de CTe individuais</h2>
<p>Disponibilizamos diversos métodos para obter mais informações de um documento recebido conforme mostramos a seguir:</p>

<p><strong>Pesquisa de um documento por chave</strong></p>

<p>Para pesquisar as informações específicas de uma CTe, consulte:</p>

<p><code>https://api.focusnfe.com.br/v2/ctes_recebidas/CHAVE</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para consultar os dados da nota fiscal.</p>

<p>Isto irá devolver os mesmos campos descritos no item 2.2. Você pode solicitar também os dados completos do documento informando o parâmetro <strong>completa=1</strong>, da seguinte forma:</p>

<p><code>https://api.focusnfe.com.br/v2/ctes_recebidas/CHAVE?completa=1</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para consultar os dados da nota fiscal.</p>

<p>Isto irá adicionar os seguintes campos:</p>

<ul>
<li><strong>mdfes</strong>: Lista de todas as MDFes associadas a CTe, se aplicável.</li>
<li><strong>requisicao</strong>: Dados completos do documento em formato JSON.</li>
<li><strong>protocolo</strong>: Dados completos do retorno do SEFAZ em formato JSON.</li>
</ul>
<h2 id='manifestacao-cte-beta_download-de-xml'>Download de XML</h2>
<blockquote>
<p>Exemplo de como realizar o download do XML de um documento específico.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">chave</span> <span class="o">=</span> <span class="s2">"chave_da_nota_fiscal"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/ctes_recebidas/"</span> <span class="o">+</span> <span class="nx">chave</span> <span class="o">+</span> <span class="s2">".xml"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/ctes_recebidas/"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s">"chave_da_nota_fiscal"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">".xml"</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/ctes_recebidas/CHAVE.xml
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DownloadNotaEspecificaXml</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">chave</span> <span class="o">=</span> <span class="s">"Chave_de_identificação_da_NFe"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/ctes_recebidas/"</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">".xml"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span>  <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s2">"chave_de_identificacao_da_NFe"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/ctes_recebidas/"</span> <span class="o">+</span> <span class="n">chave</span> <span class="o">+</span> <span class="s2">".xml"</span>

<span class="c1"># criamos uma objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// Solicite o seu token para realizar as requisições com nossa equipe de suporte.
</span> <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
 <span class="nv">$chave</span> <span class="o">=</span> <span class="s2">"Chave_de_identificação_da_NFe"</span><span class="p">;</span>
<span class="c1">// Para ambiente de Produção, utilize a URL: https://api.focusnfe.com.br/.  
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span><span class="p">;</span>
 <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"v2/ctes_recebidas/"</span><span class="o">.</span><span class="nv">$chave</span><span class="o">.</span><span class="s2">".xml"</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="cm">/* Métodos para realizar a autenticação básica do HTTP.
   Não é necessário informar campo senha, apenas o campo login. */</span>  
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// Mostra na tela o HTTP Code da sua requisição.
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="p">);</span>
<span class="c1">// Converte os dados de XML para objeto, mostrando o retorno bruto.
</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nb">simplexml_load_string</span><span class="p">(</span><span class="nv">$body</span><span class="p">));</span>
 <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre>
<blockquote>
<p>Exemplo de como fazer o download, no formato JSON, do XML de uma Nota Fiscal Eletrônica especifica.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">chave</span> <span class="o">=</span> <span class="s2">"chave_da_nota_fiscal"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/ctes_recebidas/"</span> <span class="o">+</span> <span class="nx">chave</span> <span class="o">+</span> <span class="s2">".json?completa=1"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/ctes_recebidas/"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s">"chave_da_nota_fiscal"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">".json?completa=1"</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="n">l</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  <span class="s2">"https://homologacao.focusnfe.com.br/v2/ctes_recebidas/CHAVE.json?completa=1"</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DownloadNotaEspecifica</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">chave</span> <span class="o">=</span> <span class="s">"Chave_de_identificação_da_NFe"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/ctes_recebidas/"</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">".json?completa=1"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span>  <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s2">"chave_de_identificacao_da_NFe"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/ctes_recebidas/"</span> <span class="o">+</span> <span class="n">chave</span> <span class="o">+</span> <span class="s2">".json?completa=1"</span>

<span class="c1"># criamos uma objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// Solicite o seu token para realizar as requisições com nossa equipe de suporte.
</span> <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
 <span class="nv">$chave</span> <span class="o">=</span> <span class="s2">"Chave_de_identificação_da_NFe"</span><span class="p">;</span>
<span class="c1">// Para ambiente de Produção, utilize a URL: https://api.focusnfe.com.br/.  
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span><span class="p">;</span>
 <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"v2/ctes_recebidas/"</span><span class="o">.</span><span class="nv">$chave</span><span class="o">.</span><span class="s2">".json?completa=1"</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="cm">/* Métodos para realizar a autenticação básica do HTTP.
   Não é necessário informar campo senha, apenas o campo login. */</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// Mostra na tela o HTTP Code da sua requisição.
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="p">);</span>
<span class="c1">// Mostra na tela a mensagem de retorno da API.   
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="p">);</span>
 <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre>
<blockquote>
<p>Exemplo de como fazer o download do XML de cancelamento de um documento</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">chave</span> <span class="o">=</span> <span class="s2">"chave_da_nota_fiscal"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/ctes_recebidas/"</span> <span class="o">+</span> <span class="nx">chave</span> <span class="o">+</span> <span class="s2">"/cancelamento.xml"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/ctes_recebidas/"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s">"chave_da_nota_fiscal"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/cancelamento.xml"</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/ctes_recebidas/CHAVE/cancelamento.xml
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DownloadCancelamentoXml</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">chave</span> <span class="o">=</span> <span class="s">"Chave_de_identificação_da_NFe"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/ctes_recebidas/"</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/cancelamento.xml"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span>  <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s2">"chave_de_identificacao_da_NFe"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/ctes_recebidas/"</span> <span class="o">+</span> <span class="n">chave</span> <span class="o">+</span> <span class="s2">"/cancelamento.xml"</span>

<span class="c1"># criamos uma objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// Solicite o seu token para realizar as requisições com nossa equipe de suporte.
</span> <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
 <span class="nv">$chave</span> <span class="o">=</span> <span class="s2">"Chave_de_identificação_da_NFe"</span><span class="p">;</span>
<span class="c1">// Para ambiente de Produção, utilize a URL: https://api.focusnfe.com.br/.  
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span><span class="p">;</span>
 <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"v2/ctes_recebidas/"</span><span class="o">.</span><span class="nv">$chave</span><span class="o">.</span><span class="s2">"/cancelamento.xml"</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="cm">/* Métodos para realizar a autenticação básica do HTTP.
   Não é necessário informar campo senha, apenas o campo login. */</span>   
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// Mostra na tela o HTTP Code da sua requisição.
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="p">);</span>
<span class="c1">// Converte os dados de XML para objeto, mostrando o retorno bruto.
</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nb">simplexml_load_string</span><span class="p">(</span><span class="nv">$body</span><span class="p">));</span>
 <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre>
<blockquote>
<p>Exemplo de como realizar o download do XML de um documento específico com Carta de Correção Eletrônica.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">chave</span> <span class="o">=</span> <span class="s2">"chave_da_nota_fiscal"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/ctes_recebidas/"</span> <span class="o">+</span> <span class="nx">chave</span> <span class="o">+</span> <span class="s2">"/carta_correcao.xml"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/ctes_recebidas/"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s">"chave_da_nota_fiscal"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/carta_correcao.xml"</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/ctes_recebidas/CHAVE/carta_correcao.xml
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DownloadXmlCce</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">chave</span> <span class="o">=</span> <span class="s">"Chave_de_identificação_da_NFe"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/ctes_recebidas/"</span><span class="o">+</span><span class="n">chave</span><span class="o">+</span><span class="s">"/carta_correcao.xml"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span>  <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">httpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="n">chave</span> <span class="o">=</span> <span class="s2">"chave_de_identificacao_da_NFe"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/ctes_recebidas/"</span> <span class="o">+</span> <span class="n">chave</span> <span class="o">+</span> <span class="s2">"/carta_correcao.xml"</span>

<span class="c1"># criamos uma objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Get a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// Solicite o seu token para realizar as requisições com nossa equipe de suporte.
</span> <span class="nv">$login</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>
 <span class="nv">$chave</span> <span class="o">=</span> <span class="s2">"Chave_de_identificação_da_NFe"</span><span class="p">;</span>
<span class="c1">// Para ambiente de Produção, utilize a URL: https://api.focusnfe.com.br/.  
</span> <span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span><span class="p">;</span>
 <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"v2/ctes_recebidas/"</span><span class="o">.</span><span class="nv">$chave</span><span class="o">.</span><span class="s2">"/carta_correcao.xml"</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="c1">// Métodos para realizar a autenticação básica do HTTP.
// Não é necessário informar campo senha, apenas o campo login.
</span> <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
 <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"</span><span class="nv">$login</span><span class="s2">"</span><span class="p">);</span>
 <span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
 <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// Mostra na tela o HTTP Code da sua requisição.
</span> <span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="p">);</span>
<span class="c1">// Converte os dados de XML para objeto, mostrando o retorno bruto.
</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nb">simplexml_load_string</span><span class="p">(</span><span class="nv">$body</span><span class="p">));</span>

   <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre>
<p>Também é possível fazer o download do XML das notas fiscais através da API, basta informar a chave de identificação da respectiva nota no parâmetro CHAVE:</p>

<p><strong>Baixar o XML de uma nota fiscal especifica:</strong></p>

<p><code>https://api.focusnfe.com.br/v2/ctes_recebidas/CHAVE.xml</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para obter os dados das notas no formato XML.</p>

<p><strong>Baixar o XML, em formato json, de uma nota fiscal especifica:</strong></p>

<p><code>https://api.focusnfe.com.br/v2/ctes_recebidas/CHAVE.json?completa=1</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para obter os dados das notas no formato XML.</p>

<p><strong>Baixar o XML de cancelamento de uma nota fiscal:</strong></p>

<p><code>https://api.focusnfe.com.br/v2/ctes_recebidas/CHAVE/cancelamento.xml</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para obter os dados das notas no formato XML.</p>

<p><strong>Baixar o XML da última Carta de Correção Eletrônica de uma nota fiscal:</strong></p>

<p><code>https://api.focusnfe.com.br/v2/ctes_recebidas/CHAVE/carta_correcao.xml</code></p>

<p>Utilize o método <strong>HTTP GET</strong> para obter os dados das notas no formato XML.</p>
<h1 id='backups-nfe-nfce-e-cte_backups-nfe-nfce-e-cte'>Backups (NFe, NFCe e CTe)</h1>
<p>Atualmente, realizamos o backup de todos os arquivos XML’s das notas fiscais emitidas pela nossa API. Vale lembrar que o XML é um arquivo com validade legal e deve ser armazenado pelos emitentes, para fins fiscais, por no mínimo 5 anos após a emissão.</p>

<p>Mensalmente a API gera um arquivo compactado em formato ZIP com todos os arquivos gerados de cada empresa.</p>

<p>A consulta dos arquivos de backup pode ser feito com a URL abaixo:</p>

<p><code>https://api.focusnfe.com.br/v2/backups/CNPJ.json</code></p>

<p>Utilize o comando HTTP GET para consultar o seu backup em nossa API.</p>

<p>Onde CNPJ é o CNPJ da empresa a ser consultada. Está requisição irá devolver um objeto com os seguintes atributos:</p>

<ul>
<li><strong>backups</strong>: Array de objetos contendo:

<ul>
<li><strong>mes</strong>: Mês do backup no formato AAAAMM”, ex: “201701”</li>
<li><strong>danfes</strong>: Caminho para baixar arquivo ZIP com as DANFEs geradas (NFe)</li>
<li><strong>xmls</strong>: Caminho para baixar arquivo ZIP com os XMLs gerados (NFe e NFCe)</li>
</ul></li>
</ul>

<p>Os backups serão mantidos por 6 meses em nossos servidores.</p>
<h2 id='backups-nfe-nfce-e-cte_momentos-de-geracao-e-cuidados-necessarios'>Momentos de geração e cuidados necessários</h2>
<p>O backup é gerado no primeiro dia de cada mês e uma parcial do arquivo é gerado todo sábado com as notas emitidas até então.</p>

<p>Para fins de apuração de imposto, recomendamos que a contabilidade responsável valide as notas recebidas, pois algumas exceções podem ocorrer, por exemplo:</p>

<ul>
<li>Podem ocorrer emissões de notas com datas retroativas mas posteriores ao download do XML. Neste caso o arquivo será atualizado semanalmente aos sábados.</li>
<li>É possível que notas tenham sido emitidas usando outros sistemas, então não podemos garantir que todas as notas da empresa estejam presentes.</li>
<li>Deverá ser considerado o tempo de geração do arquivo, pois dependendo do volume de notas o arquivo pode ficar disponível apenas ao final do dia primeiro. Recomendamos que o download dos arquivos seja feita apenas a partir do dia 2 de cada mês.</li>
</ul>
<h1 id='gatilhos-webhooks_gatilhos-webhooks'>Gatilhos / Webhooks</h1><h2 id='gatilhos-webhooks_informacoes-gerais'>Informações gerais</h2>
<p>Gatilhos ou &quot;WebHooks&quot; são eventos automáticos que são disparados a partir de mudanças especificas na nota fiscal. Quando isso ocorre, é enviado os dados da nota fiscal no formato JSON para uma URL da sua escolha através do método POST. Cada acionamento do gatilho contém os dados de apenas uma nota. Abaixo segue um exemplo de como a API enviará as seguintes informações para sua URL, caso a nota autorizada seja uma NFe:</p>

<blockquote>
<p>Dados enviados para sua URL:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"cnpj_emitente"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07504505000132"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"teste_webhooks"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"autorizado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem_sefaz"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Autorizado o uso da NF-e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"chave_nfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NFe77777075045050001329999930000002999999991249"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numero"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_xml_nota_fiscal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/99999999999972/201313/XMLs/77777075045050001329999930000002999999991249-nfe.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"caminho_danfe"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/arquivos_development/99999999999972/201313/DANFEs/77777075045050001329999930000002999999991249.pdf"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Para NFe e MDe (Manifestação de Destinatário Eletrônica):</p>

<ul>
<li><strong>status</strong>:

<ul>
<li><strong>processando_autorizacao</strong>: A nota ainda está em processamento pela API. Você deverá aguardar o processamento pela SEFAZ.</li>
<li><strong>autorizado</strong>: A nota foi autorizada, neste caso é fornecido os dados completos da nota como chave e arquivos para download</li>
<li><strong>cancelado</strong>: O documento foi cancelado, neste caso é fornecido o caminho para download do XML de cancelamento (caminho_xml_cancelamento).</li>
<li><strong>erro_autorizacao</strong>: Houve um erro de autorização por parte da SEFAZ. A mensagem de erro você encontrará nos campos status_sefaz e mensagem_sefaz. É possível fazer o reenvio da nota com a mesma referência se ela estiver neste estado.</li>
<li><strong>denegado</strong>: O documento foi denegado. Uma SEFAZ pode denegar uma nota se houver algum erro cadastral nos dados do destinatário ou do emitente. A mensagem de erro você encontrará nos campos status_sefaz e mensagem_sefaz. Não é possível reenviar a nota caso este estado seja alcançado pois é gerado um número, série, chave de NFe e XML para esta nota. O XML deverá ser armazenado pelo mesmo período de uma nota autorizada ou cancelada.</li>
</ul></li>
<li><strong>status_sefaz</strong>: O status da nota na SEFAZ.</li>
<li><strong>mensagem_sefaz</strong>: Mensagem descritiva da SEFAZ detalhando o status.</li>
<li><strong>serie</strong>: A série da nota fiscal, caso ela tenha sido autorizada.</li>
<li><strong>numero</strong>: O número da nota fiscal, caso ela tenha sido autorizada.</li>
<li><strong>cnpj_emitente</strong>: O CNPJ emitente da nota fiscal (o CNPJ de sua empresa).</li>
<li><strong>ref</strong>:A referência da emissão.</li>
<li><strong>chave_nfe</strong>: A chave da NFe, caso ela tenha sido autorizada.</li>
<li><strong>caminho_xml_nota_fiscal</strong>: caso a nota tenha sido autorizada, retorna o caminho para download do XML.</li>
<li><strong>caminho_danfe</strong>: caso a nota tenha sido autorizada retorna o caminho para download do DANFe.</li>
<li><strong>caminho_xml_carta_correcao</strong>: caso tenha sido emitida alguma carta de correção, aqui aparecerá o caminho para fazer o download do XML.</li>
<li><strong>caminho_pdf_carta_correcao</strong>: caso tenha sido emitida alguma carta de correção, aqui aparecerá o caminho para fazer o download do PDF da carta.</li>
<li><strong>numero_carta_correcao</strong>: o número da carta de correção, caso tenha sido emitida.</li>
<li><strong>caminho_xml_cancelamento</strong>: Caso a nota esteja cancelada, é fornecido o caminho para fazer o download do XML de cancelamento.</li>
</ul>

<p>Ressaltamos que os campos devolvidos são os mesmos da consulta da nota fiscal. Veja o tópico <a href="https://focusnfe.com.br/doc/#nfe_consulta"><strong>Consulta</strong></a> na categoria NFe.</p>

<p>Para NFSe:</p>

<ul>
<li><strong>cnpj_prestador</strong>: CNPJ do prestador do serviço.</li>
<li><strong>ref</strong>: A referência da emissão.</li>
<li><strong>numero_rps</strong>: Número do RPS da nota.</li>
<li><strong>serie_rps</strong>: Série do RPS da nota.</li>
<li><strong>status</strong>:

<ul>
<li><strong>processando_autorizacao</strong>: A nota ainda está em processamento pela API. Você deverá aguardar o processamento da Prefeitura.</li>
<li><strong>autorizado</strong>: A nota foi autorizada, neste caso é fornecido os dados completos da nota como chave e arquivos para download</li>
<li><strong>cancelado</strong>: O documento foi cancelado, neste caso é fornecido o caminho para download do XML de cancelamento (caminho_xml_cancelamento).</li>
<li><strong>erro_autorizacao</strong>: Houve um erro de autorização por parte da Prefeitura. É possível fazer o reenvio da nota com a mesma referência se ela estiver neste estado.</li>
</ul></li>
<li><strong>numero</strong>: Número da nota fiscal.</li>
<li><strong>codigo_verificacao</strong>: Código de verificação gerado pela Prefeitura.</li>
<li><strong>data_emissao</strong>: Data da emissão da nota fiscal.</li>
<li><strong>url</strong>: URL para visualização da nota fiscal a partir do portal da Prefeitura.</li>
<li><strong>caminho_xml_nota_fsical</strong>: Caminho para download do XML da nota fiscal.</li>
<li><strong>erros</strong>: Grupo contendo os detalhes do erro de emissão.

<ul>
<li><strong>codigo</strong>: Código do erro na prefeitura.</li>
<li><strong>mensagem</strong>: Mensagem de erro enviada pela prefeitura.</li>
<li><strong>correcao</strong>: Orientação do que deve ser feito para corrigir o erro.</li>
</ul></li>
</ul>

<p>Ressaltamos que os campos devolvidos são os mesmos da consulta da nota fiscal. Veja o tópico <a href="https://focusnfe.com.br/doc/#nfse_consulta"><strong>Consulta</strong></a> na categoria NFSe.</p>

<p>A vantagem de utilizar gatilhos é que não haverá a necessidade de fazer &quot;polling&quot; (realizar constantes requisições a fim de verificar o status da nota).</p>

<p>Na ocorrência de falha na execução do POST para a URL definida (exemplo: servidor fora do ar ou alguma resposta HTTP diferente de 20X) a API tentará um reenvio nos seguintes intervalos: 1 minuto, 30 minutos, 1 hora, 3 horas, 24 horas até o momento em que a API irá desistir de acionar o gatilho.</p>
<h2 id='gatilhos-webhooks_status-api'>Status API</h2>
<p>Aqui você encontra os status possíveis para os gatilhos (webhooks).</p>

<table><thead>
<tr>
<th>HTTP CODE/STATUS</th>
<th>Status API Focus</th>
<th>Descrição</th>
<th>Correção</th>
</tr>
</thead><tbody>
<tr>
<td>404 - not found</td>
<td>nao_encontrado</td>
<td>Seu gatilho não foi encontrado.</td>
<td>Verifique se o seu gatilho foi criado com sucesso. Consulte nossa documentação.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>Parâmetro &quot;event&quot; deve ser nfe, nfse ou nfe_recebida.</td>
<td>Informe um dos valores esperados para o parâmetro &quot;event&quot; e tente novamente.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>Já existe um gatilho para este evento.</td>
<td>Não é possível ter mais de um gatilho por evento.</td>
</tr>
<tr>
<td>400 - bad request</td>
<td>requisicao_invalida</td>
<td>URL inválida: X</td>
<td>Onde X é a URL inválida informado no retorno da API. Consulte nossa documentação.</td>
</tr>
</tbody></table>
<h2 id='gatilhos-webhooks_eventos'>Eventos</h2>
<p>Os seguintes eventos causam o acionamento do gatilho:</p>

<ul>
<li><strong>NFe</strong>:

<ul>
<li>Erro na emissão de uma nota fiscal</li>
<li>Emissão de nota fiscal realizada com sucesso</li>
<li>Inutilização de faixa de numeração</li>
</ul></li>
<li><strong>NFSe</strong>:

<ul>
<li>Erro na emissão de uma nota fiscal</li>
<li>Emissão de nota fiscal realizada com sucesso</li>
<li>Inutilização de faixa de numeração</li>
</ul></li>
<li><strong>Documentos fiscais recebidos (manifestação)</strong>:

<ul>
<li>Recebimento de um novo documento fiscal (CTe, NFe ou NFSe)</li>
</ul></li>
</ul>

<p>Os gatilhos para autorização de CTe deverão ser disponibilizados em breve.</p>
<h2 id='gatilhos-webhooks_criacao'>Criação</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/hooks"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="s">'''
Usamos um dicionario para armazenar os campos e valores que em seguida,
serao convertidos a JSON e enviados para nossa API
'''</span>
<span class="n">dados</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dados</span><span class="p">[</span><span class="s">"cnpj"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"51916585000125"</span>
<span class="n">dados</span><span class="p">[</span><span class="s">"event"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"nfe"</span>
<span class="n">dados</span><span class="p">[</span><span class="s">"url"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"http://minha.url/nfe"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dados</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -X POST -d <span class="s1">'{"cnpj":"51916585000125","event":"nfe","url":"http://minha.url/nfe"}'</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/hooks
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/hooks"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">"cnpj"</span> <span class="o">=&gt;</span> <span class="s2">"51916585000125"</span><span class="p">,</span>
  <span class="s2">"event"</span> <span class="o">=&gt;</span> <span class="s2">"nfe"</span><span class="p">,</span> <span class="s2">"url"</span> <span class="o">=&gt;</span> <span class="s2">"http://minha.url/nfe"</span><span class="p">)));</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"token obtido no cadastro da empresa:"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExemploCriacaoHook</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JSONException</span><span class="o">{</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/hooks"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="cm">/* Aqui são criados as hash's que receberão os dados da nota. */</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">hook</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>

        <span class="n">hook</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cnpj"</span><span class="o">,</span> <span class="s">"51916585000125"</span><span class="o">);</span>
        <span class="n">hook</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"event"</span><span class="o">,</span> <span class="s">"nfe"</span><span class="o">);</span>
        <span class="n">hook</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"url"</span><span class="o">,</span> <span class="s">"http://minha.url/nfe"</span><span class="o">);</span>

        <span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span> <span class="o">(</span><span class="n">hook</span><span class="o">);</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">json</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">HttpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/hooks"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">gatilho</span> <span class="o">=</span> <span class="p">{</span>

  <span class="s2">"cnpj"</span><span class="p">:</span><span class="s2">"51916585000125"</span><span class="p">,</span>
  <span class="s2">"event"</span><span class="p">:</span><span class="s2">"nfe"</span><span class="p">,</span>
  <span class="s2">"url"</span><span class="p">:</span><span class="s2">"http://minha.url/nfe"</span>
<span class="p">};</span>

<span class="c1">// Aqui fazermos a serializacao do JSON com os dados da nota e enviamos atraves do metodo usado.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">gatilho</span><span class="p">));</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<blockquote>
<p>Dados de resposta de gatilho criado com sucesso</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Vj5rmkBq"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://minha.url/nfe"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"authorization"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nfe"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="w"> </span><span class="s2">"51916585000125"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Para criar um novo gatilho, utilize o endereço abaixo:</p>

<p><code>https://api.focusnfe.com.br/v2/hooks</code></p>

<p>Utilize o método HTTP POST para criar um novo gatilho. Esta requisição aceita os seguintes parâmetros que deverão ser enviados em formato JSON:</p>

<ul>
<li> <strong>cnpj</strong> – CNPJ da empresa. Se o CNPJ for omitido, o gatilho será acionado para todas as emissões feitas pelo token em questão.</li>
<li> <strong>event</strong> – Informe qual evento que gostará de escutar: nfe, nfse, nfe_recebida, nfse_recebida, inutilizacao</li>
<li> <strong>url</strong> – URL que deverá ser chamada quando o gatilho for ativado</li>
<li> <strong>authorization</strong> – (opcional) O valor que for informado neste campo será devolvido no acionamento do gatilho no cabeçalho &quot;Authorization&quot;.
Desta forma você poderá por exemplo informar um token secreto para garantir que apenas nossa API acione a sua URL.</li>
</ul>

<p>A API irá devolver como resposta o gatilho criado. É possível ter mais de um gatilho por evento. Note que o gatilho pode ser por empresa ou um gatilho genérico para todas as emissões feitas usando o token informado.</p>

<p><strong>Dicas para uso do campo authorization</strong>: O propósito deste campo é garantir que a sua URL não seja acessada por nenhum outro serviço que não o nosso. Sugerimos duas formas de usar este campo: você pode usar um token secreto, por exemplo: &quot;lFNVw8q5WMeR3U9FOVOABTp36zrkvtaa&quot;. Desta forma, nossa API irá enviar sempre o seguinte cabeçalho ao acionar o gatilho:</p>

<p><code>Authorization: lFNVw8q5WMeR3U9FOVOABTp36zrkvtaa</code></p>

<p>Este cabeçalho poderá ser verificado do lado do seu sistema, rejeitando requisições que não incluam este cabeçalho. Outra forma de utilizar este campo é usando o método <a href="https://en.wikipedia.org/wiki/Basic_access_authentication">Basic Auth</a>. Este método consiste em usar uma string no formato &quot;Basic YWxndW11c3VhcmlvOmFsZ3VtYXNlbmhh&quot;, onde a última string é o resultado da concatenação de &quot;algumusuario:algumasenha&quot;, e depois aplicada a codificação em Base64. Usando este método, você poderá usar alguma biblioteca disponível na sua linguagem de proramação e simplesmente testar o recebimento do usuário &quot;algumusuario&quot; com a senha &quot;algumasenha&quot;.</p>
<h2 id='gatilhos-webhooks_consulta'>Consulta</h2><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/hooks/"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">hook_id</span> <span class="o">=</span> <span class="s">"Vj5rmkBq"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">hook_id</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="n">l</span>


</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/hooks/Vj5rmkBq
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nv">$hook_id</span> <span class="o">=</span> <span class="s2">"Vj5rmkBq"</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/hooks/"</span> <span class="o">.</span> <span class="nv">$hook_id</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"token obtido no cadastro da empresa:"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExemploConsultaHook</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
        <span class="n">String</span> <span class="n">hookId</span> <span class="o">=</span> <span class="s">"Vj5rmkBq"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/hooks/"</span><span class="o">+</span><span class="n">hookId</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">HttpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">HttpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">hook_id</span> <span class="o">=</span> <span class="s2">"n65g0RP1"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/hooks/"</span> <span class="o">+</span> <span class="nx">hook_id</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<blockquote>
<p>Dados de resposta de consulta de um gatilho individual</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Vj5rmkBq"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://minha.url/nfe"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"authorization"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nfe"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="w"> </span><span class="s2">"51916585000125"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Existem duas formas de consultar os gatilhos disponíveis, utilize o endereço abaixo:</p>

<p><code>https://api.focusnfe.com.br/v2/hooks</code></p>

<p>Utilize o método HTTP <strong>GET</strong> para consultar <strong>todos</strong> os gatilhos criados. Serão exibidos os gatilhos de todas as empresas que seu token possui acesso.</p>

<p>Para consultar apenas um gatilho individualmente, utilize a URL:</p>

<p><code>https://api.focusnfe.com.br/v2/hooks/HOOK_ID</code></p>

<p>Substituindo HOOK_ID pelo identificador do gatilho.</p>
<h2 id='gatilhos-webhooks_exclusao'>Exclusão</h2><pre class="highlight python tab-python"><code> <span class="n">Fa</span><span class="err">ç</span><span class="n">a</span> <span class="n">o</span> <span class="n">download</span> <span class="n">e</span> <span class="n">instala</span><span class="err">çã</span><span class="n">o</span> <span class="n">da</span> <span class="n">biblioteca</span> <span class="n">requests</span><span class="p">,</span> <span class="n">atrav</span><span class="err">é</span><span class="n">s</span> <span class="n">do</span> <span class="n">python</span><span class="o">-</span><span class="n">pip</span><span class="o">.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/hooks/"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">hook_id</span> <span class="o">=</span> <span class="s">"Vj5rmkBq"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">hook_id</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


</code></pre><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> -X DELETE <span class="se">\</span>
 https://homologacao.focusnfe.com.br/v2/hooks/Vj5rmkBq
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nv">$hook_id</span> <span class="o">=</span> <span class="s2">"Vj5rmkBq"</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span> <span class="o">.</span> <span class="s2">"/v2/hooks/"</span> <span class="o">.</span> <span class="nv">$hook_id</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_CUSTOMREQUEST</span><span class="p">,</span> <span class="s2">"DELETE"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"token obtido no cadastro da empresa:"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jettison.json.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExemploExclusaoHook</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Substituir pela sua identificação interna da nota. */</span>
        <span class="n">String</span> <span class="n">hookId</span> <span class="o">=</span> <span class="s">"Vj5rmkBq"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/hooks/"</span><span class="o">+</span><span class="n">hookId</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">HttpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

       <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
        * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">HttpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">hook_id</span> <span class="o">=</span> <span class="s2">"n65g0RP1"</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/hooks/"</span> <span class="o">+</span> <span class="nx">hook_id</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'DELETE'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<blockquote>
<p>Dados de resposta da exclusão de um gatilho</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Vj5rmkBq"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://minha.url/nfe"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"authorization"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nfe"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="w"> </span><span class="s2">"51916585000125"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Para excluir um gatilho, utilize a URL</p>

<p><code>https://api.focusnfe.com.br/v2/hooks/HOOK_ID</code></p>

<p>Utilize o método HTTP <strong>DELETE</strong> para excluir o gatilho. Em caso de sucesso será exibido os dados do gatilho excluído acrescentado do atributo &quot;deleted&quot; com o valor &quot;true&quot;.</p>
<h2 id='gatilhos-webhooks_teste-e-reenvio-de-notificacoes'>Teste e reenvio de notificações</h2>
<p>Para efeitos de teste ou para recuperar notificações perdidas é possível solicitar à API o reenvio desta notificação para todos os gatilhos cadastrados.</p>

<p>Para isso é disponibilizado um endereço para cada tipo de documento que aceita gatilhos. Basta enviar uma requisição POST para os endereços abaixo:</p>

<blockquote>
<p>Dados de resposta da solicitação de reenvio de notificação de uma NFe</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">

  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Vj5rmkBq"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://minha.url/nfe"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"authorization"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nfe"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="w"> </span><span class="s2">"51916585000125"</span><span class="p">,</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<ul>
<li>NFe: <code>https://api.focusnfe.com.br/v2/nfe/REFERENCIA/hook</code></li>
<li>NFSe: <code>https://api.focusnfe.com.br/v2/nfse/REFERENCIA/hook</code></li>
<li>NFe Recebida: <code>https://api.focusnfe.com.br/v2/nfes_recebidas/CHAVE_NFE/hook</code></li>
</ul>

<p>O corpo da requisição do método POST pode ser vazio.</p>

<p>Caso a nota seja encontrada, será devolvido um array contendo todos os gatilhos que foram acionados ou um array vazio se não houver gatilhos cadastrados.</p>
<h1 id='consulta-de-emails_consulta-de-emails'>Consulta de emails</h1>
<p>Fazemos um controle de &quot;reputação&quot; de nosso serviço de email, de forma a diminuir a chance dos emails enviados serem considerados spam pelos servidores de destino. Alguns aspectos que afetam a reputação de envio:</p>

<ul>
<li>Quantidade de endereços de emails inválidos</li>
<li>Quantidade de endereços de emails inexistentes</li>
<li>Quantidade de endereços de emails com problemas (ex: usuário inexistente, usuário sem espaço em sua caixa de email)</li>
<li>Quantidade de notificações de spam por parte do destinatário da mensagem</li>
</ul>

<p>Supõe-se que servidores que enviam muitos emails com problemas são servidores utilizados para enviar email não
solicitado (spam).</p>

<p>Desta forma mantemos uma lista de emails onde foi identificado algum problema. Assim a API não irá tentar enviar novamente
um email para este endereço, ignorando o envio se necessário. Com isto procuramos manter nossa taxa de erros baixa para
que os demais servidores de emails da Internet confiem em nosso serviço.</p>

<p>Nós mantemos uma API para que possa ser consultado quais emails não irão receber nossas
mensagens devido a alguns dos problemas acima. Em alguns casos é possível solicitar a remoção do endereço de email com problema de forma que nossa API possa tentar novamente o envio em uma próxima ocasião.</p>
<h2 id='consulta-de-emails_urls'>URLs</h2>
<table><thead>
<tr>
<th>Método</th>
<th>URL (recurso)</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>GET</td>
<td>/v2/blocked_emails/EMAIL</td>
<td>Consulta um possível email bloqueado</td>
</tr>
<tr>
<td>DELETE</td>
<td>/v2/blocked_emails/EMAIL</td>
<td>Solicita exclusão do bloqueio</td>
</tr>
</tbody></table>
<h2 id='consulta-de-emails_consulta-de-email-bloqueado'>Consulta de email bloqueado</h2>
<p>Utilize o método GET com o endereço abaixo:</p>

<p><code>https://api.focusnfe.com.br/v2/blocked_emails/EMAIL</code></p>

<p>Este endereço não faz diferenciação entre ambientes (homologação e produção) pois ambos utilizam o mesmo serviço de envio
de emails.</p>
<pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  <span class="s2">"https://api.focusnfe.com.br/v2/blocked_emails/test@example.com"</span>
</code></pre>
<blockquote>
<p>Exemplo de resposta de email bloqueado</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test@example.com"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"block_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bounce"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"bounce_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"transient"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"diagnostic_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"smtp; 554 4.4.7 Message expired: unable to deliver in 1440 minutes.&lt;421 4.4.0 Unable to lookup DNS for example.com&gt;"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"blocked_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-04-16T12:24:29-03:00"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Exemplo de resposta de email não encontrado</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nao_encontrado"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Email não encontrado na lista de bloqueios"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>A API irá devolver o status HTTP 200 se o email for encontrado ou 404 se não for encontrado.</p>

<p>Os campos devolvidos são descritos abaixo:</p>

<ul>
<li>email: Email bloqueado</li>
<li>block_type: pode ser dos seguites tipos:
** bounce - O email foi devolvido por algum motivo
** complaint - O email foi marcado como spam pelo destinatário</li>
<li>bounce_type: Se o block_type for do tipo &quot;bounce&quot;, este campo irá ter um dos valores abaixo:
** transient - Indica um erro transiente que pode ser resolvido nos próximos dias. Exemplo: usuário sem espaço em sua caixa de email.
** permanent - Indica um erro considerado permanente. Exemplo: o usuário não é encontrado no domínio especificado.</li>
<li>diagnostic_code - Indica a mensagem de erro, se houver, devolvida pelo servidor de email do destinatário.</li>
<li>blocket_at - Data do bloqueio</li>
</ul>
<h2 id='consulta-de-emails_solicitacao-de-exclusao-de-email-bloqueado'>Solicitação de exclusão de email bloqueado</h2>
<p>É possível solicitar a exclusão de um bloqueio, e caso ele seja aceito, o email será removido da lista de bloqueio
podendo ser utilizado novamente.</p>

<p>Utilize o método DELETE com o endereço abaixo:</p>

<p><code>https://api.focusnfe.com.br/v2/blocked_emails/EMAIL</code></p>
<pre class="highlight shell tab-shell"><code>curl -X DELETE -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  <span class="s2">"https://api.focusnfe.com.br/v2/blocked_emails/test@example.com"</span>
</code></pre>
<blockquote>
<p>Exemplo de resposta de solicitação não atendida</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"requisicao_invalida"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mensagem"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Email bloqueado por motivo de reclamação não pode ser excluído. Entre em contato com o suporte."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Caso o endereço de email seja excluído, será devolvido o status HTTP 200. Caso o email não seja encontrado, será devolvido
o status 404. Por fim, se o email existir mas não ser possível sua exclusão será devolvido o status HTTP 422.</p>

<p>Alguns endereços podem ter sua solicitação de exclusão negada, como por exemplo endereços cujo destinatário marcou
alguma mensagem enviada pelo nosso servidor como spam. Neste caso, contate o suporte técnico para entendermos melhor a
sua solicitação.</p>
<h1 id='consulta-de-ncm_consulta-de-ncm'>Consulta de NCM</h1>
<p>NCM significa &quot;Nomenclatura Comum do Mercosul&quot; e trata-se de um código de oito dígitos estabelecido através da convenção de categorização de mercadorias adotada desde 1995 pelo Uruguai, Paraguai, Brasil e Argentina e que toma por base o Sistema Harmonizado (SH). Este código é utilizado na emissão de NFe e de NFCe.</p>

<p>Nós disponibilizamos uma API que você poderá utilizar para fornecer ao seu usuário final uma pesquisa de qual o código NCM correto do seu produto.</p>

<p>O código NCM é formato por 8 dígitos no seguinte formato:</p>

<p>CCPPSÇII, sendo:</p>

<ul>
<li>CC = Capitulo</li>
<li>PP = Posição</li>
<li>S  = Subposição 1</li>
<li>Ç  = Subposição 2</li>
<li>II = Item 1 e 2</li>
</ul>
<pre class="highlight shell tab-shell"><code><span class="c"># pesquisa por códigos NCM do capítulo 90</span>
curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/ncms?capitulo<span class="o">=</span>90
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/ncms?capitulo=90"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"token obtido no cadastro da empresa:"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExemploConsultaHook</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/ncms?capitulo=90"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">HttpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">HttpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/ncms?capitulo=90"</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/ncms?capitulo=90"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/ncms?capitulo=90"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="c1">// Aqui enviamos a requisição.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<blockquote>
<p>Dados de resposta da consulta</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
 </span><span class="p">{</span><span class="w">
   </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"90049090"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"descricao_completa"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Óculos para correção, proteção ou outros fins, e artigos semelhantes. Outros Outros"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"capitulo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"90"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"posicao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"04"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"subposicao1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"subposicao2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"item1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"item2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="w">
 </span><span class="p">},</span><span class="w">
 </span><span class="p">{</span><span class="w">
   </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"90051000"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"descricao_completa"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Binóculos, lunetas, incluindo as astronômicas, telescópios ópticos, e suas armações, outros instrumentos de astronomia e suas armações, exceto os aparelhos de radioastronomia. Binóculos"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"capitulo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"90"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"posicao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"05"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"subposicao1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"subposicao2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"item1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"item2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="w">
 </span><span class="p">},</span><span class="w">
 </span><span class="p">{</span><span class="w">
   </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"90058000"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"descricao_completa"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Binóculos, lunetas, incluindo as astronômicas, telescópios ópticos, e suas armações, outros instrumentos de astronomia e suas armações, exceto os aparelhos de radioastronomia. Outros instrumentos"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"capitulo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"90"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"posicao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"05"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"subposicao1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"subposicao2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"item1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"item2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="w">
 </span><span class="p">},</span><span class="w">
 </span><span class="p">{</span><span class="w">
   </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"90059010"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"descricao_completa"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Binóculos, lunetas, incluindo as astronômicas, telescópios ópticos, e suas armações, outros instrumentos de astronomia e suas armações, exceto os aparelhos de radioastronomia. Partes e acessórios (incluindo as armações) De binóculos"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"capitulo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"90"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"posicao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"05"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"subposicao1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"subposicao2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"item1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"item2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>Para consultar os NCMs disponíveis, utilize o endereço abaixo:</p>

<p><code>https://homologacao.focusnfe.com.br/v2/ncms</code></p>

<p>Utilize o método HTTP <strong>GET</strong>. São aceitos os seguintes parâmetros de pesquisa:</p>

<ul>
<li><strong>codigo</strong>: Pesquise <strong>pela parte inicial</strong> do código NCM</li>
<li><strong>descricao</strong>: Pesquisa por parte da descrição do código NCM.</li>
<li><strong>capitulo</strong>,<strong>posicao</strong>,<strong>subposicao1</strong>,<strong>subposicao2</strong>,<strong>item1</strong> e <strong>item2</strong>: Pesquisa exata informando qualquer uma das partes do código NCM.</li>
</ul>

<p>Caso já saiba o código NCM exato, e queira apenas recuperar sua descrição, utilize o link
abaixo, substituindo CODIGO_NCM pelo código.</p>

<p><code>https://homologacao.focusnfe.com.br/v2/ncms/CODIGO_NCM</code></p>
<h2 id='consulta-de-ncm_paginacao'>Paginação</h2>
<p>Ao fazer uma pesquisa, a API irá devolver o cabeçalho HTTP <em>X-Total-Count</em> que representa
o número total de ocorrências da pesquisa, porém a API devolve apenas 50 registros por vez.
Para buscar os demais registros, utilize o parâmetro <strong>offset</strong>. Exemplo:</p>

<p>Vamos supor que a chamada abaixo devolva 123 ocorrências:</p>

<p><code>https://homologacao.focusnfe.com.br/v2/ncms?codigo=7022</code></p>

<p>A segunda e terceira páginas da consulta poderão ser acessados desta forma:</p>

<p>Registros 51 a 100:
<code>https://homologacao.focusnfe.com.br/v2/ncms?codigo=7022&amp;offset=50</code></p>

<p>Registros 101 a 123:
<code>https://homologacao.focusnfe.com.br/v2/ncms?codigo=7022&amp;offset=100</code></p>
<h1 id='consulta-de-cfop_consulta-de-cfop'>Consulta de CFOP</h1>
<p>CFOP significa &quot;Código Fiscal de Operações e Prestações&quot; e trata-se de um código de quatro dígitos que serve para identificar operações que envolvam a incidência de ICMS ou IPI. </p>

<p>Nós disponibilizamos uma API que você poderá utilizar para fornecer ao seu usuário final uma pesquisa de qual o código CFOP correto para a operação realizada.</p>

<p>O código CFOP é formato por 4 dígitos, sendo que o primeiro digito indica se a operação é de entrada ou saída e também a localização da contraparte: mesma UF, outra UF ou exterior. Exemplo:</p>

<p>Entradas</p>

<ul>
<li>1.000 – Entrada e/ou Aquisições de Serviços do Estado</li>
<li>2.000 – Entrada e/ou Aquisições de Serviços de outros Estados</li>
<li>3.000 – Entrada e/ou Aquisições de Serviços do Exterior</li>
</ul>

<p>Saídas</p>

<ul>
<li>5.000 – Saídas ou Prestações de Serviços para o Estado</li>
<li>6.000 – Saídas ou Prestações de Serviços para outros Estados</li>
<li>7.000 – Saídas ou Prestações de Serviços para o Exterior</li>
</ul>

<p>Por exemplo, o código 5101 refere-se a venda de produção do estabelecimento para um cliente do mesmo estado.</p>
<pre class="highlight shell tab-shell"><code><span class="c"># pesquisa por CFOPs que iniciam com o dígito 2</span>
curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/cfops?codigo<span class="o">=</span>2
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/cfops?codigo=2"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"token obtido no cadastro da empresa:"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExemploConsultaHook</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/cfops?codigo=2"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">HttpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">HttpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/cfops?codigo=2"</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/cfops?codigo=2"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/cfops?codigo=2"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="c1">// Aqui enviamos a requisição.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<blockquote>
<p>Dados de resposta da consulta</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
 </span><span class="p">{</span><span class="w">
    </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2151"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2151 - Transferência p/ industrialização ou produção rural"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2152"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2152 - Transferência p/ comercialização"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2153"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2153 - Transferência de energia elétrica p/ distribuição"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2154"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2154 - Transferência p/ utilização na prestação de serviço"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2159"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2159 - Entrada decorrente do fornecimento de produto ou mercadoria de ato cooperativo"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2201"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2201 - Devolução de venda de produção do estabelecimento"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2202"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2202 - Devolução de venda de mercadoria adquirida ou recebida de terceiros"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>Para consultar os CFOPs disponíveis, utilize o endereço abaixo:</p>

<p><code>https://homologacao.focusnfe.com.br/v2/cfops</code></p>

<p>Utilize o método HTTP <strong>GET</strong>. São aceitos os seguintes parâmetros de pesquisa:</p>

<ul>
<li><strong>codigo</strong>: Pesquise <strong>pela parte inicial</strong> do código CFOP</li>
<li><strong>descricao</strong>: Pesquisa por parte da descrição do código CFOP.</li>
</ul>

<p>Caso já saiba o código CFOP exato, e queira apenas recuperar sua descrição, utilize o link
abaixo, substituindo CODIGO_CFOP pelo código.</p>

<p><code>https://homologacao.focusnfe.com.br/v2/cfops?CODIGO_CFOP</code></p>
<h2 id='consulta-de-cfop_paginacao'>Paginação</h2>
<p>Ao fazer uma pesquisa, a API irá devolver o cabeçalho HTTP <em>X-Total-Count</em> que representa
o número total de ocorrências da pesquisa, porém a API devolve apenas 50 registros por vez.
Para buscar os demais registros, utilize o parâmetro <strong>offset</strong>. Exemplo:</p>

<p>Vamos supor que a chamada abaixo devolva 123 ocorrências:</p>

<p><code>https://homologacao.focusnfe.com.br/v2/cfops?codigo=2</code></p>

<p>A segunda e terceira páginas da consulta poderão ser acessados desta forma:</p>

<p>Registros 51 a 100:
<code>https://homologacao.focusnfe.com.br/v2/cfops?codigo=2&amp;offset=50</code></p>

<p>Registros 101 a 123:
<code>https://homologacao.focusnfe.com.br/v2/cfops?codigo=2&amp;offset=100</code></p>
<h1 id='consulta-de-cep-beta_consulta-de-cep-beta'>Consulta de CEP (beta)</h1>
<p>O Código de Endereçamento Postal - CEP - é um código utilizado pelo Correrios para fins de encaminhamento, tratamento e distribuição de postagens. O código, formado por oito digitos numéricos, é dividio em duas partes:</p>

<p>a) a primeira é composta por 5 (cinco) dígitos que representam Região, Sub-região, Setor, Subsetor e Divisor de Subsetor;</p>

<p>b) a segunda é composta por 3 (três) dígitos, separada por um traço da primeira, que representa os Identificadores de Distribuição.</p>

<p>Os 8 dígitos do CEP seguem o seguinte formato:</p>

<p>RSRSSSD-PREFIXO, sendo:</p>

<ul>
<li>R = Regisão</li>
<li>RS = Sub-Região</li>
<li>S  = Setor</li>
<li>SS  = Sub-setor</li>
<li>D = Divisor</li>
<li>PREFIXO = 3 dígitos que identificam localidades, logradouros e outros
<sub>fonte:https://www.correios.com.br/a-a-z/cep-codigo-de-enderecamento-postal</sub></li>
</ul>

<p>Nós disponibilizamos uma API para consultar uma descrição detalhada das informações do CEP.</p>
<pre class="highlight shell tab-shell"><code><span class="c"># pesquisa por CFOPs que iniciam com o dígito 2</span>
curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/ceps?uf<span class="o">=</span>AC&amp;logradouro<span class="o">=</span>colinas
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/ceps?uf=AC&amp;logradouro=colinas"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"token obtido no cadastro da empresa:"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExemploConsultaHook</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/ceps?uf=AC&amp;logradouro=colinas"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">HttpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">HttpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/ceps?uf=AC&amp;logradouro=colinas"</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/ceps?uf=AC&amp;logradouro=colinas"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/ceps?uf=AC&amp;logradouro=colinas"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="c1">// Aqui enviamos a requisição.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<p>Para realizar uma consulta de CEP, utilize o endereço abaixo:</p>

<p><code>https://homologacao.focusnfe.com.br/v2/ceps</code></p>

<p>Utilize o método HTTP <strong>GET</strong>. São aceitos os seguintes parâmetros de pesquisa:</p>

<ul>
<li><strong>codigo_ibge</strong>: Pesquisa pelo CEP referente a uma localidade, conforme o código IBGE do município</li>
<li><strong>uf</strong>: Pesquisa utilizando os dois caractêres referente a Unidade da Federação. Ex: &#39;PR&#39;, para o Estado do Paraná.</li>
<li><strong>logradouro</strong>: Pesquisa pelo logradouro completo ou por parte dele. Mínimo de 3 caracteres.</li>
<li><strong>localidade</strong>: Pesquisa pelo nome completo da localidade ou por parte dele.</li>
</ul>

<p>São necessários ao menos outros dois parâmetros, caso não seja informado o código IBGE para o munícipio.</p>

<p>Caso já saiba o CEP exato, e queira apenas recuperar sua descrição, utilize o link
abaixo, substituindo CODIGO_CEP pelo código.</p>

<p><code>https://api.focusnfe.com.br/v2/ceps/CODIGO_CEP</code></p>
<h2 id='consulta-de-cep-beta_resposta-da-api'>Resposta da API</h2>
<blockquote>
<p>Dados de resposta da consulta</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"cep"</span><span class="p">:</span><span class="w"> </span><span class="s2">"69909032"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tipo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"logradouro"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nome"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="s2">"uf"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AC"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nome_localidade"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Rio Branco"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_ibge"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1200401"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tipo_logradouro"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Rua"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nome_logradouro"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Colinas"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nome_bairro_inicial"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Rosa Linda"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Rua Colinas, Rio Branco, AC"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>Para cada consulta à nossa API de CEP a resposta trará um ou mais objetos JSON, com os campos como neste exemplo ao lado. Abaixo, a descrição de cada um dos campos:</p>

<ul>
<li><strong>cep</strong>: Código CEP, conforme base dos Correios.</li>
<li><strong>tipo</strong>: Informa qual o tipo do CEP, que pode ser:

<ul>
<li>localidade - se refere a um município, povoado ou distrito.</li>
<li>logradouro - são localizações em vias de tráfego de áreas urbanas ou rurais</li>
<li>unidade_operacional - designa uma unidade do Correios que possue CEP próprio</li>
<li>grande_usuario -  é utilizado para instituições, privadas ou públicas, que são referência pelo seu tamanho ou importância no local, tendo CEP próprio</li>
</ul></li>
<li><strong>nome</strong>: Para CEPs do tipo &quot;unidade_operacional&quot; ou &quot;grande_usuario&quot;, o campo retorna o nome dos estabelecimentos.</li>
<li><strong>uf</strong>: A sigla do Estado (Unidade da Federação) a qual pertence a localização do CEP.</li>
<li><strong>nome_localidade</strong>: O nome do local, seja ele uma localidade, unidade operacional ou grande usuário.</li>
<li><strong>codigo_município</strong>: Código de identificação utilizado pelo IBGE, caso a localidade seja um município.</li>
<li><strong>tipo_logradouro</strong>: Informa o tipo do logradouro. Exs: &#39;Rua&#39;, &#39;Avenida&#39;, &#39;Viela&#39;, etc.</li>
<li><strong>nome_logradouro</strong>: Nome do logradouro correspondente à consulta.</li>
<li><strong>bairro</strong>: Nome do bairro onde inicia o CEP retornado na consulta.</li>
<li><strong>descricao</strong>: Junção dos valores retornados nos campos &#39;tipo_logradouro&#39;, &#39;nome_logradouro&#39;, &#39;nome_localidade&#39; e &#39;uf&#39;.</li>
</ul>
<h1 id='consulta-de-cnae_consulta-de-cnae'>Consulta de CNAE</h1>
<p>CNAE significa &quot;Classificação Nacional de Atividades Econômicas &quot; e trata-se de um código numérico responsável por classificar as atividades econômicas no Brasil. </p>

<p>Nós disponibilizamos uma API que pode ser utilizada para consultar uma base que contém a lista de códigos CNAE do IBGE, assim como a descrição de cada atividade econômica categorizada pelo código.</p>
<pre class="highlight shell tab-shell"><code><span class="c"># pesquisa por todos os códigos CNAE que possuem 'informática' em sua descrição</span>
curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/codigos_cnae?descricao<span class="o">=</span>informatica
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/codigos_cnae?descricao=informatica"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"token obtido no cadastro da empresa:"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExemploConsultaHook</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/codigos_cnae?descricao=informatica"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">HttpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">HttpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/codigos_cnae?descricao=informatica"</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/codigos_cnae?descricao=informatica"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/codigos_cnae?descricao=informatica"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="c1">// Aqui enviamos a requisição.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<p>Disponibilizamos o seguinte método de consulta:</p>

<table><thead>
<tr>
<th>Método</th>
<th>URL (recurso)</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>GET</td>
<td>/v2/codigos_cnae</td>
<td>Busca todos os códigos CNAE ou filtra-os de acordo com parâmetros</td>
</tr>
</tbody></table>

<p>Os parâmetros disponíveis para consulta dos códigos CNAE são atualmente os seguintes:</p>

<ul>
<li>codigo: Busca pela código ou trecho do código CNAE.</li>
<li>descricao: Busca pela descrição ou pelo trecho da descrição.</li>
</ul>

<p>Caso já saiba o código CNAE exato, você pode efetuar a busca diretamente em:</p>

<ul>
<li>/v2/codigos_cnae/CODIGO_CNAE</li>
</ul>
<h2 id='consulta-de-cnae_resposta-da-api'>Resposta da API</h2>
<blockquote>
<p>Exemplo de dados de resposta da consulta</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8599603"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Treinamento em informática"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4757100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Comércio varejista especializado de peças e acessórios para aparelhos eletroeletrônicos para uso doméstico, exceto informática e comunicação"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4751202"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Recarga de cartuchos para equipamentos de informática"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>Para cada consulta à nossa API de códigos CNAE a resposta trará um ou mais objetos JSON, com os campos como neste exemplo ao lado. Abaixo, a descrição de cada um dos campos:</p>

<ul>
<li><strong>codigo</strong>: Representa o código CNAE frente ao IBGE</li>
<li><strong>descricao</strong>: Representa a descrição da atividade econômica à qual o código faz referência.</li>
</ul>
<h2 id='consulta-de-cnae_paginacao'>Paginação</h2>
<p>Ao fazer uma pesquisa, a API irá devolver o cabeçalho HTTP <em>X-Total-Count</em> que representa
o número total de ocorrências da pesquisa, porém a API devolve apenas 50 registros por vez.
Para buscar os demais registros, utilize o parâmetro <strong>offset</strong>. Exemplo:</p>

<p>Vamos supor que a chamada abaixo devolva 123 ocorrências:</p>

<p><code>https://homologacao.focusnfe.com.br/v2/codigos_cnae?codigo=2</code></p>

<p>A segunda e terceira páginas da consulta poderão ser acessados desta forma:</p>

<p>Registros 51 a 100:
<code>https://homologacao.focusnfe.com.br/v2/codigos_cnae?codigo=2&amp;offset=50</code></p>

<p>Registros 101 a 123:
<code>https://homologacao.focusnfe.com.br/v2/codigos_cnae?codigo=2&amp;offset=100</code></p>
<h1 id='consulta-de-municipios_consulta-de-municipios'>Consulta de Municípios</h1>
<p>Utilizamos a base de municípios do IBGE para identificar os municípios em nossa API. Desta forma disponibilizamos uma API para busca dos municípios cadastrados, seja para localizá-los pelo nome, para recuperar o código do município, verificar se o município tem a NFSe implementada em nosso sistema ou demais especificidades de cada município.
Ainda, é possível verificar se determinado município apresenta a necessidade de informar o código tributário do município e/ou item da lista de serviço para emissão de uma nota fiscal de serviço. Com isso, é possível verificar os valores que esses campos devem receber através de uma consulta relacionada ao próprio município.</p>
<pre class="highlight shell tab-shell"><code><span class="c"># pesquisa por todos os municípios do PR</span>
curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/municipios?sigla_uf<span class="o">=</span>PR

<span class="c"># pesquisa pelos itens da lista de serviço que contém a descrição "informática" por um município onde esse campo seja obrigatório.</span>
curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://homologacao.focusnfe.com.br/v2/municipios/4307807/itens_lista_servico?descricao<span class="o">=</span>informatica
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nv">$server</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br"</span><span class="p">;</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$server</span><span class="o">.</span><span class="s2">"/v2/municipios?sigla_uf=PR"</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">"token obtido no cadastro da empresa:"</span><span class="p">);</span>
<span class="nv">$body</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
<span class="c1">// As próximas três linhas são um exemplo de como imprimir as informações de retorno da API.
</span><span class="k">print</span><span class="p">(</span><span class="nv">$http_code</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$body</span><span class="o">.</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.ClientResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.WebResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.ClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.config.DefaultClientConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.jersey.api.client.filter.HTTPBasicAuthFilter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExemploConsultaHook</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

        <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="s">"Token_obtido_no_cadastro_da_empresa"</span><span class="o">;</span>

        <span class="cm">/* Para ambiente de produção use a variável abaixo:
        String server = "https://api.focusnfe.com.br/"; */</span>
        <span class="n">String</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/"</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"v2/municipios?sigla_uf=PR"</span><span class="o">);</span>

        <span class="cm">/* Configuração para realizar o HTTP BasicAuth. */</span>
        <span class="n">Object</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultClientConfig</span><span class="o">();</span>
        <span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="na">create</span><span class="o">((</span><span class="n">ClientConfig</span><span class="o">)</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">client</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">HTTPBasicAuthFilter</span><span class="o">(</span><span class="n">login</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>

        <span class="n">WebResource</span> <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">resource</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

        <span class="n">ClientResponse</span> <span class="n">resposta</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">HttpCode</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="cm">/* As três linhas abaixo imprimem as informações retornadas pela API.
         * Aqui o seu sistema deverá interpretar e lidar com o retorno. */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"HTTP Code: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">HttpCode</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code>
<span class="c1"># encoding: UTF-8</span>

<span class="nb">require</span> <span class="s2">"net/http"</span>
<span class="nb">require</span> <span class="s2">"net/https"</span>

<span class="c1"># token enviado pelo suporte</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">"codigo_alfanumerico_token"</span>

<span class="c1"># endereço da api que deve ser usado conforme o ambiente: produção ou homologação</span>
<span class="n">servidor_producao</span> <span class="o">=</span> <span class="s2">"https://api.focusnfe.com.br/"</span>
<span class="n">servidor_homologacao</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/"</span>

<span class="c1"># no caso do ambiente de envio ser em produção, utilizar servidor_producao</span>
<span class="n">url_envio</span> <span class="o">=</span> <span class="n">servidor_homologacao</span> <span class="o">+</span> <span class="s2">"v2/municipios?sigla_uf=PR"</span>

<span class="c1"># criamos um objeto uri para envio da nota</span>
<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url_envio</span><span class="p">)</span>

<span class="c1"># também criamos um objeto da classe HTTP a partir do host da uri</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>

<span class="c1"># aqui criamos um objeto da classe Post a partir da uri de requisição</span>
<span class="n">requisicao</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="c1"># adicionando o token à requisição</span>
<span class="n">requisicao</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

<span class="c1"># no envio de notas em produção, é necessário utilizar o protocolo ssl</span>
<span class="c1"># para isso, basta retirar o comentário da linha abaixo</span>
<span class="c1"># http.use_ssl = true</span>

<span class="c1"># aqui enviamos a requisição ao servidor e obtemos a resposta</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requisicao</span><span class="p">)</span>

<span class="c1"># imprimindo o código HTTP da resposta</span>
<span class="nb">puts</span> <span class="s2">"Código retornado pela requisição: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">code</span>

<span class="c1"># imprimindo o corpo da resposta</span>
<span class="nb">puts</span> <span class="s2">"Corpo da resposta: "</span> <span class="o">+</span> <span class="n">resposta</span><span class="p">.</span><span class="nf">body</span>

</code></pre><pre class="highlight python tab-python"><code><span class="c"># Faça o download e instalação da biblioteca requests, através do python-pip.</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
Para ambiente de produção use a variável abaixo:
url = "https://api.focusnfe.com.br"
'''</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://homologacao.focusnfe.com.br/v2/municipios?sigla_uf=PR"</span>

<span class="n">token</span><span class="o">=</span><span class="s">"token obtido no cadastro da empresa"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="s">""</span><span class="p">))</span>

<span class="c"># Mostra na tela o codigo HTTP da requisicao e a mensagem de retorno da API</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="cm">/*
As orientacoes a seguir foram extraidas do site do NPMJS: https://www.npmjs.com/package/xmlhttprequest
Here's how to include the module in your project and use as the browser-based XHR object.
Note: use the lowercase string "xmlhttprequest" in your require(). On case-sensitive systems (eg Linux) using uppercase letters won't work.
*/</span>
<span class="kd">var</span> <span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"xmlhttprequest"</span><span class="p">).</span><span class="nx">XMLHttpRequest</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="s2">"Token_obtido_no_cadastro_da_empresa"</span><span class="p">;</span>

<span class="cm">/*
Para ambiente de producao use a URL abaixo:
"https://api.focusnfe.com.br"
*/</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">"https://homologacao.focusnfe.com.br/v2/municipios?sigla_uf=PR"</span><span class="p">;</span>

<span class="cm">/*
Use o valor 'false', como terceiro parametro para que a requisicao aguarde a resposta da API
Passamos o token como quarto parametro deste metodo, como autenticador do HTTP Basic Authentication.
*/</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>

<span class="c1">// Aqui enviamos a requisição.</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">// Sua aplicacao tera que ser capaz de tratar as respostas da API.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"HTTP code: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Corpo: "</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>

</code></pre>
<p>Disponibilizamos os seguintes métodos de consulta:</p>

<table><thead>
<tr>
<th>Método</th>
<th>URL (recurso)</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>GET</td>
<td>/v2/municipios</td>
<td>Busca todos os municípios ou filtra-os de acordo com parâmetros</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/municipios/CODIGO_MUNICIPIO</td>
<td>Busca um município único pelo seu código</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/municipios/CODIGO_MUNICIPIO/itens_lista_servico</td>
<td>Busca todos os itens da lista de serviço de acordo com o município ou filtra-os de acordo com parâmetros</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/municipios/CODIGO_MUNICIPIO/itens_lista_servico/CODIGO</td>
<td>Busca um item da lista de serviço único pelo seu código de acordo com o município</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/municipios/CODIGO_MUNICIPIO/codigos_tributarios_municipio</td>
<td>Busca todos os códigos tributários municípais de acordo com o município ou filtra-os de acordo com parâmetros</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/municipios/CODIGO_MUNICIPIO/codigos_tributarios_municipio/CODIGO</td>
<td>Busca um código tributário municipal único pelo seu código de acordo com o município</td>
</tr>
</tbody></table>

<p>Os parâmetros disponíveis para consulta dos municípios são atualmente os seguintes:</p>

<ul>
<li>sigla_uf: Busca pela sigla do estado, ex: PR</li>
<li>nome_municipio: Busca pelo nome exato do município. Ex: Curitiba irá devolver apenas um registro</li>
<li>nome: Busca por parte do nome do município. Ex: Curitiba irá devolver os municípios &quot;Curitiba&quot; e &quot;Curitibanos&quot;</li>
</ul>

<p>Caso já saiba o código exato do município, você pode efetuar a busca diretamente em:</p>

<ul>
<li>/v2/municipios/CODIGO_MUNICIPIO</li>
</ul>

<p>Os parâmetros disponíveis para consulta dos itens da lista de serviço e códigos tributários municipais de acordo com o município são atualmente os seguintes:</p>

<ul>
<li>codigo: Busca pela código, ex: &quot;14.01&quot;. Busca pelo trecho de codigo. ex: &quot;14.&quot;</li>
<li>descricao: Busca pelo trecho da descrição. Ex: &quot;Aula&quot;</li>
</ul>

<p>Caso já saiba o código exato do item da lista de serviço ou do código tributário municipal, você pode efetuar a busca diretamente em:</p>

<ul>
<li>/v2/municipios/CODIGO_MUNICIPIO/itens_lista_servico/CODIGO<br></li>
<li>/v2/municipios/CODIGO_MUNICIPIO/codigos_tributarios_municipio/CODIGO</li>
</ul>
<h2 id='consulta-de-municipios_resposta-da-api'>Resposta da API</h2>
<blockquote>
<p>Exemplo de dados de resposta da consulta aos municípios</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"codigo_municipio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4204806"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nome_municipio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Curitibanos"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"sigla_uf"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SC"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nome_uf"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Santa Catarina"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nfse_habilitada"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"codigo_municipio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4106902"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nome_municipio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Curitiba"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"sigla_uf"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PR"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nome_uf"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Paraná"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nfse_habilitada"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"requer_certificado_nfse"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"possui_ambiente_homologacao_nfse"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"possui_cancelamento_nfse"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"provedor_nfse"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tecnos"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"endereco_obrigatorio_nfse"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cpf_cnpj_obrigatorio_nfse"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"item_lista_servico_nfse"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"codigo_tributario_municipio_nfse"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<blockquote>
<p>Exemplo de dados de resposta da consulta aos itens da lista de serviço de um determinado município</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.06"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Assessoria e consultoria em informática."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tax_rate"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"codigo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.07"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"descricao"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Suporte técnico em informática, inclusive instalação, configuração e manutenção de programas de computação e bancos de dados."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tax_rate"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>Para cada consulta à nossa API de municípios a resposta trará um ou mais objetos JSON, com os campos como neste exemplo ao lado. Abaixo, a descrição de cada um dos campos:</p>

<ul>
<li><strong>codigo_municipio</strong>: Representa o código do município frente ao IBGE</li>
<li><strong>nome_municipio</strong>: Nome completo do município segundo o IBGE. Podem haver pequenas diferenças de outras bases, como a dos Correios.</li>
<li><strong>sigla_uf</strong>: Sigla do estado do município</li>
<li><strong>nome_uf</strong>: Nome completo do estado onde se encontra o município</li>
<li><strong>nfse_habilitada</strong>: Verdadeiro se já implementamos a NFSe para este município, e falso caso contrário</li>
<li><strong>requer_certificado_nfse</strong>: Se a NFSe para este município está implementada, este campo irá indicar se o município precisa de um certificado digital para emissão deste documento. Caso contrário, alguma combinação de token e/ou usuário e senha deverá ser usado.</li>
<li><strong>possui_ambiente_homologacao_nfse</strong>: Se a NFSe para este município está implementada, este campo irá indicar se existe ambiente de homologação neste município</li>
<li><strong>possui_cancelamento_nfse</strong>: Se a NFSe para este município está implementada, este campo irá indicar se é possível o cancelamento de NFSe via API neste município. Caso contrário pode ser possível o cancelamento pela própria interface da prefeitura</li>
<li><strong>provedor_nfse</strong>: Se a NFSe para este município está implementada, este campo irá indicar o nome do provedor do município.</li>
<li><strong>endereco_obrigatorio_nfse</strong>: Se a NFSe para este município está implementada, esse campo irá indicar se o município precisa informar o endereço para emissão deste documento.</li>
<li><strong>cpf_cnpj_obrigatorio_nfse</strong>: Se a NFSe para este município está implementada, esse campo irá indicar se o município precisa informar o cpf/cnpj para emissão deste documento.</li>
<li><strong>item_lista_servico_nfse</strong>: Se a NFSe para este município está implementada, esse campo irá indicar se o município precisa informar o item da lista de serviço para emissão deste documento. Caso seu valor seja &#39;true&#39;, a busca pelos possíveis valores pode ser feita como exemplificada anteriormente. </li>
<li><strong>codigo_tributario_municipio_nfse</strong>: Se a NFSe para este município está implementada, esse campo irá indicar se o município precisa informar o código tributário do município para emissão deste documento. Caso seu valor seja &#39;true&#39;, a busca pelos possíveis valores pode ser feita como exemplificada anteriormente. </li>
</ul>

<p>Considere que novos campos poderão ser adicionados nesta API.</p>
<h2 id='consulta-de-municipios_paginacao'>Paginação</h2>
<p>Ao fazer uma pesquisa, a API irá devolver o cabeçalho HTTP <em>X-Total-Count</em> que representa
o número total de ocorrências da pesquisa, porém a API devolve apenas 100 registros por vez.
Para buscar os demais registros, utilize o parâmetro <strong>offset</strong>. Exemplo:</p>

<p>Vamos supor que a chamada abaixo devolva 223 ocorrências:</p>

<p><code>https://homologacao.focusnfe.com.br/v2/municipios?sigla_uf=PR</code></p>

<p>A segunda e terceira páginas da consulta poderão ser acessados desta forma:</p>

<p>Registros 101 a 200:
`https://homologacao.focusnfe.com.br/v2/municipios?sigla_uf=PR&amp;offset=100</p>

<p>Registros 201 a 223:
`https://homologacao.focusnfe.com.br/v2/municipios?sigla_uf=PR&amp;offset=200</p>
<h1 id='revenda_revenda'>Revenda</h1>
<p>A API para revenda consiste em uma série de métodos para criar e habilitar automaticamente uma empresa para emissão de documentos fiscais (NFe, NFCe ou NFSe). São disponibilizados os métodos para criar uma empresa, buscar dados de uma empresa ou listar todas as empresas. Cada empresa possui um identificador único (campo id) que você deverá armazenar em sua base de dados para poder alterar ou buscar dados da empresa posteriormente.</p>

<p><strong>Ambientes</strong></p>

<p>A API de Revendas opera exclusivamente no ambiente de produção, não sendo possível realizar operações em homologação. Porém, quando aplicável, adicionamos o parâmetro opcional dry_run=1 que permite que a criação da empresa seja simulada sem que seja efetivamente efetuada no nosso banco de dados. Desta forma você poderá testar as chamadas antes de implementá-las em produção.</p>

<p>Uma vez criada a empresa no ambiente de produção, você poderá emitir documentos fiscais no ambiente de homologação e produção usando esta empresa.</p>
<h2 id='revenda_urls'>URLs</h2>
<table><thead>
<tr>
<th>Método</th>
<th>URL (recurso)</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>POST</td>
<td>/v2/empresas</td>
<td>Cria uma nova empresa.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/empresas</td>
<td>Consulta todas as empresas.</td>
</tr>
<tr>
<td>GET</td>
<td>/v2/empresas/ID</td>
<td>Consulta uma a empresa a partir do seu identificador.</td>
</tr>
<tr>
<td>PUT</td>
<td>/v2/empresa/ID</td>
<td>Altera os dados de uma empresa específica.</td>
</tr>
</tbody></table>
<h2 id='revenda_campos'>Campos</h2>
<p>O formato de envio dos campos é no formato JSON, que deverá ser enviado no formato:</p>

<p>{empresa: {atributo1: valor1, atributo2: valor2, … } }</p>

<p>Abaixo são listados todos os campos de uma empresa.</p>

<blockquote>
<p>Exemplo de um arquivo JSON</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"nome"</span><span class="p">:</span><span class="s2">"Nome da empresa Ltda"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"nome_fantasia"</span><span class="p">:</span><span class="s2">"Nome Fantasia"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"bairro"</span><span class="p">:</span><span class="s2">"Vila Isabel"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"cep"</span><span class="p">:</span><span class="mi">80210000</span><span class="p">,</span><span class="w">
   </span><span class="s2">"cnpj"</span><span class="p">:</span><span class="s2">"10964044000164"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"complemento"</span><span class="p">:</span><span class="s2">"Loja 1"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"discrimina_impostos"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
   </span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"test@example.com"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"enviar_email_destinatario"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
   </span><span class="s2">"inscricao_estadual"</span><span class="p">:</span><span class="mi">1234</span><span class="p">,</span><span class="w">
   </span><span class="s2">"inscricao_municipal"</span><span class="p">:</span><span class="mi">46532</span><span class="p">,</span><span class="w">
   </span><span class="s2">"logradouro"</span><span class="p">:</span><span class="s2">"Rua João da Silva"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"numero"</span><span class="p">:</span><span class="mi">153</span><span class="p">,</span><span class="w">
   </span><span class="s2">"regime_tributario"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
   </span><span class="s2">"telefone"</span><span class="p">:</span><span class="s2">"4130333333"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"municipio"</span><span class="p">:</span><span class="s2">"Curitiba"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"uf"</span><span class="p">:</span><span class="s2">"PR"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"habilita_nfe"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
   </span><span class="s2">"habilita_nfce"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
   </span><span class="s2">"arquivo_certificado_base64"</span><span class="p">:</span><span class="s2">"MIIj4gIBAzCCI54GCSqGSIb3DQEHAaCC..apagado…ASD=="</span><span class="p">,</span><span class="w">
   </span><span class="s2">"senha_certificado"</span><span class="p">:</span><span class="mi">123456</span><span class="p">,</span><span class="w">
   </span><span class="s2">"csc_nfce_producao"</span><span class="p">:</span><span class="s2">"ABCDEF"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"id_token_nfce_producao"</span><span class="p">:</span><span class="s2">"00001"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Obrig. NFe</th>
<th>Obrig. NFCe</th>
<th>Obrig. NFSe</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>nome</td>
<td>texto</td>
<td>Sim</td>
<td>Sim</td>
<td>Sim</td>
<td>Razão social da empresa</td>
</tr>
<tr>
<td>nome_fantasia</td>
<td>texto</td>
<td>Sim</td>
<td>Sim</td>
<td>Sim</td>
<td>Nome fantasia</td>
</tr>
<tr>
<td>inscricao_estadual</td>
<td>numérico</td>
<td>Sim</td>
<td>Sim</td>
<td></td>
<td>Inscrição estadual</td>
</tr>
<tr>
<td>inscricao_municipal</td>
<td>numérico</td>
<td></td>
<td></td>
<td>Sim</td>
<td>Inscrição municipal</td>
</tr>
<tr>
<td>cnpj</td>
<td>numérico</td>
<td>Sim</td>
<td>Sim</td>
<td>Sim</td>
<td>CNPJ</td>
</tr>
<tr>
<td>regime_tributario</td>
<td>enumeração</td>
<td>Sim</td>
<td>Sim</td>
<td>Sim</td>
<td>&quot;Regime tributário. Valores possíveis: 1 - Simples Nacional; 2 - Simples Naciona - Excesso de sublimite de receita bruta; 3 - Regime Normal</td>
</tr>
<tr>
<td>email</td>
<td>email</td>
<td>Sim</td>
<td>Sim</td>
<td>Sim</td>
<td>Email de contato da empresa</td>
</tr>
<tr>
<td>telefone</td>
<td>numérico</td>
<td>Sim</td>
<td>Sim</td>
<td></td>
<td>Telefone da empresa</td>
</tr>
<tr>
<td>logradouro</td>
<td>texto</td>
<td>Sim</td>
<td>Sim</td>
<td>Sim</td>
<td>Endereço: logradouro</td>
</tr>
<tr>
<td>numero</td>
<td>numérico</td>
<td>Sim</td>
<td>Sim</td>
<td>Sim</td>
<td>Endereço: número</td>
</tr>
<tr>
<td>complemento</td>
<td>texto</td>
<td></td>
<td></td>
<td></td>
<td>Endereço: complemento</td>
</tr>
<tr>
<td>bairro</td>
<td>texto</td>
<td>Sim</td>
<td>Sim</td>
<td>Sim</td>
<td>Endereço: bairro</td>
</tr>
<tr>
<td>cep</td>
<td>numérico</td>
<td>Sim</td>
<td>Sim</td>
<td>Sim</td>
<td>Endereço: CEP completo</td>
</tr>
<tr>
<td>municipio</td>
<td>texto</td>
<td>Sim</td>
<td>Sim</td>
<td>Sim</td>
<td>Endereço: nome do município sem abreviações</td>
</tr>
<tr>
<td>uf</td>
<td>texto</td>
<td>Sim</td>
<td>Sim</td>
<td>Sim</td>
<td>Endereço: UF com 2 caracteres</td>
</tr>
<tr>
<td>enviar_email_destinatario</td>
<td>booleano</td>
<td></td>
<td></td>
<td></td>
<td>Habilita ou não envio de e-mail ao destinatário/tomador do serviço após emissão do documento fiscal</td>
</tr>
<tr>
<td>discrimina_impostos</td>
<td>booleano</td>
<td></td>
<td></td>
<td>N/A</td>
<td>Habilita ou não o cálculo automático de impostos totais aproximados de acordo com a Lei da Transparência. Não é utilizado para NFSe.</td>
</tr>
<tr>
<td>cpf_cnpj_contabilidade</td>
<td>numérico</td>
<td></td>
<td></td>
<td>N/A</td>
<td>CPF/CNPJ da contabilidade da empresa. Alguns estados necessitam que esta informação seja adicionado (no momento apenas BA obriga).</td>
</tr>
<tr>
<td>habilita_nfe</td>
<td>booleano</td>
<td>Sim</td>
<td>N/A</td>
<td>N/A</td>
<td>Informa se empresa será habilitada para emissão de NFe – Nota Fiscal Eletrônica modelo 55</td>
</tr>
<tr>
<td>habilita_nfce</td>
<td>booleano</td>
<td>N/A</td>
<td>Sim</td>
<td>N/A</td>
<td>Informa se empresa será habilitada para emissão de NFCe – Nota Fiscal ao Consumidor Eletrônica modelo 65</td>
</tr>
<tr>
<td>habilita_nfse</td>
<td>booleano</td>
<td>N/A</td>
<td>N/A</td>
<td>Sim</td>
<td>Informa se empresa será habilitada para emissão de NFSe – Nota Fiscal de Serviço Eletrônica</td>
</tr>
<tr>
<td>csc_nfce_producao</td>
<td>texto</td>
<td>N/A</td>
<td>Sim</td>
<td>N/A</td>
<td>CSC para emissão de NFCe em ambiente de produção. Sem este campo não será possível emitir NFCe em produção. Veja com o SEFAZ do seu estado como gerar este código.</td>
</tr>
<tr>
<td>id_token_nfce_producao</td>
<td>numérico</td>
<td>N/A</td>
<td>Sim</td>
<td>N/A</td>
<td>Id do CSC para emissão de NFCe em ambiente de produção. Sem este campo não será possível emitir NFCe em produção.Veja com o SEFAZ do seu estado como gerar este número.</td>
</tr>
<tr>
<td>csc_nfce_homologacao</td>
<td>texto</td>
<td>N/A</td>
<td></td>
<td>N/A</td>
<td>CSC para emissão de NFCe em ambiente de homologação. Sem este campo não será possível emitir NFCe em homologação.</td>
</tr>
<tr>
<td>id_token_nfce_homologacao</td>
<td>numérico</td>
<td>N/A</td>
<td></td>
<td></td>
<td>Id do CSC para emissão de NFCe em ambiente dehomologação. Sem este campo não será possível emitir NFCe em homologação.</td>
</tr>
<tr>
<td>proximo_numero_nfe_producao</td>
<td>numérico</td>
<td></td>
<td>N/A</td>
<td>N/A</td>
<td>Próximo número da NFe a ser emitida em produção. Calculado automaticamente.</td>
</tr>
<tr>
<td>proximo_numero_nfe_homologacao</td>
<td>numérico</td>
<td></td>
<td>N/A</td>
<td>N/A</td>
<td>Próximo número da NFe a ser emitida em homologação. Calculado automaticamente.</td>
</tr>
<tr>
<td>serie_nfe_producao</td>
<td>numérico</td>
<td></td>
<td>N/A</td>
<td>N/A</td>
<td>Série da NFe a ser emitida em produção. Valor padrão: 1</td>
</tr>
<tr>
<td>serie_nfe_homologacao</td>
<td>numérico</td>
<td></td>
<td>N/A</td>
<td>N/A</td>
<td>Série da NFe a ser emitida em homologação. Valor padrão: 1</td>
</tr>
<tr>
<td>proximo_numero_nfse_producao</td>
<td>numérico</td>
<td>N/A</td>
<td>N/A</td>
<td></td>
<td>Próximo número do RPS da NFSe a ser emitida em produção. Calculado automaticamente.</td>
</tr>
<tr>
<td>proximo_numero_nfse_homologacao</td>
<td>numérico</td>
<td>N/A</td>
<td>N/A</td>
<td></td>
<td>Próximo número do RPS da NFSe a ser emitida em homologação. Calculado automaticamente.</td>
</tr>
<tr>
<td>serie_nfse_producao</td>
<td>numérico</td>
<td>N/A</td>
<td>N/A</td>
<td></td>
<td>Série do RPS para envio de NFSe em produção. Algumas prefeituras não utilizam.</td>
</tr>
<tr>
<td>serie_nfse_homologacao</td>
<td>numérico</td>
<td>N/A</td>
<td>N/A</td>
<td></td>
<td>Série do RPS em homologação.</td>
</tr>
<tr>
<td>arquivo_certificado_base64</td>
<td>texto em base 64</td>
<td>Sim</td>
<td>Sim</td>
<td>Sim*</td>
<td>&quot;Arquivo do certificado digital, em formato PFX ou P12, codificado em base64. Nem todas as prefeituras necessitam de certificado para emissão de NFSe.&quot;</td>
</tr>
<tr>
<td>senha_certificado</td>
<td>texto</td>
<td>Sim</td>
<td>Sim</td>
<td>Sim*</td>
<td>Senha do certificado digital.</td>
</tr>
<tr>
<td>arquivo_logo_base64</td>
<td>texto em base 64</td>
<td></td>
<td></td>
<td></td>
<td>Logomarca da empresa para ser usada na DANFE. Nem todas as prefeituras aceitam o uso de logo. Utilize uma imagem em formato PNG de no máximo 200×200 pixels</td>
</tr>
</tbody></table>
<h2 id='revenda_criacao-de-empresa'>Criação de empresa</h2><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -T empresa.json
  https://api.focusnfe.com.br/v2/empresas
</code></pre>
<p>Uma empresa pode ser criada usando o seguinte endereço</p>

<p><code>https://api.focusnfe.com.br/v2/empresas</code></p>

<p>Caso queira apenas testar a criação de uma empresa, utilize o endereço abaixo:</p>

<p><code>https://api.focusnfe.com.br/v2/empresas?dry_run=1</code></p>

<p>Utilize o comando <strong>HTTP POST</strong>.
O conteúdo do POST deverá conter os dados da empresa. O resultado será os dados da empresa criados ou uma mensagem de erro de validação. É importante salvar o campo id gerado para posterior consulta ou alteração da empresa. Considere o campo &quot;id&quot; como sendo alfanumérico, pois no futuro o formato deverá ser alterado para permitir letras e números na identificação.</p>
<h2 id='revenda_consulta-de-empresas'>Consulta de empresas</h2><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://api.focusnfe.com.br/v2/empresas/123
</code></pre>
<p>Uma empresa pode ser visualizada usando o seguinte endereço</p>

<p><code>https://api.focusnfe.com.br/v2/empresas/ID</code></p>

<p>Onde ID é o id da empresa fornecido no momento da criação. Utilize o comando <strong>HTTP GET</strong>. O resultado será todos os dados da empresa.</p>
<h2 id='revenda_alteracao-de-empresa'>Alteração de empresa</h2><pre class="highlight shell tab-shell"><code>curl -X PUT -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  -T empresa.json
  https://api.focusnfe.com.br/v2/empresas/123
</code></pre>
<p>Uma empresa pode ser alterada usando o seguinte endereço.</p>

<p><code>https://api.focusnfe.com.br/v2/empresas/ID</code></p>

<p>Caso queira apenas testar a alteração de uma empresa, utilize o endereço abaixo:</p>

<p><code>https://api.focusnfe.com.br/v2/empresas?dry_run=1</code></p>

<p>Onde ID é o id da empresa fornecido no momento da criação Utilize o comando <strong>HTTP PUT</strong> para alterar a empresa. O conteúdo do PUT deverá conter os dados da empresa que serão alterados. Os demais dados permanecerão inalterados. O resultado será todos os dados da empresa criados ou uma mensagem de erro de validação. Os dados devem seguir o mesmo formato para criação da empresa.</p>

<p>Atributos que não serão modificados podem ser omitidos.</p>
<h2 id='revenda_listagem-de-empresas'>Listagem de empresas</h2><pre class="highlight shell tab-shell"><code>curl -u <span class="s2">"token obtido no cadastro da empresa:"</span> <span class="se">\</span>
  https://api.focusnfe.com.br/v2/empresas
</code></pre>
<p>É possível listar todas as empresas criadas usando o seguinte método HTTP:</p>

<p><code>https://api.focusnfe.com.br/v2/empresas</code></p>

<p>Utilize o comando <strong>HTTP GET</strong>. O resultado será todos os dados de todas a empresas.</p>
<h2 id='revenda_paginacao'>Paginação</h2>
<p>Ao fazer uma pesquisa, a API irá devolver o cabeçalho HTTP <em>X-Total-Count</em> que representa
o número total de ocorrências da pesquisa, porém a API devolve apenas 50 registros por vez.
Para buscar os demais registros, utilize o parâmetro <strong>offset</strong>. Exemplo:</p>

<p>Vamos supor que a chamada abaixo devolva 123 ocorrências:</p>

<p><code>https://api.focusnfe.com.br/v2/empresas</code></p>

<p>A segunda e terceira páginas da consulta poderão ser acessados desta forma:</p>

<p>Registros 51 a 100:
<code>https://api.focusnfe.com.br/v2/empresas?offset=50</code></p>

<p>Registros 101 a 123:
<code>https://api.focusnfe.com.br/v2/empresas?offset=100</code></p>
<h1 id='limite-de-requisicoes_limite-de-requisicoes'>Limite de requisições</h1>
<p>A API é limitada a 100 créditos/minuto por token de acesso. Cada requisição consome 1 crédito. Isto é válido para requisições de qualquer documento fiscal, para qualquer método. Todas as respostas da API incluem os cabeçalhos abaixo, que descrevem os limites atuais da sua aplicação:</p>

<ul>
<li>Rate-Limit-Limit - Número de créditos para o período atual</li>
<li>Rate-Limit-Remaining - Número de créditos que restam no período atual</li>
<li>Rate-Limit-Reset - Número de segundos até que seja reinicializado o contador de créditos</li>
</ul>

<p>Se o limite é atingido, é devolvido o código status HTTP 429 (Too many requests) e sua aplicação deverá aguardar o término do período (Rate-Limit-Reset) para poder fazer novas requisições.</p>
<h1 id='bibliotecas-externas_bibliotecas-externas'>Bibliotecas externas</h1>
<p>Abaixo disponibilizamos as bibliotecas criadas por nós ou por nossos usuários. Caso tenha criado uma biblioteca e possa compartilha-la entre em contato conosco para a disponibilizarmos aqui.</p>
<h2 id='bibliotecas-externas_java'>Java</h2>
<p><a href="https://github.com/frekele/focusnfe-api-client">https://github.com/frekele/focusnfe-api-client</a> Biblioteca que contempla as APIs de NFe, NFCe, Manifestação, NCM e suporte a gatilhos. Biblioteca criada e gentilmente disponiblizada através da licença MIT por @frekele (Leandro Kersting de Freitas).</p>
<h1 id='codigos-de-exemplo-no-github_codigos-de-exemplo-no-github'>Códigos de exemplo no GitHub</h1>
<p>Você pode consultar os exemplos de códigos nos seguintes repositórios gits:</p>

<ul>
<li><a href="https://github.com/FocusNFe/java">https://github.com/FocusNFe/java</a></li>
<li><a href="https://github.com/FocusNFe/php">https://github.com/FocusNFe/php</a></li>
<li><a href="https://github.com/FocusNFe/javascript">https://github.com/FocusNFe/javascript</a></li>
<li><a href="https://github.com/FocusNFe/ruby">https://github.com/FocusNFe/ruby</a></li>
</ul>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
                <a href="#" data-language-name="php">php</a>
                <a href="#" data-language-name="java">java</a>
                <a href="#" data-language-name="ruby">ruby</a>
                <a href="#" data-language-name="python">python</a>
                <a href="#" data-language-name="javascript">javascript</a>
          </div>
      </div>
    </div>
  </body>
</html>
